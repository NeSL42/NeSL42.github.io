<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>UniswapV2æºç é˜…è¯» - æ•¬æ¸Š&#39;s Blog</title><meta name="author" content="">
<meta name="description" content="è¿™ç³»åˆ—æ–‡ç« å‡†å¤‡è¯¦ç»†çœ‹çœ‹Uniswapçš„ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯ Hardhat
é›¶ã€‚ä¸»è¦å†…å®¹ å½“ç„¶ï¼é˜…è¯» Uniswap V2 æºç æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ä¸»é¢˜ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªéå¸¸æ·±å…¥å’Œå—æ¬¢è¿çš„ç³»åˆ—ã€‚åŸºäºç¬¬ä¸€ç¯‡ã€Šç¯å¢ƒæ­å»ºã€‹ï¼Œåç»­æ–‡ç« å¯ä»¥æŒ‰ç…§ä»æ ¸å¿ƒåˆ°å¤–å›´ã€ä»åŸºç¡€åˆ°å¤æ‚çš„é€»è¾‘å±•å¼€ã€‚
"><meta name="keywords" content='é‡åŒ–'>
  <meta itemprop="name" content="UniswapV2æºç é˜…è¯»">
  <meta itemprop="description" content="è¿™ç³»åˆ—æ–‡ç« å‡†å¤‡è¯¦ç»†çœ‹çœ‹Uniswapçš„ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯ Hardhat
é›¶ã€‚ä¸»è¦å†…å®¹ å½“ç„¶ï¼é˜…è¯» Uniswap V2 æºç æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ä¸»é¢˜ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªéå¸¸æ·±å…¥å’Œå—æ¬¢è¿çš„ç³»åˆ—ã€‚åŸºäºç¬¬ä¸€ç¯‡ã€Šç¯å¢ƒæ­å»ºã€‹ï¼Œåç»­æ–‡ç« å¯ä»¥æŒ‰ç…§ä»æ ¸å¿ƒåˆ°å¤–å›´ã€ä»åŸºç¡€åˆ°å¤æ‚çš„é€»è¾‘å±•å¼€ã€‚">
  <meta itemprop="datePublished" content="2025-09-20T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-09-20T00:00:00+00:00">
  <meta itemprop="wordCount" content="16183">
  <meta itemprop="keywords" content="é‡åŒ–"><meta property="og:url" content="http://localhost:1313/posts/202509-uniswapv2source/">
  <meta property="og:site_name" content="æ•¬æ¸Š&#39;s Blog">
  <meta property="og:title" content="UniswapV2æºç é˜…è¯»">
  <meta property="og:description" content="è¿™ç³»åˆ—æ–‡ç« å‡†å¤‡è¯¦ç»†çœ‹çœ‹Uniswapçš„ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯ Hardhat
é›¶ã€‚ä¸»è¦å†…å®¹ å½“ç„¶ï¼é˜…è¯» Uniswap V2 æºç æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ä¸»é¢˜ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªéå¸¸æ·±å…¥å’Œå—æ¬¢è¿çš„ç³»åˆ—ã€‚åŸºäºç¬¬ä¸€ç¯‡ã€Šç¯å¢ƒæ­å»ºã€‹ï¼Œåç»­æ–‡ç« å¯ä»¥æŒ‰ç…§ä»æ ¸å¿ƒåˆ°å¤–å›´ã€ä»åŸºç¡€åˆ°å¤æ‚çš„é€»è¾‘å±•å¼€ã€‚">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-20T00:00:00+00:00">
    <meta property="article:tag" content="é‡åŒ–">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="UniswapV2æºç é˜…è¯»">
  <meta name="twitter:description" content="è¿™ç³»åˆ—æ–‡ç« å‡†å¤‡è¯¦ç»†çœ‹çœ‹Uniswapçš„ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯ Hardhat
é›¶ã€‚ä¸»è¦å†…å®¹ å½“ç„¶ï¼é˜…è¯» Uniswap V2 æºç æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ä¸»é¢˜ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªéå¸¸æ·±å…¥å’Œå—æ¬¢è¿çš„ç³»åˆ—ã€‚åŸºäºç¬¬ä¸€ç¯‡ã€Šç¯å¢ƒæ­å»ºã€‹ï¼Œåç»­æ–‡ç« å¯ä»¥æŒ‰ç…§ä»æ ¸å¿ƒåˆ°å¤–å›´ã€ä»åŸºç¡€åˆ°å¤æ‚çš„é€»è¾‘å±•å¼€ã€‚">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/posts/202509-uniswapv2source/" title="UniswapV2æºç é˜…è¯» - æ•¬æ¸Š&#39;s Blog" /><link rel="prev" type="text/html" href="http://localhost:1313/posts/202509-clamm/" title="Uniswapæºç åˆ†æï¼šï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º" /><link rel="next" type="text/html" href="http://localhost:1313/posts/apo-04/" title="ã€Šé«˜çº§æŠ•èµ„ç»„åˆä¼˜åŒ–ã€‹é˜…è¯»ç¬”è®°-ç¬¬å››ç« " /><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "UniswapV2æºç é˜…è¯»",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/posts\/202509-uniswapv2source\/"
    },"genre": "posts","keywords": "é‡åŒ–","wordcount":  16183 ,
    "url": "http:\/\/localhost:1313\/posts\/202509-uniswapv2source\/","datePublished": "2025-09-20T00:00:00+00:00","dateModified": "2025-09-20T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "ä½œè€…"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="æ•¬æ¸Š&#39;s Blog"><span class="header-title-text">æ•¬æ¸Š&#39;s Blog</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/">æ–‡ç« </a></li><li class="menu-item">
              <a class="menu-link" href="/tags/">æ ‡ç­¾</a></li><li class="menu-item">
              <a class="menu-link" href="/about/">å…³äº</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/">åˆ†ç±»</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" role="button" aria-label="åˆ‡æ¢ä¸»é¢˜" title="åˆ‡æ¢ä¸»é¢˜"><i class="fa-solid fa-adjust" aria-hidden="true"></i></li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="æ•¬æ¸Š&#39;s Blog"><span class="header-title-text">æ•¬æ¸Š&#39;s Blog</span></a><span class="header-subtitle"></span></div>
      <div class="theme-switch" role="button" aria-label="åˆ‡æ¢ä¸»é¢˜"><i class="fa-solid fa-adjust" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="menu-item"><a class="menu-link" href="/posts/">æ–‡ç« </a></li><li class="menu-item"><a class="menu-link" href="/tags/">æ ‡ç­¾</a></li><li class="menu-item"><a class="menu-link" href="/about/">å…³äº</a></li><li class="menu-item"><a class="menu-link" href="/categories/">åˆ†ç±»</a></li><li class="menu-item menu-system"></li>
      </ul>
    </nav>
  </div>
</header><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="åˆé›†"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>UniswapV2æºç é˜…è¯»</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Anonymous</span></span><span class="post-included-in">&nbsp;æ”¶å½•äº <a href="/categories/technology/" class="post-category" title="åˆ†ç±» - Technology"><i class="fa-regular fa-folder" aria-hidden="true"></i> Technology</a></span></div><div class="post-meta-line"><span title="å‘å¸ƒäº 2025-09-20 00:00:00"><i class="fa-solid fa-calendar-days me-1" aria-hidden="true"></i><time datetime="2025-09-20">2025-09-20</time></span>&nbsp;<span title="16183 å­—"><i class="fa-solid fa-pencil-alt me-1" aria-hidden="true"></i>çº¦ 16200 å­—</span>&nbsp;<span><i class="fa-regular fa-clock me-1" aria-hidden="true"></i>é¢„è®¡é˜…è¯» 33 åˆ†é’Ÿ</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>ç›®å½•</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#uniswapv2-æºç é˜…è¯»ç³»åˆ—æ–‡ç« å¤§çº²"><strong>UniswapV2 æºç é˜…è¯»ç³»åˆ—æ–‡ç« å¤§çº²</strong></a>
          <ul>
            <li><a href="#ç¬¬ä¸€ç¯‡uniswapv2æºç é˜…è¯»ä¸€ç¯å¢ƒæ­å»º"><strong>ç¬¬ä¸€ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º</strong></a></li>
            <li><a href="#ç¬¬äºŒç¯‡uniswapv2æºç é˜…è¯»äºŒå·¥å‚åˆçº¦uniswapv2factory"><strong>ç¬¬äºŒç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäºŒï¼‰å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</strong></a></li>
            <li><a href="#ç¬¬ä¸‰ç¯‡uniswapv2æºç é˜…è¯»ä¸‰é…å¯¹åˆçº¦æ ¸å¿ƒuniswapv2pair"><strong>ç¬¬ä¸‰ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸‰ï¼‰é…å¯¹åˆçº¦æ ¸å¿ƒï¼ˆUniswapV2Pairï¼‰</strong></a></li>
            <li><a href="#ç¬¬å››ç¯‡uniswapv2æºç é˜…è¯»å››ä»·æ ¼é¢„è¨€æœº"><strong>ç¬¬å››ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå››ï¼‰ä»·æ ¼é¢„è¨€æœº</strong></a></li>
            <li><a href="#ç¬¬äº”ç¯‡uniswapv2æºç é˜…è¯»äº”è·¯ç”±åˆçº¦uniswapv2router"><strong>ç¬¬äº”ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäº”ï¼‰è·¯ç”±åˆçº¦ï¼ˆUniswapV2Routerï¼‰</strong></a></li>
            <li><a href="#ç¬¬å…­ç¯‡uniswapv2æºç é˜…è¯»å…­åˆçº¦éƒ¨ç½²ä¸åˆå§‹åŒ–æµç¨‹"><strong>ç¬¬å…­ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå…­ï¼‰åˆçº¦éƒ¨ç½²ä¸åˆå§‹åŒ–æµç¨‹</strong></a></li>
            <li><a href="#ç¬¬ä¸ƒç¯‡uniswapv2æºç é˜…è¯»ä¸ƒé—ªç”µè´·flash-swapåŸç†è§£æ"><strong>ç¬¬ä¸ƒç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸ƒï¼‰é—ªç”µè´·ï¼ˆFlash Swapï¼‰åŸç†è§£æ</strong></a></li>
            <li><a href="#ç¬¬å…«ç¯‡uniswapv2æºç é˜…è¯»ç»ˆæ€»ç»“ä¸å±•æœ›"><strong>ç¬¬å…«ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆç»ˆï¼‰æ€»ç»“ä¸å±•æœ›</strong></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#ä¸€æ•´ä½“æ¶æ„åˆ†å±‚">ä¸€ã€æ•´ä½“æ¶æ„åˆ†å±‚</a>
      <ul>
        <li><a href="#1-æ ¸å¿ƒå±‚core-contracts">1. æ ¸å¿ƒå±‚ï¼ˆCore Contractsï¼‰</a></li>
        <li><a href="#2-åº”ç”¨å±‚periphery-contracts">2. åº”ç”¨å±‚ï¼ˆPeriphery Contractsï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#äºŒæ ¸å¿ƒå±‚åˆçº¦è¯¦è§£">äºŒã€æ ¸å¿ƒå±‚åˆçº¦è¯¦è§£</a>
      <ul>
        <li><a href="#1-å·¥å‚åˆçº¦uniswapv2factory">1. å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</a></li>
        <li><a href="#2-äº¤æ˜“å¯¹åˆçº¦uniswapv2pair">2. äº¤æ˜“å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰</a></li>
        <li><a href="#3-æµåŠ¨æ€§ä»£å¸åˆçº¦uniswapv2erc20">3. æµåŠ¨æ€§ä»£å¸åˆçº¦ï¼ˆUniswapV2ERC20ï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶">ä¸‰ã€åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶</a>
      <ul>
        <li><a href="#è·¯ç”±åˆçº¦uniswapv2router02">è·¯ç”±åˆçº¦ï¼ˆUniswapV2Router02ï¼‰</a></li>
        <li><a href="#åº“åˆçº¦library-contracts">åº“åˆçº¦ï¼ˆLibrary Contractsï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#å››åˆçº¦äº¤äº’æµç¨‹">å››ã€åˆçº¦äº¤äº’æµç¨‹</a></li>
    <li><a href="#äº”å…³é”®è®¾è®¡æ€æƒ³">äº”ã€å…³é”®è®¾è®¡æ€æƒ³</a></li>
  </ul>

  <ul>
    <li><a href="#1-å·¥å‚åˆçº¦ç®€ä»‹">1. å·¥å‚åˆçº¦ç®€ä»‹</a></li>
    <li><a href="#2-æºç é˜…è¯»">2. æºç é˜…è¯»</a>
      <ul>
        <li><a href="#21-å…³é”®å˜é‡">2.1 å…³é”®å˜é‡</a></li>
        <li><a href="#22-å‡½æ•°åˆ—è¡¨ä¸è§£æ">2.2 å‡½æ•°åˆ—è¡¨ä¸è§£æ</a>
          <ul>
            <li><a href="#221-constructoraddress-_feetosetter-public">2.2.1. <code>constructor(address _feeToSetter) public</code></a></li>
            <li><a href="#222-setfeetoaddress-_feeto-external">2.2.2. <code>setFeeTo(address _feeTo) external</code></a></li>
            <li><a href="#223-setfeetosetteraddress-_feetosetter-external">2.2.3. <code>setFeeToSetter(address _feeToSetter) external</code></a></li>
            <li><a href="#224-allpairslength-external-view-returns-uint">2.2.4. <code>allPairsLength() external view returns (uint)</code></a></li>
            <li><a href="#225-createpairaddress-tokena-address-tokenb-external-returns-address-pair">2.2.5. <code>createPair(address tokenA, address tokenB) external returns (address pair)</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-æœ¬åœ°æµ‹è¯•éªŒè¯">3. æœ¬åœ°æµ‹è¯•éªŒè¯</a>
      <ul>
        <li><a href="#31-éƒ¨ç½²å·¥å‚åˆçº¦">3.1 éƒ¨ç½²å·¥å‚åˆçº¦</a></li>
        <li><a href="#32-åˆ›å»ºåˆçº¦å¯¹å¹¶ç›‘å¬äº‹ä»¶">3.2 åˆ›å»ºåˆçº¦å¯¹å¹¶ç›‘å¬äº‹ä»¶</a></li>
        <li><a href="#33-ä¿®æ”¹-feetosetter">3.3 ä¿®æ”¹ feeToSetter</a></li>
      </ul>
    </li>
    <li><a href="#4-å°ç»“">4. å°ç»“</a></li>
  </ul>

  <ul>
    <li><a href="#1-äº¤æ˜“å¯¹åˆçº¦uniswapv2pairç®€è¿°">1. äº¤æ˜“å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰ç®€è¿°</a></li>
    <li><a href="#2-æºç é˜…è¯»-1">2. æºç é˜…è¯»</a>
      <ul>
        <li><a href="#21-æ ¸å¿ƒçŠ¶æ€å˜é‡">2.1 æ ¸å¿ƒçŠ¶æ€å˜é‡</a></li>
        <li><a href="#22-getreserves">2.2 getReserves()</a></li>
        <li><a href="#23-getreserves">2.3 getReserves()</a></li>
        <li><a href="#24-_update">2.4 _update()</a></li>
        <li><a href="#24-_mintfee">2.4 _mintFee()</a>
          <ul>
            <li><a href="#241-uniswap-v2-åè®®æ‰‹ç»­è´¹-protocol_fee-æœºåˆ¶">2.4.1 Uniswap V2 åè®®æ‰‹ç»­è´¹ (PROTOCOL_FEE) æœºåˆ¶</a>
              <ul>
                <li><a href="#2411-é¡¹ç›®æ–¹çš„éœ€æ±‚">2.4.1.1 <strong>é¡¹ç›®æ–¹çš„éœ€æ±‚</strong></a></li>
                <li><a href="#2412-phi-phi-å‚æ•°">2.4.1.2 <code>phi</code> ($\phi$) å‚æ•°</a></li>
                <li><a href="#2413-å®ç°æ–¹å¼å¢å‘-share">2.4.1.3 å®ç°æ–¹å¼ï¼šå¢å‘ Share</a></li>
                <li><a href="#2414-æ•°å­¦æ¨å¯¼sm-çš„è®¡ç®—">2.4.1.4 æ•°å­¦æ¨å¯¼ï¼š<code>SM</code> çš„è®¡ç®—</a></li>
              </ul>
            </li>
            <li><a href="#242-ä»£ç å®ç°">2.4.2 ä»£ç å®ç°</a></li>
          </ul>
        </li>
        <li><a href="#25-mint">2.5 mint()</a></li>
        <li><a href="#26-burn">2.6 burn()</a></li>
        <li><a href="#27-swap">2.7 swap</a></li>
        <li><a href="#3-æµ‹è¯•">3. æµ‹è¯•</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>è¿™ç³»åˆ—æ–‡ç« å‡†å¤‡è¯¦ç»†çœ‹çœ‹Uniswapçš„ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯ <code>Hardhat</code></p>
<h1 class="heading-element" id="é›¶ä¸»è¦å†…å®¹"><span>é›¶ã€‚ä¸»è¦å†…å®¹</span>
  <a href="#%e9%9b%b6%e4%b8%bb%e8%a6%81%e5%86%85%e5%ae%b9" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>å½“ç„¶ï¼é˜…è¯» Uniswap V2 æºç æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ä¸»é¢˜ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªéå¸¸æ·±å…¥å’Œå—æ¬¢è¿çš„ç³»åˆ—ã€‚åŸºäºç¬¬ä¸€ç¯‡ã€Šç¯å¢ƒæ­å»ºã€‹ï¼Œåç»­æ–‡ç« å¯ä»¥æŒ‰ç…§ä»æ ¸å¿ƒåˆ°å¤–å›´ã€ä»åŸºç¡€åˆ°å¤æ‚çš„é€»è¾‘å±•å¼€ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯è¡Œçš„ç³»åˆ—æ–‡ç« å¤§çº²ï¼Œæ¯ä¸€ç¯‡éƒ½èšç„¦äºä¸€ä¸ªå¯éªŒè¯ã€å¯æ“ä½œçš„å…·ä½“æ¨¡å—æˆ–åŠŸèƒ½ï¼š</p>
<h3 class="heading-element" id="uniswapv2-æºç é˜…è¯»ç³»åˆ—æ–‡ç« å¤§çº²"><span><strong>UniswapV2 æºç é˜…è¯»ç³»åˆ—æ–‡ç« å¤§çº²</strong></span>
  <a href="#uniswapv2-%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e7%b3%bb%e5%88%97%e6%96%87%e7%ab%a0%e5%a4%a7%e7%ba%b2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 class="heading-element" id="ç¬¬ä¸€ç¯‡uniswapv2æºç é˜…è¯»ä¸€ç¯å¢ƒæ­å»º"><span><strong>ç¬¬ä¸€ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º</strong></span>
  <a href="#%e7%ac%ac%e4%b8%80%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%b8%80%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><em>(å·²å®Œæˆ)</em></p>
<ul>
<li><strong>å†…å®¹</strong>ï¼šå¦‚ä½•å…‹éš†ä»£ç ã€å®‰è£…ä¾èµ–ã€é…ç½® Hardhat æœ¬åœ°å¼€å‘ç¯å¢ƒã€è¿è¡Œæµ‹è¯•èŠ‚ç‚¹å’ŒåŸºç¡€è„šæœ¬ã€‚</li>
<li><strong>ç›®æ ‡</strong>ï¼šè®©è¯»è€…æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥ç¼–è¯‘ã€éƒ¨ç½²å’Œäº¤äº’çš„æœ¬åœ°å®éªŒç¯å¢ƒã€‚</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬äºŒç¯‡uniswapv2æºç é˜…è¯»äºŒå·¥å‚åˆçº¦uniswapv2factory"><span><strong>ç¬¬äºŒç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäºŒï¼‰å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</strong></span>
  <a href="#%e7%ac%ac%e4%ba%8c%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%ba%8c%e5%b7%a5%e5%8e%82%e5%90%88%e7%ba%a6uniswapv2factory" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>å‰–æ <code>UniswapV2Factory.sol</code>ï¼šæ„é€ å‡½æ•°ã€çŠ¶æ€å˜é‡ï¼ˆ<code>feeTo</code>, <code>feeToSetter</code>, <code>getPair</code> æ˜ å°„ï¼‰ã€‚</li>
<li>æ·±å…¥ <code>createPair</code> å‡½æ•°ï¼šå¦‚ä½•é€šè¿‡ <code>bytescode</code> å’Œ <code>create2</code> æ“ä½œç ç¡®å®šæ€§åœ°åˆ›å»ºé…å¯¹åˆçº¦ã€‚</li>
<li>è§’è‰²æƒé™ï¼š<code>feeToSetter</code> çš„æƒé™å’Œä½œç”¨ï¼ˆä¸ºåè®®æ”¶è´¹è®¾ç½®æ¥æ”¶åœ°å€ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å¯æ“ä½œå®è·µ</strong>ï¼š
<ul>
<li>å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½¿ç”¨ Factory åˆçº¦åœ¨æœ¬åœ°ç½‘ç»œä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„äº¤æ˜“å¯¹ï¼ˆå¦‚ WETH/USDTï¼‰ã€‚</li>
<li>éªŒè¯ <code>getPair</code> æ˜ å°„æ˜¯å¦æ­£ç¡®æ›´æ–°ã€‚</li>
<li>æŸ¥è¯¢åˆ›å»ºçš„ Pair åˆçº¦åœ°å€ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬ä¸‰ç¯‡uniswapv2æºç é˜…è¯»ä¸‰é…å¯¹åˆçº¦æ ¸å¿ƒuniswapv2pair"><span><strong>ç¬¬ä¸‰ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸‰ï¼‰é…å¯¹åˆçº¦æ ¸å¿ƒï¼ˆUniswapV2Pairï¼‰</strong></span>
  <a href="#%e7%ac%ac%e4%b8%89%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%b8%89%e9%85%8d%e5%af%b9%e5%90%88%e7%ba%a6%e6%a0%b8%e5%bf%83uniswapv2pair" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>åˆçº¦ç»“æ„ï¼šçŠ¶æ€å˜é‡ï¼ˆ<code>reserve0</code>, <code>reserve1</code>, <code>blockTimestampLast</code>, <code>price0CumulativeLast</code>ï¼‰ã€‚</li>
<li>æ ¸å¿ƒåŠŸèƒ½ï¼š<code>mint</code> (æ·»åŠ æµåŠ¨æ€§), <code>burn</code> (ç§»é™¤æµåŠ¨æ€§), <code>swap</code> (äº¤æ˜“)ã€‚</li>
<li>æ·±å…¥ç†è§£ <code>_update</code> å‡½æ•°ï¼šå¦‚ä½•æ›´æ–°å‡†å¤‡é‡‘å¹¶ç´¯ç§¯ä»·æ ¼ã€‚</li>
</ul>
</li>
<li><strong>å¯æ“ä½œå®è·µ</strong>ï¼š
<ul>
<li>åœ¨ä¸Šä¸€ç¯‡åˆ›å»ºçš„ Pair åˆçº¦ä¸­ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œ <code>mint</code> å’Œ <code>swap</code> æ“ä½œã€‚</li>
<li>ç¼–å†™è„šæœ¬æŸ¥è¯¢äº¤æ˜“å‰åçš„å‚¨å¤‡é‡‘å˜åŒ–ï¼Œç›´è§‚ç†è§£ AMM åšå¸‚ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬å››ç¯‡uniswapv2æºç é˜…è¯»å››ä»·æ ¼é¢„è¨€æœº"><span><strong>ç¬¬å››ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå››ï¼‰ä»·æ ¼é¢„è¨€æœº</strong></span>
  <a href="#%e7%ac%ac%e5%9b%9b%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%9b%9b%e4%bb%b7%e6%a0%bc%e9%a2%84%e8%a8%80%e6%9c%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>åŸç†é˜è¿°ï¼šå¦‚ä½•é€šè¿‡â€œç´¯ç§¯ä»·æ ¼â€æä¾›é˜²æ“çºµçš„é“¾ä¸Šä»·æ ¼æ•°æ®ã€‚</li>
<li>ä»£ç åˆ†æï¼š<code>price0CumulativeLast</code> å’Œ <code>price1CumulativeLast</code> çš„è®¡ç®—æ–¹å¼ã€‚</li>
<li>ç²¾åº¦ä¸æ—¶é—´çª—å£ï¼šè®²è§£ <code>UQ112x112</code> åº“å¦‚ä½•ç”¨ 224 ä½å­˜å‚¨æµ®ç‚¹æ•°ï¼Œä»¥åŠæ—¶é—´å·®å¯¹ä»·æ ¼è®¡ç®—çš„å½±å“ã€‚</li>
</ul>
</li>
<li><strong>å¯æ“ä½œå®è·µ</strong>ï¼š
<ul>
<li>åœ¨å‡ æ¬¡ <code>swap</code> æ“ä½œåï¼Œç¼–å†™è„šæœ¬è®¡ç®—æŒ‡å®šæ—¶é—´çª—å£å†…çš„å¹³å‡ä»·æ ¼ã€‚</li>
<li>ä¸ Chainlink ç­‰é¢„è¨€æœºè¿›è¡Œç®€å•å¯¹æ¯”ï¼Œç†è§£å…¶ä¼˜ç¼ºç‚¹ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬äº”ç¯‡uniswapv2æºç é˜…è¯»äº”è·¯ç”±åˆçº¦uniswapv2router"><span><strong>ç¬¬äº”ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäº”ï¼‰è·¯ç”±åˆçº¦ï¼ˆUniswapV2Routerï¼‰</strong></span>
  <a href="#%e7%ac%ac%e4%ba%94%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%ba%94%e8%b7%af%e7%94%b1%e5%90%88%e7%ba%a6uniswapv2router" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>è§’è‰²å®šä½ï¼šä¸ºä»€ä¹ˆéœ€è¦ Routerï¼Ÿå®ƒæ˜¯ç”¨æˆ·çš„å…¥å£ï¼Œè´Ÿè´£å¤„ç†å¤æ‚çš„äº¤æ˜“è·¯å¾„å’Œ ETH åŒ…è£…ã€‚</li>
<li>æ ¸å¿ƒå‡½æ•°ï¼š<code>addLiquidity</code>, <code>removeLiquidity</code>, <code>swapExactTokensForTokens</code>ã€‚</li>
<li>å®‰å…¨æ€§ï¼š<code>deadline</code> å‚æ•°çš„ä½œç”¨ã€é˜²æ­¢å‰ç«¯è¿è¡Œï¼ˆFront-runningï¼‰çš„æœºåˆ¶ã€‚</li>
</ul>
</li>
<li><strong>å¯æ“ä½œå®è·µ</strong>ï¼š
<ul>
<li>ç¼–å†™è„šæœ¬ï¼Œé€šè¿‡ Router åˆçº¦å®Œæˆä¸€æ¬¡å®Œæ•´çš„â€œæ·»åŠ æµåŠ¨æ€§ -&gt; äº¤æ˜“ -&gt; ç§»é™¤æµåŠ¨æ€§â€æµç¨‹ã€‚</li>
<li>å¯¹æ¯”ç›´æ¥è°ƒç”¨ Pair åˆçº¦å’Œé€šè¿‡ Router åˆçº¦çš„å·®å¼‚ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬å…­ç¯‡uniswapv2æºç é˜…è¯»å…­åˆçº¦éƒ¨ç½²ä¸åˆå§‹åŒ–æµç¨‹"><span><strong>ç¬¬å…­ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå…­ï¼‰åˆçº¦éƒ¨ç½²ä¸åˆå§‹åŒ–æµç¨‹</strong></span>
  <a href="#%e7%ac%ac%e5%85%ad%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%85%ad%e5%90%88%e7%ba%a6%e9%83%a8%e7%bd%b2%e4%b8%8e%e5%88%9d%e5%a7%8b%e5%8c%96%e6%b5%81%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>å®Œæ•´å¤ç›˜ï¼šä»é›¶å¼€å§‹éƒ¨ç½²å…¨å¥— Uniswap V2 åˆçº¦çš„æ­¥éª¤ã€‚</li>
<li>é¡ºåºä¾èµ–ï¼šå…ˆéƒ¨ç½² <code>WETH</code> -&gt; å†éƒ¨ç½² <code>Factory</code> -&gt; è®¾ç½® <code>FeeTo</code> -&gt; éƒ¨ç½² <code>Router</code>ã€‚</li>
<li>æƒé™ç®¡ç†ï¼š<code>feeToSetter</code> åœ°å€çš„è½¬ç§»å’Œå¤šç­¾è®¾ç½®æœ€ä½³å®è·µã€‚</li>
</ul>
</li>
<li><strong>å¯æ“ä½œå®è·µ</strong>ï¼š
<ul>
<li>ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„éƒ¨ç½²è„šæœ¬ï¼Œä¸€æ¬¡æ€§åœ¨æœ¬åœ°æˆ–æµ‹è¯•ç½‘éƒ¨ç½²æ‰€æœ‰åˆçº¦ã€‚</li>
<li>éªŒè¯æ•´å¥—ç³»ç»Ÿèƒ½å¦æ­£å¸¸å·¥ä½œã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬ä¸ƒç¯‡uniswapv2æºç é˜…è¯»ä¸ƒé—ªç”µè´·flash-swapåŸç†è§£æ"><span><strong>ç¬¬ä¸ƒç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸ƒï¼‰é—ªç”µè´·ï¼ˆFlash Swapï¼‰åŸç†è§£æ</strong></span>
  <a href="#%e7%ac%ac%e4%b8%83%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%b8%83%e9%97%aa%e7%94%b5%e8%b4%b7flash-swap%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>æ¦‚å¿µè®²è§£ï¼šä»€ä¹ˆæ˜¯é—ªç”µè´·ï¼Ÿä¸ Aave ç­‰å¹³å°çš„é—ªç”µè´·åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ä»£ç è¿½è¸ªï¼šå‰–æ <code>swap</code> å‡½æ•°ä¸­çš„ <code>data</code> å‚æ•°å’Œ <code>uniswapV2Call</code> å›è°ƒæœºåˆ¶ã€‚</li>
<li>åº”ç”¨åœºæ™¯ï¼šå¥—åˆ©ã€è‡ªæˆ‘æ¸…ç®—ã€æ— æŠµæŠ¼è´·æ¬¾ã€‚</li>
</ul>
</li>
<li><strong>å¯æ“ä½œå®è·µ</strong>ï¼š
<ul>
<li>ç¼–å†™ä¸€ä¸ªå¯æ‰§è¡Œé—ªç”µè´·çš„åˆçº¦ã€‚</li>
<li>è®¾è®¡ä¸€ä¸ªå¥—åˆ©åœºæ™¯ï¼Œå¹¶ç¼–å†™è„šæœ¬æ¼”ç¤ºä¸€æ¬¡æˆåŠŸçš„é—ªç”µè´·å¥—åˆ©æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<hr>
<h4 class="heading-element" id="ç¬¬å…«ç¯‡uniswapv2æºç é˜…è¯»ç»ˆæ€»ç»“ä¸å±•æœ›"><span><strong>ç¬¬å…«ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆç»ˆï¼‰æ€»ç»“ä¸å±•æœ›</strong></span>
  <a href="#%e7%ac%ac%e5%85%ab%e7%af%87uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e7%bb%88%e6%80%bb%e7%bb%93%e4%b8%8e%e5%b1%95%e6%9c%9b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li><strong>æ ¸å¿ƒå†…å®¹</strong>ï¼š
<ul>
<li>æ¶æ„æ€»ç»“ï¼šå›é¡¾æ ¸å¿ƒåˆçº¦ä¹‹é—´çš„äº¤äº’å…³ç³»å’Œæ•°æ®æµå‘ã€‚</li>
<li>å®‰å…¨è®¾è®¡ï¼šé‡å…¥é”ã€ç²¾åº¦å¤„ç†ã€æƒé™æ§åˆ¶ç­‰å®‰å…¨è€ƒè™‘ã€‚</li>
<li>ç»æµæ¨¡å‹ï¼š0.3% æ‰‹ç»­è´¹çš„å»å‘ï¼ˆLP æä¾›è€… vs. åè®®ï¼‰ã€‚</li>
<li>å¯¹æ¯” V3ï¼šç®€è¦ä»‹ç» V3 çš„é›†ä¸­æµåŠ¨æ€§ç­‰åˆ›æ–°ï¼Œä½œä¸ºç³»åˆ—çš„å»¶ä¼¸ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸ªç»“æ„ä»æ˜“åˆ°éš¾ï¼Œæ¯ä¸€ç¯‡éƒ½å»ºç«‹åœ¨ä¸Šä¸€ç¯‡çš„åŸºç¡€ä¸Šï¼Œå¹¶ä¸”æ¯ä¸€ç¯‡éƒ½æœ‰å…·ä½“çš„ä»£ç å’Œå®æ“ç¯èŠ‚ï¼Œé¿å…äº†çº¯ç†è®ºåˆ†æï¼Œå®Œå…¨ç¬¦åˆä½ â€œä¸€å®šè¦å¯è¡Œâ€çš„è¦æ±‚ã€‚ç¥ä½ å†™ä½œé¡ºåˆ©ï¼è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„ç³»åˆ—ã€‚</p>
<h1 class="heading-element" id="ä¸€ç¯å¢ƒæ­å»º"><span>ä¸€ã€ç¯å¢ƒæ­å»º</span>
  <a href="#%e4%b8%80%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>è¿™æ˜¯ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²ç¯å¢ƒæ­å»ºå’Œéƒ¨ç½²çš„éƒ¨åˆ†ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨ <code>npm</code> å®‰è£… <code>hardhat</code></p>
<p>æ¥ä¸‹æ¥åˆå§‹åŒ– Hardhat é¡¹ç›®</p>
<ol>
<li>åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥</li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir UniswapV2_SourceRead
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> UniswapV2_SourceRead</span></span></code></pre></div></div><ol start="2">
<li>åˆå§‹åŒ– Hardhat é¡¹ç›®</li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% npx hardhat --init
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                         â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ                  â–ˆâ–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</span></span><span class="line"><span class="cl">â–‘â–‘â–ˆâ–ˆâ–ˆ  â–‘â–‘â–ˆâ–ˆâ–ˆ                         â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ                 â–‘â–ˆâ–ˆâ–ˆ     â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ
</span></span><span class="line"><span class="cl"> â–‘â–ˆâ–ˆâ–ˆ   â–‘â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ–ˆ
</span></span><span class="line"><span class="cl"> â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ  â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘      â–ˆâ–ˆâ–ˆâ–ˆâ–‘
</span></span><span class="line"><span class="cl"> â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘ â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–ˆ      â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆ
</span></span><span class="line"><span class="cl"> â–‘â–ˆâ–ˆâ–ˆ   â–‘â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆ
</span></span><span class="line"><span class="cl"> â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</span></span><span class="line"><span class="cl">â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘      â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘â–‘â–‘    â–‘â–‘â–‘â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">ğŸ‘· Welcome to Hardhat v3.0.6 ğŸ‘·
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">âœ” Which version of Hardhat would you like to use? Â· hardhat-2
</span></span><span class="line"><span class="cl">âœ” Where would you like to initialize the project?
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Please provide either a relative or an absolute path: Â· .
</span></span><span class="line"><span class="cl">âœ” What <span class="nb">type</span> of project would you like to initialize? Â· mocha-ethers-js
</span></span><span class="line"><span class="cl">âœ¨ Template files copied âœ¨
</span></span><span class="line"><span class="cl">âœ” You need to install the necessary dependencies using the following command:
</span></span><span class="line"><span class="cl">npm install --save-dev <span class="s2">&#34;@nomicfoundation/hardhat-chai-matchers@^2.0.0&#34;</span> <span class="s2">&#34;@nomicfoundation/hardhat-ethers@^3.0.0&#34;</span> <span class="s2">&#34;@nomicfoundation/hardhat-ignition@^0.15.0&#34;</span> <span class="s2">&#34;@nomicfoundation/hardhat-ignition-ethers@^0.15.0&#34;</span> <span class="s2">&#34;@nomicfoundation/hardhat-network-helpers@^1.0.0&#34;</span> <span class="s2">&#34;@nomicfoundation/hardhat-toolbox@^6.0.0&#34;</span> <span class="s2">&#34;@nomicfoundation/hardhat-verify@^2.0.0&#34;</span> <span class="s2">&#34;@typechain/ethers-v6@^0.5.0&#34;</span> <span class="s2">&#34;@typechain/hardhat@^9.0.0&#34;</span> <span class="s2">&#34;chai@^4.2.0&#34;</span> <span class="s2">&#34;ethers@^6.4.0&#34;</span> <span class="s2">&#34;hardhat@^2.14.0&#34;</span> <span class="s2">&#34;hardhat-gas-reporter@^2.3.0&#34;</span> <span class="s2">&#34;solidity-coverage@^0.8.0&#34;</span> <span class="s2">&#34;typechain@^8.3.0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Do you want to run it now? <span class="o">(</span>Y/n<span class="o">)</span> Â· <span class="nb">true</span>
</span></span><span class="line"><span class="cl">....</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>ä¸‹è½½Uniswap V2çš„æºç å¹¶å®‰è£…ç›¸åº”çš„ä¾èµ–</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">npm install @uniswap/lib
</span></span><span class="line"><span class="cl">npm install @uniswap/v2-core
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git clone https://github.com/Uniswap/uniswap-v2-core.git
</span></span><span class="line"><span class="cl">git clone https://github.com/Uniswap/uniswap-v2-periphery.git
</span></span><span class="line"><span class="cl">mv uniswap-v2-core contracts/
</span></span><span class="line"><span class="cl">mv uniswap-v2-periphery contracts/</span></span></code></pre></div></div><p>ä¿®æ”¹<code>hardhat.config.js</code>ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-js"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@nomicfoundation/hardhat-toolbox&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** @type import(&#39;hardhat/config&#39;).HardhatUserConfig */</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">solidity</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compilers</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç”¨äº uniswap-v2-core
</span></span></span><span class="line"><span class="cl">        <span class="nx">version</span><span class="o">:</span> <span class="s2">&#34;0.5.16&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">optimizer</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">runs</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç”¨äº uniswap-v2-periphery
</span></span></span><span class="line"><span class="cl">        <span class="nx">version</span><span class="o">:</span> <span class="s2">&#34;0.6.6&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">optimizer</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">runs</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">networks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hardhat</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// é»˜è®¤è®¾ç½®ï¼Œå¯ä»¥ä¸å†™
</span></span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>ç„¶åç¼–è¯‘ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% npx hardhat compile                       
</span></span><span class="line"><span class="cl">Compiled <span class="m">43</span> Solidity files successfully <span class="o">(</span>evm target: istanbul<span class="o">)</span>.</span></span></code></pre></div></div><p>æ¥ä¸‹æ¥å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„ä»¥å¤ªåŠæµ‹è¯•ç½‘ç»œï¼Œé»˜è®¤åˆ›å»º â€‹20 ä¸ªæµ‹è¯•è´¦æˆ·ï¼Œå¹¶ä¸ºæ¯ä¸ªè´¦æˆ·é¢„åˆ†é… â€‹10,000 ä¸ªå‡çš„ ETHï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% npx hardhat node
</span></span><span class="line"><span class="cl">Started HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">Accounts</span>
</span></span><span class="line"><span class="cl"><span class="o">========</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">WARNING: These accounts, and their private keys, are publicly known.
</span></span><span class="line"><span class="cl">Any funds sent to them on Mainnet or any other live network WILL BE LOST.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#0: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#1: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#2: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#3: 0x90F79bf6EB2c4f870365E785982E1f101E93b906 (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#4: 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#5: 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x8b3a350cf5c34c9194ca85829a2df0ec3153be0318b5e2d3348e872092edffba
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#6: 0x976EA74026E726554dB657fA54763abd0C3a0aa9 (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x92db14e403b83dfe3df233f83dfa3a0d7096f21ca9b0d6d6b8d88b2b4ec1564e
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Account <span class="c1">#7: 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 (10000 ETH)</span>
</span></span><span class="line"><span class="cl">Private Key: 0x4bbbf85ce3377467afe5d46f804f221813b2bb87f24d81f60f1fcdbf7cbf4356
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>å†™ä¸ªæµ‹è¯•çš„ä»£ç ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-js"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// scripts/sc.js
</span></span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hardhat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;ğŸ” è·å–æœ¬åœ°ç½‘ç»œè´¦æˆ·ä¿¡æ¯...\n&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è·å–æ‰€æœ‰è´¦æˆ·ï¼ˆåŒ…æ‹¬éƒ¨ç½²è€…ï¼‰
</span></span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">accounts</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">provider</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸ“ å…±æ‰¾åˆ° </span><span class="si">${</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> ä¸ªè´¦æˆ·\n`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è·å–éƒ¨ç½²è€…è´¦æˆ·ï¼ˆç¬¬ä¸€ä¸ªè´¦æˆ·ï¼‰
</span></span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">deployer</span> <span class="o">=</span> <span class="nx">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">deployerBalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;ğŸ‘¤ éƒ¨ç½²è€…è´¦æˆ·:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   åœ°å€: </span><span class="si">${</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   ä½™é¢: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">deployerBalance</span><span class="p">)</span><span class="si">}</span><span class="sb"> ETH\n`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è·å–æ‰€æœ‰æµ‹è¯•è´¦æˆ·åŠå…¶ä½™é¢
</span></span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;ğŸ‘¥ æ‰€æœ‰æµ‹è¯•è´¦æˆ·:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">accounts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">accounts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">balance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   </span><span class="si">${</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="sb">. åœ°å€: </span><span class="si">${</span><span class="nx">account</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`      ä½™é¢: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">balance</span><span class="p">)</span><span class="si">}</span><span class="sb"> ETH`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\nâœ… è´¦æˆ·ä¿¡æ¯è·å–å®Œæˆ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰§è¡Œå¹¶å¤„ç†é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="nx">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>è¿è¡Œè„šæœ¬ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% npx hardhat run scripts/sc.js --network localhost
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ğŸ” è·å–æœ¬åœ°ç½‘ç»œè´¦æˆ·ä¿¡æ¯...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ğŸ“ å…±æ‰¾åˆ° <span class="m">20</span> ä¸ªè´¦æˆ·
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ğŸ‘¤ éƒ¨ç½²è€…è´¦æˆ·:
</span></span><span class="line"><span class="cl">   åœ°å€: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">   ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ğŸ‘¥ æ‰€æœ‰æµ‹è¯•è´¦æˆ·:
</span></span><span class="line"><span class="cl">   1. åœ°å€: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   2. åœ°å€: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   3. åœ°å€: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   4. åœ°å€: 0x90F79bf6EB2c4f870365E785982E1f101E93b906
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   5. åœ°å€: 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   6. åœ°å€: 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   7. åœ°å€: 0x976EA74026E726554dB657fA54763abd0C3a0aa9
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   8. åœ°å€: 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   9. åœ°å€: 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   10. åœ°å€: 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   11. åœ°å€: 0xBcd4042DE499D14e55001CcbB24a551F3b954096
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   12. åœ°å€: 0x71bE63f3384f5fb98995898A86B02Fb2426c5788
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   13. åœ°å€: 0xFABB0ac9d68B0B445fB7357272Ff202C5651694a
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   14. åœ°å€: 0x1CBd3b2770909D4e10f157cABC84C7264073C9Ec
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   15. åœ°å€: 0xdF3e18d64BC6A983f673Ab319CCaE4f1a57C7097
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   16. åœ°å€: 0xcd3B766CCDd6AE721141F452C550Ca635964ce71
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   17. åœ°å€: 0x2546BcD3c84621e976D8185a91A922aE77ECEc30
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   18. åœ°å€: 0xbDA5747bFD65F08deb54cb465eB87D40e51B197E
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   19. åœ°å€: 0xdD2FD4581271e230360230F9337D5c0430Bf44C0
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">   20. åœ°å€: 0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199
</span></span><span class="line"><span class="cl">      ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">âœ… è´¦æˆ·ä¿¡æ¯è·å–å®Œæˆ</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h1 class="heading-element" id="uniswapv2æºç é˜…è¯»äºŒåˆçº¦æ¶æ„"><span>UniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäºŒï¼‰åˆçº¦æ¶æ„</span>
  <a href="#uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%ba%8c%e5%90%88%e7%ba%a6%e6%9e%b6%e6%9e%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><h2 class="heading-element" id="ä¸€æ•´ä½“æ¶æ„åˆ†å±‚"><span>ä¸€ã€æ•´ä½“æ¶æ„åˆ†å±‚</span>
  <a href="#%e4%b8%80%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84%e5%88%86%e5%b1%82" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Uniswap V2 çš„åˆçº¦æ¶æ„é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œå°†æ ¸å¿ƒå±‚ï¼ˆCoreï¼‰ä¸åº”ç”¨å±‚ï¼ˆPeripheryï¼‰åˆ†ç¦»ï¼Œæ—¢ä¿è¯äº†èµ„é‡‘å®‰å…¨åˆæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æœ¬æ–‡å°†ç³»ç»Ÿä»‹ç» Uniswap V2 çš„æ•´ä½“åˆçº¦æ¶æ„ï¼Œä¸ºåç»­æ·±å…¥åˆ†æå„åˆçº¦ç»†èŠ‚å¥ å®šåŸºç¡€ã€‚</p>
<h3 class="heading-element" id="1-æ ¸å¿ƒå±‚core-contracts"><span>1. æ ¸å¿ƒå±‚ï¼ˆCore Contractsï¼‰</span>
  <a href="#1-%e6%a0%b8%e5%bf%83%e5%b1%82core-contracts" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li><strong>å®šä½</strong>ï¼šç›´æ¥ç®¡ç†ç”¨æˆ·èµ„äº§çš„åŸºç¡€åˆçº¦ï¼Œä»£ç é«˜åº¦ç²¾ç®€ï¼Œä»…åŒ…å«åè®®è¿è¡Œæ‰€å¿…éœ€çš„æœ€å°åŠŸèƒ½é›†ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå®‰å…¨è‡³ä¸Šã€åŠŸèƒ½æœ€å°åŒ–ã€‚æ‰€æœ‰ç”¨æˆ·èµ„é‡‘å’ŒæµåŠ¨æ€§å‡ç”±æ ¸å¿ƒåˆçº¦ç›´æ¥æŒæœ‰ï¼Œå› æ­¤å…¶é€»è¾‘å¿…é¡»å°½å¯èƒ½ç®€å•ï¼Œä»¥æœ€å¤§é™åº¦å‡å°‘æ”»å‡»é¢å’Œæ½œåœ¨æ¼æ´ã€‚</li>
<li><strong>èŒè´£</strong>ï¼šå®ç°è‡ªåŠ¨åšå¸‚å•†ï¼ˆAMMï¼‰çš„æ ¸å¿ƒæœºåˆ¶ï¼ŒåŒ…æ‹¬äº¤æ˜“å¯¹åˆ›å»ºã€æµåŠ¨æ€§ç®¡ç†ã€ä»£å¸å…‘æ¢ã€LP ä»£å¸å‘è¡Œç­‰ã€‚</li>
<li><strong>æ ¸å¿ƒåˆçº¦</strong>ï¼š
<ul>
<li><code>UniswapV2Factory</code>ï¼šäº¤æ˜“å¯¹å·¥å‚åˆçº¦ï¼Œè´Ÿè´£åˆ›å»ºå’Œæ³¨å†Œäº¤æ˜“å¯¹ã€‚</li>
<li><code>UniswapV2Pair</code> ç»§æ‰¿è‡ª <code>UniswapV2ERC20</code>ï¼Œå› æ­¤<strong>æ¯ä¸ª Pair åˆçº¦è‡ªèº«å°±æ˜¯ä¸€ä¸ª ERC20 ä»£å¸</strong>ï¼Œå…¶ä»£å¸ä»£è¡¨è¯¥æ± çš„æµåŠ¨æ€§ä»½é¢ï¼ˆå³ LP ä»£å¸ï¼‰ã€‚</li>
<li><code>UniswapV2ERC20</code> å¹¶éç‹¬ç«‹éƒ¨ç½²çš„åˆçº¦ï¼Œè€Œæ˜¯ä½œä¸ºåŸºç±»è¢« <code>UniswapV2Pair</code> ç»§æ‰¿ï¼Œç”¨äºæä¾›æ ‡å‡† ERC20 æ¥å£åŠ EIP-2612 æ”¯æŒã€‚</li>
</ul>
</li>
</ul>
<h3 class="heading-element" id="2-åº”ç”¨å±‚periphery-contracts"><span>2. åº”ç”¨å±‚ï¼ˆPeriphery Contractsï¼‰</span>
  <a href="#2-%e5%ba%94%e7%94%a8%e5%b1%82periphery-contracts" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li><strong>å®šä½</strong>ï¼šæä¾›ç”¨æˆ·å‹å¥½çš„äº¤äº’æ¥å£ï¼Œå°è£…æ ¸å¿ƒå±‚çš„åº•å±‚æ“ä½œã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåŠŸèƒ½ä¸°å¯Œã€ä¾¿äºé›†æˆã€‚- å¤–å›´åˆçº¦<strong>ä¸æŒä¹…æŒæœ‰ç”¨æˆ·èµ„äº§</strong>ï¼Œä»…åœ¨äº¤æ˜“æ‰§è¡ŒæœŸé—´ä¸´æ—¶ä¸­è½¬ã€‚æ‰€æœ‰ç”¨æˆ·èµ„é‡‘æœ€ç»ˆç”±æ ¸å¿ƒå±‚ï¼ˆPairï¼‰æŒæœ‰ï¼Œå¤–å›´åˆçº¦æ— æƒé•¿æœŸæ§åˆ¶æˆ–æŒªç”¨èµ„äº§ã€‚</li>
<li><strong>èŒè´£</strong>ï¼šç®€åŒ–ç”¨æˆ·æ“ä½œï¼Œä¾‹å¦‚è‡ªåŠ¨å¤„ç† ETH ä¸ WETH çš„è½¬æ¢ã€æ”¯æŒå¤šè·³å…‘æ¢è·¯å¾„ã€é›†æˆæ»‘ç‚¹ä¿æŠ¤ä¸äº¤æ˜“æ—¶é™ç­‰å®‰å…¨æœºåˆ¶ã€‚</li>
<li><strong>ä¸»è¦ç»„ä»¶</strong>ï¼š
<ul>
<li><code>UniswapV2Router02</code>ï¼šä¸»è·¯ç”±åˆçº¦ï¼Œæ˜¯ç”¨æˆ·æœ€å¸¸ç”¨çš„äº¤äº’å…¥å£ã€‚</li>
<li>å·¥å…·åº“ï¼ˆLibrariesï¼‰ï¼šå¦‚ <code>TransferHelper</code> ç”¨äºå®‰å…¨è½¬è´¦ï¼Œ<code>UniswapV2Library</code> æä¾›è·¯å¾„è®¡ç®—ç­‰è¾…åŠ©å‡½æ•°ã€‚</li>
<li>ç¤ºä¾‹åˆçº¦ï¼šé—ªç”µè´·ã€é¢„è¨€æœºç­‰ç”¨ä¾‹æ¼”ç¤º</li>
</ul>
</li>
</ul>
<p>è¿™ç§åˆ†ç¦»è®¾è®¡ä½¿å¾—æ ¸å¿ƒåˆçº¦å¯ä»¥ä¿æŒ<strong>ä¸å¯å˜ä¸”é«˜åº¦å®‰å…¨</strong>ï¼Œè€Œå¤–å›´åˆçº¦å¯æ ¹æ®éœ€æ±‚è¿­ä»£å‡çº§ï¼Œè€Œä¸å½±å“åº•å±‚èµ„äº§å®‰å…¨ã€‚</p>
<h2 class="heading-element" id="äºŒæ ¸å¿ƒå±‚åˆçº¦è¯¦è§£"><span>äºŒã€æ ¸å¿ƒå±‚åˆçº¦è¯¦è§£</span>
  <a href="#%e4%ba%8c%e6%a0%b8%e5%bf%83%e5%b1%82%e5%90%88%e7%ba%a6%e8%af%a6%e8%a7%a3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="1-å·¥å‚åˆçº¦uniswapv2factory"><span>1. å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</span>
  <a href="#1-%e5%b7%a5%e5%8e%82%e5%90%88%e7%ba%a6uniswapv2factory" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>è§’è‰²</strong>ï¼šä½œä¸ºæ‰€æœ‰äº¤æ˜“å¯¹çš„ä¸­å¤®æ³¨å†Œä¸­å¿ƒå’Œå”¯ä¸€åˆ›å»ºå…¥å£ã€‚åè®®éƒ¨ç½²æ—¶ä»…éœ€éƒ¨ç½²æ­¤åˆçº¦ï¼Œå¹¶æŒ‡å®šä¸€ä¸ª <code>feeToSetter</code> åœ°å€ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ <code>createPair</code> ä¸ºä»»æ„ä¸¤ä¸ª ERC20 ä»£å¸ï¼ˆæˆ– WETHï¼‰åˆ›å»ºå”¯ä¸€çš„äº¤æ˜“å¯¹åˆçº¦ã€‚</li>
<li>ç®¡ç†åè®®æ‰‹ç»­è´¹æ¥æ”¶åœ°å€ <code>feeTo</code>ï¼ˆé»˜è®¤ä¸ºé›¶åœ°å€ï¼Œå³æ— åè®®æ”¶å…¥ï¼‰ã€‚</li>
</ul>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">UniswapV2Factory</span> <span class="k">is</span> <span class="n">IUniswapV2Factory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// çŠ¶æ€å˜é‡
</span></span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="k">public</span> <span class="n">feeTo</span><span class="p">;</span>         <span class="c1">// åè®®æ‰‹ç»­è´¹æ¥æ”¶åœ°å€ï¼ˆå¯é€‰ï¼‰
</span></span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="k">public</span> <span class="n">feeToSetter</span><span class="p">;</span>   <span class="c1">// æ‹¥æœ‰æƒé™è®¾ç½®æˆ–æ›´æ”¹ `feeTo`åœ°å€çš„è´¦æˆ·
</span></span></span><span class="line"><span class="cl">    <span class="kt">address</span><span class="p">[]</span> <span class="k">public</span> <span class="n">allPairs</span><span class="p">;</span>    <span class="c1">// å­˜å‚¨æ‰€æœ‰å·²åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆPairï¼‰çš„åˆçº¦åœ°å€
</span></span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// äº‹ä»¶ï¼Œå½“æ–°äº¤æ˜“å¯¹è¢«åˆ›å»ºæ—¶è§¦å‘
</span></span></span><span class="line"><span class="cl">    <span class="kd">event</span> <span class="nc">PairCreated</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">token0</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">token1</span><span class="p">,</span> <span class="kt">address</span> <span class="n">pair</span><span class="p">,</span> <span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºæ–°äº¤æ˜“å¯¹
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">createPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–å·²å­˜åœ¨çš„äº¤æ˜“å¯¹
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">getPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="2-äº¤æ˜“å¯¹åˆçº¦uniswapv2pair"><span>2. äº¤æ˜“å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰</span>
  <a href="#2-%e4%ba%a4%e6%98%93%e5%af%b9%e5%90%88%e7%ba%a6uniswapv2pair" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>è§’è‰²</strong>ï¼šå®é™…çš„æµåŠ¨æ€§æ± ï¼Œæ‰§è¡Œ AMM é€»è¾‘ï¼Œå¹¶å‘è¡Œ LP ä»£å¸ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><code>swap</code>: æ‰§è¡Œä»£å¸å…‘æ¢ï¼Œå¹¶æ”¶å–åƒåˆ†ä¹‹ä¸‰ï¼ˆ0.3%ï¼‰çš„äº¤æ˜“æ‰‹ç»­è´¹ï¼Œè¯¥è´¹ç”¨<strong>å…¨éƒ¨æ³¨å…¥æµåŠ¨æ€§æ± </strong>ï¼Œæå‡ LP ä»£å¸ä»·å€¼ã€‚</li>
<li><code>mint</code> / <code>burn</code>: ç®¡ç†æµåŠ¨æ€§å¢å‡ï¼Œé“¸é€ /é”€æ¯ LP ä»£å¸ã€‚</li>
<li><strong>ä»·æ ¼é¢„è¨€æœº</strong>: æä¾›æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼ˆTWAPï¼‰åŠŸèƒ½ã€‚TWAP é€šè¿‡åœ¨æ¯æ¬¡æµåŠ¨æ€§æ“ä½œ (<code>mint</code>, <code>burn</code>) æˆ–å…‘æ¢ (<code>swap</code>) è§¦å‘å‚¨å¤‡æ›´æ–° (<code>_update</code>) æ—¶ï¼Œè®¡ç®—è‡ªä¸Šæ¬¡æ›´æ–°ä»¥æ¥çš„æ—¶é—´é—´éš” (<code>timeElapsed</code>)ï¼Œå¹¶æŒ‰ç…§å½“å‰å‚¨å¤‡æ¯”ä¾‹ (<code>reserve1 / reserve0</code>å’Œ <code>reserve0 / reserve1</code>) ä¹˜ä»¥æ—¶é—´é—´éš”æ¥æ›´æ–°ç´¯ç§¯ä»·æ ¼ (<code>price0CumulativeLast</code>å’Œ <code>price1CumulativeLast</code>)ã€‚è¿™ç¡®ä¿äº†ç´¯ç§¯ä»·æ ¼åæ˜ äº†ä»·æ ¼éšæ—¶é—´çš„å˜åŒ–ï¼Œä½†æ›´æ–°ä¾èµ–äºé“¾ä¸Šæ“ä½œçš„å‘ç”Ÿã€‚</li>
<li><strong>é—ªç”µè´·</strong>:  é€šè¿‡ <code>swap</code> çš„ <code>data</code> å‚æ•°å›è°ƒå®ç°ï¼Œç”¨æˆ·å¯åœ¨å•ç¬”äº¤æ˜“ä¸­å€Ÿå‡ºå¹¶å½’è¿˜èµ„äº§ã€‚</li>
</ul>
<p><strong>åŒé‡èº«ä»½</strong>ï¼šå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç¬¦åˆ ERC20 æ ‡å‡†çš„ä»£å¸åˆçº¦ï¼Œå…¶å‘è¡Œçš„ä»£å¸ï¼ˆLPä»£å¸ï¼‰ä»£è¡¨äº†æµåŠ¨æ€§æä¾›è€…åœ¨æ± ä¸­çš„ä»½é¢ã€‚</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">UniswapV2Pair</span> <span class="k">is</span> <span class="n">IUniswapV2Pair</span><span class="p">,</span> <span class="n">UniswapV2ERC20</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ ¸å¿ƒçŠ¶æ€
</span></span></span><span class="line"><span class="cl">    <span class="kt">uint112</span> <span class="k">private</span> <span class="n">reserve0</span><span class="p">;</span>     <span class="c1">// ä»£å¸0å‚¨å¤‡é‡
</span></span></span><span class="line"><span class="cl">    <span class="kt">uint112</span> <span class="k">private</span> <span class="n">reserve1</span><span class="p">;</span>     <span class="c1">// ä»£å¸1å‚¨å¤‡é‡
</span></span></span><span class="line"><span class="cl">    <span class="kt">uint32</span>  <span class="k">private</span> <span class="n">blockTimestampLast</span><span class="p">;</span> <span class="c1">// ä¸Šæ¬¡æ›´æ–°æ—¶é—´æˆ³ï¼ˆç”¨äº TWAPï¼‰
</span></span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// æ·»åŠ æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç§»é™¤æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">burn</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ‰§è¡Œäº¤æ˜“
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount0Out</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1Out</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">calldata</span> <span class="nb">data</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="3-æµåŠ¨æ€§ä»£å¸åˆçº¦uniswapv2erc20"><span>3. æµåŠ¨æ€§ä»£å¸åˆçº¦ï¼ˆUniswapV2ERC20ï¼‰</span>
  <a href="#3-%e6%b5%81%e5%8a%a8%e6%80%a7%e4%bb%a3%e5%b8%81%e5%90%88%e7%ba%a6uniswapv2erc20" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>è§’è‰²</strong>ï¼šä¸º <code>UniswapV2Pair</code> åˆçº¦æä¾› ERC20 ä»£å¸çš„æ ‡å‡†å®ç°ï¼Œä½¿å…¶å‘è¡Œçš„ LP ä»£å¸å¯ä»¥åƒæ™®é€šä»£å¸ä¸€æ ·è¢«è½¬ç§»å’Œäº¤æ˜“ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>æ ‡å‡†ERC20åŠŸèƒ½ï¼š<code>transfer</code>, <code>approve</code>, <code>balanceOf</code> ç­‰ã€‚</li>
<li><strong>EIP-2612 æ”¯æŒ</strong>ï¼šé€šè¿‡ <code>permit</code> å‡½æ•°å®ç°ç¦»çº¿ç­¾åæˆæƒï¼Œå‡å°‘ç”¨æˆ· Gas æ¶ˆè€—ã€‚</li>
</ul>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">UniswapV2ERC20</span> <span class="k">is</span> <span class="n">IUniswapV2ERC20</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ERC20æ ‡å‡†åŠŸèƒ½
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç¦»çº¿ç­¾åæˆæƒ
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">permit</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">deadline</span><span class="p">,</span> <span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><h2 class="heading-element" id="ä¸‰åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶"><span>ä¸‰ã€åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶</span>
  <a href="#%e4%b8%89%e5%ba%94%e7%94%a8%e5%b1%82%e6%a0%b8%e5%bf%83%e7%bb%84%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>å¤–å›´åˆçº¦ç”¨äºç®€åŒ–ç”¨æˆ·ä¸æ ¸å¿ƒåˆçº¦çš„äº¤äº’ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯è·¯ç”±åˆçº¦å’Œåº“åˆçº¦ã€‚</p>
<h3 class="heading-element" id="è·¯ç”±åˆçº¦uniswapv2router02"><span>è·¯ç”±åˆçº¦ï¼ˆUniswapV2Router02ï¼‰</span>
  <a href="#%e8%b7%af%e7%94%b1%e5%90%88%e7%ba%a6uniswapv2router02" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>è§’è‰²</strong>ï¼šç”¨æˆ·ä¸åè®®äº¤äº’æœ€å¸¸ç”¨çš„ä¸»å…¥å£ï¼Œå°è£…æ ¸å¿ƒå±‚æ“ä½œã€‚è™½ç„¶ Pair åˆçº¦å·²èƒ½å®Œæˆæ‰€æœ‰äº¤æ˜“æ“ä½œï¼Œä½†è·¯ç”±åˆçº¦å°†è¿™äº›æ“ä½œæ•´åˆï¼Œæå¤§åœ°æ–¹ä¾¿äº†ç”¨æˆ·å’Œå‰ç«¯åº”ç”¨ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ol>
<li><strong>æµåŠ¨æ€§ç®¡ç†</strong>: æä¾› <code>addLiquidity</code> å’Œ <code>removeLiquidity</code> ç­‰æ–¹æ³•ï¼Œæ”¯æŒ ETH/WETH è‡ªåŠ¨è½¬æ¢ã€‚</li>
<li><strong>å¤šè·³å…‘æ¢</strong>ï¼šå¦‚ <code>swapExactTokensForTokens</code>ï¼Œæ”¯æŒè·¯å¾„ <code>[A, B, C]</code> å®ç° Aâ†’Bâ†’C å…‘æ¢ã€‚</li>
<li><strong>å®‰å…¨ç‰¹æ€§</strong>: å¼ºåˆ¶ç”¨æˆ·æŒ‡å®š <code>amountOutMin</code>ï¼ˆé˜²æ»‘ç‚¹ï¼‰å’Œ <code>deadline</code>ï¼ˆé˜²äº¤æ˜“å»¶è¿Ÿï¼‰ã€‚</li>
</ol>
<p><strong>ç‰ˆæœ¬è¯´æ˜</strong>ï¼š<code>UniswapV2Router02</code> ç›¸æ¯” <code>01</code> ç‰ˆæœ¬ï¼Œ<strong>æ”¹è¿›äº†å¯¹éƒ¨åˆ†ç‰¹æ®Šä»£å¸ï¼ˆå¦‚ fee-on-transfer ä»£å¸ï¼‰çš„å…¼å®¹æ€§</strong>ï¼Œä½†å¹¶éå®Œå…¨æ”¯æŒæ‰€æœ‰éæ ‡å‡† ERC20ã€‚</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">UniswapV2Router02</span> <span class="k">is</span> <span class="n">IUniswapV2Router02</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ETHåŒ…è£…å™¨åœ°å€
</span></span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="k">public</span> <span class="k">immutable</span> <span class="n">WETH</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// æ·»åŠ ç§»é™¤æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">addLiquidity</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">removeLiquidity</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å¤šè·¯å¾„å…‘æ¢
</span></span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">swapExactTokensForTokens</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">amountIn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">amountOutMin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">to</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">deadline</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="åº“åˆçº¦library-contracts"><span>åº“åˆçº¦ï¼ˆLibrary Contractsï¼‰</span>
  <a href="#%e5%ba%93%e5%90%88%e7%ba%a6library-contracts" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>è§’è‰²</strong>ï¼šæä¾›å¯é‡ç”¨çš„å·¥å…·å‡½æ•°ï¼Œä¾‹å¦‚è®¡ç®—äº¤æ˜“å¯¹åœ°å€ã€è®¡ç®—å…‘æ¢æ•°é‡ç­‰ã€‚å¦‚ï¼š</p>
<ul>
<li><code>UniswapV2Library</code>: æä¾› Pair åœ°å€è®¡ç®—ã€å…‘æ¢é‡ä¼°ç®—ã€è·¯å¾„éªŒè¯ç­‰é™æ€å‡½æ•°ã€‚</li>
<li><code>TransferHelper</code>: å°è£… <code>safeTransfer</code> / <code>safeTransferFrom</code>ï¼Œé¿å…éƒ¨åˆ† ERC20 å®ç°ä¸è¿”å› bool çš„é—®é¢˜ã€‚</li>
<li><code>SafeMath</code>: æ•°å­¦è¿ç®—å®‰å…¨ä¿æŠ¤</li>
</ul>
<h2 class="heading-element" id="å››åˆçº¦äº¤äº’æµç¨‹"><span>å››ã€åˆçº¦äº¤äº’æµç¨‹</span>
  <a href="#%e5%9b%9b%e5%90%88%e7%ba%a6%e4%ba%a4%e4%ba%92%e6%b5%81%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>ä¸€ä¸ªå…¸å‹çš„ Uniswap V2 äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆæŒ‰éœ€ï¼‰</strong></p>
<ul>
<li>ç”¨æˆ·<strong>ä¸ç›´æ¥è°ƒç”¨</strong> <code>Factory.createPair</code>ï¼Œè€Œæ˜¯é€šè¿‡ Routerï¼ˆå¦‚ <code>addLiquidity</code>ï¼‰é—´æ¥è§¦å‘ã€‚</li>
<li>Router å†…éƒ¨æ£€æŸ¥ Pair æ˜¯å¦å­˜åœ¨ï¼šè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ <code>Factory.createPair(tokenA, tokenB)</code>ã€‚</li>
<li>Factory ä»…åœ¨ Pair ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨ <code>CREATE2</code> éƒ¨ç½²æ–° Pair åˆçº¦ï¼Œå…¶åœ°å€ç”±æ’åºåçš„ä»£å¸åœ°å€å’Œ init code å“ˆå¸Œå”¯ä¸€ç¡®å®šã€‚</li>
</ul>
</li>
<li>
<p><strong>æ·»åŠ æµåŠ¨æ€§</strong></p>
<ul>
<li>ç”¨æˆ·è°ƒç”¨ <code>Router.addLiquidity</code>ï¼ˆæˆ– <code>addLiquidityETH</code>ï¼‰ï¼Œä¼ å…¥ä¸¤ç§ä»£å¸ï¼ˆæˆ– ETHï¼‰åŠæ•°é‡ï¼Œå¹¶æˆæƒä»£å¸ç»™ Routerã€‚</li>
<li>Router å°†ç”¨æˆ·èµ„äº§ï¼ˆä»£å¸æˆ– WETHï¼‰è½¬å…¥ Pair åˆçº¦ã€‚</li>
<li>Router è°ƒç”¨ <code>Pair.mint(userAddress)</code>ï¼ŒPair <strong>ç›´æ¥å‘ç”¨æˆ·åœ°å€é“¸é€  LP ä»£å¸</strong>ï¼Œä¸ç»è¿‡ Router ä¸­è½¬ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œå…‘æ¢</strong></p>
<ul>
<li>ç”¨æˆ·è°ƒç”¨ <code>Router.swapExactTokensForTokens</code> ç­‰å‡½æ•°ï¼ŒæŒ‡å®šå…‘æ¢è·¯å¾„ã€è¾“å…¥é‡ã€æœ€å°è¾“å‡ºé‡ï¼ˆ<code>amountOutMin</code>ï¼‰å’Œæˆªæ­¢æ—¶é—´ï¼ˆ<code>deadline</code>ï¼‰ã€‚</li>
<li>Router æŒ‰è·¯å¾„ä¾æ¬¡è°ƒç”¨å„ Pair çš„ <code>swap(amount0Out, amount1Out, userAddress, &quot;&quot;)</code>ã€‚</li>
<li>æ¯ä¸ª Pair <strong>ç›´æ¥å°†è¾“å‡ºä»£å¸è½¬è´¦è‡³ç”¨æˆ·æŒ‡å®šåœ°å€</strong>ï¼ˆé€šå¸¸ä¸ºç”¨æˆ·è‡ªèº«ï¼‰ï¼Œå®Œæˆå¤šè·³å…‘æ¢ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç§»é™¤æµåŠ¨æ€§</strong></p>
<ul>
<li>ç”¨æˆ·è°ƒç”¨ <code>Router.removeLiquidity</code>ï¼ˆæˆ– <code>removeLiquidityETH</code>ï¼‰ï¼Œå¹¶å°† LP ä»£å¸æˆæƒæˆ–è½¬å…¥ Routerã€‚</li>
<li>Router è°ƒç”¨ <code>Pair.burn(userAddress)</code>ã€‚</li>
<li>Pair é”€æ¯ LP ä»£å¸ï¼Œå¹¶<strong>ç›´æ¥å°†å¯¹åº”æ¯”ä¾‹çš„ä¸¤ç§ä»£å¸ï¼ˆå«ç´¯ç§¯æ‰‹ç»­è´¹ï¼‰è½¬è´¦ç»™ç”¨æˆ·åœ°å€</strong>ã€‚</li>
</ul>
</li>
</ol>
<div class="diagram-container">
  <pre class="mermaid">graph TD
    subgraph ç”¨æˆ· User
        UserA[ç”¨æˆ·]
    end

    subgraph åº”ç”¨å±‚ Periphery
        Router[UniswapV2Router02]
    end

    subgraph æ ¸å¿ƒå±‚ Core
        Factory[UniswapV2Factory]
        Pair[UniswapV2Pair]
    end

    UserA -- 1. æˆæƒä»£å¸<br>æˆ–å‘é€ETH --> Router
    UserA -- 2. è°ƒç”¨Routerå‡½æ•°<br>(add/remove/swap) --> Router
    
    Router -- 3a. è‹¥Pairä¸å­˜åœ¨:<br>åˆ›å»ºPair --> Factory
    Factory -- 3b. è¿”å›Pairåœ°å€ --> Router
    
    Router -- 4. è½¬å…¥è¾“å…¥èµ„äº§åˆ°Pair --> Pair
    Router -- 5. è°ƒç”¨Pairå‡½æ•° --> Pair
    
    Pair -- 6. æ‰§è¡Œæ ¸å¿ƒé€»è¾‘ --> Pair
    Pair -- 7. å°†è¾“å‡ºèµ„äº§<br>ç›´æ¥å‘é€ç»™ç”¨æˆ· --> UserA

    classDef user fill:#d4f7e5,stroke:#2e8b57;
    classDef periphery fill:#e6f0ff,stroke:#1e5dbf;
    classDef core fill:#fff0f0,stroke:#b33c3c;
    class UserA user
    class Router periphery
    class Factory,Pair core</pre>
  <pre class="mermaid-dark">graph TD
    subgraph ç”¨æˆ· User
        UserA[ç”¨æˆ·]
    end

    subgraph åº”ç”¨å±‚ Periphery
        Router[UniswapV2Router02]
    end

    subgraph æ ¸å¿ƒå±‚ Core
        Factory[UniswapV2Factory]
        Pair[UniswapV2Pair]
    end

    UserA -- 1. æˆæƒä»£å¸<br>æˆ–å‘é€ETH --> Router
    UserA -- 2. è°ƒç”¨Routerå‡½æ•°<br>(add/remove/swap) --> Router
    
    Router -- 3a. è‹¥Pairä¸å­˜åœ¨:<br>åˆ›å»ºPair --> Factory
    Factory -- 3b. è¿”å›Pairåœ°å€ --> Router
    
    Router -- 4. è½¬å…¥è¾“å…¥èµ„äº§åˆ°Pair --> Pair
    Router -- 5. è°ƒç”¨Pairå‡½æ•° --> Pair
    
    Pair -- 6. æ‰§è¡Œæ ¸å¿ƒé€»è¾‘ --> Pair
    Pair -- 7. å°†è¾“å‡ºèµ„äº§<br>ç›´æ¥å‘é€ç»™ç”¨æˆ· --> UserA

    classDef user fill:#d4f7e5,stroke:#2e8b57;
    classDef periphery fill:#e6f0ff,stroke:#1e5dbf;
    classDef core fill:#fff0f0,stroke:#b33c3c;
    class UserA user
    class Router periphery
    class Factory,Pair core</pre>
  <pre class="mermaid-neutral">graph TD
    subgraph ç”¨æˆ· User
        UserA[ç”¨æˆ·]
    end

    subgraph åº”ç”¨å±‚ Periphery
        Router[UniswapV2Router02]
    end

    subgraph æ ¸å¿ƒå±‚ Core
        Factory[UniswapV2Factory]
        Pair[UniswapV2Pair]
    end

    UserA -- 1. æˆæƒä»£å¸<br>æˆ–å‘é€ETH --> Router
    UserA -- 2. è°ƒç”¨Routerå‡½æ•°<br>(add/remove/swap) --> Router
    
    Router -- 3a. è‹¥Pairä¸å­˜åœ¨:<br>åˆ›å»ºPair --> Factory
    Factory -- 3b. è¿”å›Pairåœ°å€ --> Router
    
    Router -- 4. è½¬å…¥è¾“å…¥èµ„äº§åˆ°Pair --> Pair
    Router -- 5. è°ƒç”¨Pairå‡½æ•° --> Pair
    
    Pair -- 6. æ‰§è¡Œæ ¸å¿ƒé€»è¾‘ --> Pair
    Pair -- 7. å°†è¾“å‡ºèµ„äº§<br>ç›´æ¥å‘é€ç»™ç”¨æˆ· --> UserA

    classDef user fill:#d4f7e5,stroke:#2e8b57;
    classDef periphery fill:#e6f0ff,stroke:#1e5dbf;
    classDef core fill:#fff0f0,stroke:#b33c3c;
    class UserA user
    class Router periphery
    class Factory,Pair core</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone fa-width-auto" aria-hidden="true"></i></div>
<template><pre>graph TD
    subgraph ç”¨æˆ· User
        UserA[ç”¨æˆ·]
    end

    subgraph åº”ç”¨å±‚ Periphery
        Router[UniswapV2Router02]
    end

    subgraph æ ¸å¿ƒå±‚ Core
        Factory[UniswapV2Factory]
        Pair[UniswapV2Pair]
    end

    UserA -- 1. æˆæƒä»£å¸<br>æˆ–å‘é€ETH --> Router
    UserA -- 2. è°ƒç”¨Routerå‡½æ•°<br>(add/remove/swap) --> Router
    
    Router -- 3a. è‹¥Pairä¸å­˜åœ¨:<br>åˆ›å»ºPair --> Factory
    Factory -- 3b. è¿”å›Pairåœ°å€ --> Router
    
    Router -- 4. è½¬å…¥è¾“å…¥èµ„äº§åˆ°Pair --> Pair
    Router -- 5. è°ƒç”¨Pairå‡½æ•° --> Pair
    
    Pair -- 6. æ‰§è¡Œæ ¸å¿ƒé€»è¾‘ --> Pair
    Pair -- 7. å°†è¾“å‡ºèµ„äº§<br>ç›´æ¥å‘é€ç»™ç”¨æˆ· --> UserA

    classDef user fill:#d4f7e5,stroke:#2e8b57;
    classDef periphery fill:#e6f0ff,stroke:#1e5dbf;
    classDef core fill:#fff0f0,stroke:#b33c3c;
    class UserA user
    class Router periphery
    class Factory,Pair core</pre></template>
</div><h2 class="heading-element" id="äº”å…³é”®è®¾è®¡æ€æƒ³"><span>äº”ã€å…³é”®è®¾è®¡æ€æƒ³</span>
  <a href="#%e4%ba%94%e5%85%b3%e9%94%ae%e8%ae%be%e8%ae%a1%e6%80%9d%e6%83%b3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>
<p><strong>å®‰å…¨è¾¹ç•Œæ§åˆ¶</strong></p>
<ul>
<li>æ ¸å¿ƒåˆçº¦åŠŸèƒ½æœ€å°åŒ–ï¼ˆé€»è¾‘ç®€æ´ï¼Œæ— å¤–éƒ¨ä¾èµ–ï¼‰</li>
<li>ç”¨æˆ·èµ„é‡‘ä»…ç”±æ ¸å¿ƒåˆçº¦æŒæœ‰ï¼Œå¤–å›´åˆçº¦æ— èµ„äº§æ‰€æœ‰æƒ</li>
</ul>
</li>
<li>
<p><strong>ç¡®å®šæ€§åœ°å€ç”Ÿæˆ</strong></p>
<ul>
<li>é€šé€šè¿‡ CREATE2 éƒ¨ç½² Pair åˆçº¦ï¼Œç¡®ä¿åœ°å€å¯é¢„å…ˆè®¡ç®—ã€‚</li>
<li>åœ°å€ç”±å·¥å‚åœ°å€ã€init code å“ˆå¸ŒåŠæ’åºåä»£å¸åœ°å€çš„å“ˆå¸Œï¼ˆä½œä¸º saltï¼‰å…±åŒç¡®å®šï¼Œæ— éœ€é“¾ä¸ŠæŸ¥è¯¢å³å¯æ¨å¯¼ Pair åœ°å€ã€‚</li>
</ul>
</li>
<li>
<p><strong>åè®®å¯æ‰©å±•æ€§</strong></p>
<ul>
<li>åè®®è´¹å¼€å…³ï¼šé€šè¿‡ <code>feeTo</code> æ¿€æ´»åè®®æ”¶å…¥ï¼ˆ0.05%ï¼‰</li>
<li>å¤–å›´åˆçº¦å¯ç‹¬ç«‹å‡çº§ï¼ˆå¦‚éƒ¨ç½²æ–° Routerï¼‰</li>
</ul>
</li>
<li>
<p><strong>Gas ä¼˜åŒ–</strong></p>
<ul>
<li>å‚¨å¤‡é‡ä½¿ç”¨ <code>uint112</code>ï¼ˆé…åˆ <code>uint32</code> æ—¶é—´æˆ³ï¼Œå…±å  3 ä¸ªå­˜å‚¨æ§½ï¼‰</li>
<li>å‡å°‘ SSTOREï¼šçŠ¶æ€æ›´æ–°é›†ä¸­å¤„ç†ï¼Œé¿å…ä¸­é—´å†™å…¥</li>
</ul>
</li>
</ol>
<h1 class="heading-element" id="uniswapv2æºç é˜…è¯»ä¸‰å·¥å‚åˆçº¦uniswapv2factory"><span>UniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸‰ï¼‰å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</span>
  <a href="#uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e4%b8%89%e5%b7%a5%e5%8e%82%e5%90%88%e7%ba%a6uniswapv2factory" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><h2 class="heading-element" id="1-å·¥å‚åˆçº¦ç®€ä»‹"><span>1. å·¥å‚åˆçº¦ç®€ä»‹</span>
  <a href="#1-%e5%b7%a5%e5%8e%82%e5%90%88%e7%ba%a6%e7%ae%80%e4%bb%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><code>UniswapV2Factory</code> æ˜¯ Uniswap V2 çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£åˆ›å»ºäº¤æ˜“å¯¹åˆçº¦ï¼ˆ<code>UniswapV2Pair</code>ï¼‰ã€‚</p>
<p><strong>è§’è‰²</strong>ï¼šä½œä¸ºæ‰€æœ‰äº¤æ˜“å¯¹çš„ä¸­å¤®æ³¨å†Œä¸­å¿ƒå’Œå”¯ä¸€åˆ›å»ºå…¥å£ã€‚åè®®éƒ¨ç½²æ—¶ä»…éœ€éƒ¨ç½²æ­¤åˆçº¦ï¼Œå¹¶æŒ‡å®šä¸€ä¸ª <code>feeToSetter</code> åœ°å€ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ <code>createPair</code> ä¸ºä»»æ„ä¸¤ä¸ª ERC20 ä»£å¸ï¼ˆæˆ– WETHï¼‰åˆ›å»ºå”¯ä¸€çš„äº¤æ˜“å¯¹åˆçº¦ã€‚</li>
<li>ç®¡ç†åè®®æ‰‹ç»­è´¹æ¥æ”¶åœ°å€ <code>feeTo</code>ï¼ˆé»˜è®¤ä¸ºé›¶åœ°å€ï¼Œå³æ— åè®®æ”¶å…¥ï¼‰ã€‚</li>
</ul>
<h2 class="heading-element" id="2-æºç é˜…è¯»"><span>2. æºç é˜…è¯»</span>
  <a href="#2-%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="21-å…³é”®å˜é‡"><span>2.1 å…³é”®å˜é‡</span>
  <a href="#21-%e5%85%b3%e9%94%ae%e5%8f%98%e9%87%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">public</span> <span class="n">feeTo</span><span class="p">;</span> <span class="c1">// æ”¶å–æ‰‹ç»­è´¹çš„åœ°å€ï¼Œå½“ feeTo == address(0)æ—¶ï¼šâ€‹åè®®è´¹ç”¨å…³é—­â€‹
</span></span></span><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">public</span> <span class="n">feeToSetter</span><span class="p">;</span> <span class="c1">// æƒé™ç®¡ç†åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">address</span><span class="p">))</span> <span class="k">public</span> <span class="n">getPair</span><span class="p">;</span> <span class="c1">// token0 -&gt; token1 -&gt; pair address
</span></span></span><span class="line"><span class="cl"><span class="kt">address</span><span class="p">[]</span> <span class="k">public</span> <span class="n">allPairs</span><span class="p">;</span> <span class="c1">// æ‰€æœ‰äº¤æ˜“å¯¹åœ°å€åˆ—è¡¨
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">event</span> <span class="nc">PairCreated</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">token0</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">token1</span><span class="p">,</span> <span class="kt">address</span> <span class="n">pair</span><span class="p">,</span> <span class="kt">uint</span><span class="p">);</span></span></span></code></pre></div></div><ul>
<li><code>getPair[token0][token1]</code>ï¼šå¿«é€ŸæŸ¥æ‰¾ <code>token0</code> å’Œ <code>token1</code> å¯¹åº”çš„äº¤æ˜“å¯¹åœ°å€</li>
<li><code>allPairs</code>ï¼šç»´æŠ¤æ‰€æœ‰åˆ›å»ºçš„äº¤æ˜“å¯¹åœ°å€</li>
<li><code>PairCreated</code>ï¼šäº¤æ˜“å¯¹åˆ›å»ºæ—¶è§¦å‘çš„äº‹ä»¶</li>
</ul>
<h3 class="heading-element" id="22-å‡½æ•°åˆ—è¡¨ä¸è§£æ"><span>2.2 å‡½æ•°åˆ—è¡¨ä¸è§£æ</span>
  <a href="#22-%e5%87%bd%e6%95%b0%e5%88%97%e8%a1%a8%e4%b8%8e%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 class="heading-element" id="221-constructoraddress-_feetosetter-public"><span>2.2.1. <code>constructor(address _feeToSetter) public</code></span>
  <a href="#221-constructoraddress-_feetosetter-public" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_feeToSetter</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">feeToSetter</span> <span class="o">=</span> <span class="n">_feeToSetter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><ul>
<li><strong>ä½œç”¨</strong>ï¼šåˆçº¦æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ– <code>feeToSetter</code> åœ°å€</li>
<li><strong>å‚æ•°</strong>ï¼š<code>_feeToSetter</code> æ˜¯å”¯ä¸€èƒ½è®¾ç½® <code>feeTo</code> çš„åœ°å€</li>
</ul>
<h4 class="heading-element" id="222-setfeetoaddress-_feeto-external"><span>2.2.2. <code>setFeeTo(address _feeTo) external</code></span>
  <a href="#222-setfeetoaddress-_feeto-external" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">setFeeTo</span><span class="p">(</span><span class="kt">address</span> <span class="n">_feeTo</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span> <span class="o">==</span> <span class="n">feeToSetter</span><span class="p">,</span> <span class="s">&#39;UniswapV2: FORBIDDEN&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">feeTo</span> <span class="o">=</span> <span class="n">_feeTo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><ul>
<li><strong>ä½œç”¨</strong>ï¼šè®¾ç½®æ‰‹ç»­è´¹æ¥æ”¶åœ°å€</li>
<li><strong>å‚æ•°</strong>ï¼š<code>_feeTo</code> æ˜¯æ–°çš„æ‰‹ç»­è´¹åœ°å€</li>
<li><strong>æƒé™æ§åˆ¶</strong>ï¼šåªæœ‰ <code>feeToSetter</code> å¯è°ƒç”¨</li>
</ul>
<h4 class="heading-element" id="223-setfeetosetteraddress-_feetosetter-external"><span>2.2.3. <code>setFeeToSetter(address _feeToSetter) external</code></span>
  <a href="#223-setfeetosetteraddress-_feetosetter-external" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">setFeeToSetter</span><span class="p">(</span><span class="kt">address</span> <span class="n">_feeToSetter</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span> <span class="o">==</span> <span class="n">feeToSetter</span><span class="p">,</span> <span class="s">&#39;UniswapV2: FORBIDDEN&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">feeToSetter</span> <span class="o">=</span> <span class="n">_feeToSetter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><ul>
<li><strong>ä½œç”¨</strong>ï¼šè®¾ç½® <code>feeToSetter</code> åœ°å€ï¼ˆå³æœªæ¥èƒ½è®¾ç½® <code>feeTo</code> çš„åœ°å€ï¼‰</li>
<li><strong>å‚æ•°</strong>ï¼š<code>_feeToSetter</code> æ˜¯æ–°çš„ <code>feeToSetter</code></li>
<li><strong>æƒé™æ§åˆ¶</strong>ï¼šåªæœ‰å½“å‰ <code>feeToSetter</code> å¯è°ƒç”¨</li>
<li><strong>è¯´æ˜</strong>ï¼š<code>setFeeToSetter</code> å®ç°äº†æƒé™çš„ç§»äº¤æœºåˆ¶ï¼Œå…è®¸å½“å‰çš„ <code>feeToSetter</code> å°†æƒé™è½¬ç§»ç»™æ–°çš„è´¦æˆ·ï¼Œä»è€Œé˜²æ­¢æƒé™è¢«æ°¸ä¹…é”å®šã€‚</li>
</ul>
<h4 class="heading-element" id="224-allpairslength-external-view-returns-uint"><span>2.2.4. <code>allPairsLength() external view returns (uint)</code></span>
  <a href="#224-allpairslength-external-view-returns-uint" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">allPairsLength</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">allPairs</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿”å›å½“å‰åˆ›å»ºçš„äº¤æ˜“å¯¹æ•°é‡</li>
<li><strong>è¿”å›å€¼</strong>ï¼š<code>uint</code> ç±»å‹çš„äº¤æ˜“å¯¹æ€»æ•°</li>
</ul>
<h4 class="heading-element" id="225-createpairaddress-tokena-address-tokenb-external-returns-address-pair"><span>2.2.5. <code>createPair(address tokenA, address tokenB) external returns (address pair)</code></span>
  <a href="#225-createpairaddress-tokena-address-tokenb-external-returns-address-pair" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">createPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">tokenA</span> <span class="o">!=</span> <span class="n">tokenB</span><span class="p">,</span> <span class="s">&#39;UniswapV2: IDENTICAL_ADDRESSES&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">address</span> <span class="n">token0</span><span class="p">,</span> <span class="kt">address</span> <span class="n">token1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tokenA</span> <span class="o">&lt;</span> <span class="n">tokenB</span> <span class="o">?</span> <span class="p">(</span><span class="n">tokenA</span><span class="p">,</span> <span class="n">tokenB</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">tokenB</span><span class="p">,</span> <span class="n">tokenA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">token0</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;UniswapV2: ZERO_ADDRESS&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">getPair</span><span class="p">[</span><span class="n">token0</span><span class="p">][</span><span class="n">token1</span><span class="p">]</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;UniswapV2: PAIR_EXISTS&#39;</span><span class="p">);</span> <span class="c1">// single check is sufficient
</span></span></span><span class="line"><span class="cl">    <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">bytecode</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nc">UniswapV2Pair</span><span class="p">).</span><span class="nb">creationCode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bytes32</span> <span class="n">salt</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span><span class="n">token0</span><span class="p">,</span> <span class="n">token1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">assembly</span> {
</span></span><span class="line"><span class="cl">        <span class="n">pair</span> <span class="o">:=</span> <span class="n">create2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">bytecode</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="nf">mload</span><span class="p">(</span><span class="n">bytecode</span><span class="p">),</span> <span class="n">salt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">IUniswapV2Pair</span><span class="p">(</span><span class="n">pair</span><span class="p">).</span><span class="n">initialize</span><span class="p">(</span><span class="n">token0</span><span class="p">,</span> <span class="n">token1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">getPair</span><span class="p">[</span><span class="n">token0</span><span class="p">][</span><span class="n">token1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">getPair</span><span class="p">[</span><span class="n">token1</span><span class="p">][</span><span class="n">token0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="p">;</span> <span class="c1">// populate mapping in the reverse direction
</span></span></span><span class="line"><span class="cl">    <span class="n">allPairs</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">emit</span> <span class="n">PairCreated</span><span class="p">(</span><span class="n">token0</span><span class="p">,</span> <span class="n">token1</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">allPairs</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><ul>
<li><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºæ–°çš„äº¤æ˜“å¯¹åˆçº¦</li>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li><code>tokenA</code>, <code>tokenB</code>ï¼šè¦åˆ›å»ºäº¤æ˜“å¯¹çš„ä¸¤ç§ä»£å¸åœ°å€</li>
</ul>
</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæ–°åˆ›å»ºçš„äº¤æ˜“å¯¹åˆçº¦åœ°å€</li>
<li><strong>æ•´ä½“æµç¨‹</strong>ï¼š
<ol>
<li>æ ¡éªŒ <code>tokenA != tokenB</code></li>
<li>æ’åº <code>token0 &lt; token1</code>ï¼Œé¿å…é‡å¤åˆ›å»º</li>
<li>ä½¿ç”¨ <code>create2</code> é¢„è®¡ç®—äº¤æ˜“å¯¹åœ°å€</li>
<li>åˆå§‹åŒ–äº¤æ˜“å¯¹åˆçº¦</li>
<li>æ›´æ–° <code>getPair</code> æ˜ å°„å’Œ <code>allPairs</code> åˆ—è¡¨</li>
<li>è§¦å‘ <code>PairCreated</code> äº‹ä»¶</li>
</ol>
</li>
</ul>
<p>å…¶ä¸­ <code>CREATE2</code> æ˜¯ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ä¸­ç”¨äºåˆ›å»ºæ–°åˆçº¦çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚å®ƒéœ€è¦å››ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>â€‹valueâ€‹</code> (uint256)ï¼šå‘é€ç»™æ–°åˆçº¦çš„ ETH æ•°é‡</li>
<li><code>â€‹offsetâ€‹</code> (uint256)ï¼šåˆå§‹åŒ–ä»£ç åœ¨å†…å­˜ä¸­çš„èµ·å§‹ä½ç½®</li>
<li><code>â€‹sizeâ€‹</code> (uint256)ï¼šåˆå§‹åŒ–ä»£ç çš„é•¿åº¦</li>
<li><code>â€‹saltâ€‹</code> (uint256)ï¼šç”¨äºåœ°å€è®¡ç®—çš„ 32 å­—èŠ‚ç›å€¼</li>
</ul>
<h2 class="heading-element" id="3-æœ¬åœ°æµ‹è¯•éªŒè¯"><span>3. æœ¬åœ°æµ‹è¯•éªŒè¯</span>
  <a href="#3-%e6%9c%ac%e5%9c%b0%e6%b5%8b%e8%af%95%e9%aa%8c%e8%af%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="31-éƒ¨ç½²å·¥å‚åˆçº¦"><span>3.1 éƒ¨ç½²å·¥å‚åˆçº¦</span>
  <a href="#31-%e9%83%a8%e7%bd%b2%e5%b7%a5%e5%8e%82%e5%90%88%e7%ba%a6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è¿™ä¸ªè„šæœ¬çš„åŠŸèƒ½æ˜¯å‡†å¤‡ä¸€ä¸ªè´¦æˆ·ï¼Œä½¿ç”¨è¿™ä¸ªè´¦æˆ·éƒ¨ç½² Factory åˆçº¦ï¼Œç„¶åçœ‹ä¸‹è´¦æˆ·çš„ä½™é¢</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-javascript"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hardhat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å‡†å¤‡è´¦æˆ·
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">[</span><span class="nx">deployer</span><span class="p">,</span> <span class="nx">user</span><span class="p">]</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] éƒ¨ç½²è€…è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    ç”¨æˆ·è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    éƒ¨ç½²è€…ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">)),</span> <span class="s2">&#34;ETH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// éƒ¨ç½² Factory åˆçº¦
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&#34;contracts/uniswap-v2-core/contracts/UniswapV2Factory.sol:UniswapV2Factory&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">FACTORY_ADDRESS</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] Factory åˆçº¦åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">FACTORY_ADDRESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è´¦æˆ·ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] éƒ¨ç½²è€…è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    ç”¨æˆ·è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    éƒ¨ç½²è€…ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">)),</span> <span class="s2">&#34;ETH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">process</span><span class="p">.</span><span class="nx">exitCode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;è„šæœ¬æ‰§è¡Œå®Œæˆï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// npx hardhat run scripts/deploy-factory.js --network localhost
</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç»ˆç«¯çš„è¾“å‡ºï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">  Contract deployment: UniswapV2Factory
</span></span><span class="line"><span class="cl">  Contract address:    0x5fbdb2315678afecb367f032d93f642f64180aa3
</span></span><span class="line"><span class="cl">  Transaction:         0xf75cadcf3e2efb3dc1426023c16786738b80c3e775f1d5a883d196ad91756e26
</span></span><span class="line"><span class="cl">  From:                0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
</span></span><span class="line"><span class="cl">  Value:               <span class="m">0</span> ETH
</span></span><span class="line"><span class="cl">  Gas used:            <span class="m">2414728</span> of <span class="m">30000000</span>
</span></span><span class="line"><span class="cl">  Block <span class="c1">#1:            0x2bcc0018790c91d6bcb412e211739ed6abfaddbb87e972c967d11fe94a5668f1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">% npx hardhat run scripts/tmp.js --network localhost
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²è€…è´¦æˆ·: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">    ç”¨æˆ·è´¦æˆ·: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl">    éƒ¨ç½²è€…ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Factory åˆçº¦åœ°å€: 0x5FbDB2315678afecb367f032d93F642f64180aa3
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²è€…è´¦æˆ·: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">    ç”¨æˆ·è´¦æˆ·: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl">    éƒ¨ç½²è€…ä½™é¢: 9999.997325877390625 ETH
</span></span><span class="line"><span class="cl">è„šæœ¬æ‰§è¡Œå®Œæˆï¼</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="32-åˆ›å»ºåˆçº¦å¯¹å¹¶ç›‘å¬äº‹ä»¶"><span>3.2 åˆ›å»ºåˆçº¦å¯¹å¹¶ç›‘å¬äº‹ä»¶</span>
  <a href="#32-%e5%88%9b%e5%bb%ba%e5%90%88%e7%ba%a6%e5%af%b9%e5%b9%b6%e7%9b%91%e5%90%ac%e4%ba%8b%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>åœ¨ä¸‹é¢çš„è„šæœ¬ä¸­ï¼Œåˆ›å»ºåˆçº¦å¹¶ç›‘å¬<code>PairCreated</code>äº‹ä»¶ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-javascript"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hardhat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å‡†å¤‡è´¦æˆ·
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">[</span><span class="nx">deployer</span><span class="p">,</span> <span class="nx">user</span><span class="p">]</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] éƒ¨ç½²è€…è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    ç”¨æˆ·è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    éƒ¨ç½²è€…ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">)),</span> <span class="s2">&#34;ETH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// éƒ¨ç½² Factory åˆçº¦
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&#34;contracts/uniswap-v2-core/contracts/UniswapV2Factory.sol:UniswapV2Factory&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">FACTORY_ADDRESS</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] Factory åˆçº¦åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">FACTORY_ADDRESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// éƒ¨ç½²æµ‹è¯•ä»£å¸
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">ERC20Contract</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;contracts/uniswap-v2-periphery/contracts/test/ERC20.sol:ERC20&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenA</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ERC20Contract</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="s2">&#34;100&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenAAddress</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] TokenA éƒ¨ç½²æˆåŠŸ! åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">tokenAAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenB</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ERC20Contract</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="s2">&#34;10000&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenBAddress</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] TokenB éƒ¨ç½²æˆåŠŸ! åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">tokenBAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç›‘å¬ PairCreated äº‹ä»¶ï¼Œä½¿ç”¨ä¸€æ¬¡æ€§ç›‘å¬
</span></span></span><span class="line"><span class="cl">    <span class="nx">factory</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">&#34;PairCreated&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">tokenA</span><span class="p">,</span> <span class="nx">tokenB</span><span class="p">,</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">pairIndex</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;äº¤æ˜“å¯¹åˆ›å»ºæˆåŠŸï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;  TokenA:&#34;</span><span class="p">,</span> <span class="nx">tokenA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;  TokenB:&#34;</span><span class="p">,</span> <span class="nx">tokenB</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;  Pair Address:&#34;</span><span class="p">,</span> <span class="nx">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;  Index:&#34;</span><span class="p">,</span> <span class="nx">pairIndex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºäº¤æ˜“å¯¹
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">createPair</span><span class="p">(</span><span class="nx">tokenAAddress</span><span class="p">,</span> <span class="nx">tokenBAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">pairAddress</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">getPair</span><span class="p">(</span><span class="nx">tokenAAddress</span><span class="p">,</span> <span class="nx">tokenBAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] åˆ›å»ºäº¤æ˜“å¯¹ï¼Œåœ°å€:&#34;</span><span class="p">,</span> <span class="nx">pairAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">process</span><span class="p">.</span><span class="nx">exitCode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;è„šæœ¬æ‰§è¡Œå®Œæˆï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// npx hardhat run scripts/deploy-factory.js --network localhost
</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% npx hardhat run scripts/tmp.js --network localhost
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²è€…è´¦æˆ·: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">    ç”¨æˆ·è´¦æˆ·: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl">    éƒ¨ç½²è€…ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Factory åˆçº¦åœ°å€: 0x5FbDB2315678afecb367f032d93F642f64180aa3
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> TokenA éƒ¨ç½²æˆåŠŸ! åœ°å€: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> TokenB éƒ¨ç½²æˆåŠŸ! åœ°å€: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> åˆ›å»ºäº¤æ˜“å¯¹ï¼Œåœ°å€: 0xb362C9fd281047185623Ee91c5Ff405274bbEEFe
</span></span><span class="line"><span class="cl">è„šæœ¬æ‰§è¡Œå®Œæˆï¼
</span></span><span class="line"><span class="cl">äº¤æ˜“å¯¹åˆ›å»ºæˆåŠŸï¼
</span></span><span class="line"><span class="cl">  TokenA: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
</span></span><span class="line"><span class="cl">  TokenB: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
</span></span><span class="line"><span class="cl">  Pair Address: 0xb362C9fd281047185623Ee91c5Ff405274bbEEFe
</span></span><span class="line"><span class="cl">  Index: 1n</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="33-ä¿®æ”¹-feetosetter"><span>3.3 ä¿®æ”¹ feeToSetter</span>
  <a href="#33-%e4%bf%ae%e6%94%b9-feetosetter" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è¿™ä¸ªè„šæœ¬ç”¨äºä¿®æ”¹ Factory åˆçº¦çš„ <code>feeToSetter</code></p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-js"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hardhat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å‡†å¤‡è´¦æˆ·
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">[</span><span class="nx">deployer</span><span class="p">,</span> <span class="nx">user</span><span class="p">]</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] éƒ¨ç½²è€…è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    ç”¨æˆ·è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;    éƒ¨ç½²è€…ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">)),</span> <span class="s2">&#34;ETH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// éƒ¨ç½² Factory åˆçº¦
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="s2">&#34;contracts/uniswap-v2-core/contracts/UniswapV2Factory.sol:UniswapV2Factory&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">FACTORY_ADDRESS</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] Factory åˆçº¦åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">FACTORY_ADDRESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. éªŒè¯åˆå§‹ feeToSetter
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">initialFeeToSetter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">feeToSetter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;âœ… åˆå§‹ feeToSetter:&#34;</span><span class="p">,</span> <span class="nx">initialFeeToSetter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - æ˜¯å¦éƒ¨ç½²è€…?&#34;</span><span class="p">,</span> <span class="nx">initialFeeToSetter</span> <span class="o">===</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span> <span class="o">?</span> <span class="s2">&#34;æ˜¯&#34;</span> <span class="o">:</span> <span class="s2">&#34;å¦&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. ä¿®æ”¹ feeToSetter
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] ä¿®æ”¹ feeToSetter åˆ°ç”¨æˆ·åœ°å€...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">setFeeToSetter</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - äº¤æ˜“å“ˆå¸Œ:&#34;</span><span class="p">,</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. éªŒè¯ä¿®æ”¹ç»“æœ
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">newFeeToSetter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">feeToSetter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\nâœ… æ–° feeToSetter:&#34;</span><span class="p">,</span> <span class="nx">newFeeToSetter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - æ˜¯å¦ç”¨æˆ·?&#34;</span><span class="p">,</span> <span class="nx">newFeeToSetter</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">address</span> <span class="o">?</span> <span class="s2">&#34;æ˜¯&#34;</span> <span class="o">:</span> <span class="s2">&#34;å¦&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 4. å°è¯•ä»éƒ¨ç½²è€…å†æ¬¡ä¿®æ”¹ï¼ˆåº”å¤±è´¥ï¼‰
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] æµ‹è¯•æƒé™éªŒè¯ï¼ˆéƒ¨ç½²è€…åº”ä¸å†æœ‰æƒä¿®æ”¹ï¼‰...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">invalidTx</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">setFeeToSetter</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">invalidTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;âŒ æµ‹è¯•å¤±è´¥ï¼šéƒ¨ç½²è€…ä»èƒ½ä¿®æ”¹ feeToSetter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;âœ… æµ‹è¯•é€šè¿‡ï¼šéƒ¨ç½²è€…æ— æ³•ä¿®æ”¹ feeToSetter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - é”™è¯¯ä¿¡æ¯:&#34;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">reason</span> <span class="o">||</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 5. å°è¯•ä»ç”¨æˆ·ä¿®æ”¹
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] æµ‹è¯•æ–° feeToSetter æƒé™ï¼ˆç”¨æˆ·åº”èƒ½ä¿®æ”¹ï¼‰...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä½¿ç”¨ç”¨æˆ·è´¦æˆ·è¿æ¥å·¥å‚åˆçº¦
</span></span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">factoryAsUser</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">userTx</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factoryAsUser</span><span class="p">.</span><span class="nx">setFeeToSetter</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">userTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;âœ… æµ‹è¯•é€šè¿‡ï¼šç”¨æˆ·æˆåŠŸä¿®æ”¹ feeToSetter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// éªŒè¯ä¿®æ”¹ç»“æœ
</span></span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">finalFeeToSetter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">feeToSetter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - æœ€ç»ˆ feeToSetter:&#34;</span><span class="p">,</span> <span class="nx">finalFeeToSetter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - æ˜¯å¦éƒ¨ç½²è€…?&#34;</span><span class="p">,</span> <span class="nx">finalFeeToSetter</span> <span class="o">===</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span> <span class="o">?</span> <span class="s2">&#34;æ˜¯&#34;</span> <span class="o">:</span> <span class="s2">&#34;å¦&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;âŒ æµ‹è¯•å¤±è´¥ï¼šç”¨æˆ·æ— æ³•ä¿®æ”¹ feeToSetter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;   - é”™è¯¯ä¿¡æ¯:&#34;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">reason</span> <span class="o">||</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">process</span><span class="p">.</span><span class="nx">exitCode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\nè„šæœ¬æ‰§è¡Œå®Œæˆï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// ç¡®ä¿è„šæœ¬é€€å‡º
</span></span></span><span class="line"><span class="cl"><span class="p">});</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>è¿è¡Œåå¯ä»¥çœ‹åˆ°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% npx hardhat run scripts/tmp.js --network localhost
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²è€…è´¦æˆ·: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">    ç”¨æˆ·è´¦æˆ·: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl">    éƒ¨ç½²è€…ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Factory åˆçº¦åœ°å€: 0x5FbDB2315678afecb367f032d93F642f64180aa3
</span></span><span class="line"><span class="cl">âœ… åˆå§‹ feeToSetter: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">   - æ˜¯å¦éƒ¨ç½²è€…? æ˜¯
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ä¿®æ”¹ feeToSetter åˆ°ç”¨æˆ·åœ°å€...
</span></span><span class="line"><span class="cl">   - äº¤æ˜“å“ˆå¸Œ: 0xa25858adc4e98b91cc314456920f202c6f5e2b284c10f83ce131f1a4e64ca515
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">âœ… æ–° feeToSetter: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl">   - æ˜¯å¦ç”¨æˆ·? æ˜¯
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æµ‹è¯•æƒé™éªŒè¯ï¼ˆéƒ¨ç½²è€…åº”ä¸å†æœ‰æƒä¿®æ”¹ï¼‰...
</span></span><span class="line"><span class="cl">âœ… æµ‹è¯•é€šè¿‡ï¼šéƒ¨ç½²è€…æ— æ³•ä¿®æ”¹ feeToSetter
</span></span><span class="line"><span class="cl">   - é”™è¯¯ä¿¡æ¯: Error: VM Exception <span class="k">while</span> processing transaction: reverted with reason string <span class="s1">&#39;UniswapV2: FORBIDDEN&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æµ‹è¯•æ–° feeToSetter æƒé™ï¼ˆç”¨æˆ·åº”èƒ½ä¿®æ”¹ï¼‰...
</span></span><span class="line"><span class="cl">âœ… æµ‹è¯•é€šè¿‡ï¼šç”¨æˆ·æˆåŠŸä¿®æ”¹ feeToSetter
</span></span><span class="line"><span class="cl">   - æœ€ç»ˆ feeToSetter: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl">   - æ˜¯å¦éƒ¨ç½²è€…? æ˜¯
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è„šæœ¬æ‰§è¡Œå®Œæˆï¼</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h2 class="heading-element" id="4-å°ç»“"><span>4. å°ç»“</span>
  <a href="#4-%e5%b0%8f%e7%bb%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><code>createPair</code> ä½¿ç”¨ <code>create2</code> é¢„è®¡ç®—äº¤æ˜“å¯¹åœ°å€ï¼Œåœ°å€å¯é¢„æµ‹</li>
<li><code>getPair</code> æ˜ å°„é¿å…é‡å¤åˆ›å»ºäº¤æ˜“å¯¹</li>
<li><code>PairCreated</code> äº‹ä»¶å¯ç”¨äºå‰ç«¯ç›‘å¬äº¤æ˜“å¯¹åˆ›å»º</li>
<li><code>allPairs</code> åˆ—è¡¨å¯ç”¨äºéå†æ‰€æœ‰äº¤æ˜“å¯¹</li>
</ul>
<h1 class="heading-element" id="uniswapv2æºç é˜…è¯»å››é…å¯¹åˆçº¦uniswapv2pair"><span>UniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå››ï¼‰é…å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰</span>
  <a href="#uniswapv2%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%9b%9b%e9%85%8d%e5%af%b9%e5%90%88%e7%ba%a6uniswapv2pair" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><h2 class="heading-element" id="1-äº¤æ˜“å¯¹åˆçº¦uniswapv2pairç®€è¿°"><span>1. äº¤æ˜“å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰ç®€è¿°</span>
  <a href="#1-%e4%ba%a4%e6%98%93%e5%af%b9%e5%90%88%e7%ba%a6uniswapv2pair%e7%ae%80%e8%bf%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>è¿™éƒ¨åˆ†ä¹‹å‰ä»‹ç»è¿‡</p>
<p><strong>è§’è‰²</strong>ï¼šå®é™…çš„æµåŠ¨æ€§æ± ï¼Œæ‰§è¡Œ AMM é€»è¾‘ï¼Œå¹¶å‘è¡Œ LP ä»£å¸ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><code>swap</code>: æ‰§è¡Œä»£å¸å…‘æ¢ï¼Œå¹¶æ”¶å–åƒåˆ†ä¹‹ä¸‰ï¼ˆ0.3%ï¼‰çš„äº¤æ˜“æ‰‹ç»­è´¹ï¼Œè¯¥è´¹ç”¨<strong>å…¨éƒ¨æ³¨å…¥æµåŠ¨æ€§æ± </strong>ï¼Œæå‡ LP ä»£å¸ä»·å€¼ã€‚</li>
<li><code>mint</code> / <code>burn</code>: ç®¡ç†æµåŠ¨æ€§å¢å‡ï¼Œé“¸é€ /é”€æ¯ LP ä»£å¸ã€‚</li>
<li><strong>ä»·æ ¼é¢„è¨€æœº</strong>: æä¾›æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼ˆTWAPï¼‰åŠŸèƒ½ã€‚TWAP é€šè¿‡åœ¨æ¯æ¬¡æµåŠ¨æ€§æ“ä½œ (<code>mint</code>, <code>burn</code>) æˆ–å…‘æ¢ (<code>swap</code>) è§¦å‘å‚¨å¤‡æ›´æ–° (<code>_update</code>) æ—¶ï¼Œè®¡ç®—è‡ªä¸Šæ¬¡æ›´æ–°ä»¥æ¥çš„æ—¶é—´é—´éš” (<code>timeElapsed</code>)ï¼Œå¹¶æŒ‰ç…§å½“å‰å‚¨å¤‡æ¯”ä¾‹ (<code>reserve1 / reserve0</code>å’Œ <code>reserve0 / reserve1</code>) ä¹˜ä»¥æ—¶é—´é—´éš”æ¥æ›´æ–°ç´¯ç§¯ä»·æ ¼ (<code>price0CumulativeLast</code>å’Œ <code>price1CumulativeLast</code>)ã€‚è¿™ç¡®ä¿äº†ç´¯ç§¯ä»·æ ¼åæ˜ äº†ä»·æ ¼éšæ—¶é—´çš„å˜åŒ–ï¼Œä½†æ›´æ–°ä¾èµ–äºé“¾ä¸Šæ“ä½œçš„å‘ç”Ÿã€‚</li>
<li><strong>é—ªç”µè´·</strong>:  é€šè¿‡ <code>swap</code> çš„ <code>data</code> å‚æ•°å›è°ƒå®ç°ï¼Œç”¨æˆ·å¯åœ¨å•ç¬”äº¤æ˜“ä¸­å€Ÿå‡ºå¹¶å½’è¿˜èµ„äº§ã€‚</li>
</ul>
<p><strong>åŒé‡èº«ä»½</strong>ï¼šå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç¬¦åˆ ERC20 æ ‡å‡†çš„ä»£å¸åˆçº¦ï¼Œå…¶å‘è¡Œçš„ä»£å¸ï¼ˆLPä»£å¸ï¼‰ä»£è¡¨äº†æµåŠ¨æ€§æä¾›è€…åœ¨æ± ä¸­çš„ä»½é¢ã€‚</p>
<h2 class="heading-element" id="2-æºç é˜…è¯»-1"><span>2. æºç é˜…è¯»</span>
  <a href="#2-%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="21-æ ¸å¿ƒçŠ¶æ€å˜é‡"><span>2.1 æ ¸å¿ƒçŠ¶æ€å˜é‡</span>
  <a href="#21-%e6%a0%b8%e5%bf%83%e7%8a%b6%e6%80%81%e5%8f%98%e9%87%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>ä»¥ä¸‹æ˜¯ <code>UniswapV2Pair</code> åˆçº¦ä¸­æ ¸å¿ƒçŠ¶æ€å˜é‡</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kt">uint</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">MINIMUM_LIQUIDITY</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">bytes4</span> <span class="k">private</span> <span class="k">constant</span> <span class="n">SELECTOR</span> <span class="o">=</span> <span class="kt">bytes4</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="kt">bytes</span><span class="p">(</span><span class="s">&#39;transfer(address,uint256)&#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">public</span> <span class="n">factory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">public</span> <span class="n">token0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">public</span> <span class="n">token1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">uint112</span> <span class="k">private</span> <span class="n">reserve0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">uint112</span> <span class="k">private</span> <span class="n">reserve1</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">uint32</span> <span class="k">private</span> <span class="n">blockTimestampLast</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">uint</span> <span class="k">public</span> <span class="n">price0CumulativeLast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">uint</span> <span class="k">public</span> <span class="n">price1CumulativeLast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">uint</span> <span class="k">public</span> <span class="n">kLast</span><span class="p">;</span> </span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><ul>
<li><code>MINIMUM_LIQUIDITY</code>: ä½œç”¨æ˜¯é˜²æ­¢åˆå§‹æµåŠ¨æ€§è¢«å®Œå…¨ç§»é™¤ã€‚åœ¨åˆæ¬¡<code>mint</code>çš„æ—¶å€™ï¼Œä¼šé“¸é€  <code>sqrt(amount0 Ã— amount1)</code> çš„ LP ä»£å¸ï¼Œä½†å…¶ä¸­ 1000ï¼ˆå³ 10^3ï¼‰ä¸ªä¼šè¢«é”€æ¯ï¼ˆ<code>mint</code> ç»™ <code>address(0)</code>ï¼‰ã€‚</li>
<li><code>SELECTOR</code>: ç”¨äºåœ¨ <code>swap</code> å‡½æ•°ä¸­å®‰å…¨è°ƒç”¨ä»£å¸çš„ <code>transfer</code> æ–¹æ³•ã€‚<code>swap</code> æ”¯æŒâ€œå…ˆè½¬å‡ºä»£å¸ï¼Œå†ç”±æ¥æ”¶æ–¹å›è°ƒè¡¥è¶³â€çš„é—ªç”µè´·æ¨¡å¼ã€‚ä¸ºé¿å…è°ƒç”¨æ¶æ„åˆçº¦çš„ <code>transfer</code>ï¼ŒUniswap V2 é€šè¿‡ <code>SELECTOR</code> ç¡®ä¿åªè°ƒç”¨æ ‡å‡† ERC20 çš„ <code>transfer</code> å‡½æ•°</li>
<li><code>factory</code>: è®°å½•åˆ›å»ºè¯¥ Pair çš„å·¥å‚åˆçº¦åœ°å€ï¼ˆå³ UniswapV2Factoryï¼‰</li>
<li><code>token0,token1</code>: ç»„æˆè¯¥äº¤æ˜“å¯¹çš„ä¸¤ä¸ª ERC20 ä»£å¸åœ°å€</li>
<li><code>reserve0,reserve1</code>: åˆ†åˆ«å­˜å‚¨ <code>token0</code> å’Œ <code>token1</code> çš„å½“å‰å‚¨å¤‡é‡</li>
<li><code>blockTimestampLast</code>: è®°å½•ä¸Šæ¬¡æ›´æ–°å‚¨å¤‡çš„æ—¶é—´æˆ³</li>
<li><code>price0CumulativeLast,price1CumulativeLast</code>: åˆ†åˆ«ç´¯è®¡ <code>token1/token0</code> å’Œ <code>token0/token1</code> çš„ä»·æ ¼ç§¯åˆ†å€¼ï¼ˆå³ä»·æ ¼å¯¹æ—¶é—´çš„ç§¯åˆ†ï¼‰ã€‚ä¾›å¤–éƒ¨è°ƒç”¨è€…ï¼ˆå¦‚é¢„è¨€æœºï¼‰é€šè¿‡ <code>(currentCumulative - lastCumulative) / timeElapsed</code> è®¡ç®— TWAP</li>
<li><code>kLast</code>: è®°å½•ä¸Šæ¬¡æ”¶å–åè®®æ‰‹ç»­è´¹æ—¶çš„ <code>reserve0 Ã— reserve1</code> å€¼</li>
</ul>
<h3 class="heading-element" id="22-getreserves"><span>2.2 getReserves()</span>
  <a href="#22-getreserves" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è·å–ä¸¤ä¸ªä»£å¸çš„å‚¨å¤‡é‡å’Œä¸Šæ¬¡æ›´æ–°å‚¨å¤‡çš„æ—¶é—´</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">getReserves</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint112</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve1</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">_blockTimestampLast</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">_reserve0</span> <span class="o">=</span> <span class="n">reserve0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_reserve1</span> <span class="o">=</span> <span class="n">reserve1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_blockTimestampLast</span> <span class="o">=</span> <span class="n">blockTimestampLast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><h3 class="heading-element" id="23-getreserves"><span>2.3 getReserves()</span>
  <a href="#23-getreserves" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>ç”¨äºå®‰å…¨è½¬è´¦ ERC20 ä»£å¸ï¼Œå¹¶ç¡®ä¿è½¬è´¦å¤±è´¥æ—¶èƒ½æ­£ç¡®å›æ»šäº¤æ˜“ã€‚</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">_safeTransfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="nb">data</span><span class="p">)</span> <span class="o">=</span> <span class="n">token</span><span class="p">.</span><span class="nb">call</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSelector</span><span class="p">(</span><span class="n">SELECTOR</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="nb">value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">success</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">decode</span><span class="p">(</span><span class="nb">data</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span><span class="p">))),</span> <span class="s">&#39;UniswapV2: TRANSFER_FAILED&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><h3 class="heading-element" id="24-_update"><span>2.4 _update()</span>
  <a href="#24-_update" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><code>_update</code>æ–¹æ³•ç”¨äºæ›´æ–°å‚¨å¤‡é‡‘ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆè¿›è¡Œæº¢å‡ºæ£€æŸ¥ï¼Œ<code>uint112(-1)</code>è¡¨ç¤º <code>uint112</code> çš„æœ€å¤§å€¼ï¼ˆ2^112 - 1ï¼‰ï¼Œç¡®ä¿ä»£å¸ä½™é¢ä¸è¶…è¿‡ <code>uint112</code> çš„å­˜å‚¨ä¸Šé™ã€‚ç„¶åè·å–æ—¶é—´æˆ³è®¡ç®—å‡ºå½“å‰æ—¶é—´è·ç¦»ä¸Šæ¬¡æ›´æ–°åç»è¿‡çš„æ—¶é—´ã€‚</p>
<p>è®¡ç®—<code>token1 ç›¸å¯¹äº token0 çš„ç´¯ç§¯ä»·æ ¼</code>å’Œ<code>token0 ç›¸å¯¹äº token1 çš„ç´¯ç§¯ä»·æ ¼</code>ï¼Œ å³<code>price0CumulativeLast</code>å’Œ<code>price0CumulativeLast</code>ã€‚å…¶ä¸­ï¼Œ<code>UQ112x112.encode(x)</code> è¡¨ç¤ºå°† <code>uint112</code> è½¬æ¢ä¸º <code>Q112x112</code> å®šç‚¹æ•°ã€‚<code>.uqdiv(x)</code>è¡¨ç¤ºæ— æº¢å‡ºé™¤æ³•</p>
<p>å¯¹æ—¶é—´è¿›è¡ŒåŠ æƒï¼ˆå³<code>* timeElapsed</code>ï¼‰ï¼Œç›¸å½“äºè®¡ç®—äº†ä»ä¸Šæ¬¡æ›´æ–°åˆ°å½“å‰æ—¶åˆ»è¿™æ®µæ—¶é—´å†…ï¼Œä»·æ ¼å¯¹æ—¶é—´çš„â€œç§¯åˆ†â€ã€‚å®ƒä»£è¡¨äº†åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œä»·æ ¼æ›²çº¿ä¸‹çš„â€œé¢ç§¯â€ï¼Œç„¶åè¿›è¡Œç´¯åŠ ã€‚ä¹Ÿå°±æ˜¯åœ¨è®¡ç®—TWAPã€‚</p>
<p><code>price0CumulativeLas</code>tå› æ­¤æˆä¸ºäº†ä¸€ä¸ª â€‹ä»æŸä¸ªèµ·å§‹æ—¶é—´ç‚¹å¼€å§‹ï¼Œ<code>token0</code> ç›¸å¯¹äº <code>token1</code> çš„ä»·æ ¼å¯¹æ—¶é—´çš„ç´¯è®¡ç§¯åˆ†ã€‚å®ƒæ˜¯ä¸€ä¸ªéšæ—¶é—´å•è°ƒé€’å¢ï¼ˆæˆ–é€’å‡ï¼Œå¦‚æœä»·æ ¼å˜ä¸ºè´Ÿï¼Œä½†ä»·æ ¼é€šå¸¸ä¸ºæ­£ï¼‰çš„å€¼ã€‚</p>
<p>è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†æŠ—æ“çºµæ€§ã€‚å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ä¸Šçš„ç¬æ—¶ä»·æ ¼å¾ˆå®¹æ˜“è¢«å¤§é¢äº¤æ˜“ï¼ˆå¦‚é—ªç”µè´·æ”»å‡»ï¼‰ç¬é—´æ“çºµã€‚TWAP é€šè¿‡è®¡ç®—ä¸€æ®µæ—¶é—´å†…çš„å¹³å‡ä»·æ ¼ï¼Œå¤§å¤§å¢åŠ äº†æ“çºµä»·æ ¼çš„æˆæœ¬å’Œéš¾åº¦ã€‚</p>
<p>æœ€åå°±æ˜¯æ›´æ–°å‚¨å¤‡é‡å’Œæ—¶é—´æˆ³ï¼Œæ›´æ–°æœ€åæ—¶é—´æˆ³ä¸ºå½“å‰åŒºå—æ—¶é—´ã€‚</p>
<p>å…·ä½“è®¡ç®—TWAPçš„è¯ï¼š</p>
<ol>
<li>åœ¨æ—¶é—´ç‚¹ <code>t1</code> è¯»å– <code>price0CumulativeLast</code> çš„å€¼ï¼Œè®°ä¸º <code>C1</code>ã€‚</li>
<li>åœ¨ç¨åçš„æ—¶é—´ç‚¹ <code>t2</code> å†æ¬¡è¯»å– <code>price0CumulativeLast</code> çš„å€¼ï¼Œè®°ä¸º <code>C2</code>ã€‚</li>
<li>è®¡ç®—æ—¶é—´å·® <code>T = t2 - t1ï¼ˆç§’ï¼‰</code>ã€‚</li>
<li>è®¡ç®— TWAPï¼š<code>TWAP = (C2 - C1) / T</code>ã€‚
<ul>
<li>è¿™é‡Œçš„ <code>(C2 - C1)</code> å°±æ˜¯æ—¶é—´åŒºé—´ Tå†…çš„ä»·æ ¼ç´¯è®¡å¢é‡ï¼ˆå³ä»·æ ¼å¯¹æ—¶é—´çš„ç§¯åˆ†ï¼‰ã€‚</li>
<li>é™¤ä»¥ <code>T</code> å°±å¾—åˆ°äº†è¯¥æ—¶é—´æ®µå†…çš„å¹³å‡ä»·æ ¼ã€‚</li>
</ul>
</li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">_update</span><span class="p">(</span><span class="kt">uint</span> <span class="n">balance0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">balance1</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve1</span><span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">balance0</span> <span class="o">&lt;=</span> <span class="kt">uint112</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">balance1</span> <span class="o">&lt;=</span> <span class="kt">uint112</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;UniswapV2: OVERFLOW&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32</span> <span class="n">blockTimestamp</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32</span> <span class="n">timeElapsed</span> <span class="o">=</span> <span class="n">blockTimestamp</span> <span class="o">-</span> <span class="n">blockTimestampLast</span><span class="p">;</span> <span class="c1">// overflow is desired
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">timeElapsed</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">_reserve0</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">_reserve1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">price0CumulativeLast</span> <span class="o">+=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">UQ112x112</span><span class="p">.</span><span class="nb">encode</span><span class="p">(</span><span class="n">_reserve1</span><span class="p">).</span><span class="n">uqdiv</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">))</span> <span class="o">*</span> <span class="n">timeElapsed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">price1CumulativeLast</span> <span class="o">+=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">UQ112x112</span><span class="p">.</span><span class="nb">encode</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">).</span><span class="n">uqdiv</span><span class="p">(</span><span class="n">_reserve1</span><span class="p">))</span> <span class="o">*</span> <span class="n">timeElapsed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">reserve0</span> <span class="o">=</span> <span class="kt">uint112</span><span class="p">(</span><span class="n">balance0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">reserve1</span> <span class="o">=</span> <span class="kt">uint112</span><span class="p">(</span><span class="n">balance1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">blockTimestampLast</span> <span class="o">=</span> <span class="n">blockTimestamp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">emit</span> <span class="n">Sync</span><span class="p">(</span><span class="n">reserve0</span><span class="p">,</span> <span class="n">reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="24-_mintfee"><span>2.4 _mintFee()</span>
  <a href="#24-_mintfee" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è¿™æ˜¯ Uniswap V2 çš„åè®®æ‰‹ç»­è´¹è®¡ç®—å‡½æ•°ï¼Œè´Ÿè´£åœ¨æµåŠ¨æ€§å¢é•¿æ—¶é“¸é€ é¢å¤–çš„æµåŠ¨æ€§ä»£å¸ä½œä¸ºåè®®æ”¶å…¥ã€‚</p>
<p>é¦–å…ˆä»å·¥å‚åˆçº¦è·å–åè®®æ‰‹ç»­è´¹æ¥æ”¶åœ°å€ <code>feeTo</code>ï¼Œå¦‚æœ <code>feeTo</code> ä¸æ˜¯é›¶åœ°å€ï¼Œè¯´æ˜åè®®æ‰‹ç»­è´¹åŠŸèƒ½å·²å¯ç”¨ã€‚</p>
<p>å½“æ‰‹ç»­è´¹åŠŸèƒ½å¼€å¯æ—¶è®¡ç®—æ‰‹ç»­è´¹ï¼Œç„¶åé“¸é€ è®¡ç®—å‡ºçš„æµåŠ¨æ€§ä»£å¸ç»™ <code>feeTo</code> åœ°å€ã€‚</p>
<p>æ‰‹ç»­è´¹åŠŸèƒ½å¼€å¯æ—¶æ‰‹ç»­è´¹è®¡ç®—æ–¹æ³•è¿™éƒ¨åˆ†ä¹‹å‰å·²ç»å†™è¿‡äº†ï¼Œæ‰€ä»¥ç›´æ¥æ‹·è´è¿‡æ¥ï¼š</p>
<h4 class="heading-element" id="241-uniswap-v2-åè®®æ‰‹ç»­è´¹-protocol_fee-æœºåˆ¶"><span>2.4.1 Uniswap V2 åè®®æ‰‹ç»­è´¹ (PROTOCOL_FEE) æœºåˆ¶</span>
  <a href="#241-uniswap-v2-%e5%8d%8f%e8%ae%ae%e6%89%8b%e7%bb%ad%e8%b4%b9-protocol_fee-%e6%9c%ba%e5%88%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><h5 class="heading-element" id="2411-é¡¹ç›®æ–¹çš„éœ€æ±‚"><span>2.4.1.1 <strong>é¡¹ç›®æ–¹çš„éœ€æ±‚</strong></span>
  <a href="#2411-%e9%a1%b9%e7%9b%ae%e6%96%b9%e7%9a%84%e9%9c%80%e6%b1%82" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><ul>
<li>åœ¨ Uniswap V1 ä¸­ï¼Œæ‰€æœ‰æ‰‹ç»­è´¹éƒ½å½’ LP æ‰€æœ‰ï¼Œåè®®å¼€å‘è€…ï¼ˆUniswap å›¢é˜Ÿï¼‰è‡ªèº«æ— æ³•ä»ä¸­ç›´æ¥è·åˆ©ã€‚</li>
<li>ä¸ºäº†æ¿€åŠ±åè®®çš„æŒç»­å¼€å‘å’Œç»´æŠ¤ï¼ŒUniswap V2 å¼•å…¥äº†åè®®æ‰‹ç»­è´¹æœºåˆ¶ï¼Œå…è®¸é¡¹ç›®æ–¹ä»åè®®ä¸­åˆ†å¾—ä¸€æ¯ç¾¹ã€‚</li>
</ul>
<h5 class="heading-element" id="2412-phi-phi-å‚æ•°"><span>2.4.1.2 <code>phi</code> ($\phi$) å‚æ•°</span>
  <a href="#2412-phi-phi-%e5%8f%82%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><ul>
<li><strong>å®šä¹‰</strong>ï¼š$\phi$ (phi) ä»£è¡¨é¡¹ç›®æ–¹å¸Œæœ›ä»æ€»æ‰‹ç»­è´¹ä¸­åˆ†èµ°çš„æ¯”ä¾‹ã€‚
<ul>
<li>ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®æ–¹æƒ³åˆ†èµ° 0.3% æ‰‹ç»­è´¹ä¸­çš„ 1/6ï¼Œé‚£ä¹ˆ $\phi = 1/6$ã€‚</li>
<li>å®é™…æ”¶å–çš„åè®®è´¹ç‡ä¸º $0.3% \times \frac{1}{6} = 0.05%$ (ä¸‡åˆ†ä¹‹äº”)ã€‚</li>
</ul>
</li>
</ul>
<h5 class="heading-element" id="2413-å®ç°æ–¹å¼å¢å‘-share"><span>2.4.1.3 å®ç°æ–¹å¼ï¼šå¢å‘ Share</span>
  <a href="#2413-%e5%ae%9e%e7%8e%b0%e6%96%b9%e5%bc%8f%e5%a2%9e%e5%8f%91-share" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><ul>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé¡¹ç›®æ–¹é€šå¸¸ä¸æä¾›æµåŠ¨æ€§ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æŒæœ‰ LP Token æ¥åˆ†äº«æ”¶ç›Šã€‚ä¸ºäº†è®©é¡¹ç›®æ–¹è·å¾—æ”¶ç›Šï¼ŒUniswap V2 é‡‡å–äº†<strong>å¢å‘æ–°çš„ LP Token (Share)</strong> ç»™é¡¹ç›®æ–¹çš„æ–¹å¼ã€‚</li>
<li><strong>â€œåšå¤§è›‹ç³•ï¼Œåˆ†å¢é‡â€</strong>ï¼šé¡¹ç›®æ–¹å¢å‘ Share çš„é€»è¾‘æ˜¯ï¼Œåœ¨æµåŠ¨æ€§æ± å› æ‰‹ç»­è´¹è€Œå˜å¤§ï¼ˆè›‹ç³•å˜å¤§ï¼‰çš„åŒæ—¶ï¼Œä»è¿™ä¸ªâ€œå˜å¤§çš„éƒ¨åˆ†â€ä¸­åˆ†èµ°ä¸€å°å—ï¼Œè€Œä¸æ˜¯ä¾µå ç°æœ‰ LP çš„åˆå§‹åˆ©ç›Šã€‚</li>
</ul>
<h5 class="heading-element" id="2414-æ•°å­¦æ¨å¯¼sm-çš„è®¡ç®—"><span>2.4.1.4 æ•°å­¦æ¨å¯¼ï¼š<code>SM</code> çš„è®¡ç®—</span>
  <a href="#2414-%e6%95%b0%e5%ad%a6%e6%8e%a8%e5%af%bcsm-%e7%9a%84%e8%ae%a1%e7%ae%97" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>å‡è®¾ï¼š</p>
<ul>
<li>$S_1$ï¼š<code>T1</code> æ—¶åˆ» LP æŒæœ‰çš„ LP Token æ€»é‡ã€‚</li>
<li>$K_1$ï¼š<code>T1</code> æ—¶åˆ»æ± å­çš„æµåŠ¨æ€§å¸¸æ•°ã€‚</li>
<li>$K_2$ï¼š<code>T2</code> æ—¶åˆ»æ± å­çš„æµåŠ¨æ€§å¸¸æ•°ï¼ˆå› æ‰‹ç»­è´¹ç§¯ç´¯è€Œå¢é•¿ï¼‰ã€‚</li>
<li>$SM$ï¼šé¡¹ç›®æ–¹åœ¨ <code>T2</code> æ—¶åˆ»åº”å¢å‘çš„æ–° LP Token æ•°é‡ã€‚</li>
<li>$\phi$ï¼šé¡¹ç›®æ–¹å¸Œæœ›åˆ†èµ°çš„æ‰‹ç»­è´¹æ¯”ä¾‹ã€‚</li>
</ul>
<p>åè®®æ‰‹ç»­è´¹çš„è®¡ç®—åŸºäºä»¥ä¸‹å…¬å¼ï¼š
$$
\frac{SM}{S_1 + SM} = \phi \cdot \frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}
$$
è¿™ä¸ªå…¬å¼çš„å«ä¹‰æ˜¯ï¼š</p>
<ul>
<li>å·¦ä¾§ $\frac{SM}{S_1 + SM}$ ä»£è¡¨é¡¹ç›®æ–¹å¢å‘çš„ Share å æ€» Share æ•°é‡çš„æ¯”ä¾‹ã€‚</li>
<li>å³ä¾§ $\frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}$ ä»£è¡¨ä» <code>T1</code> åˆ° <code>T2</code> æ—¶åˆ»ï¼Œå› æ‰‹ç»­è´¹ç§¯ç´¯è€Œå¯¼è‡´çš„æµåŠ¨æ€§ï¼ˆ<code>L = sqrt(K)</code>ï¼‰çš„å¢é•¿æ¯”ä¾‹ã€‚</li>
<li>$\phi$ æ˜¯é¡¹ç›®æ–¹ä»è¿™ä¸ªå¢é•¿æ¯”ä¾‹ä¸­åˆ†èµ°çš„ä»½é¢ã€‚</li>
</ul>
<p>é€šè¿‡å¯¹ä¸Šè¿°å…¬å¼è¿›è¡Œæ¨å¯¼ï¼Œå¯ä»¥æ±‚å¾— <code>SM</code> çš„è¡¨è¾¾å¼ï¼š</p>
<p><strong>æ¨å¯¼è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>åˆå§‹å…¬å¼ï¼š
$$
\frac{SM}{S_1 + SM} = \phi \cdot \frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}
$$</li>
<li>å°†å³ä¾§çš„ $\frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}$ è®°ä¸º $F_{ratio}$ (æ‰‹ç»­è´¹å¯¼è‡´çš„æµåŠ¨æ€§å¢é•¿æ¯”ä¾‹)ã€‚
$$
\frac{SM}{S_1 + SM} = \phi \cdot F_{ratio}
$$</li>
<li>äº¤å‰ç›¸ä¹˜ï¼š
$$
SM = \phi \cdot F_{ratio} \cdot (S_1 + SM)
$$</li>
<li>å±•å¼€ï¼š
$$
SM = \phi \cdot F_{ratio} \cdot S_1 + \phi \cdot F_{ratio} \cdot SM
$$</li>
<li>å°†åŒ…å« $SM$ çš„é¡¹ç§»åˆ°ç­‰å¼å·¦ä¾§ï¼š
$$
SM - \phi \cdot F_{ratio} \cdot SM = \phi \cdot F_{ratio} \cdot S_1
$$</li>
<li>æå– $SM$ï¼š
$$
SM \cdot (1 - \phi \cdot F_{ratio}) = \phi \cdot F_{ratio} \cdot S_1
$$</li>
<li>è§£å‡º $SM$ï¼š
$$
SM = \frac{\phi \cdot F_{ratio}}{1 - \phi \cdot F_{ratio}} \cdot S_1
$$</li>
<li>å°† $F_{ratio} = \frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}$ ä»£å›ï¼š
$$
SM = \frac{\phi \cdot \frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}}{1 - \phi \cdot \frac{\sqrt{K_2} - \sqrt{K_1}}{\sqrt{K_2}}} \cdot S_1
$$</li>
<li>ä¸ºäº†ç®€åŒ–ï¼Œåˆ†å­åˆ†æ¯åŒä¹˜ä»¥ $\sqrt{K_2}$ï¼š
$$
SM = \frac{\phi \cdot (\sqrt{K_2} - \sqrt{K_1})}{\sqrt{K_2} - \phi \cdot (\sqrt{K_2} - \sqrt{K_1})} \cdot S_1
$$</li>
<li>è¿›ä¸€æ­¥æ•´ç†åˆ†æ¯ï¼š
$$
\sqrt{K_2} - \phi\sqrt{K_2} + \phi\sqrt{K_1} = (1-\phi)\sqrt{K_2} + \phi\sqrt{K_1}
$$</li>
<li>æœ€ç»ˆå¾—åˆ° $SM$ çš„è¡¨è¾¾å¼ï¼š
$$
SM = \frac{\phi \cdot (\sqrt{K_2} - \sqrt{K_1})}{(1-\phi)\sqrt{K_2} + \phi\sqrt{K_1}} \cdot S_1
$$</li>
<li>ä¸ºäº†å¾—åˆ°ä¸ç™½çš®ä¹¦å’Œä»£ç å®ç°ä¸€è‡´çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ†å­åˆ†æ¯åŒé™¤ä»¥ $\phi$ï¼š
$$
SM = \frac{\frac{\phi}{\phi} \cdot (\sqrt{K_2} - \sqrt{K_1})}{\frac{(1-\phi)}{\phi}\sqrt{K_2} + \frac{\phi}{\phi}\sqrt{K_1}} \cdot S_1
$$
$$
SM = \frac{\sqrt{K_2} - \sqrt{K_1}}{(\frac{1}{\phi} - 1)\sqrt{K_2} + \sqrt{K_1}} \cdot S_1
$$
å½“ Uniswap V2 åè®®è´¹æ¯”ä¾‹ $\phi = 1/6$ æ—¶ï¼Œ$\frac{1}{\phi} - 1 = \frac{1}{1/6} - 1 = 6 - 1 = 5$ã€‚
å› æ­¤ï¼Œæœ€ç»ˆç”¨äºè®¡ç®—çš„ <code>SM</code> å…¬å¼ä¸ºï¼š
$$
SM = \frac{\sqrt{K_2} - \sqrt{K_1}}{5 \cdot \sqrt{K_2} + \sqrt{K_1}} \cdot S_1
$$
è¿™ä¸ªå…¬å¼ä¸ Uniswap V2 ç™½çš®ä¹¦å’Œä»£ç å®ç°ä¸­çš„é€»è¾‘å®Œå…¨ä¸€è‡´ã€‚</li>
</ol>
<h4 class="heading-element" id="242-ä»£ç å®ç°"><span>2.4.2 ä»£ç å®ç°</span>
  <a href="#242-%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">_mintFee</span><span class="p">(</span><span class="kt">uint112</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve1</span><span class="p">)</span> <span class="k">private</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">feeOn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="n">feeTo</span> <span class="o">=</span> <span class="n">IUniswapV2Factory</span><span class="p">(</span><span class="n">factory</span><span class="p">).</span><span class="n">feeTo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">feeOn</span> <span class="o">=</span> <span class="n">feeTo</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">_kLast</span> <span class="o">=</span> <span class="n">kLast</span><span class="p">;</span> <span class="c1">// gas savings
</span></span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">feeOn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_kLast</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint</span> <span class="n">rootK</span> <span class="o">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">).</span><span class="n">mul</span><span class="p">(</span><span class="n">_reserve1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint</span> <span class="n">rootKLast</span> <span class="o">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_kLast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">rootK</span> <span class="o">&gt;</span> <span class="n">rootKLast</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">uint</span> <span class="n">numerator</span> <span class="o">=</span> <span class="n">totalSupply</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">rootK</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">rootKLast</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="kt">uint</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">rootK</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">rootKLast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="kt">uint</span> <span class="n">liquidity</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">liquidity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">_mint</span><span class="p">(</span><span class="n">feeTo</span><span class="p">,</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">_kLast</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">kLast</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="25-mint"><span>2.5 mint()</span>
  <a href="#25-mint" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è¿™æ˜¯æ·»åŠ æµåŠ¨æ€§çš„æ ¸å¿ƒå‡½æ•°ï¼Œç”¨æˆ·é€šè¿‡å‘äº¤æ˜“å¯¹åˆçº¦å­˜å…¥ä»£å¸æ¥è·å¾—æµåŠ¨æ€§ä»£å¸ï¼ˆLP Tokenï¼‰ï¼ŒåŒæ—¶å¤„ç†é¦–æ¬¡æ·»åŠ çš„ç‰¹æ®Šé€»è¾‘ã€åè®®æ‰‹ç»­è´¹è®¡ç®—å’ŒçŠ¶æ€æ›´æ–°ã€‚</p>
<p>åŒæ ·çš„ï¼Œå…ˆè·å–è·å–å½“å‰å‚¨å¤‡é‡å’Œå½“å‰å®é™…ä»£å¸ä½™é¢ã€‚ç„¶åè·å–å½“å‰åˆçº¦å®é™…æŒæœ‰çš„ä»£å¸ä½™é¢ï¼Œè¿™æ˜¯å½“å‰æ± å­çœŸå®æŒæœ‰çš„ä»£å¸æ•°é‡ï¼ˆåŒ…æ‹¬ç”¨æˆ·åˆšåˆšè½¬å…¥çš„ï¼‰ï¼Œå› ä¸ºç”¨æˆ·åœ¨è°ƒç”¨ <code>mint</code> å‰å·²å°†ä»£å¸ <code>transfer</code> åˆ° Pair åˆçº¦ï¼Œæ‰€ä»¥ï¼š<code>balance0 &gt;= _reserve0</code>, <code>balance1 &gt;= _reserve1</code>ã€‚</p>
<p>ä¹‹åè®¡ç®—ç”¨æˆ·æ–°å¢çš„ä»£å¸æ•°é‡ï¼Œ<code>amount0</code> å’Œ <code>amount1</code> å°±æ˜¯ç”¨æˆ·æœ¬æ¬¡æä¾›çš„æµåŠ¨æ€§ï¼Œç„¶åå¤„ç†åè®®æ‰‹ç»­è´¹ã€‚å³è®¡ç®—åº”å¥–åŠ±ç»™ <code>feeTo</code> çš„é¢å¤– LPï¼Œå‘ <code>feeTo</code> é“¸é€ è¿™éƒ¨åˆ† LPå¹¶ä¿®æ”¹<code>totalSupply</code>ã€‚</p>
<p>ç„¶åè¯»å–å½“å‰LPæ€»ä¾›åº”é‡ <code>totalSupply</code>ï¼Œè¿™ä¸ªè¯»å–çš„æ—¶æœºå¾ˆé‡è¦ï¼Œå¿…é¡»åœ¨<code>_mintFee</code>ä¹‹åè¯»å–ã€‚</p>
<p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ æµåŠ¨æ€§ï¼Œéœ€è¦å‡å» <code>MINIMUM_LIQUIDITY</code>ï¼Œç›®çš„å¦‚ä¸‹ï¼š</p>
<ul>
<li>é˜²æ­¢æ€»ä¾›åº”é‡ä¸º 0ï¼ˆé¿å…åç»­é™¤é›¶é”™è¯¯ï¼‰ï¼›</li>
<li>é˜²æ­¢ç¬¬ä¸€ä¸ª LP æä¾›è€…ç§»é™¤å…¨éƒ¨æµåŠ¨æ€§ï¼ˆå› ä¸º 1000 LP æ°¸è¿œæ— æ³•èµå›ï¼‰ï¼›</li>
<li>è¿™æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œä¸æ˜¯â€œé”å®šæµåŠ¨æ€§â€ï¼Œè€Œæ˜¯â€œæ°¸ä¹…é”€æ¯ä¸€å°éƒ¨åˆ† LPâ€ã€‚</li>
</ul>
<p>åç»­æ·»åŠ æµåŠ¨æ€§çš„è¯å°±æŒ‰ç…§æ¯”ä¾‹è®¡ç®—ï¼šç”¨æˆ·åº”å¾—çš„ <code>LP æ•°é‡ = å…¶è´¡çŒ® / å½“å‰å‚¨å¤‡ Ã— æ€» LP</code>ï¼Œè¿˜æœ‰éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå–ä¸¤ä¸ªå¸ç§çš„æœ€å°å€¼ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¸ç ´å <code>x * y = k</code>ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯éªŒè¯é“¸é€ æ•°é‡æœ‰æ•ˆï¼Œé“¸é€  LP ä»£å¸ç»™æ¥æ”¶è€…(<code>_mint(to, liquidity)</code>) å¹¶æ›´æ–°æ± å­çŠ¶æ€(<code>_update(balance0, balance1, _reserve0, _reserve1)</code>)</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="n">lock</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">liquidity</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">uint112</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve1</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">getReserves</span><span class="p">();</span> <span class="c1">// gas savings
</span></span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">balance0</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">token0</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">balance1</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">token1</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">amount0</span> <span class="o">=</span> <span class="n">balance0</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">amount1</span> <span class="o">=</span> <span class="n">balance1</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="n">feeOn</span> <span class="o">=</span> <span class="n">_mintFee</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">,</span> <span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">_totalSupply</span> <span class="o">=</span> <span class="n">totalSupply</span><span class="p">;</span> <span class="c1">// gas savings, must be defined here since totalSupply can update in _mintFee
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">_totalSupply</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">liquidity</span> <span class="o">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">amount0</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">amount1</span><span class="p">)).</span><span class="n">sub</span><span class="p">(</span><span class="n">MINIMUM_LIQUIDITY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">_mint</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">MINIMUM_LIQUIDITY</span><span class="p">);</span> <span class="c1">// permanently lock the first MINIMUM_LIQUIDITY tokens
</span></span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">liquidity</span> <span class="o">=</span> <span class="n">Math</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">amount0</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">_totalSupply</span><span class="p">)</span> <span class="o">/</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="n">amount1</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">_totalSupply</span><span class="p">)</span> <span class="o">/</span> <span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">liquidity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;UniswapV2: INSUFFICIENT_LIQUIDITY_MINTED&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">_mint</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">_update</span><span class="p">(</span><span class="n">balance0</span><span class="p">,</span> <span class="n">balance1</span><span class="p">,</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">feeOn</span><span class="p">)</span> <span class="n">kLast</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">reserve0</span><span class="p">).</span><span class="n">mul</span><span class="p">(</span><span class="n">reserve1</span><span class="p">);</span> <span class="c1">// reserve0 and reserve1 are up-to-date
</span></span></span><span class="line"><span class="cl">    <span class="n">emit</span> <span class="n">Mint</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="n">amount0</span><span class="p">,</span> <span class="n">amount1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="26-burn"><span>2.6 burn()</span>
  <a href="#26-burn" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºç§»é™¤æµåŠ¨æ€§ï¼Œçœ‹äº†æ·»åŠ æµåŠ¨æ€§å†çœ‹è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="c1">// ç§»é™¤æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">burn</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="n">lock</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">uint112</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve1</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">getReserves</span><span class="p">();</span> <span class="c1">// gas savings
</span></span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="n">_token0</span> <span class="o">=</span> <span class="n">token0</span><span class="p">;</span> <span class="c1">// gas savings
</span></span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="n">_token1</span> <span class="o">=</span> <span class="n">token1</span><span class="p">;</span> <span class="c1">// gas savings
</span></span></span><span class="line"><span class="cl">    <span class="c1">// è·å–å½“å‰åˆçº¦æŒæœ‰çš„ä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">balance0</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">_token0</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">balance1</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">_token1</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–è¦èµå›çš„ LP æ•°é‡ï¼Œåˆçº¦ä¼šçƒ§æ¯è¿™éƒ¨åˆ† LPï¼Œå¹¶æŒ‰æ¯”ä¾‹è¿”è¿˜åº•å±‚èµ„äº§ã€‚
</span></span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">liquidity</span> <span class="o">=</span> <span class="n">balanceOf</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="n">feeOn</span> <span class="o">=</span> <span class="n">_mintFee</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">,</span> <span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">_totalSupply</span> <span class="o">=</span> <span class="n">totalSupply</span><span class="p">;</span> <span class="c1">// æ³¨æ„æ—¶æœº
</span></span></span><span class="line"><span class="cl">    <span class="c1">// è®¡ç®—åº”è¿”è¿˜çš„ä»£å¸æ•°é‡ï¼ˆæŒ‰æ¯”ä¾‹ï¼‰
</span></span></span><span class="line"><span class="cl">    <span class="n">amount0</span> <span class="o">=</span> <span class="n">liquidity</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">balance0</span><span class="p">)</span> <span class="o">/</span> <span class="n">_totalSupply</span><span class="p">;</span> <span class="c1">// using balances ensures pro-rata distribution
</span></span></span><span class="line"><span class="cl">    <span class="n">amount1</span> <span class="o">=</span> <span class="n">liquidity</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">balance1</span><span class="p">)</span> <span class="o">/</span> <span class="n">_totalSupply</span><span class="p">;</span> <span class="c1">// using balances ensures pro-rata distribution
</span></span></span><span class="line"><span class="cl">    <span class="c1">// éªŒè¯èµå›é‡‘é¢æœ‰æ•ˆ
</span></span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">amount0</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">amount1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;UniswapV2: INSUFFICIENT_LIQUIDITY_BURNED&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">_burn</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">liquidity</span><span class="p">);</span> <span class="c1">// çƒ§æ¯ LP ä»£å¸
</span></span></span><span class="line"><span class="cl">    <span class="n">_safeTransfer</span><span class="p">(</span><span class="n">_token0</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount0</span><span class="p">);</span> <span class="c1">// å°†ä»£å¸è½¬ç»™ç”¨æˆ·æŒ‡å®šåœ°å€
</span></span></span><span class="line"><span class="cl">    <span class="n">_safeTransfer</span><span class="p">(</span><span class="n">_token1</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é‡æ–°è·å–è½¬è´¦åçš„ä½™é¢ï¼ˆç”¨äºçŠ¶æ€æ›´æ–°ï¼‰
</span></span></span><span class="line"><span class="cl">    <span class="n">balance0</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">_token0</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">balance1</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">_token1</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//  æ›´æ–°å‚¨å¤‡å’Œæ—¶é—´æˆ³
</span></span></span><span class="line"><span class="cl">    <span class="n">_update</span><span class="p">(</span><span class="n">balance0</span><span class="p">,</span> <span class="n">balance1</span><span class="p">,</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">feeOn</span><span class="p">)</span> <span class="n">kLast</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">reserve0</span><span class="p">).</span><span class="n">mul</span><span class="p">(</span><span class="n">reserve1</span><span class="p">);</span> <span class="c1">// reserve0 and reserve1 are up-to-date
</span></span></span><span class="line"><span class="cl">    <span class="n">emit</span> <span class="n">Burn</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="n">amount0</span><span class="p">,</span> <span class="n">amount1</span><span class="p">,</span> <span class="n">to</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="27-swap"><span>2.7 swap</span>
  <a href="#27-swap" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>swap å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œ ä»£å¸å…‘æ¢ï¼ˆtoken swapï¼‰ã€‚æ˜¯ Uniswap V2 çš„æ ¸å¿ƒäº¤æ˜“é€»è¾‘ï¼Œå®ç°äº†æ’å®šä¹˜ç§¯åšå¸‚å•†æ¨¡å‹ï¼ˆ<code>x * y = k</code>ï¼‰ã€‚</p>
<p>é¦–å…ˆéªŒè¯è¾“å‡ºé‡‘é¢æœ‰æ•ˆï¼Œè‡³å°‘è¦å…‘æ¢å‡ºä¸€ç§ä»£å¸ï¼Œä¸èƒ½ä¸¤ä¸ªéƒ½ä¸º 0ã€‚ç„¶åè·å–å½“å‰å‚¨å¤‡é‡ï¼Œå¹¶éªŒè¯æ± å­æœ‰è¶³å¤ŸæµåŠ¨æ€§ï¼Œä¸èƒ½å…‘æ¢è¶…è¿‡å½“å‰å‚¨å¤‡çš„ä»£å¸ï¼ˆå¿…é¡»ç•™è‡³å°‘ 1 weiï¼Œé˜²æ­¢é™¤é›¶æˆ–æ± å­æ¯ç«­ï¼‰ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å°äºå¹¶ä¸æ˜¯å°äºç­‰äºï¼Œç¡®ä¿æ± å­æ°¸ä¸ä¸ºç©ºã€‚</p>
<p>ç„¶åéªŒè¯æ¥æ”¶åœ°å€åˆæ³•ï¼Œç¦æ­¢å°†ä»£å¸è½¬ç»™ <code>token0</code> æˆ– <code>token1</code> åˆçº¦æœ¬èº«ã€‚è¿™æ˜¯å› ä¸ºæŸäº› ERC20 åˆçº¦åœ¨æ”¶åˆ°ä»£å¸æ—¶ä¼šæ‰§è¡Œé€»è¾‘ï¼ˆå¦‚é”€æ¯ã€å›è°ƒï¼‰ï¼Œå¯èƒ½å¯¼è‡´èµ„é‡‘é”å®šæˆ–æ”»å‡»ã€‚</p>
<p>ä¹‹åä½¿ç”¨<code>_safeTransfer</code>è¿›è¡Œè½¬è´¦ï¼Œå…ˆå°†ç”¨æˆ·è¦çš„ä»£å¸æå‰è½¬å‡ºï¼Œå†éªŒè¯ç”¨æˆ·æ˜¯å¦æ”¯ä»˜äº†è¶³å¤Ÿå¯¹ä»·ã€‚è¿™æ˜¯â€œä¹è§‚â€æ‰§è¡Œâ€”â€”å‡è®¾ç”¨æˆ·ä¼šé€šè¿‡å›è°ƒè¡¥è¶³æ”¯ä»˜ã€‚å¦‚æœåç»­éªŒè¯å¤±è´¥ï¼Œæ•´ä¸ªäº¤æ˜“ä¼š <code>revert</code>ï¼Œè½¬è´¦ä¹Ÿä¼šå›æ»šã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹ï¼šæ”¯æŒé—ªç”µè´·ï¼ˆFlash Swapï¼‰ï¼ç”¨æˆ·å¯ä»¥å…ˆæ‹¿èµ°ä»£å¸ï¼Œåªè¦åœ¨å›è°ƒä¸­è¿˜å›æ¥ï¼ˆæˆ–æ”¯ä»˜å¯¹ä»·ï¼‰å³å¯ã€‚</p>
</blockquote>
<p>ä¹‹åè°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆæ”¯æŒé—ªç”µè´·å’Œå¤æ‚é€»è¾‘ï¼‰ï¼š</p>
<ul>
<li>å¦‚æœ <code>data</code> éç©ºï¼Œè¯´æ˜ <code>to</code> æ˜¯ä¸€ä¸ªåˆçº¦ï¼Œä¸”å®ç°äº† <code>uniswapV2Call</code> æ¥å£ã€‚</li>
<li>è°ƒç”¨è¯¥å›è°ƒï¼Œå…è®¸ <code>to</code> æ‰§è¡Œä»»æ„é€»è¾‘ï¼Œä¾‹å¦‚ï¼š
<ul>
<li>ç”¨å€Ÿå‡ºçš„ä»£å¸è¿›è¡Œå¥—åˆ©ï¼›</li>
<li>æ”¯ä»˜å…‘æ¢æ‰€éœ€çš„å¦ä¸€ç§ä»£å¸ï¼›</li>
<li>æ‰§è¡Œç»„åˆç­–ç•¥ã€‚</li>
</ul>
</li>
<li>è¿™æ˜¯é—ªç”µè´·å’Œå¤æ‚ DeFi ç»„åˆçš„åŸºç¡€ã€‚</li>
</ul>
<p>å†ä¹‹åè·å–è½¬è´¦+å›è°ƒåçš„å®é™…ä½™é¢ï¼Œæ­¤æ—¶æ± å­ä½™é¢ = åŸå‚¨å¤‡ - å·²è½¬å‡º + ç”¨æˆ·åœ¨å›è°ƒä¸­è½¬å…¥çš„ä»£å¸ï¼Œè¿™äº›å€¼å°†ç”¨äºè®¡ç®—ç”¨æˆ·å®é™…æ”¯ä»˜äº†å¤šå°‘ï¼ˆ<code>amount0In</code>, <code>amount1In</code>ï¼‰</p>
<p>ç„¶åè®¡ç®—ç”¨æˆ·å®é™…æ”¯ä»˜çš„è¾“å…¥é‡‘é¢ï¼ˆ<code>amount0In</code>, <code>amount1In</code>ï¼‰ï¼Œå¹¶éªŒè¯éªŒè¯ç”¨æˆ·è‡³å°‘æ”¯ä»˜äº†ä¸€ç§ä»£å¸</p>
<p>åœ¨æœ€åï¼ŒUniswap V2 æ”¶å– 0.3% äº¤æ˜“è´¹ã€‚æ‰‹ç»­è´¹ä¸ç«‹å³æå–ï¼Œè€Œæ˜¯ç•™åœ¨æ± å­ä¸­ï¼Œä½¿ <code>x * y</code> ç•¥å¾®å¢é•¿ã€‚ä¸ºéªŒè¯äº¤æ˜“åˆæ³•ï¼Œéœ€æ£€æŸ¥ï¼šæ‰£é™¤æ‰‹ç»­è´¹åçš„ä½™é¢ä»æ»¡è¶³ <code>x * y &gt;= k</code>ã€‚è¿™é‡Œä¸ºé¿å…å°æ•°ï¼Œä¸¤è¾¹åŒä¹˜ <code>1000 * 1000</code>ã€‚</p>
<p>æœ€ç»ˆæ›´æ–°æ± å­çŠ¶æ€ï¼Œå¹¶è§¦å‘ Swap äº‹ä»¶ã€‚</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-solidity"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount0Out</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1Out</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">calldata</span> <span class="nb">data</span><span class="p">)</span> <span class="k">external</span> <span class="n">lock</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">amount0Out</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">amount1Out</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">uint112</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">_reserve1</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">getReserves</span><span class="p">();</span> <span class="c1">// gas savings
</span></span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">amount0Out</span> <span class="o">&lt;</span> <span class="n">_reserve0</span> <span class="o">&amp;&amp;</span> <span class="n">amount1Out</span> <span class="o">&lt;</span> <span class="n">_reserve1</span><span class="p">,</span> <span class="s">&#39;UniswapV2: INSUFFICIENT_LIQUIDITY&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">balance0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">balance1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// scope for _token{0,1}, avoids stack too deep errors
</span></span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">_token0</span> <span class="o">=</span> <span class="n">token0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">_token1</span> <span class="o">=</span> <span class="n">token1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="n">to</span> <span class="o">!=</span> <span class="n">_token0</span> <span class="o">&amp;&amp;</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">_token1</span><span class="p">,</span> <span class="s">&#39;UniswapV2: INVALID_TO&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">amount0Out</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">_safeTransfer</span><span class="p">(</span><span class="n">_token0</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount0Out</span><span class="p">);</span> <span class="c1">// optimistically transfer tokens
</span></span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">amount1Out</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">_safeTransfer</span><span class="p">(</span><span class="n">_token1</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount1Out</span><span class="p">);</span> <span class="c1">// optimistically transfer tokens
</span></span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nb">data</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">IUniswapV2Callee</span><span class="p">(</span><span class="n">to</span><span class="p">).</span><span class="n">uniswapV2Call</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="n">amount0Out</span><span class="p">,</span> <span class="n">amount1Out</span><span class="p">,</span> <span class="nb">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">balance0</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">_token0</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">balance1</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">_token1</span><span class="p">).</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">amount0In</span> <span class="o">=</span> <span class="n">balance0</span> <span class="o">&gt;</span> <span class="n">_reserve0</span> <span class="o">-</span> <span class="n">amount0Out</span> <span class="o">?</span> <span class="n">balance0</span> <span class="o">-</span> <span class="p">(</span><span class="n">_reserve0</span> <span class="o">-</span> <span class="n">amount0Out</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">amount1In</span> <span class="o">=</span> <span class="n">balance1</span> <span class="o">&gt;</span> <span class="n">_reserve1</span> <span class="o">-</span> <span class="n">amount1Out</span> <span class="o">?</span> <span class="n">balance1</span> <span class="o">-</span> <span class="p">(</span><span class="n">_reserve1</span> <span class="o">-</span> <span class="n">amount1Out</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">require</span><span class="p">(</span><span class="n">amount0In</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">amount1In</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;UniswapV2: INSUFFICIENT_INPUT_AMOUNT&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// scope for reserve{0,1}Adjusted, avoids stack too deep errors
</span></span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">balance0Adjusted</span> <span class="o">=</span> <span class="n">balance0</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="n">sub</span><span class="p">(</span><span class="n">amount0In</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">balance1Adjusted</span> <span class="o">=</span> <span class="n">balance1</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="n">sub</span><span class="p">(</span><span class="n">amount1In</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">balance0Adjusted</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">balance1Adjusted</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">_reserve0</span><span class="p">).</span><span class="n">mul</span><span class="p">(</span><span class="n">_reserve1</span><span class="p">).</span><span class="n">mul</span><span class="p">(</span><span class="mi">1000</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#39;UniswapV2: K&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">_update</span><span class="p">(</span><span class="n">balance0</span><span class="p">,</span> <span class="n">balance1</span><span class="p">,</span> <span class="n">_reserve0</span><span class="p">,</span> <span class="n">_reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">emit</span> <span class="n">Swap</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="n">amount0In</span><span class="p">,</span> <span class="n">amount1In</span><span class="p">,</span> <span class="n">amount0Out</span><span class="p">,</span> <span class="n">amount1Out</span><span class="p">,</span> <span class="n">to</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="3-æµ‹è¯•"><span>3. æµ‹è¯•</span>
  <a href="#3-%e6%b5%8b%e8%af%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>è¿™æ˜¯ä¸€ä¸ªæ·»åŠ å’Œç§»é™¤æµåŠ¨æ€§çš„æµ‹è¯•ä»£ç ï¼Œåªä½¿ç”¨äº†<code>UniswapV2Pair</code>ï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-js"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="3" style="--fi-max-shown-lines:10;--fi-line-digit:3;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ethers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hardhat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] å¼€å§‹ Uniswap V2 æµåŠ¨æ€§ç®¡ç†æµ‹è¯•ï¼šç›´æ¥ä½¿ç”¨ Pair åˆçº¦&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="c1">// 0. å‡†å¤‡è´¦æˆ·
</span></span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">[</span><span class="nx">deployer</span><span class="p">,</span> <span class="nx">user</span><span class="p">]</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] éƒ¨ç½²è€…è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·è´¦æˆ·:&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] éƒ¨ç½²è€…ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">provider</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">)),</span> <span class="s2">&#34;ETH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="c1">// 1. éƒ¨ç½² Uniswap æ ¸å¿ƒåˆçº¦
</span></span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] éƒ¨ç½² Uniswap V2 æ ¸å¿ƒåˆçº¦&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// éƒ¨ç½² Factory
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;contracts/uniswap-v2-core/contracts/UniswapV2Factory.sol:UniswapV2Factory&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">factory</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">deployer</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">FACTORY_ADDRESS</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] Factory éƒ¨ç½²æˆåŠŸ! åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">FACTORY_ADDRESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="c1">// 2. éƒ¨ç½²æµ‹è¯•ä»£å¸
</span></span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] éƒ¨ç½²æµ‹è¯•ä»£å¸&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">ERC20Contract</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;contracts/uniswap-v2-periphery/contracts/test/ERC20.sol:ERC20&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenA</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ERC20Contract</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="s2">&#34;10000&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenAAddress</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] TokenA éƒ¨ç½²æˆåŠŸ! åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">tokenAAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenB</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ERC20Contract</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="s2">&#34;1000000&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenBAddress</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] TokenB éƒ¨ç½²æˆåŠŸ! åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">tokenBAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="c1">// 3. åˆ›å»ºäº¤æ˜“å¯¹
</span></span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] åˆ›å»ºäº¤æ˜“å¯¹&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºäº¤æ˜“å¯¹
</span></span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">createPair</span><span class="p">(</span><span class="nx">tokenAAddress</span><span class="p">,</span> <span class="nx">tokenBAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">pairAddress</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">factory</span><span class="p">.</span><span class="nx">getPair</span><span class="p">(</span><span class="nx">tokenAAddress</span><span class="p">,</span> <span class="nx">tokenBAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] äº¤æ˜“å¯¹åˆ›å»ºæˆåŠŸ! åœ°å€:&#34;</span><span class="p">,</span> <span class="nx">pairAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–äº¤æ˜“å¯¹åˆçº¦å®ä¾‹
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">pair</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractAt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;contracts/uniswap-v2-core/contracts/interfaces/IUniswapV2Pair.sol:IUniswapV2Pair&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">pairAddress</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å– token0 å’Œ token1
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">token0</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">token0</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">token1</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">token1</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[+] Token0: </span><span class="si">${</span><span class="nx">token0</span> <span class="o">===</span> <span class="nx">tokenAAddress</span> <span class="o">?</span> <span class="s2">&#34;TokenA&#34;</span> <span class="o">:</span> <span class="s2">&#34;TokenB&#34;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[+] Token1: </span><span class="si">${</span><span class="nx">token1</span> <span class="o">===</span> <span class="nx">tokenBAddress</span> <span class="o">?</span> <span class="s2">&#34;TokenB&#34;</span> <span class="o">:</span> <span class="s2">&#34;TokenA&#34;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è½¬è´¦ä»£å¸ç»™ç”¨æˆ·ç”¨äºæ·»åŠ æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenAAmount</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="s2">&#34;100&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenBAmount</span> <span class="o">=</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">parseEther</span><span class="p">(</span><span class="s2">&#34;10000&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="nx">tokenAAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="nx">tokenBAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®°å½•åˆå§‹ä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">initialTokenABalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">initialTokenBBalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·åˆå§‹ä»£å¸ä½™é¢:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">initialTokenABalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">initialTokenBBalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="c1">// 4. æ·»åŠ æµåŠ¨æ€§ï¼ˆç›´æ¥ä½¿ç”¨ Pair åˆçº¦ï¼‰
</span></span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] æ·»åŠ æµåŠ¨æ€§ï¼ˆç›´æ¥ä½¿ç”¨ Pair åˆçº¦ï¼‰&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”¨æˆ·æˆæƒ Pair åˆçº¦ä½¿ç”¨ä»£å¸
</span></span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">pairAddress</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">MaxUint256</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">pairAddress</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">MaxUint256</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·å·²æˆæƒ Pair åˆçº¦ä½¿ç”¨ä»£å¸&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–æ·»åŠ å‰çš„å‚¨å¤‡é‡
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">reservesBefore</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">getReserves</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] æ·»åŠ å‰å‚¨å¤‡é‡:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">reservesBefore</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">reservesBefore</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”¨æˆ·å‘ Pair åˆçº¦è½¬è´¦ä»£å¸
</span></span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">pairAddress</span><span class="p">,</span> <span class="nx">tokenAAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">pairAddress</span><span class="p">,</span> <span class="nx">tokenBAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·å·²å‘ Pair åˆçº¦è½¬è´¦ä»£å¸&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®°å½•è½¬è´¦åä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">afterTransferTokenABalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">afterTransferTokenBBalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] è½¬è´¦åç”¨æˆ·ä»£å¸ä½™é¢:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">afterTransferTokenABalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">afterTransferTokenBBalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA å‡å°‘: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">initialTokenABalance</span> <span class="o">-</span> <span class="nx">afterTransferTokenABalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB å‡å°‘: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">initialTokenBBalance</span> <span class="o">-</span> <span class="nx">afterTransferTokenBBalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è°ƒç”¨ mint å‡½æ•°æ·»åŠ æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">mintTx</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">mint</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">mintTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] æµåŠ¨æ€§æ·»åŠ æˆåŠŸ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ç”¨æˆ·æµåŠ¨æ€§ä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">liquidityBalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·æµåŠ¨æ€§ä»£å¸ (LP Token) ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">liquidityBalance</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–æ·»åŠ åçš„å‚¨å¤‡é‡
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">reservesAfter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">getReserves</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] æ·»åŠ åå‚¨å¤‡é‡:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">reservesAfter</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">reservesAfter</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®°å½•æ·»åŠ æµåŠ¨æ€§åä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">afterMintTokenABalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">afterMintTokenBBalance</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] æ·»åŠ æµåŠ¨æ€§åç”¨æˆ·ä»£å¸ä½™é¢:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">afterMintTokenABalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">afterMintTokenBBalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - æ€»å‡å°‘: TokenA </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">initialTokenABalance</span> <span class="o">-</span> <span class="nx">afterMintTokenABalance</span><span class="p">)</span><span class="si">}</span><span class="sb">, TokenB </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">initialTokenBBalance</span> <span class="o">-</span> <span class="nx">afterMintTokenBBalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="c1">// 5. ç§»é™¤æµåŠ¨æ€§ï¼ˆç›´æ¥ä½¿ç”¨ Pair åˆçº¦ï¼‰
</span></span></span><span class="line"><span class="cl">    <span class="c1">// ======================
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] ç§»é™¤æµåŠ¨æ€§ï¼ˆç›´æ¥ä½¿ç”¨ Pair åˆçº¦ï¼‰&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ç§»é™¤å‰çš„ä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">userTokenABalanceBefore</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">userTokenBBalanceBefore</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”¨æˆ·æˆæƒ Pair åˆçº¦ä½¿ç”¨æµåŠ¨æ€§ä»£å¸
</span></span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">pairAddress</span><span class="p">,</span> <span class="nx">liquidityBalance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·å·²æˆæƒ Pair åˆçº¦ä½¿ç”¨æµåŠ¨æ€§ä»£å¸&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”¨æˆ·å°†æµåŠ¨æ€§ä»£å¸è½¬ç§»åˆ° Pair åˆçº¦
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç”¨æˆ·å°†æµåŠ¨æ€§ä»£å¸è½¬ç§»åˆ° Pair åˆçº¦&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">pairAddress</span><span class="p">,</span> <span class="nx">liquidityBalance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è°ƒç”¨ burn å‡½æ•°ç§»é™¤æµåŠ¨æ€§
</span></span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] è°ƒç”¨ burn å‡½æ•°&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">burnTx</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">user</span><span class="p">).</span><span class="nx">burn</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">burnTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] æµåŠ¨æ€§ç§»é™¤æˆåŠŸ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ç§»é™¤åçš„æµåŠ¨æ€§ä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">liquidityBalanceAfter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[+] ç§»é™¤åæµåŠ¨æ€§ä»£å¸ä½™é¢:&#34;</span><span class="p">,</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">liquidityBalanceAfter</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ç§»é™¤åçš„ä»£å¸ä½™é¢
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">userTokenABalanceAfter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">userTokenBBalanceAfter</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¡ç®—ç”¨æˆ·è·å¾—çš„ä»£å¸æ•°é‡
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenAReceived</span> <span class="o">=</span> <span class="nx">userTokenABalanceAfter</span> <span class="o">-</span> <span class="nx">userTokenABalanceBefore</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenBReceived</span> <span class="o">=</span> <span class="nx">userTokenBBalanceAfter</span> <span class="o">-</span> <span class="nx">userTokenBBalanceBefore</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] ç§»é™¤æµåŠ¨æ€§ç»“æœ:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - è·å¾— TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">tokenAReceived</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - è·å¾— TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">tokenBReceived</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - é”€æ¯æµåŠ¨æ€§ä»£å¸: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">liquidityBalance</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ç§»é™¤åçš„å‚¨å¤‡é‡
</span></span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">reservesAfterRemove</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">pair</span><span class="p">.</span><span class="nx">getReserves</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] ç§»é™¤åå‚¨å¤‡é‡:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenA: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">reservesAfterRemove</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   - TokenB: </span><span class="si">${</span><span class="nx">ethers</span><span class="p">.</span><span class="nx">formatEther</span><span class="p">(</span><span class="nx">reservesAfterRemove</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n[+] Uniswap V2 æµåŠ¨æ€§ç®¡ç†æµ‹è¯•å®Œæˆ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;[!] æ“ä½œå¤±è´¥:&#34;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>è¾“å‡ºï¼š</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="åˆ‡æ¢è¡Œå·" role="button" title="åˆ‡æ¢è¡Œå·"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ" role="button" title="åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="å¤åˆ¶åˆ°å‰ªè´´æ¿" role="button" title="å¤åˆ¶åˆ°å‰ªè´´æ¿"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ghostasky@gaowentaodeMac-mini UniswapV2_SourceRead % npx hardhat run scripts/2.js --network localhost
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> å¼€å§‹ Uniswap V2 æµåŠ¨æ€§ç®¡ç†æµ‹è¯•ï¼šç›´æ¥ä½¿ç”¨ Pair åˆçº¦
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²è€…è´¦æˆ·: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·è´¦æˆ·: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²è€…ä½™é¢: 10000.0 ETH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½² Uniswap V2 æ ¸å¿ƒåˆçº¦
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Factory éƒ¨ç½²æˆåŠŸ! åœ°å€: 0x5FbDB2315678afecb367f032d93F642f64180aa3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> éƒ¨ç½²æµ‹è¯•ä»£å¸
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> TokenA éƒ¨ç½²æˆåŠŸ! åœ°å€: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> TokenB éƒ¨ç½²æˆåŠŸ! åœ°å€: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> åˆ›å»ºäº¤æ˜“å¯¹
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> äº¤æ˜“å¯¹åˆ›å»ºæˆåŠŸ! åœ°å€: 0x581Caa5c335A3367D59939547166BdA139561e84
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Token0: TokenB
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Token1: TokenA
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·åˆå§‹ä»£å¸ä½™é¢:
</span></span><span class="line"><span class="cl">   - TokenA: 100.0
</span></span><span class="line"><span class="cl">   - TokenB: 10000.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æ·»åŠ æµåŠ¨æ€§ï¼ˆç›´æ¥ä½¿ç”¨ Pair åˆçº¦ï¼‰
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·å·²æˆæƒ Pair åˆçº¦ä½¿ç”¨ä»£å¸
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æ·»åŠ å‰å‚¨å¤‡é‡:
</span></span><span class="line"><span class="cl">   - TokenA: 0.0
</span></span><span class="line"><span class="cl">   - TokenB: 0.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·å·²å‘ Pair åˆçº¦è½¬è´¦ä»£å¸
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> è½¬è´¦åç”¨æˆ·ä»£å¸ä½™é¢:
</span></span><span class="line"><span class="cl">   - TokenA: 0.0
</span></span><span class="line"><span class="cl">   - TokenB: 0.0
</span></span><span class="line"><span class="cl">   - TokenA å‡å°‘: 100.0
</span></span><span class="line"><span class="cl">   - TokenB å‡å°‘: 10000.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æµåŠ¨æ€§æ·»åŠ æˆåŠŸ
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·æµåŠ¨æ€§ä»£å¸ <span class="o">(</span>LP Token<span class="o">)</span> ä½™é¢: 999.999999999999999
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æ·»åŠ åå‚¨å¤‡é‡:
</span></span><span class="line"><span class="cl">   - TokenA: 10000.0
</span></span><span class="line"><span class="cl">   - TokenB: 100.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æ·»åŠ æµåŠ¨æ€§åç”¨æˆ·ä»£å¸ä½™é¢:
</span></span><span class="line"><span class="cl">   - TokenA: 0.0
</span></span><span class="line"><span class="cl">   - TokenB: 0.0
</span></span><span class="line"><span class="cl">   - æ€»å‡å°‘: TokenA 100.0, TokenB 10000.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç§»é™¤æµåŠ¨æ€§ï¼ˆç›´æ¥ä½¿ç”¨ Pair åˆçº¦ï¼‰
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·å·²æˆæƒ Pair åˆçº¦ä½¿ç”¨æµåŠ¨æ€§ä»£å¸
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç”¨æˆ·å°†æµåŠ¨æ€§ä»£å¸è½¬ç§»åˆ° Pair åˆçº¦
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> è°ƒç”¨ burn å‡½æ•°
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> æµåŠ¨æ€§ç§»é™¤æˆåŠŸ
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç§»é™¤åæµåŠ¨æ€§ä»£å¸ä½™é¢: 0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç§»é™¤æµåŠ¨æ€§ç»“æœ:
</span></span><span class="line"><span class="cl">   - è·å¾— TokenA: 99.9999999999999999
</span></span><span class="line"><span class="cl">   - è·å¾— TokenB: 9999.99999999999999
</span></span><span class="line"><span class="cl">   - é”€æ¯æµåŠ¨æ€§ä»£å¸: 999.999999999999999
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ç§»é™¤åå‚¨å¤‡é‡:
</span></span><span class="line"><span class="cl">   - TokenA: 0.00000000000001
</span></span><span class="line"><span class="cl">   - TokenB: 0.0000000000000001
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Uniswap V2 æµåŠ¨æ€§ç®¡ç†æµ‹è¯•å®Œæˆ</span></span></code></pre></div><div class="code-expand-btn" aria-label="å±•å¼€æˆ–æŠ˜å ä»£ç å—" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="æ›´æ–°äº 2025-09-20 00:00:00">æ›´æ–°äº 2025-09-20&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="vscode://file//Users/ghostasky/Blog/content/posts/202509-UniswapV2Source/index.md" title="åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° X" data-sharer="twitter" data-url="http://localhost:1313/posts/202509-uniswapv2source/" data-title="UniswapV2æºç é˜…è¯»" data-hashtags="é‡åŒ–"><i class="fa-brands fa-x-twitter" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/202509-uniswapv2source/" data-hashtag="é‡åŒ–"><i class="fa-brands fa-facebook-square" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="http://localhost:1313/posts/202509-uniswapv2source/" data-title="UniswapV2æºç é˜…è¯»"><i class="fa-brands fa-weibo" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags me-1" aria-hidden="true"></i><a href="/tags/%E9%87%8F%E5%8C%96/" class="post-tag" title="æ ‡ç­¾ - é‡åŒ–">é‡åŒ–</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/202509-clamm/" class="post-nav-item" rel="prev" title="Uniswapæºç åˆ†æï¼šï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º"><i class="fa-solid fa-angle-left" aria-hidden="true"></i>Uniswapæºç åˆ†æï¼šï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º</a><a href="/posts/apo-04/" class="post-nav-item" rel="next" title="ã€Šé«˜çº§æŠ•èµ„ç»„åˆä¼˜åŒ–ã€‹é˜…è¯»ç¬”è®°-ç¬¬å››ç« ">ã€Šé«˜çº§æŠ•èµ„ç»„åˆä¼˜åŒ–ã€‹é˜…è¯»ç¬”è®°-ç¬¬å››ç« <i class="fa-solid fa-angle-right" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="ç›®å½•"><h2 class="toc-title">ç›®å½•&nbsp;<i class="toc-icon fa-solid fa-angle-down" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">ç›®å½•</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li>
      <ul>
        <li><a href="#uniswapv2-æºç é˜…è¯»ç³»åˆ—æ–‡ç« å¤§çº²"><strong>UniswapV2 æºç é˜…è¯»ç³»åˆ—æ–‡ç« å¤§çº²</strong></a>
          <ul>
            <li><a href="#ç¬¬ä¸€ç¯‡uniswapv2æºç é˜…è¯»ä¸€ç¯å¢ƒæ­å»º"><strong>ç¬¬ä¸€ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º</strong></a></li>
            <li><a href="#ç¬¬äºŒç¯‡uniswapv2æºç é˜…è¯»äºŒå·¥å‚åˆçº¦uniswapv2factory"><strong>ç¬¬äºŒç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäºŒï¼‰å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</strong></a></li>
            <li><a href="#ç¬¬ä¸‰ç¯‡uniswapv2æºç é˜…è¯»ä¸‰é…å¯¹åˆçº¦æ ¸å¿ƒuniswapv2pair"><strong>ç¬¬ä¸‰ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸‰ï¼‰é…å¯¹åˆçº¦æ ¸å¿ƒï¼ˆUniswapV2Pairï¼‰</strong></a></li>
            <li><a href="#ç¬¬å››ç¯‡uniswapv2æºç é˜…è¯»å››ä»·æ ¼é¢„è¨€æœº"><strong>ç¬¬å››ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå››ï¼‰ä»·æ ¼é¢„è¨€æœº</strong></a></li>
            <li><a href="#ç¬¬äº”ç¯‡uniswapv2æºç é˜…è¯»äº”è·¯ç”±åˆçº¦uniswapv2router"><strong>ç¬¬äº”ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆäº”ï¼‰è·¯ç”±åˆçº¦ï¼ˆUniswapV2Routerï¼‰</strong></a></li>
            <li><a href="#ç¬¬å…­ç¯‡uniswapv2æºç é˜…è¯»å…­åˆçº¦éƒ¨ç½²ä¸åˆå§‹åŒ–æµç¨‹"><strong>ç¬¬å…­ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆå…­ï¼‰åˆçº¦éƒ¨ç½²ä¸åˆå§‹åŒ–æµç¨‹</strong></a></li>
            <li><a href="#ç¬¬ä¸ƒç¯‡uniswapv2æºç é˜…è¯»ä¸ƒé—ªç”µè´·flash-swapåŸç†è§£æ"><strong>ç¬¬ä¸ƒç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆä¸ƒï¼‰é—ªç”µè´·ï¼ˆFlash Swapï¼‰åŸç†è§£æ</strong></a></li>
            <li><a href="#ç¬¬å…«ç¯‡uniswapv2æºç é˜…è¯»ç»ˆæ€»ç»“ä¸å±•æœ›"><strong>ç¬¬å…«ç¯‡ï¼šUniswapV2æºç é˜…è¯»â€”â€”ï¼ˆç»ˆï¼‰æ€»ç»“ä¸å±•æœ›</strong></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#ä¸€æ•´ä½“æ¶æ„åˆ†å±‚">ä¸€ã€æ•´ä½“æ¶æ„åˆ†å±‚</a>
      <ul>
        <li><a href="#1-æ ¸å¿ƒå±‚core-contracts">1. æ ¸å¿ƒå±‚ï¼ˆCore Contractsï¼‰</a></li>
        <li><a href="#2-åº”ç”¨å±‚periphery-contracts">2. åº”ç”¨å±‚ï¼ˆPeriphery Contractsï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#äºŒæ ¸å¿ƒå±‚åˆçº¦è¯¦è§£">äºŒã€æ ¸å¿ƒå±‚åˆçº¦è¯¦è§£</a>
      <ul>
        <li><a href="#1-å·¥å‚åˆçº¦uniswapv2factory">1. å·¥å‚åˆçº¦ï¼ˆUniswapV2Factoryï¼‰</a></li>
        <li><a href="#2-äº¤æ˜“å¯¹åˆçº¦uniswapv2pair">2. äº¤æ˜“å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰</a></li>
        <li><a href="#3-æµåŠ¨æ€§ä»£å¸åˆçº¦uniswapv2erc20">3. æµåŠ¨æ€§ä»£å¸åˆçº¦ï¼ˆUniswapV2ERC20ï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶">ä¸‰ã€åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶</a>
      <ul>
        <li><a href="#è·¯ç”±åˆçº¦uniswapv2router02">è·¯ç”±åˆçº¦ï¼ˆUniswapV2Router02ï¼‰</a></li>
        <li><a href="#åº“åˆçº¦library-contracts">åº“åˆçº¦ï¼ˆLibrary Contractsï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#å››åˆçº¦äº¤äº’æµç¨‹">å››ã€åˆçº¦äº¤äº’æµç¨‹</a></li>
    <li><a href="#äº”å…³é”®è®¾è®¡æ€æƒ³">äº”ã€å…³é”®è®¾è®¡æ€æƒ³</a></li>
  </ul>

  <ul>
    <li><a href="#1-å·¥å‚åˆçº¦ç®€ä»‹">1. å·¥å‚åˆçº¦ç®€ä»‹</a></li>
    <li><a href="#2-æºç é˜…è¯»">2. æºç é˜…è¯»</a>
      <ul>
        <li><a href="#21-å…³é”®å˜é‡">2.1 å…³é”®å˜é‡</a></li>
        <li><a href="#22-å‡½æ•°åˆ—è¡¨ä¸è§£æ">2.2 å‡½æ•°åˆ—è¡¨ä¸è§£æ</a>
          <ul>
            <li><a href="#221-constructoraddress-_feetosetter-public">2.2.1. <code>constructor(address _feeToSetter) public</code></a></li>
            <li><a href="#222-setfeetoaddress-_feeto-external">2.2.2. <code>setFeeTo(address _feeTo) external</code></a></li>
            <li><a href="#223-setfeetosetteraddress-_feetosetter-external">2.2.3. <code>setFeeToSetter(address _feeToSetter) external</code></a></li>
            <li><a href="#224-allpairslength-external-view-returns-uint">2.2.4. <code>allPairsLength() external view returns (uint)</code></a></li>
            <li><a href="#225-createpairaddress-tokena-address-tokenb-external-returns-address-pair">2.2.5. <code>createPair(address tokenA, address tokenB) external returns (address pair)</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-æœ¬åœ°æµ‹è¯•éªŒè¯">3. æœ¬åœ°æµ‹è¯•éªŒè¯</a>
      <ul>
        <li><a href="#31-éƒ¨ç½²å·¥å‚åˆçº¦">3.1 éƒ¨ç½²å·¥å‚åˆçº¦</a></li>
        <li><a href="#32-åˆ›å»ºåˆçº¦å¯¹å¹¶ç›‘å¬äº‹ä»¶">3.2 åˆ›å»ºåˆçº¦å¯¹å¹¶ç›‘å¬äº‹ä»¶</a></li>
        <li><a href="#33-ä¿®æ”¹-feetosetter">3.3 ä¿®æ”¹ feeToSetter</a></li>
      </ul>
    </li>
    <li><a href="#4-å°ç»“">4. å°ç»“</a></li>
  </ul>

  <ul>
    <li><a href="#1-äº¤æ˜“å¯¹åˆçº¦uniswapv2pairç®€è¿°">1. äº¤æ˜“å¯¹åˆçº¦ï¼ˆUniswapV2Pairï¼‰ç®€è¿°</a></li>
    <li><a href="#2-æºç é˜…è¯»-1">2. æºç é˜…è¯»</a>
      <ul>
        <li><a href="#21-æ ¸å¿ƒçŠ¶æ€å˜é‡">2.1 æ ¸å¿ƒçŠ¶æ€å˜é‡</a></li>
        <li><a href="#22-getreserves">2.2 getReserves()</a></li>
        <li><a href="#23-getreserves">2.3 getReserves()</a></li>
        <li><a href="#24-_update">2.4 _update()</a></li>
        <li><a href="#24-_mintfee">2.4 _mintFee()</a>
          <ul>
            <li><a href="#241-uniswap-v2-åè®®æ‰‹ç»­è´¹-protocol_fee-æœºåˆ¶">2.4.1 Uniswap V2 åè®®æ‰‹ç»­è´¹ (PROTOCOL_FEE) æœºåˆ¶</a>
              <ul>
                <li><a href="#2411-é¡¹ç›®æ–¹çš„éœ€æ±‚">2.4.1.1 <strong>é¡¹ç›®æ–¹çš„éœ€æ±‚</strong></a></li>
                <li><a href="#2412-phi-phi-å‚æ•°">2.4.1.2 <code>phi</code> ($\phi$) å‚æ•°</a></li>
                <li><a href="#2413-å®ç°æ–¹å¼å¢å‘-share">2.4.1.3 å®ç°æ–¹å¼ï¼šå¢å‘ Share</a></li>
                <li><a href="#2414-æ•°å­¦æ¨å¯¼sm-çš„è®¡ç®—">2.4.1.4 æ•°å­¦æ¨å¯¼ï¼š<code>SM</code> çš„è®¡ç®—</a></li>
              </ul>
            </li>
            <li><a href="#242-ä»£ç å®ç°">2.4.2 ä»£ç å®ç°</a></li>
          </ul>
        </li>
        <li><a href="#25-mint">2.5 mint()</a></li>
        <li><a href="#26-burn">2.6 burn()</a></li>
        <li><a href="#27-swap">2.7 swap</a></li>
        <li><a href="#3-æµ‹è¯•">3. æµ‹è¯•</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">ç”± <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.154.5"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.3-20260123080729-2a5bd268"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2026</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="å›åˆ°é¡¶éƒ¨"><i class="fa-solid fa-arrow-up" aria-hidden="true"></i></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="ç›®å½•"><i class="fa-solid fa-bars" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">è¯¥ç½‘ç«™åœ¨å¯ç”¨ JavaScript çš„æƒ…å†µä¸‹æ•ˆæœæœ€ä½³ã€‚</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/js/config/c791276295365e91a53a400a8d3aeff4.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script></body>
</html>
