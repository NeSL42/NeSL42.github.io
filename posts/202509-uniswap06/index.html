<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>06.Uniswap V2 闪电贷 - 敬渊&#39;s Blog</title><meta name="author" content="">
<meta name="description" content="核心摘要 (Key Takeaways) Flash Swaps (闪电交换) 是一种无需任何抵押即可借出资产的机制，但前提是必须在同一笔区块链交易内归还借款本金及相应的手续费。 该机制的核心是原子性 (Atomicity)，即整笔复杂操作（借款、执行自定义逻辑、还款）要么全部成功，要么全部失败回滚，从而保证资金池的安全。 Flash Swaps 是 DeFi 可组合性 (Composability) 的强大体现，允许开发者像搭乐高一样，在单笔交易中调用多个协议（如 Uniswap, Compound, Aave）来执行复杂的套利或其它金融策略。 为了确保协议盈利，用户需要支付一笔手续费。这笔费用的最低标准是借出资产数量的 3/997，这个数值是通过数学计算确保资金池资产不会减少而得出的。 实现 Flash Swap 需要用户编写并部署一个智能合约，该合约必须实现一个特定的回调接口（uniswapV2Call），Uniswap 的交易对（Pair）合约会通过调用这个接口来执行用户的自定义逻辑。 1. Flash Swaps 核心概念 Flash Swaps，也常被称为闪电贷 (Flash Loan)，是 Uniswap V2 引入的一项创新功能。它与普通交易（Swap）的根本区别在于资金的获取和使用方式。
"><meta name="keywords" content='Web3'>
  <meta itemprop="name" content="06.Uniswap V2 闪电贷">
  <meta itemprop="description" content="核心摘要 (Key Takeaways) Flash Swaps (闪电交换) 是一种无需任何抵押即可借出资产的机制，但前提是必须在同一笔区块链交易内归还借款本金及相应的手续费。 该机制的核心是原子性 (Atomicity)，即整笔复杂操作（借款、执行自定义逻辑、还款）要么全部成功，要么全部失败回滚，从而保证资金池的安全。 Flash Swaps 是 DeFi 可组合性 (Composability) 的强大体现，允许开发者像搭乐高一样，在单笔交易中调用多个协议（如 Uniswap, Compound, Aave）来执行复杂的套利或其它金融策略。 为了确保协议盈利，用户需要支付一笔手续费。这笔费用的最低标准是借出资产数量的 3/997，这个数值是通过数学计算确保资金池资产不会减少而得出的。 实现 Flash Swap 需要用户编写并部署一个智能合约，该合约必须实现一个特定的回调接口（uniswapV2Call），Uniswap 的交易对（Pair）合约会通过调用这个接口来执行用户的自定义逻辑。 1. Flash Swaps 核心概念 Flash Swaps，也常被称为闪电贷 (Flash Loan)，是 Uniswap V2 引入的一项创新功能。它与普通交易（Swap）的根本区别在于资金的获取和使用方式。">
  <meta itemprop="datePublished" content="2025-09-02T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-09-02T00:00:00+00:00">
  <meta itemprop="wordCount" content="2890">
  <meta itemprop="keywords" content="Web3"><meta property="og:url" content="http://localhost:1313/posts/202509-uniswap06/">
  <meta property="og:site_name" content="敬渊&#39;s Blog">
  <meta property="og:title" content="06.Uniswap V2 闪电贷">
  <meta property="og:description" content="核心摘要 (Key Takeaways) Flash Swaps (闪电交换) 是一种无需任何抵押即可借出资产的机制，但前提是必须在同一笔区块链交易内归还借款本金及相应的手续费。 该机制的核心是原子性 (Atomicity)，即整笔复杂操作（借款、执行自定义逻辑、还款）要么全部成功，要么全部失败回滚，从而保证资金池的安全。 Flash Swaps 是 DeFi 可组合性 (Composability) 的强大体现，允许开发者像搭乐高一样，在单笔交易中调用多个协议（如 Uniswap, Compound, Aave）来执行复杂的套利或其它金融策略。 为了确保协议盈利，用户需要支付一笔手续费。这笔费用的最低标准是借出资产数量的 3/997，这个数值是通过数学计算确保资金池资产不会减少而得出的。 实现 Flash Swap 需要用户编写并部署一个智能合约，该合约必须实现一个特定的回调接口（uniswapV2Call），Uniswap 的交易对（Pair）合约会通过调用这个接口来执行用户的自定义逻辑。 1. Flash Swaps 核心概念 Flash Swaps，也常被称为闪电贷 (Flash Loan)，是 Uniswap V2 引入的一项创新功能。它与普通交易（Swap）的根本区别在于资金的获取和使用方式。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-02T00:00:00+00:00">
    <meta property="article:tag" content="Web3">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="06.Uniswap V2 闪电贷">
  <meta name="twitter:description" content="核心摘要 (Key Takeaways) Flash Swaps (闪电交换) 是一种无需任何抵押即可借出资产的机制，但前提是必须在同一笔区块链交易内归还借款本金及相应的手续费。 该机制的核心是原子性 (Atomicity)，即整笔复杂操作（借款、执行自定义逻辑、还款）要么全部成功，要么全部失败回滚，从而保证资金池的安全。 Flash Swaps 是 DeFi 可组合性 (Composability) 的强大体现，允许开发者像搭乐高一样，在单笔交易中调用多个协议（如 Uniswap, Compound, Aave）来执行复杂的套利或其它金融策略。 为了确保协议盈利，用户需要支付一笔手续费。这笔费用的最低标准是借出资产数量的 3/997，这个数值是通过数学计算确保资金池资产不会减少而得出的。 实现 Flash Swap 需要用户编写并部署一个智能合约，该合约必须实现一个特定的回调接口（uniswapV2Call），Uniswap 的交易对（Pair）合约会通过调用这个接口来执行用户的自定义逻辑。 1. Flash Swaps 核心概念 Flash Swaps，也常被称为闪电贷 (Flash Loan)，是 Uniswap V2 引入的一项创新功能。它与普通交易（Swap）的根本区别在于资金的获取和使用方式。">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/posts/202509-uniswap06/" title="06.Uniswap V2 闪电贷 - 敬渊&#39;s Blog" /><link rel="prev" type="text/html" href="http://localhost:1313/posts/202509-uniswap07/" title="07.Uniswap V2 TWAP" /><link rel="next" type="text/html" href="http://localhost:1313/posts/202509-uniswap05/" title="05.Uniswap V2 无常损失" /><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "06.Uniswap V2 闪电贷",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/posts\/202509-uniswap06\/"
    },"genre": "posts","keywords": "Web3","wordcount":  2890 ,
    "url": "http:\/\/localhost:1313\/posts\/202509-uniswap06\/","datePublished": "2025-09-02T00:00:00+00:00","dateModified": "2025-09-02T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "作者"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="敬渊&#39;s Blog"><span class="header-title-text">敬渊&#39;s Blog</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/">文章</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/">标签</a></li><li class="menu-item">
              <a class="menu-link" href="/about/">关于</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/">分类</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" role="button" aria-label="切换主题" title="切换主题"><i class="fa-solid fa-adjust" aria-hidden="true"></i></li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="敬渊&#39;s Blog"><span class="header-title-text">敬渊&#39;s Blog</span></a><span class="header-subtitle"></span></div>
      <div class="theme-switch" role="button" aria-label="切换主题"><i class="fa-solid fa-adjust" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="menu-item"><a class="menu-link" href="/posts/">文章</a></li><li class="menu-item"><a class="menu-link" href="/tags/">标签</a></li><li class="menu-item"><a class="menu-link" href="/about/">关于</a></li><li class="menu-item"><a class="menu-link" href="/categories/">分类</a></li><li class="menu-item menu-system"></li>
      </ul>
    </nav>
  </div>
</header><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>06.Uniswap V2 闪电贷</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Anonymous</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/technology/" class="post-category" title="分类 - Technology"><i class="fa-regular fa-folder" aria-hidden="true"></i> Technology</a></span></div><div class="post-meta-line"><span title="发布于 2025-09-02 00:00:00"><i class="fa-solid fa-calendar-days me-1" aria-hidden="true"></i><time datetime="2025-09-02">2025-09-02</time></span>&nbsp;<span title="2890 字"><i class="fa-solid fa-pencil-alt me-1" aria-hidden="true"></i>约 2900 字</span>&nbsp;<span><i class="fa-regular fa-clock me-1" aria-hidden="true"></i>预计阅读 6 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#核心摘要-key-takeaways"><strong>核心摘要 (Key Takeaways)</strong></a></li>
        <li><a href="#1-flash-swaps-核心概念"><strong>1. Flash Swaps 核心概念</strong></a>
          <ul>
            <li><a href="#11-为什么需要-flash-swaps">1.1 为什么需要 Flash Swaps？</a></li>
            <li><a href="#12-核心保障原子性">1.2 核心保障：原子性</a></li>
          </ul>
        </li>
        <li><a href="#2-flash-swap-的数学原理"><strong>2. Flash Swap 的数学原理</strong></a>
          <ul>
            <li><a href="#21-关键参数定义">2.1 关键参数定义</a></li>
            <li><a href="#22-手续费计算">2.2 手续费计算</a></li>
            <li><a href="#23-从资金池角度的验证逻辑">2.3 从资金池角度的验证逻辑</a></li>
          </ul>
        </li>
        <li><a href="#3-flash-swap-的实现流程"><strong>3. Flash Swap 的实现流程</strong></a>
          <ul>
            <li><a href="#31-交互时序图-mermaid-sequence-diagram">3.1 交互时序图 (Mermaid Sequence Diagram)</a></li>
            <li><a href="#32-流程解释">3.2 流程解释</a></li>
          </ul>
        </li>
        <li><a href="#4-flash-swap-的实际应用与案例"><strong>4. Flash Swap 的实际应用与案例</strong></a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h3 class="heading-element" id="核心摘要-key-takeaways"><span><strong>核心摘要 (Key Takeaways)</strong></span>
  <a href="#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li><strong>Flash Swaps (闪电交换)</strong> 是一种无需任何抵押即可借出资产的机制，但前提是必须在<strong>同一笔区块链交易</strong>内归还借款本金及相应的手续费。</li>
<li>该机制的核心是<strong>原子性 (Atomicity)</strong>，即整笔复杂操作（借款、执行自定义逻辑、还款）要么全部成功，要么全部失败回滚，从而保证资金池的安全。</li>
<li>Flash Swaps 是 <strong>DeFi 可组合性 (Composability)</strong> 的强大体现，允许开发者像搭乐高一样，在单笔交易中调用多个协议（如 Uniswap, Compound, Aave）来执行复杂的套利或其它金融策略。</li>
<li>为了确保协议盈利，用户需要支付一笔手续费。这笔费用的最低标准是借出资产数量的 <code>3/997</code>，这个数值是通过数学计算确保资金池资产不会减少而得出的。</li>
<li>实现 Flash Swap 需要用户编写并部署一个智能合约，该合约必须实现一个特定的回调接口（<code>uniswapV2Call</code>），Uniswap 的交易对（Pair）合约会通过调用这个接口来执行用户的自定义逻辑。</li>
</ul>
<h3 class="heading-element" id="1-flash-swaps-核心概念"><span><strong>1. Flash Swaps 核心概念</strong></span>
  <a href="#1-flash-swaps-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>Flash Swaps</strong>，也常被称为<strong>闪电贷 (Flash Loan)</strong>，是 Uniswap V2 引入的一项创新功能。它与普通交易（Swap）的根本区别在于资金的获取和使用方式。</p>
<ul>
<li><strong>普通 Swap</strong>：用户必须<strong>先持有</strong>一种资产（如 ETH），才能将其兑换成池中的另一种资产（如 DAI）。</li>
<li><strong>Flash Swap</strong>：用户可以<strong>不持有任何资产</strong>，直接从流动性池中“借出”想要的资产，执行一系列操作，然后在同一笔交易结束前，将借出的资产和一笔手续费归还给池子。</li>
</ul>
<h4 class="heading-element" id="11-为什么需要-flash-swaps"><span>1.1 为什么需要 Flash Swaps？</span>
  <a href="#11-%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81-flash-swaps" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Flash Swaps 主要服务于需要大量临时资金的复杂链上操作，最典型的场景是<strong>套利</strong>。</p>
<ul>
<li><strong>DeFi 产品的可组合性</strong>：DeFi 协议（如交易所、借贷平台、衍生品）都是开源且部署在链上的，可以像乐高积木一样被自由组合。Flash Swaps 提供了一个接口，让用户可以临时获得海量资金，去执行跨多个协议的复杂套利策略。</li>
<li><strong>机会发现</strong>：当不同 DeFi 平台之间出现价差时，套利者可以利用 Flash Swaps 借入巨额资金来抹平价差并从中获利，而无需自己承担资金成本。</li>
</ul>
<h4 class="heading-element" id="12-核心保障原子性"><span>1.2 核心保障：原子性</span>
  <a href="#12-%e6%a0%b8%e5%bf%83%e4%bf%9d%e9%9a%9c%e5%8e%9f%e5%ad%90%e6%80%a7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Flash Swaps 的安全性依赖于区块链交易的<strong>原子性</strong>。</p>
<ul>
<li>一笔交易内的所有操作（借款、调用其他合约、还款、验证）被捆绑在一起。</li>
<li>如果交易结束时，用户未能足额归还本金和手续费，整个交易就会被<strong>回滚 (Revert)</strong>，就像什么都没有发生过一样。</li>
<li>这对资金池来说是零风险的，因为它要么成功收取了手续费，要么资产原封不动地保留在池中。</li>
</ul>
<h3 class="heading-element" id="2-flash-swap-的数学原理"><span><strong>2. Flash Swap 的数学原理</strong></span>
  <a href="#2-flash-swap-%e7%9a%84%e6%95%b0%e5%ad%a6%e5%8e%9f%e7%90%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>为了保证流动性池在任何 Flash Swap 交易中都不会亏损，其背后有一套严谨的数学逻辑。</p>
<h4 class="heading-element" id="21-关键参数定义"><span>2.1 关键参数定义</span>
  <a href="#21-%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e5%ae%9a%e4%b9%89" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li>
<p><strong>普通 Swap</strong>:</p>
<ul>
<li>$D_x$: 用户存入池子的资产数量 (Amount In)。</li>
<li>$D_y$: 用户从池子取出的资产数量 (Amount Out)。</li>
<li>手续费在 <code>Amount In</code> 上收取，池子实际用于计算的是 $0.997 \times D_x$。</li>
</ul>
</li>
<li>
<p><strong>Flash Swap</strong>:</p>
<ul>
<li>$D_{x0}$: 用户从池子<strong>借出</strong>的资产数量 (Amount Out)。</li>
<li>$D_{x1}$: 用户最终<strong>还回</strong>池子的资产数量 (Amount In)。</li>
<li><strong>核心关系</strong>: $D_{x1} = D_{x0} + \text{Fee}$</li>
</ul>
</li>
</ul>
<h4 class="heading-element" id="22-手续费计算"><span>2.2 手续费计算</span>
  <a href="#22-%e6%89%8b%e7%bb%ad%e8%b4%b9%e8%ae%a1%e7%ae%97" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Uniswap 的手续费总是对 <strong>Amount In</strong>（即存入池子的资金）收取的，费率为 0.3%。</p>
<ol>
<li>在 Flash Swap 中，<code>Amount In</code> 是用户还回来的 $D_{x1}$。</li>
<li>因此，手续费 $\text{Fee} = 0.003 \times D_{x1}$。</li>
<li>我们将此公式代入核心关系式中：
$$
D_{x1} = D_{x0} + (0.003 \times D_{x1})
$$</li>
<li>移项求解 <code>Fee</code> 与 $D_{x0}$ 的关系：
$$
D_{x1} - 0.003 \times D_{x1} = D_{x0} \
0.997 \times D_{x1} = D_{x0} \
D_{x1} = \frac{D_{x0}}{0.997}
$$</li>
<li>最后计算手续费：
$$
\text{Fee} = D_{x1} - D_{x0} = \frac{D_{x0}}{0.997} - D_{x0} = D_{x0} \left( \frac{1 - 0.997}{0.997} \right) = D_{x0} \left( \frac{0.003}{0.997} \right)
$$</li>
<li>最终得到手续费公式：
$$
\text{Fee} = \frac{3}{997} \times D_{x0}
$$
<strong>结论</strong>：用户需要归还的手续费，至少是你借出资产数量的 <code>3/997</code>。代码实现时通常会向上取整，以确保池子利益。</li>
</ol>
<h4 class="heading-element" id="23-从资金池角度的验证逻辑"><span>2.3 从资金池角度的验证逻辑</span>
  <a href="#23-%e4%bb%8e%e8%b5%84%e9%87%91%e6%b1%a0%e8%a7%92%e5%ba%a6%e7%9a%84%e9%aa%8c%e8%af%81%e9%80%bb%e8%be%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>站在资金池的角度，必须确保在 Flash Swap 之后，池内对应资产的数量<strong>大于等于</strong>交易前的数量。</p>
<ul>
<li>设池子原有某资产数量为 $X_0$。</li>
<li>用户借走 $D_{x0}$，池内剩余 $(X_0 - D_{x0})$。</li>
<li>用户还回 $D_{x1}$，扣除 0.3% 手续费后，池子净增 $(0.997 \times D_{x1})$。</li>
<li>交易后的总量为 $(X_0 - D_{x0}) + (0.997 \times D_{x1})$。</li>
<li>为保证不亏损，必须满足以下不等式：
$$
(X_0 - D_{x0}) + (0.997 \times D_{x1}) \ge X_0
$$</li>
<li>简化后得到：
$$
0.997 \times D_{x1} \ge D_{x0}
$$
这个不等式是 Pair 合约在交易结束时进行验证的核心，如果条件不满足，交易将失败。</li>
</ul>
<h3 class="heading-element" id="3-flash-swap-的实现流程"><span><strong>3. Flash Swap 的实现流程</strong></span>
  <a href="#3-flash-swap-%e7%9a%84%e5%ae%9e%e7%8e%b0%e6%b5%81%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>与普通用户通过前端或路由合约交互不同，Flash Swap 要求用户（通常是开发者）直接与 <strong>Pair 合约</strong>进行交互。</p>
<h4 class="heading-element" id="31-交互时序图-mermaid-sequence-diagram"><span>3.1 交互时序图 (Mermaid Sequence Diagram)</span>
  <a href="#31-%e4%ba%a4%e4%ba%92%e6%97%b6%e5%ba%8f%e5%9b%be-mermaid-sequence-diagram" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="diagram-container">
  <pre class="mermaid">sequenceDiagram
    actor User
    participant UserContract as 用户合约
    participant PairContract as Uniswap Pair 合约

    User->>UserContract: 启动Flash Swap交易
    UserContract->>PairContract: 1. 调用 swap(amountOut, to, data) 发起借款
    PairContract->>UserContract: 2. transfer(token, amountOut) 发送借款
    PairContract->>UserContract: 3. 回调 uniswapV2Call() 触发用户逻辑
    activate UserContract
    UserContract->>UserContract: 4. 执行自定义逻辑 (如跨协议套利)
    UserContract->>PairContract: 5. transfer(token, amountOut + fee) 归还本金和手续费
    deactivate UserContract
    PairContract->>PairContract: 6. 内部验证还款是否足额 (balance >= initialBalance)
    Note right of PairContract: 若验证失败, 整笔交易将回滚 (Revert)</pre>
  <pre class="mermaid-dark">sequenceDiagram
    actor User
    participant UserContract as 用户合约
    participant PairContract as Uniswap Pair 合约

    User->>UserContract: 启动Flash Swap交易
    UserContract->>PairContract: 1. 调用 swap(amountOut, to, data) 发起借款
    PairContract->>UserContract: 2. transfer(token, amountOut) 发送借款
    PairContract->>UserContract: 3. 回调 uniswapV2Call() 触发用户逻辑
    activate UserContract
    UserContract->>UserContract: 4. 执行自定义逻辑 (如跨协议套利)
    UserContract->>PairContract: 5. transfer(token, amountOut + fee) 归还本金和手续费
    deactivate UserContract
    PairContract->>PairContract: 6. 内部验证还款是否足额 (balance >= initialBalance)
    Note right of PairContract: 若验证失败, 整笔交易将回滚 (Revert)</pre>
  <pre class="mermaid-neutral">sequenceDiagram
    actor User
    participant UserContract as 用户合约
    participant PairContract as Uniswap Pair 合约

    User->>UserContract: 启动Flash Swap交易
    UserContract->>PairContract: 1. 调用 swap(amountOut, to, data) 发起借款
    PairContract->>UserContract: 2. transfer(token, amountOut) 发送借款
    PairContract->>UserContract: 3. 回调 uniswapV2Call() 触发用户逻辑
    activate UserContract
    UserContract->>UserContract: 4. 执行自定义逻辑 (如跨协议套利)
    UserContract->>PairContract: 5. transfer(token, amountOut + fee) 归还本金和手续费
    deactivate UserContract
    PairContract->>PairContract: 6. 内部验证还款是否足额 (balance >= initialBalance)
    Note right of PairContract: 若验证失败, 整笔交易将回滚 (Revert)</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone fa-width-auto" aria-hidden="true"></i></div>
<template><pre>sequenceDiagram
    actor User
    participant UserContract as 用户合约
    participant PairContract as Uniswap Pair 合约

    User->>UserContract: 启动Flash Swap交易
    UserContract->>PairContract: 1. 调用 swap(amountOut, to, data) 发起借款
    PairContract->>UserContract: 2. transfer(token, amountOut) 发送借款
    PairContract->>UserContract: 3. 回调 uniswapV2Call() 触发用户逻辑
    activate UserContract
    UserContract->>UserContract: 4. 执行自定义逻辑 (如跨协议套利)
    UserContract->>PairContract: 5. transfer(token, amountOut + fee) 归还本金和手续费
    deactivate UserContract
    PairContract->>PairContract: 6. 内部验证还款是否足额 (balance >= initialBalance)
    Note right of PairContract: 若验证失败, 整笔交易将回滚 (Revert)</pre></template>
</div><h4 class="heading-element" id="32-流程解释"><span>3.2 流程解释</span>
  <a href="#32-%e6%b5%81%e7%a8%8b%e8%a7%a3%e9%87%8a" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ol>
<li><strong>发起借款</strong>：用户的智能合约调用目标流动性池（Pair 合约）的 <code>swap()</code> 方法。它会填充 <code>data</code> 参数，并指定 <code>amount0Out</code> 或 <code>amount1Out</code> 作为借出的 Token 数量。</li>
<li><strong>发送资产</strong>：Pair 合约在收到请求后，首先会将用户请求的 Token 发送到用户合约地址。</li>
<li><strong>执行回调</strong>：紧接着，Pair 合约会调用用户合约中实现的 <code>uniswapV2Call</code> 方法。这是执行用户自定义逻辑的入口。</li>
<li><strong>执行自定义逻辑</strong>：在 <code>uniswapV2Call</code> 函数中，开发者可以编写任意复杂的逻辑，例如调用其他 DeFi 协议进行交易、抵押、借贷等。
<ul>
<li><strong>安全校验</strong>：在 <code>uniswapV2Call</code> 函数内部，通常会进行安全检查，例如 <code>require(msg.sender == pair, 'Unauthorized')</code>，确保该回调是由合法的 Pair 合约发起的。</li>
</ul>
</li>
<li><strong>归还资金</strong>：在自定义逻辑执行完毕后，用户合约必须将借出的 Token 加上计算好的手续费转回给 Pair 合约。
<ul>
<li><strong>手续费计算细节</strong>：如视频中代码示例所示，实际计算手续费时常用 <code>(amount * 3 / 997) + 1</code> 的方式，<code>+1</code> 是为了在整数除法中实现<strong>向上取整</strong>，确保支付的手续费只多不少。</li>
</ul>
</li>
<li><strong>最终验证</strong>：Pair 合约在回调执行完毕后，会检查池内资产余额。如果余额满足 <code>期末余额 &gt;= 期初余额</code> 的条件，则交易成功；否则，整笔交易被回滚。</li>
</ol>
<h3 class="heading-element" id="4-flash-swap-的实际应用与案例"><span><strong>4. Flash Swap 的实际应用与案例</strong></span>
  <a href="#4-flash-swap-%e7%9a%84%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e4%b8%8e%e6%a1%88%e4%be%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Flash Swaps 最强大的用途是执行复杂的<strong>套利策略</strong>。</p>
<ul>
<li><strong>案例：bZx 协议套利事件</strong>
<ul>
<li><strong>背景</strong>：一名套利者在没有自有资金的情况下，通过组合多个 DeFi 协议，在单笔交易中获利约 35 万美元。</li>
<li><strong>操作步骤</strong>：
<ol>
<li><strong>借款</strong>：通过 <code>dYdX</code> 协议的闪电贷功能，借出 <strong>10,000 ETH</strong>。</li>
<li><strong>抵押借贷</strong>：将其中 5,500 ETH 发送到 <code>Compound</code> 协议，抵押借出 <strong>112 WBTC</strong>。</li>
<li><strong>开空单</strong>：将另外 1,300 ETH 发送到 <code>bZx</code> 协议，开设 5 倍杠杆的 ETH 空单。</li>
<li><strong>价格操纵</strong>：将剩余的 5,637 ETH 在 <code>Uniswap</code> 的 WBTC/ETH 池中大量卖出，导致 Uniswap 上的 WBTC 价格被瞬间拉高。</li>
<li><strong>卖出获利</strong>：将在 <code>Compound</code> 借到的 112 WBTC 在价格被拉高的 <code>Uniswap</code> 卖出，换回约 <strong>6,800 ETH</strong>。</li>
<li><strong>归还贷款</strong>：将最初从 <code>dYdX</code> 借来的 10,000 ETH 归还。</li>
</ol>
</li>
<li><strong>结果</strong>：通过这一系列复杂操作，套利者净赚了大量 ETH，而所有这一切都在一个区块内（一笔交易中）完成，充分展示了 DeFi 的可组合性和 Flash Swaps 的威力。</li>
</ul>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="更新于 2025-09-02 00:00:00">更新于 2025-09-02&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="vscode://file//Users/ghostasky/Blog/content/posts/202509-Uniswap06/index.md" title="在编辑器中打开" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">在编辑器中打开</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="分享到 X" data-sharer="twitter" data-url="http://localhost:1313/posts/202509-uniswap06/" data-title="06.Uniswap V2 闪电贷" data-hashtags="Web3"><i class="fa-brands fa-x-twitter" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/202509-uniswap06/" data-hashtag="Web3"><i class="fa-brands fa-facebook-square" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/202509-uniswap06/" data-title="06.Uniswap V2 闪电贷"><i class="fa-brands fa-weibo" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags me-1" aria-hidden="true"></i><a href="/tags/web3/" class="post-tag" title="标签 - Web3">Web3</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/202509-uniswap07/" class="post-nav-item" rel="prev" title="07.Uniswap V2 TWAP"><i class="fa-solid fa-angle-left" aria-hidden="true"></i>07.Uniswap V2 TWAP</a><a href="/posts/202509-uniswap05/" class="post-nav-item" rel="next" title="05.Uniswap V2 无常损失">05.Uniswap V2 无常损失<i class="fa-solid fa-angle-right" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li>
      <ul>
        <li><a href="#核心摘要-key-takeaways"><strong>核心摘要 (Key Takeaways)</strong></a></li>
        <li><a href="#1-flash-swaps-核心概念"><strong>1. Flash Swaps 核心概念</strong></a>
          <ul>
            <li><a href="#11-为什么需要-flash-swaps">1.1 为什么需要 Flash Swaps？</a></li>
            <li><a href="#12-核心保障原子性">1.2 核心保障：原子性</a></li>
          </ul>
        </li>
        <li><a href="#2-flash-swap-的数学原理"><strong>2. Flash Swap 的数学原理</strong></a>
          <ul>
            <li><a href="#21-关键参数定义">2.1 关键参数定义</a></li>
            <li><a href="#22-手续费计算">2.2 手续费计算</a></li>
            <li><a href="#23-从资金池角度的验证逻辑">2.3 从资金池角度的验证逻辑</a></li>
          </ul>
        </li>
        <li><a href="#3-flash-swap-的实现流程"><strong>3. Flash Swap 的实现流程</strong></a>
          <ul>
            <li><a href="#31-交互时序图-mermaid-sequence-diagram">3.1 交互时序图 (Mermaid Sequence Diagram)</a></li>
            <li><a href="#32-流程解释">3.2 流程解释</a></li>
          </ul>
        </li>
        <li><a href="#4-flash-swap-的实际应用与案例"><strong>4. Flash Swap 的实际应用与案例</strong></a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.154.5"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.3-20260123080729-2a5bd268"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2026</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up" aria-hidden="true"></i></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="目录"><i class="fa-solid fa-bars" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/js/config/e7c41aa45c5c95cf1786d2938d2c227e.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script></body>
</html>
