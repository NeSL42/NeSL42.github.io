<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>以太坊-基础数据结构解析 - 敬渊&#39;s Blog</title><meta name="author" content="">
<meta name="description" content="以太坊基础配置 以太坊的基础配置用于服务于链，启动以太坊节点，则需要将链配置载入
"><meta name="keywords" content='Web3'>
  <meta itemprop="name" content="以太坊-基础数据结构解析">
  <meta itemprop="description" content="以太坊基础配置 以太坊的基础配置用于服务于链，启动以太坊节点，则需要将链配置载入">
  <meta itemprop="datePublished" content="2025-09-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-09-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="19083">
  <meta itemprop="keywords" content="Web3"><meta property="og:url" content="https://nesl42.github.io/posts/202509-ethbasestruct/">
  <meta property="og:site_name" content="敬渊&#39;s Blog">
  <meta property="og:title" content="以太坊-基础数据结构解析">
  <meta property="og:description" content="以太坊基础配置 以太坊的基础配置用于服务于链，启动以太坊节点，则需要将链配置载入">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-10T00:00:00+00:00">
    <meta property="article:tag" content="Web3">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="以太坊-基础数据结构解析">
  <meta name="twitter:description" content="以太坊基础配置 以太坊的基础配置用于服务于链，启动以太坊节点，则需要将链配置载入">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://nesl42.github.io/posts/202509-ethbasestruct/" title="以太坊-基础数据结构解析 - 敬渊&#39;s Blog" /><link rel="prev" type="text/html" href="https://nesl42.github.io/posts/202509-llmquart/" title="量化可视化指南揭秘：大型语言模型的压缩" /><link rel="next" type="text/html" href="https://nesl42.github.io/posts/202509-ethpool/" title="以太坊详解之交易池" /><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "以太坊-基础数据结构解析",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/nesl42.github.io\/posts\/202509-ethbasestruct\/"
    },"genre": "posts","keywords": "Web3","wordcount":  19083 ,
    "url": "https:\/\/nesl42.github.io\/posts\/202509-ethbasestruct\/","datePublished": "2025-09-10T00:00:00+00:00","dateModified": "2025-09-10T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "作者"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="敬渊&#39;s Blog"><span class="header-title-text">敬渊&#39;s Blog</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/">文章</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/">标签</a></li><li class="menu-item">
              <a class="menu-link" href="/about/">关于</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/">分类</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" role="button" aria-label="切换主题" title="切换主题"><i class="fa-solid fa-adjust" aria-hidden="true"></i></li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="敬渊&#39;s Blog"><span class="header-title-text">敬渊&#39;s Blog</span></a><span class="header-subtitle"></span></div>
      <div class="theme-switch" role="button" aria-label="切换主题"><i class="fa-solid fa-adjust" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="menu-item"><a class="menu-link" href="/posts/">文章</a></li><li class="menu-item"><a class="menu-link" href="/tags/">标签</a></li><li class="menu-item"><a class="menu-link" href="/about/">关于</a></li><li class="menu-item"><a class="menu-link" href="/categories/">分类</a></li><li class="menu-item menu-system"></li>
      </ul>
    </nav>
  </div>
</header><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>以太坊-基础数据结构解析</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Anonymous</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/technology/" class="post-category" title="分类 - Technology"><i class="fa-regular fa-folder" aria-hidden="true"></i> Technology</a></span></div><div class="post-meta-line"><span title="发布于 2025-09-10 00:00:00"><i class="fa-solid fa-calendar-days me-1" aria-hidden="true"></i><time datetime="2025-09-10">2025-09-10</time></span>&nbsp;<span title="19083 字"><i class="fa-solid fa-pencil-alt me-1" aria-hidden="true"></i>约 19100 字</span>&nbsp;<span><i class="fa-regular fa-clock me-1" aria-hidden="true"></i>预计阅读 39 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#chainconfig-结构体概述"><code>ChainConfig</code> 结构体概述</a>
      <ul>
        <li><a href="#字段解释">字段解释</a>
          <ul>
            <li><a href="#以太坊兼容或基于以太坊协议的区块链网络">以太坊兼容或基于以太坊协议的区块链网络</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#最外层创世区块的头部和初始状态">最外层（创世区块的头部和初始状态）</a></li>
        <li><a href="#config-对象网络配置和硬分叉时间表"><code>config</code> 对象（网络配置和硬分叉时间表）</a></li>
        <li><a href="#alloc-对象初始账户分配"><code>alloc</code> 对象（初始账户分配）</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#外部账户">外部账户</a></li>
    <li><a href="#合约账户">合约账户</a></li>
    <li><a href="#账户数据结构">账户数据结构</a></li>
  </ul>

  <ul>
    <li><a href="#交易数据结构">交易数据结构</a></li>
    <li><a href="#交易对象">交易对象</a></li>
    <li><a href="#交易对象方法">交易对象方法</a></li>
  </ul>

  <ul>
    <li><a href="#receipt结构体">Receipt结构体</a></li>
    <li><a href="#交易回执内容介绍">交易回执内容介绍</a>
      <ul>
        <li><a href="#交易回执共识信息">交易回执共识信息</a></li>
        <li><a href="#交易回执交易信息">交易回执交易信息</a></li>
        <li><a href="#交易回执区块信息">交易回执区块信息</a></li>
      </ul>
    </li>
    <li><a href="#交易回执构造">交易回执构造</a></li>
    <li><a href="#交易回执存储">交易回执存储</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h1 class="heading-element" id="以太坊基础配置"><span>以太坊基础配置</span>
  <a href="#%e4%bb%a5%e5%a4%aa%e5%9d%8a%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>以太坊的基础配置用于服务于链，启动以太坊节点，则需要将链配置载入</p>
<blockquote>
<p><a href="https://github.com/ethereum/go-ethereum#" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ethereum/go-ethereum#</a></p>
</blockquote>
<p>在<code>params/config.go</code> 中：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ChainConfig 是决定区块链设置的核心配置。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// ChainConfig 以每个区块为基础存储在数据库中。这意味着</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 任何由其创世区块标识的网络，都可以拥有自己的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 一套配置选项。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">ChainConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ChainID</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;chainId&#34;`</span><span class="w"> </span><span class="c1">// chainId 标识当前链，用于重放攻击保护。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">HomesteadBlock</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;homesteadBlock,omitempty&#34;`</span><span class="w"> </span><span class="c1">// Homestead 硬分叉切换区块（nil = 无硬分叉，0 = 已是 Homestead）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">DAOForkBlock</span><span class="w">   </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;daoForkBlock,omitempty&#34;`</span><span class="w">   </span><span class="c1">// TheDAO 硬分叉切换区块（nil = 无硬分叉）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">DAOForkSupport</span><span class="w"> </span><span class="kt">bool</span><span class="w">     </span><span class="s">`json:&#34;daoForkSupport,omitempty&#34;`</span><span class="w"> </span><span class="c1">// 节点是否支持或反对 DAO 硬分叉</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// EIP150 实现了 Gas 价格变化 (https://github.com/ethereum/EIPs/issues/150)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">EIP150Block</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;eip150Block,omitempty&#34;`</span><span class="w"> </span><span class="c1">// EIP150 硬分叉区块（nil = 无硬分叉）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">EIP155Block</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;eip155Block,omitempty&#34;`</span><span class="w"> </span><span class="c1">// EIP155 硬分叉区块</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">EIP158Block</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;eip158Block,omitempty&#34;`</span><span class="w"> </span><span class="c1">// EIP158 硬分叉区块</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ByzantiumBlock</span><span class="w">      </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;byzantiumBlock,omitempty&#34;`</span><span class="w">      </span><span class="c1">// Byzantium 切换区块（nil = 无硬分叉，0 = 已在 Byzantium）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ConstantinopleBlock</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;constantinopleBlock,omitempty&#34;`</span><span class="w"> </span><span class="c1">// Constantinople 切换区块（nil = 无硬分叉，0 = 已激活）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">PetersburgBlock</span><span class="w">     </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;petersburgBlock,omitempty&#34;`</span><span class="w">     </span><span class="c1">// Petersburg 切换区块（nil = 与 Constantinople 相同）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">IstanbulBlock</span><span class="w">       </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;istanbulBlock,omitempty&#34;`</span><span class="w">       </span><span class="c1">// Istanbul 切换区块（nil = 无硬分叉，0 = 已在 Istanbul）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">MuirGlacierBlock</span><span class="w">    </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;muirGlacierBlock,omitempty&#34;`</span><span class="w">    </span><span class="c1">// Eip-2384（难度炸弹延迟）切换区块（nil = 无硬分叉，0 = 已激活）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BerlinBlock</span><span class="w">         </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;berlinBlock,omitempty&#34;`</span><span class="w">         </span><span class="c1">// Berlin 切换区块（nil = 无硬分叉，0 = 已在 Berlin）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">LondonBlock</span><span class="w">         </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;londonBlock,omitempty&#34;`</span><span class="w">         </span><span class="c1">// London 切换区块（nil = 无硬分叉，0 = 已在 London）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ArrowGlacierBlock</span><span class="w">   </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;arrowGlacierBlock,omitempty&#34;`</span><span class="w">   </span><span class="c1">// Eip-4345（难度炸弹延迟）切换区块（nil = 无硬分叉，0 = 已激活）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">GrayGlacierBlock</span><span class="w">    </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;grayGlacierBlock,omitempty&#34;`</span><span class="w">    </span><span class="c1">// Eip-5133（难度炸弹延迟）切换区块（nil = 无硬分叉，0 = 已激活）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">MergeNetsplitBlock</span><span class="w">  </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;mergeNetsplitBlock,omitempty&#34;`</span><span class="w">  </span><span class="c1">// 在合并（The Merge）后用于网络拆分的虚拟硬分叉</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 硬分叉调度已从区块改为时间戳</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ShanghaiTime</span><span class="w"> </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;shanghaiTime,omitempty&#34;`</span><span class="w"> </span><span class="c1">// Shanghai 切换时间（nil = 无硬分叉，0 = 已在 Shanghai）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">CancunTime</span><span class="w">   </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;cancunTime,omitempty&#34;`</span><span class="w">   </span><span class="c1">// Cancun 切换时间（nil = 无硬分叉，0 = 已在 Cancun）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">PragueTime</span><span class="w">   </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;pragueTime,omitempty&#34;`</span><span class="w">   </span><span class="c1">// Prague 切换时间（nil = 无硬分叉，0 = 已在 Prague）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">OsakaTime</span><span class="w">    </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;osakaTime,omitempty&#34;`</span><span class="w">    </span><span class="c1">// Osaka 切换时间（nil = 无硬分叉，0 = 已在 Osaka）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">VerkleTime</span><span class="w">   </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;verkleTime,omitempty&#34;`</span><span class="w">   </span><span class="c1">// Verkle 切换时间（nil = 无硬分叉，0 = 已在 Verkle）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BPO1Time</span><span class="w">     </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;bpo1Time,omitempty&#34;`</span><span class="w">     </span><span class="c1">// BPO1 切换时间（nil = 无硬分叉，0 = 已在 BPO1）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BPO2Time</span><span class="w">     </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;bpo2Time,omitempty&#34;`</span><span class="w">     </span><span class="c1">// BPO2 切换时间（nil = 无硬分叉，0 = 已在 BPO2）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BPO3Time</span><span class="w">     </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;bpo3Time,omitempty&#34;`</span><span class="w">     </span><span class="c1">// BPO3 切换时间（nil = 无硬分叉，0 = 已在 BPO3）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BPO4Time</span><span class="w">     </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;bpo4Time,omitempty&#34;`</span><span class="w">     </span><span class="c1">// BPO4 切换时间（nil = 无硬分叉，0 = 已在 BPO4）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BPO5Time</span><span class="w">     </span><span class="o">*</span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;bpo5Time,omitempty&#34;`</span><span class="w">     </span><span class="c1">// BPO5 切换时间（nil = 无硬分叉，0 = 已在 BPO5）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// TerminalTotalDifficulty 是网络达到的总难度量，它会触发共识升级。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">TerminalTotalDifficulty</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="s">`json:&#34;terminalTotalDifficulty,omitempty&#34;`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">DepositContractAddress</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="w"> </span><span class="s">`json:&#34;depositContractAddress,omitempty&#34;`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// EnableVerkleAtGenesis 是一个标志，指定网络是否从创世区块开始使用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Verkle 树。如果设置为 true，创世状态将使用 Verkle 树提交，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 从而无需后续进行任何 Verkle 转换。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">    // 这只是 Verkle 开发网络测试的临时标志，其中 Verkle 从</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 创世区块激活，并且配置的激活日期已经过去。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">    // 在生产网络（主网和公共测试网）中，Verkle 激活</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 总是发生在创世区块之后，使此标志在</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 这些情况下无关紧要。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">EnableVerkleAtGenesis</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="s">`json:&#34;enableVerkleAtGenesis,omitempty&#34;`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 各种共识引擎</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Ethash</span><span class="w">             </span><span class="o">*</span><span class="nx">EthashConfig</span><span class="w">       </span><span class="s">`json:&#34;ethash,omitempty&#34;`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Clique</span><span class="w">             </span><span class="o">*</span><span class="nx">CliqueConfig</span><span class="w">       </span><span class="s">`json:&#34;clique,omitempty&#34;`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BlobScheduleConfig</span><span class="w"> </span><span class="o">*</span><span class="nx">BlobScheduleConfig</span><span class="w"> </span><span class="s">`json:&#34;blobSchedule,omitempty&#34;`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h2 class="heading-element" id="chainconfig-结构体概述"><span><code>ChainConfig</code> 结构体概述</span>
  <a href="#chainconfig-%e7%bb%93%e6%9e%84%e4%bd%93%e6%a6%82%e8%bf%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><code>ChainConfig</code> 是决定区块链设置的核心配置。它以每个区块为基础存储在数据库中，这意味着任何由其创世区块标识的网络（无论是主网、测试网还是私有链），都可以拥有自己的一套配置选项，从而实现不同网络间的差异化协议和功能。</p>
<h3 class="heading-element" id="字段解释"><span>字段解释</span>
  <a href="#%e5%ad%97%e6%ae%b5%e8%a7%a3%e9%87%8a" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ol>
<li>
<p><code>ChainID *big.Int</code></p>
<p>解释：<code>ChainID</code>（链ID）标识当前区块链网络，并且是用于防止交易重放攻击的关键机制。当用户签署一笔交易时，交易数据中会包含该 <code>ChainID</code>。如果这笔交易被复制到另一个具有不同 <code>ChainID</code> 的网络上，该交易将因 <code>ChainID</code> 不匹配而被视为无效，从而保护用户资产。</p>
</li>
<li>
<p><code>HomesteadBlock *big.Int</code></p>
<p>解释：这是 Homestead 硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示该链没有发生 Homestead 硬分叉，或者说还未达到 Homestead 阶段。</li>
<li><code>0</code>：表示该链从创世区块开始就已经处于 Homestead 阶段。</li>
</ul>
<p>背景：Homestead 是以太坊主网的第二次重大升级，引入了一些重要的改进，例如取消了未使用的交易类型、改进了 Gas 算法等。意味着从此高度开始，新区块受 homested 版本共识规则约束。 因涉及共识变更，如果希望继续接受新区块则必须升级以太坊程序，属于区块链硬分叉。 如果不愿意接受共识变更，则可以独立使用新的 ChainID 继续原共识，且必须独立维护版本。</p>
</li>
<li>
<p><code>DAOForkBlock *big.Int</code>
解释：这是 TheDAO 硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示该链没有发生 TheDAO 硬分叉。</li>
</ul>
<p>背景：TheDAO 硬分叉是以太坊历史上最著名的事件之一。2016年，一个名为 TheDAO 的去中心化自治组织合约被黑客攻击，导致大量以太币被盗。社区就是否“回滚”交易记录以追回资产进行了激烈辩论，最终以太坊社区投票决定进行硬分叉，分叉后的链成为了当前的以太坊主网，而未回滚的链则成为了以太坊经典 (Ethereum Classic)。</p>
</li>
<li>
<p><code>DAOForkSupport bool</code>
解释：指示当前节点是支持还是反对 DAO 硬分叉。这是一个历史性的标志，在 DAO 硬分叉期间用于区分支持和反对该分叉的节点行为。</p>
</li>
<li>
<p><code>EIP150Block *big.Int</code>
解释：EIP-150 硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示该链没有启用 EIP-150。</li>
</ul>
<p>背景：EIP-150 引入了 Gas 价格的变化（例如，通过调整 Gas 成本来限制拒绝服务攻击），旨在提高网络的稳定性。</p>
</li>
<li>
<p><code>EIP155Block *big.Int</code>
解释：EIP-155 硬分叉的切换区块高度。
背景：EIP-155 进一步增强了交易的重放保护，它强制交易签名包含 <code>ChainID</code>，使得不同区块链网络之间的交易更难被混淆和重放。</p>
</li>
<li>
<p><code>EIP158Block *big.Int</code>
解释：EIP-158 硬分叉的切换区块高度。</p>
<p>背景：EIP-158 引入了状态清理规则，使得空账户（无余额且无交易记录的账户）可以被移除，有助于修剪区块链状态树的大小。</p>
</li>
<li>
<p><code>ByzantiumBlock *big.Int</code>
解释：Byzantium（拜占庭）硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已在 Byzantium 阶段。</li>
</ul>
<p>背景：Byzantium 是以太坊大都會（Metropolis）升级的第一阶段，引入了多种改进，包括交易收据中的状态根、预编译合约的更新等。</p>
</li>
<li>
<p><code>ConstantinopleBlock *big.Int</code>
解释：Constantinople（君士坦丁堡）硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已激活此硬分叉。</li>
</ul>
<p>背景：Constantinople 是大都會升级的第二阶段，引入了更多的 EIP，包括更高效的虚拟机指令、难度炸弹的延迟等。</p>
</li>
<li>
<p><code>PetersburgBlock *big.Int</code>
解释：Petersburg（圣彼得堡）硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：PetersburgBlock 是一个独立的硬分叉，虽然它在以太坊主网上与 ConstantinopleBlock 在同一区块高度激活，但它们是两个不同的配置项。Petersburg 的目的是移除 Constantinople 中一个被发现有安全漏洞的 EIP。因此，一个网络可以只激活其中一个，或者在同一区块激活两个。如果 PetersburgBlock 为 nil，则意味着 Petersburg 规则不生效。</li>
</ul>
<p>背景：Petersburg 可以被视为对 Constantinople 的紧急修复，主要处理了一些安全漏洞，并且也延迟了难度炸弹。</p>
</li>
<li>
<p><code>IstanbulBlock *big.Int</code>
解释：Istanbul（伊斯坦布尔）硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已在 Istanbul 阶段。
背景：Istanbul 再次延迟了难度炸弹，并引入了费用模型优化、预编译合约更新等 EIP。</li>
</ul>
</li>
<li>
<p><code>MuirGlacierBlock *big.Int</code>
解释：EIP-2384（难度炸弹延迟）切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已激活此硬分叉。</li>
</ul>
<p>背景：专门用于再次延迟以太坊的“难度炸弹”，确保在 PoS Transition 之前网络可以平稳运行。</p>
</li>
<li>
<p><code>BerlinBlock *big.Int</code>
解释：Berlin（柏林）硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已在 Berlin 阶段。</li>
</ul>
<p>背景：Berlin 主要优化了 Gas 成本和一些安全补丁。</p>
</li>
<li>
<p><code>LondonBlock *big.Int</code>
解释：London（伦敦）硬分叉的切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已在 London 阶段。
背景：London 引入了 EIP-1559，改变了交易费用机制，引入了基础费用燃烧（base fee burning）和最大优先级费用（max priority fee），旨在使 Gas 费用更可预测。</li>
</ul>
</li>
<li>
<p><code>ArrowGlacierBlock *big.Int</code>
解释：EIP-4345（难度炸弹延迟）切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已激活此硬分叉。</li>
</ul>
<p>背景：又一次用于延迟难度炸弹，为以太坊合并做准备。</p>
</li>
<li>
<p><code>GrayGlacierBlock *big.Int</code>
解释：EIP-5133（难度炸弹延迟）切换区块高度。</p>
<ul>
<li><code>nil</code>：表示无此硬分叉。</li>
<li><code>0</code>：表示该链从创世区块开始就已激活此硬分叉。</li>
</ul>
<p>背景：再次延迟难度炸弹，确保以太坊的 PoW 链在合并之前有足够长的时间。</p>
</li>
<li>
<p><code>MergeNetsplitBlock *big.Int</code>
解释：为了防止网络分裂。在“合并”（The Merge）期间，如果一个节点未能成功切换到权益证明（PoS）链，它可能会继续遵循旧的工作量证明（PoW）规则。MergeNetsplitBlock 标志着一个区块，在此之后，任何只支持 PoW 的节点都应停止处理区块。这确保了旧的 PoW 链不会意外地继续下去，从而防止了网络分裂，保障了平稳过渡。它不是一个“虚拟硬分叉”，而是一个停止 PoW 链的信号。
背景：The Merge 是以太坊从工作量证明 (PoW) 过渡到权益证明 (PoS) 的关键事件。</p>
</li>
</ol>
<h4 class="heading-element" id="以太坊兼容或基于以太坊协议的区块链网络"><span>以太坊兼容或基于以太坊协议的区块链网络</span>
  <a href="#%e4%bb%a5%e5%a4%aa%e5%9d%8a%e5%85%bc%e5%ae%b9%e6%88%96%e5%9f%ba%e4%ba%8e%e4%bb%a5%e5%a4%aa%e5%9d%8a%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8c%ba%e5%9d%97%e9%93%be%e7%bd%91%e7%bb%9c" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">链ID (Chain ID)</th>
            <th style="text-align: left">名称 (Name)</th>
            <th style="text-align: left">简称 (Short Name)</th>
            <th style="text-align: left">链 (Chain)</th>
            <th style="text-align: left">网络 (Network)</th>
            <th style="text-align: left">网络ID (Network ID)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">1</td>
            <td style="text-align: left">以太坊主网 (Ethereum Mainnet)</td>
            <td style="text-align: left">eth (eth)</td>
            <td style="text-align: left">ETH (ETH)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">2</td>
            <td style="text-align: left">Expanse 网络 (Expanse Network)</td>
            <td style="text-align: left">exp (exp)</td>
            <td style="text-align: left">EXP (EXP)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">3</td>
            <td style="text-align: left">以太坊测试网 Ropsten (Ethereum Testnet Ropsten)</td>
            <td style="text-align: left">rop (rop)</td>
            <td style="text-align: left">ETH (ETH)</td>
            <td style="text-align: left">Ropsten (ropsten)</td>
            <td style="text-align: left">3</td>
        </tr>
        <tr>
            <td style="text-align: left">4</td>
            <td style="text-align: left">以太坊测试网 Rinkeby (Ethereum Testnet Rinkeby)</td>
            <td style="text-align: left">rin (rin)</td>
            <td style="text-align: left">ETH (ETH)</td>
            <td style="text-align: left">Rinkeby (rinkeby)</td>
            <td style="text-align: left">4</td>
        </tr>
        <tr>
            <td style="text-align: left">5</td>
            <td style="text-align: left">以太坊测试网 Görli (Ethereum Testnet Görli)</td>
            <td style="text-align: left">gor (gor)</td>
            <td style="text-align: left">ETH (ETH)</td>
            <td style="text-align: left">Goerli (goerli)</td>
            <td style="text-align: left">5</td>
        </tr>
        <tr>
            <td style="text-align: left">6</td>
            <td style="text-align: left">以太坊经典测试网 Kotti (Ethereum Classic Testnet Kotti)</td>
            <td style="text-align: left">kot (kot)</td>
            <td style="text-align: left">ETC (ETC)</td>
            <td style="text-align: left">Kotti (kotti)</td>
            <td style="text-align: left">6</td>
        </tr>
        <tr>
            <td style="text-align: left">8</td>
            <td style="text-align: left">Ubiq 网络主网 (Ubiq Network Mainnet)</td>
            <td style="text-align: left">ubq (ubq)</td>
            <td style="text-align: left">UBQ (UBQ)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">9</td>
            <td style="text-align: left">Ubiq 网络测试网 (Ubiq Network Testnet)</td>
            <td style="text-align: left">tubq (tubq)</td>
            <td style="text-align: left">UBQ (UBQ)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">2</td>
        </tr>
        <tr>
            <td style="text-align: left">28</td>
            <td style="text-align: left">以太坊社交 (Ethereum Social)</td>
            <td style="text-align: left">etsc (etsc)</td>
            <td style="text-align: left">ETSC (ETSC)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">30</td>
            <td style="text-align: left">RSK 主网 (RSK Mainnet)</td>
            <td style="text-align: left">rsk (rsk)</td>
            <td style="text-align: left">RSK (RSK)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">775</td>
        </tr>
        <tr>
            <td style="text-align: left">31</td>
            <td style="text-align: left">RSK 测试网 (RSK Testnet)</td>
            <td style="text-align: left">trsk (trsk)</td>
            <td style="text-align: left">RSK (RSK)</td>
            <td style="text-align: left">测试网 (testnet)</td>
            <td style="text-align: left">8052</td>
        </tr>
        <tr>
            <td style="text-align: left">42</td>
            <td style="text-align: left">以太坊测试网 Kovan (Ethereum Testnet Kovan)</td>
            <td style="text-align: left">kov (kov)</td>
            <td style="text-align: left">ETH (ETH)</td>
            <td style="text-align: left">Kovan (kovan)</td>
            <td style="text-align: left">42</td>
        </tr>
        <tr>
            <td style="text-align: left">60</td>
            <td style="text-align: left">GoChain (GoChain)</td>
            <td style="text-align: left">go (go)</td>
            <td style="text-align: left">GO (GO)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">60</td>
        </tr>
        <tr>
            <td style="text-align: left">61</td>
            <td style="text-align: left">以太坊经典主网 (Ethereum Classic Mainnet)</td>
            <td style="text-align: left">etc (etc)</td>
            <td style="text-align: left">ETC (ETC)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">62</td>
            <td style="text-align: left">以太坊经典测试网 (Ethereum Classic Testnet)</td>
            <td style="text-align: left">tetc (tetc)</td>
            <td style="text-align: left">ETC (ETC)</td>
            <td style="text-align: left">测试网 (testnet)</td>
            <td style="text-align: left">2</td>
        </tr>
        <tr>
            <td style="text-align: left">64</td>
            <td style="text-align: left">Ellaism (Ellaism)</td>
            <td style="text-align: left">ella (ella)</td>
            <td style="text-align: left">ELLA (ELLA)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">76</td>
            <td style="text-align: left">Mix (Mix)</td>
            <td style="text-align: left">mix (mix)</td>
            <td style="text-align: left">MIX (MIX)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">77</td>
            <td style="text-align: left">POA Network Sokol (POA Network Sokol)</td>
            <td style="text-align: left">poa (poa)</td>
            <td style="text-align: left">POA (POA)</td>
            <td style="text-align: left">Sokol (sokol)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">88</td>
            <td style="text-align: left">TomoChain (TomoChain)</td>
            <td style="text-align: left">tomo (tomo)</td>
            <td style="text-align: left">TOMO (TOMO)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">88</td>
        </tr>
        <tr>
            <td style="text-align: left">99</td>
            <td style="text-align: left">POA Network Core (POA Network Core)</td>
            <td style="text-align: left">skl (skl)</td>
            <td style="text-align: left">POA (POA)</td>
            <td style="text-align: left">Core (core)</td>
            <td style="text-align: left">2</td>
        </tr>
        <tr>
            <td style="text-align: left">100</td>
            <td style="text-align: left">xDAI 链 (xDAI Chain)</td>
            <td style="text-align: left">xdai (xdai)</td>
            <td style="text-align: left">XDAI (XDAI)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">101</td>
            <td style="text-align: left">Webchain (Webchain)</td>
            <td style="text-align: left">web (web)</td>
            <td style="text-align: left">WEB (WEB)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">37129</td>
        </tr>
        <tr>
            <td style="text-align: left">101</td>
            <td style="text-align: left">EtherInc (EtherInc)</td>
            <td style="text-align: left">eti (eti)</td>
            <td style="text-align: left">ETI (ETI)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">820</td>
            <td style="text-align: left">Callisto 主网 (Callisto Mainnet)</td>
            <td style="text-align: left">clo (clo)</td>
            <td style="text-align: left">CLO (CLO)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">821</td>
            <td style="text-align: left">Callisto 测试网 (Callisto Testnet)</td>
            <td style="text-align: left">tclo (tclo)</td>
            <td style="text-align: left">CLO (CLO)</td>
            <td style="text-align: left">测试网 (testnet)</td>
            <td style="text-align: left">2</td>
        </tr>
        <tr>
            <td style="text-align: left">1620</td>
            <td style="text-align: left">Atheios (Atheios)</td>
            <td style="text-align: left">ath (ath)</td>
            <td style="text-align: left">ATH (ATH)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">11235813</td>
        </tr>
        <tr>
            <td style="text-align: left">1856</td>
            <td style="text-align: left">Teslafunds (Teslafunds)</td>
            <td style="text-align: left">tsf (tsf)</td>
            <td style="text-align: left">TSF (TSF)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">1987</td>
            <td style="text-align: left">EtherGem (EtherGem)</td>
            <td style="text-align: left">egem (egem)</td>
            <td style="text-align: left">EGEM (EGEM)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1987</td>
        </tr>
        <tr>
            <td style="text-align: left">2018</td>
            <td style="text-align: left">EOS Classic (EOS Classic)</td>
            <td style="text-align: left">eosc (eosc)</td>
            <td style="text-align: left">EOSC (EOSC)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">24484</td>
            <td style="text-align: left">Webchain (在区块 xxxxxxx 之后) (Webchain (after block xxxxxxx))</td>
            <td style="text-align: left">web (web)</td>
            <td style="text-align: left">WEB (WEB)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">37129</td>
        </tr>
        <tr>
            <td style="text-align: left">31102</td>
            <td style="text-align: left">Ethersocial Network (Ethersocial Network)</td>
            <td style="text-align: left">esn (esn)</td>
            <td style="text-align: left">ESN (ESN)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1</td>
        </tr>
        <tr>
            <td style="text-align: left">200625</td>
            <td style="text-align: left">Akaroma (Akaroma)</td>
            <td style="text-align: left">aka (aka)</td>
            <td style="text-align: left">AKA (AKA)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">200625</td>
        </tr>
        <tr>
            <td style="text-align: left">246529</td>
            <td style="text-align: left">ARTIS sigma1 (ARTIS sigma1)</td>
            <td style="text-align: left">ats (ats)</td>
            <td style="text-align: left">ARTIS (ARTIS)</td>
            <td style="text-align: left">sigma1 (sigma1)</td>
            <td style="text-align: left">246529</td>
        </tr>
        <tr>
            <td style="text-align: left">246785</td>
            <td style="text-align: left">ARTIS tau1 (ARTIS tau1)</td>
            <td style="text-align: left">ats (ats)</td>
            <td style="text-align: left">ARTIS (ARTIS)</td>
            <td style="text-align: left">tau1 (tau1)</td>
            <td style="text-align: left">246785</td>
        </tr>
        <tr>
            <td style="text-align: left">1313114</td>
            <td style="text-align: left">Ether-1 (Ether-1)</td>
            <td style="text-align: left">etho (etho)</td>
            <td style="text-align: left">ETHO (ETHO)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">1313114</td>
        </tr>
        <tr>
            <td style="text-align: left">7762959</td>
            <td style="text-align: left">Musicoin (Musicoin)</td>
            <td style="text-align: left">music (music)</td>
            <td style="text-align: left">MUSIC (MUSIC)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">7762959</td>
        </tr>
        <tr>
            <td style="text-align: left">18289463</td>
            <td style="text-align: left">IOLite (IOLite)</td>
            <td style="text-align: left">ilt (ilt)</td>
            <td style="text-align: left">ILT (ILT)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">18289463</td>
        </tr>
        <tr>
            <td style="text-align: left">3125659152</td>
            <td style="text-align: left">Pirl (Pirl)</td>
            <td style="text-align: left">pirl (pirl)</td>
            <td style="text-align: left">PIRL (PIRL)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">3125659152</td>
        </tr>
        <tr>
            <td style="text-align: left">385</td>
            <td style="text-align: left">Lisinski (Lisinski)</td>
            <td style="text-align: left">lisinski (lisinski)</td>
            <td style="text-align: left">CRO (CRO)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">385</td>
        </tr>
        <tr>
            <td style="text-align: left">108</td>
            <td style="text-align: left">ThunderCore 主网 (ThunderCore Mainnet)</td>
            <td style="text-align: left">TT (TT)</td>
            <td style="text-align: left">TT (TT)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">108</td>
        </tr>
        <tr>
            <td style="text-align: left">18</td>
            <td style="text-align: left">ThunderCore 测试网 (ThunderCore Testnet)</td>
            <td style="text-align: left">TST (TST)</td>
            <td style="text-align: left">TST (TST)</td>
            <td style="text-align: left">测试网 (testnet)</td>
            <td style="text-align: left">18</td>
        </tr>
        <tr>
            <td style="text-align: left">11</td>
            <td style="text-align: left">Metadium 主网 (Metadium Mainnet)</td>
            <td style="text-align: left">meta (meta)</td>
            <td style="text-align: left">META (META)</td>
            <td style="text-align: left">主网 (mainnet)</td>
            <td style="text-align: left">11</td>
        </tr>
        <tr>
            <td style="text-align: left">12</td>
            <td style="text-align: left">Metadium 测试网 (Metadium Testnet)</td>
            <td style="text-align: left">kal (kal)</td>
            <td style="text-align: left">META (META)</td>
            <td style="text-align: left">测试网 (testnet)</td>
            <td style="text-align: left">12</td>
        </tr>
        <tr>
            <td style="text-align: left">13371337</td>
            <td style="text-align: left">PepChain Churchill (PepChain Churchill)</td>
            <td style="text-align: left">tpep (tpep)</td>
            <td style="text-align: left">PEP (PEP)</td>
            <td style="text-align: left">测试网 (testnet)</td>
            <td style="text-align: left">13371337</td>
        </tr>
    </tbody>
  </table>
</div><h1 class="heading-element" id="创世区块"><span>创世区块</span>
  <a href="#%e5%88%9b%e4%b8%96%e5%8c%ba%e5%9d%97" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>如果要搭建以太坊私有链的话，了解创世配置是配置的，示例配置：</p>
<json-viewer value="&#34;{\n  \&#34;config\&#34;: {\n    \&#34;chainId\&#34;: 1,\n    \&#34;homesteadBlock\&#34;: 1150000,\n    \&#34;daoForkBlock\&#34;: 1920000,\n    \&#34;daoForkSupport\&#34;: true,\n    \&#34;eip150Block\&#34;: 2463000,\n    \&#34;eip150Hash\&#34;: \&#34;0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0\&#34;,\n    \&#34;eip155Block\&#34;: 2675000,\n    \&#34;eip158Block\&#34;: 2675000,\n    \&#34;byzantiumBlock\&#34;: 4370000,\n    \&#34;constantinopleBlock\&#34;: 7280000,\n    \&#34;petersburgBlock\&#34;: 7280000,\n    \&#34;ethash\&#34;: {}\n  },\n  \&#34;nonce\&#34;: \&#34;0x42\&#34;,\n  \&#34;timestamp\&#34;: \&#34;0x0\&#34;,\n  \&#34;extraData\&#34;: \&#34;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa\&#34;,\n  \&#34;gasLimit\&#34;: \&#34;0x1388\&#34;,\n  \&#34;difficulty\&#34;: \&#34;0x400000000\&#34;,\n  \&#34;mixHash\&#34;: \&#34;0x0000000000000000000000000000000000000000000000000000000000000000\&#34;,\n  \&#34;coinbase\&#34;: \&#34;0x0000000000000000000000000000000000000000\&#34;,\n  \&#34;number\&#34;: \&#34;0x0\&#34;,\n  \&#34;gasUsed\&#34;: \&#34;0x0\&#34;,\n  \&#34;parentHash\&#34;: \&#34;0x0000000000000000000000000000000000000000000000000000000000000000\&#34;,\n  \&#34;alloc\&#34;: {\n    \&#34;000d836201318ec6899a67540690382780743280\&#34;: {\n      \&#34;balance\&#34;: \&#34;0xad78ebc5ac6200000\&#34;\n    },\n    \&#34;001762430ea9c3a26e5749afdb70da5f78ddbb8c\&#34;: {\n      \&#34;balance\&#34;: \&#34;0xad78ebc5ac6200000\&#34;\n    }\n  }\n}&#34;" expand-depth="1" boxed copyable="{&#34;copiedText&#34;:&#34;已复制&#34;,&#34;copyText&#34;:&#34;复制&#34;}"></json-viewer><p>这个配置是一个 <strong>以太坊创世区块（Genesis Block）</strong> 的定义。创世区块是区块链的第一个区块（区块号为 0），它没有前一个区块，并定义了网络启动时的初始状态和一系列网络规则。</p>
<p>下面是对每个字段的详细解释：</p>
<h3 class="heading-element" id="最外层创世区块的头部和初始状态"><span>最外层（创世区块的头部和初始状态）</span>
  <a href="#%e6%9c%80%e5%a4%96%e5%b1%82%e5%88%9b%e4%b8%96%e5%8c%ba%e5%9d%97%e7%9a%84%e5%a4%b4%e9%83%a8%e5%92%8c%e5%88%9d%e5%a7%8b%e7%8a%b6%e6%80%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这些字段定义了创世区块的基本属性，类似于任何一个以太坊区块的头部，但针对创世区块有特殊的初始值。</p>
<ul>
<li><strong><code>nonce</code>: &ldquo;0x42&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 一个64位的哈希值，矿工挖矿时尝试找到的随机数。对于创世区块，它是一个任意的初始值，<strong><code>0x42</code></strong> 是一个常见的惯例，可以理解为一个固定的魔术数字或占位符。</li>
</ul>
</li>
<li><strong><code>timestamp</code>: &ldquo;0x0&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 区块被挖出的时间戳（Unix时间）。对于创世区块，通常设为 <strong><code>0x0</code></strong> (格林威治标准时间 1970/1/1 00:00:00)，或者一个非常早的时间。</li>
</ul>
</li>
<li><strong><code>extraData</code>: &ldquo;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 矿工可以包含的任意数据。对于以太坊主网的创世区块，这个值包含了拉丁语的 &ldquo;GenesiS&rdquo; 和一个笑脸表情的编码，是一个非常有标志性的字段。</li>
</ul>
</li>
<li><strong><code>gasLimit</code>: &ldquo;0x1388&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 区块中所有交易允许消耗的最大 Gas 量。在创世区块中，它是一个初始上限（<code>0x1388</code> 十进制为 5000）。未来的区块会动态调整这个值。</li>
</ul>
</li>
<li><strong><code>difficulty</code>: &ldquo;0x400000000&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 挖出当前区块的难度值。对于创世区块，它被设置为一个初始值，既不能太低导致轻易挖出，也不能太高导致无法启动。<code>0x400000000</code> 是以太坊主网创世区块的初始难度。</li>
</ul>
</li>
<li><strong><code>mixHash</code>: &ldquo;0x0000000000000000000000000000000000000000000000000000000000000000&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 与 <code>nonce</code> 一起，用于工作量证明（PoW）的哈希值。对于创世区块，因为没有上一个区块参与 PoW 计算，通常设为全零。</li>
</ul>
</li>
<li><strong><code>coinbase</code>: &ldquo;0x0000000000000000000000000000000000000000&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 接收当前区块奖励（如果存在）的矿工地址。对于创世区块，通常设为零地址，因为创世区块本身没有挖矿奖励。</li>
</ul>
</li>
<li><strong><code>number</code>: &ldquo;0x0&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 区块号。创世区块始终是区块 <strong><code>0</code></strong>。</li>
</ul>
</li>
<li><strong><code>gasUsed</code>: &ldquo;0x0&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 当前区块中所有交易实际消耗的总 Gas 量。对于创世区块，没有包含交易，所以是 <strong><code>0x0</code></strong>。</li>
</ul>
</li>
<li><strong><code>parentHash</code>: &ldquo;0x0000000000000000000000000000000000000000000000000000000000000000&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 上一个区块的哈希值。由于创世区块是链上的第一个区块，它没有父区块，因此 <code>parentHash</code> 设为全零。</li>
</ul>
</li>
</ul>
<h3 class="heading-element" id="config-对象网络配置和硬分叉时间表"><span><code>config</code> 对象（网络配置和硬分叉时间表）</span>
  <a href="#config-%e5%af%b9%e8%b1%a1%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae%e5%92%8c%e7%a1%ac%e5%88%86%e5%8f%89%e6%97%b6%e9%97%b4%e8%a1%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这个对象定义了网络的关键配置参数，包括 Chain ID 和一系列硬分叉（Hard Fork）的激活区块号。这些通常与以太坊主网的硬分叉历史保持一致。</p>
<ul>
<li><strong><code>chainId</code>: 1</strong>
<ul>
<li><strong>含义</strong>: 网络的唯一标识符。<code>1</code> 是以太坊主网的 Chain ID。</li>
</ul>
</li>
<li><strong><code>homesteadBlock</code>: 1150000</strong>
<ul>
<li><strong>含义</strong>: Homestead 硬分叉激活的区块号。Homestead 是以太坊的第二个主要版本。</li>
</ul>
</li>
<li><strong><code>daoForkBlock</code>: 1920000</strong>
<ul>
<li><strong>含义</strong>: DAO 硬分叉激活的区块号。这是因为 DAO 攻击事件而进行的一次社群驱动的强制性协议升级。</li>
</ul>
</li>
<li><strong><code>daoForkSupport</code>: true</strong>
<ul>
<li><strong>含义</strong>: 指示客户端是否支持 DAO 硬分叉。<code>true</code> 表示客户端将遵循 DAO 硬分叉后的链（即以太坊主网）。如果为 <code>false</code>，则会遵循 ETC（以太坊经典）链。</li>
</ul>
</li>
<li><strong><code>eip150Block</code>: 2463000</strong>
<ul>
<li><strong>含义</strong>: EIP-150（Tangerine Whistle Hardfork，橘皮哨音硬分叉）激活的区块号。此硬分叉修改了某些操作码的 Gas 成本。</li>
</ul>
</li>
<li><strong><code>eip150Hash</code>: &ldquo;0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0&rdquo;</strong>
<ul>
<li><strong>含义</strong>: EIP-150 硬分叉激活区块的哈希值。这是一个额外的校验，确保客户端在正确的链上执行硬分叉。</li>
</ul>
</li>
<li><strong><code>eip155Block</code>: 2675000</strong>
<ul>
<li><strong>含义</strong>: EIP-155（Spurious Dragon Hardfork，虚假龙硬分叉）激活的区块号。引入了交易回放保护。</li>
</ul>
</li>
<li><strong><code>eip158Block</code>: 2675000</strong>
<ul>
<li><strong>含义</strong>: EIP-158（Spurious Dragon Hardfork，虚假龙硬分叉的一部分）激活的区块号。此硬分叉改变了空账户的状态清除规则。它通常与 EIP-155 在同一区块激活。</li>
</ul>
</li>
<li><strong><code>byzantiumBlock</code>: 4370000</strong>
<ul>
<li><strong>含义</strong>: Byzantium（拜占庭）硬分叉激活的区块号。引入了一些重要的协议改进，如改进的难度调整算法和预编译合约。</li>
</ul>
</li>
<li><strong><code>constantinopleBlock</code>: 7280000</strong>
<ul>
<li><strong>含义</strong>: Constantinople（君士坦丁堡）硬分叉激活的区块号。包含延迟难度炸弹、新的操作码等。</li>
</ul>
</li>
<li><strong><code>petersburgBlock</code>: 7280000</strong>
<ul>
<li><strong>含义</strong>: Petersburg（彼得堡）硬分叉激活的区块号。这是一个紧急更新，与君士坦丁堡硬分叉在同一区块激活，主要用于修复君士坦丁堡中发现的安全漏洞。</li>
</ul>
</li>
<li><strong><code>ethash</code>: {}</strong>
<ul>
<li><strong>含义</strong>: Ethash 工作量证明算法的特定配置。一个空对象表示使用默认的 Ethash 参数，这对于标准以太坊链是常见的。</li>
</ul>
</li>
</ul>
<h3 class="heading-element" id="alloc-对象初始账户分配"><span><code>alloc</code> 对象（初始账户分配）</span>
  <a href="#alloc-%e5%af%b9%e8%b1%a1%e5%88%9d%e5%a7%8b%e8%b4%a6%e6%88%b7%e5%88%86%e9%85%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这个对象定义了在链启动时，有哪些账户拥有多少初始资金。</p>
<ul>
<li><strong><code>&quot;000d836201318ec6899a67540690382780743280&quot;</code></strong>:
<ul>
<li><strong><code>balance</code>: &ldquo;0xad78ebc5ac6200000&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 一个以太坊地址 (<code>0x000d836...</code>)，在链启动时被分配了十六进制表示的 Wei 余额。</li>
<li>将 <code>0xad78ebc5ac6200000</code> 转换为十进制是 <code>500,000,000,000,000,000,000</code> Wei。由于 1 Ether = 10^18 Wei，这意味着这个地址拥有 <strong>500,000,000 (5亿) ETH</strong>。</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>&quot;001762430ea9c3a26e5749afdb70da5f78ddbb8c&quot;</code></strong>:
<ul>
<li><strong><code>balance</code>: &ldquo;0xad78ebc5ac6200000&rdquo;</strong>
<ul>
<li><strong>含义</strong>: 另一个以太坊地址 (<code>0x0017624...</code>)，同样被分配了 <strong>500,000,000 (5亿) ETH</strong> 的初始余额。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>总结</strong>: <code>alloc</code> 部分列出了在创始区块时预分配大量 Ether 的两个账户。这些账户在以太坊主网的创世区块中扮演了重要角色，代表了在初始众筹中分配的资金。</p>
<h1 class="heading-element" id="账户"><span>账户</span>
  <a href="#%e8%b4%a6%e6%88%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>比特币使用 “UTXO” 余额模型，以太坊使用“账户”余额模型。 以太坊丰富了账户内容，除余额外还能自定义存放任意多数据。 并利用账户数据的可维护性，构建智能合约账户。</p>
<p>以太坊账户分为外部账户（EOAs）和合约账户（contract account）</p>
<h2 class="heading-element" id="外部账户"><span>外部账户</span>
  <a href="#%e5%a4%96%e9%83%a8%e8%b4%a6%e6%88%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>EOAs-外部账户(external owned accouts)是通过私钥创建的账户。</p>
<p>特点：</p>
<ol>
<li>拥有以太余额。</li>
<li>能发送交易，包括转账和执行合约代码。</li>
<li>被私钥控制。</li>
<li>没有相关的可执行代码。</li>
</ol>
<h2 class="heading-element" id="合约账户"><span>合约账户</span>
  <a href="#%e5%90%88%e7%ba%a6%e8%b4%a6%e6%88%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>含有合约代码的账户。 被外部账户或者合约创建，合约在创建时被自动分配到一个账户地址， 用于存储合约代码以及合约部署或执行过程中产生的存储数据。 合约账户地址是通过SHA3哈希算法产生，而非私钥。</p>
<p>因为没有私钥，因此无人可以拿合约账户当做外部账户使用。 只能通过外部账户来驱动合约执行合约代码。</p>
<p>因为合约由其他账户创建，因此将创建者地址和该交易的随机数进行哈希后截取部分生成。</p>
<p>下面是代码实现：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// crypto/crypto.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// CreateAddress 根据给定的发送者地址（或父地址）和 nonce 创建一个以太坊地址。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">CreateAddress</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="w"> </span><span class="kt">uint64</span><span class="p">)</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 使用 RLP 编码将发送者地址 &#39;b&#39; 和 &#39;nonce&#39; 序列化为一个字节数组。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 这是标准的以太坊地址创建机制之一，通常用于计算合约地址：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 新地址 = Keccak256(RLP编码(发送者地址, nonce))[12:]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">EncodeToBytes</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 计算 RLP 编码数据 &#39;data&#39; 的 Keccak-256 哈希值。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Keccak-256 哈希会生成一个 32 字节的结果。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 以太坊地址是该 32 字节哈希的最后 20 字节。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 例如，如果哈希是 `0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA` (32字节)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 那么 `[12:]` 会截取出 `0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA` (最后 20 字节)。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nf">BytesToAddress</span><span class="p">(</span><span class="nf">Keccak256</span><span class="p">(</span><span class="nx">data</span><span class="p">)[</span><span class="mi">12</span><span class="p">:])</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>需要注意的是，在EIP1014中提出的另一种生成合约地址的算法。 其目的是为状态通道提供便利，通过确定内容输出稳定的合约地址。 在部署合约前就可以知道确切的合约地址。
下面是算法方法:<code>keccak256( 0xff ++ address ++ salt ++ keccak256(init_code))[12:]</code>。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// CreateAddress2 根据给定的发送者地址（或父地址）、初始合约代码哈希和一个盐值来创建以太坊地址。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 这个函数实现了 EIP-1014 中定义的 CREATE2 操作码的地址计算逻辑。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">CreateAddress2</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">,</span><span class="w"> </span><span class="nx">salt</span><span class="w"> </span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">inithash</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// CREATE2 地址的计算公式如下：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 新地址 = Keccak256(0xff + 发送者地址字节 + 盐值字节 + 初始合约代码哈希)[12:]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">    // - 0xff: 一个固定的单字节前缀，用于防止与 CREATE 操作码的地址计算冲突，并明确标识这是一个 CREATE2 地址。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// - b.Bytes(): 发送者的 20 字节地址。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// - salt[:]: 一个 32 字节的盐值，用于确保地址的唯一性和可预测性。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   通过更改盐值，即使初始代码相同，也可以多次部署到不同的地址。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// - inithash: 初始合约代码的 Keccak-256 哈希值。它通常是部署前合约字节码的哈希。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">    // Keccak256 函数会将所有传入的字节数组连接起来，然后计算它们的 Keccak-256 哈希。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 最终的以太坊地址是这个 32 字节哈希的最后 20 字节（通过 [12:] 切片获取）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nf">BytesToAddress</span><span class="p">(</span><span class="nf">Keccak256</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="mh">0xff</span><span class="p">},</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nf">Bytes</span><span class="p">(),</span><span class="w"> </span><span class="nx">salt</span><span class="p">[:],</span><span class="w"> </span><span class="nx">inithash</span><span class="p">)[</span><span class="mi">12</span><span class="p">:])</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>合约账户特点：</p>
<ul>
<li>拥有以太余额。</li>
<li>有相关的可执行代码（合约代码）。</li>
<li>合约代码能够被交易或者其他合约消息调用。</li>
<li>合约代码被执行时可再调用其他合约代码。</li>
<li>合约代码被执行时可执行复杂运算，可永久地改变合约内部的数据存储。</li>
</ul>
<h2 class="heading-element" id="账户数据结构"><span>账户数据结构</span>
  <a href="#%e8%b4%a6%e6%88%b7%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>以太坊数据以账户为单位组织，账户数据的变更引起账户状态变化。 从而引起以太坊状态变化（关于以太坊状态，后续另写文章介绍）。</p>
<p>在程序逻辑上两类账户的数据结构一致：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/state/state_object.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// StateAccount 是以太坊共识层中账户的表示。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 这些对象存储在主账户 Merkle Patricia Tries (MPT) 中。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">StateAccount</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Nonce</span><span class="w">    </span><span class="kt">uint64</span><span class="w"> </span><span class="c1">// 账户的交易计数（对于外部账户）或已创建合约的计数（对于合约账户）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Balance</span><span class="w">  </span><span class="o">*</span><span class="nx">uint256</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// 账户中持有的 Wei 数量。使用 uint256.Int 表示大整数。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Root</span><span class="w">     </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="w"> </span><span class="c1">// 存储 Merkle Patricia Trie 的根哈希。这个 Trie 存储了合约账户的所有存储变量和数据。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">CodeHash</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="c1">// 合约账户的字节码的 Keccak-256 哈希。对于外部账户，此字段为空（Keccak256(nil)）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><p>由于外部账户无内部存储数据和合约代码，因此外部账户数据中 <code>StateRootHash</code> 和 <code>CodeHash</code> 是一个空默认值。一旦属于空默认值，则不会存储对应物理数据库中。 在程序逻辑上，存在code则为合约账户。 即 CodeHash 为空值时，账户是一个外部账户，否则是合约账户。</p>
<div class="diagram-container">
  <pre class="mermaid">graph TD
    subgraph LevelDB
        direction LR
        subgraph Account
            A[Account] --- Nonce(Nonce)
            A --- Balance(Balance)
            A --- CodeHash(CodeHash)
            A --- StateRootHash(StateRootHash)

            style Account fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
            style Nonce fill:#fff,stroke:#333,stroke-width:1px
            style Balance fill:#fff,stroke:#333,stroke-width:1px
            style CodeHash fill:#fff,stroke:#333,stroke-width:1px
            style StateRootHash fill:#fff,stroke:#333,stroke-width:1px
        end

        Code[["`</> Code`"]]
        style Code fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px

        subgraph State_Tree["State Tree"]
            S1(( )) --> S2(( ))
            S1(( )) --> S3(( ))
            S2(( )) --> S4(( ))
            S3(( )) --> S5(( ))
            S3(( )) --> S6(( ))
            S6(( )) --> S7(( ))
            S6(( )) --> S8(( ))

            style S1 fill:#333,stroke:#333,stroke-width:1px
            style S2 fill:#333,stroke:#333,stroke-width:1px
            style S3 fill:#333,stroke:#333,stroke-width:1px
            style S4 fill:#333,stroke:#333,stroke-width:1px
            style S5 fill:#333,stroke:#333,stroke-width:1px
            style S6 fill:#333,stroke:#333,stroke-width:1px
            style S7 fill:#333,stroke:#333,stroke-width:1px
            style S8 fill:#333,stroke:#333,stroke-width:1px
            style State_Tree fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
        end

        CodeHash ---> Code
        StateRootHash ---> S1

        linkStyle 9 stroke-width:2px,fill:none,stroke:black;
        linkStyle 10 stroke-width:2px,fill:none,stroke:black;
    end
    style LevelDB fill:#eef,stroke:#333,stroke-width:2px,ry:30px,rx:30px,border-radius:50%/10% leveledb-shape;</pre>
  <pre class="mermaid-dark">graph TD
    subgraph LevelDB
        direction LR
        subgraph Account
            A[Account] --- Nonce(Nonce)
            A --- Balance(Balance)
            A --- CodeHash(CodeHash)
            A --- StateRootHash(StateRootHash)

            style Account fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
            style Nonce fill:#fff,stroke:#333,stroke-width:1px
            style Balance fill:#fff,stroke:#333,stroke-width:1px
            style CodeHash fill:#fff,stroke:#333,stroke-width:1px
            style StateRootHash fill:#fff,stroke:#333,stroke-width:1px
        end

        Code[["`</> Code`"]]
        style Code fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px

        subgraph State_Tree["State Tree"]
            S1(( )) --> S2(( ))
            S1(( )) --> S3(( ))
            S2(( )) --> S4(( ))
            S3(( )) --> S5(( ))
            S3(( )) --> S6(( ))
            S6(( )) --> S7(( ))
            S6(( )) --> S8(( ))

            style S1 fill:#333,stroke:#333,stroke-width:1px
            style S2 fill:#333,stroke:#333,stroke-width:1px
            style S3 fill:#333,stroke:#333,stroke-width:1px
            style S4 fill:#333,stroke:#333,stroke-width:1px
            style S5 fill:#333,stroke:#333,stroke-width:1px
            style S6 fill:#333,stroke:#333,stroke-width:1px
            style S7 fill:#333,stroke:#333,stroke-width:1px
            style S8 fill:#333,stroke:#333,stroke-width:1px
            style State_Tree fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
        end

        CodeHash ---> Code
        StateRootHash ---> S1

        linkStyle 9 stroke-width:2px,fill:none,stroke:black;
        linkStyle 10 stroke-width:2px,fill:none,stroke:black;
    end
    style LevelDB fill:#eef,stroke:#333,stroke-width:2px,ry:30px,rx:30px,border-radius:50%/10% leveledb-shape;</pre>
  <pre class="mermaid-neutral">graph TD
    subgraph LevelDB
        direction LR
        subgraph Account
            A[Account] --- Nonce(Nonce)
            A --- Balance(Balance)
            A --- CodeHash(CodeHash)
            A --- StateRootHash(StateRootHash)

            style Account fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
            style Nonce fill:#fff,stroke:#333,stroke-width:1px
            style Balance fill:#fff,stroke:#333,stroke-width:1px
            style CodeHash fill:#fff,stroke:#333,stroke-width:1px
            style StateRootHash fill:#fff,stroke:#333,stroke-width:1px
        end

        Code[["`</> Code`"]]
        style Code fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px

        subgraph State_Tree["State Tree"]
            S1(( )) --> S2(( ))
            S1(( )) --> S3(( ))
            S2(( )) --> S4(( ))
            S3(( )) --> S5(( ))
            S3(( )) --> S6(( ))
            S6(( )) --> S7(( ))
            S6(( )) --> S8(( ))

            style S1 fill:#333,stroke:#333,stroke-width:1px
            style S2 fill:#333,stroke:#333,stroke-width:1px
            style S3 fill:#333,stroke:#333,stroke-width:1px
            style S4 fill:#333,stroke:#333,stroke-width:1px
            style S5 fill:#333,stroke:#333,stroke-width:1px
            style S6 fill:#333,stroke:#333,stroke-width:1px
            style S7 fill:#333,stroke:#333,stroke-width:1px
            style S8 fill:#333,stroke:#333,stroke-width:1px
            style State_Tree fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
        end

        CodeHash ---> Code
        StateRootHash ---> S1

        linkStyle 9 stroke-width:2px,fill:none,stroke:black;
        linkStyle 10 stroke-width:2px,fill:none,stroke:black;
    end
    style LevelDB fill:#eef,stroke:#333,stroke-width:2px,ry:30px,rx:30px,border-radius:50%/10% leveledb-shape;</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone fa-width-auto" aria-hidden="true"></i></div>
<template><pre>graph TD
    subgraph LevelDB
        direction LR
        subgraph Account
            A[Account] --- Nonce(Nonce)
            A --- Balance(Balance)
            A --- CodeHash(CodeHash)
            A --- StateRootHash(StateRootHash)

            style Account fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
            style Nonce fill:#fff,stroke:#333,stroke-width:1px
            style Balance fill:#fff,stroke:#333,stroke-width:1px
            style CodeHash fill:#fff,stroke:#333,stroke-width:1px
            style StateRootHash fill:#fff,stroke:#333,stroke-width:1px
        end

        Code[["`</> Code`"]]
        style Code fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px

        subgraph State_Tree["State Tree"]
            S1(( )) --> S2(( ))
            S1(( )) --> S3(( ))
            S2(( )) --> S4(( ))
            S3(( )) --> S5(( ))
            S3(( )) --> S6(( ))
            S6(( )) --> S7(( ))
            S6(( )) --> S8(( ))

            style S1 fill:#333,stroke:#333,stroke-width:1px
            style S2 fill:#333,stroke:#333,stroke-width:1px
            style S3 fill:#333,stroke:#333,stroke-width:1px
            style S4 fill:#333,stroke:#333,stroke-width:1px
            style S5 fill:#333,stroke:#333,stroke-width:1px
            style S6 fill:#333,stroke:#333,stroke-width:1px
            style S7 fill:#333,stroke:#333,stroke-width:1px
            style S8 fill:#333,stroke:#333,stroke-width:1px
            style State_Tree fill:#fff,stroke:#333,stroke-width:2px,rx:5px,ry:5px
        end

        CodeHash ---> Code
        StateRootHash ---> S1

        linkStyle 9 stroke-width:2px,fill:none,stroke:black;
        linkStyle 10 stroke-width:2px,fill:none,stroke:black;
    end
    style LevelDB fill:#eef,stroke:#333,stroke-width:2px,ry:30px,rx:30px,border-radius:50%/10% leveledb-shape;</pre></template>
</div><p>上图是以太坊账户数据存储结构，账户内部实际只存储关键数据，而合约代码以及合约自身数据则通过对应的哈希值关联。 因为每个账户对象，将作为一个以太坊账户树的一个叶子数据存储， 不能太大。</p>
<ol>
<li>
<p><strong>LevelDB</strong>:</p>
<ul>
<li>最外层最大的容器代表 <code>LevelDB</code>，这是一个高性能的键值存储数据库，常被以太坊客户端（如 Geth、OpenEthereum）用作底层数据存储。所有以太坊的状态数据、交易数据、区块数据等最终都会以键值对的形式存储在 LevelDB 中。</li>
</ul>
</li>
<li>
<p><strong>Account (账户)</strong>:</p>
<ul>
<li><code>Account</code> 是以太坊中的核心概念，分为两类：外部账户（Externally Owned Account, EOA）和合约账户（Contract Account）。图中展示的是一个通用的账户结构，其中包含了四个主要字段：
<ul>
<li><strong>Nonce</strong>: 一个非负整数。
<ul>
<li>对于 EOA，它表示该账户已发送的交易数量。</li>
<li>对于合约账户，它表示该合约创建的新合约数量。</li>
<li>Nonce 主要用于防止交易重放攻击，并确保交易的有序执行。</li>
</ul>
</li>
<li><strong>Balance</strong>: 该账户持有的以太币（ETH）数量，以 Wei（ETH 的最小单位）计。</li>
<li><strong>CodeHash</strong>: 这是账户代码的 <code>Keccak-256</code> 哈希值。
<ul>
<li>如果是一个 EOA，<code>CodeHash</code> 通常是空字符串的哈希（或一个特定全零哈希）。</li>
<li>如果是一个合约账户，<code>CodeHash</code> 指向实际的智能合约字节码（<code>Code</code>）。箭头从 <code>CodeHash</code> 指向 <code>Code</code>，表示 <code>CodeHash</code> 是 <code>Code</code> 的一个引用或标识。</li>
</ul>
</li>
<li><strong>StateRootHash</strong>: 这是账户的存储状态（Storage State）的根哈希。
<ul>
<li>它是一个 Merkle Patricia Trie（更准确地说是 Merkle-Patricia-Trie 的根哈希）的根哈希值。这个 Trie 存储了合约的所有存储变量。</li>
<li>如果是一个 EOA，<code>StateRootHash</code> 将是一个空 Trie 的哈希。</li>
<li>如果是一个合约账户，<code>StateRootHash</code> 指向该合约的私有存储空间，也就是图中的 <code>State Tree</code>。箭头从 <code>StateRootHash</code> 指向 <code>State Tree</code> 的根节点，表示 <code>StateRootHash</code> 是 <code>State Tree</code> 的引用。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Code (代码)</strong>:</p>
<ul>
<li>图中的 <code>Code</code> 块代表智能合约的实际字节码。当一个合约被部署时，其字节码会被存储到 LevelDB 中，并通过 <code>CodeHash</code> 引用。</li>
</ul>
</li>
<li>
<p><strong>State Tree (状态树)</strong>:</p>
<ul>
<li>图中的树形结构代表一个 Merkle Patricia Trie，我们称之为<strong>存储状态树</strong>。这个树用于存储智能合约的所有状态变量（即键值对数据）。</li>
<li><code>StateRootHash</code> 是这棵树的根哈希。这棵树的每个节点（分支节点、叶子节点）都存储在 LevelDB 中，并通过其哈希值引用。通过验证 <code>StateRootHash</code>，可以高效地验证合约的某个特定存储变量是否存在以及它的值是什么（Merkle Proof）。</li>
</ul>
</li>
</ol>
<p>账户 Nonce 起始值是 0，后续每触发一次账户执行则 Nonce 值计加一次。这样的附加好处是，一般可将 Nonce 当做账户的交易次数计数器使用，特别是对于合约账户可以准确的记录合约被调用次数。</p>
<p>代码在这里：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/state_transition.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nx">st</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">SetNonce</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">From</span><span class="p">,</span><span class="w"> </span><span class="nx">st</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">GetNonce</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">From</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">tracing</span><span class="p">.</span><span class="nx">NonceChangeEoACall</span><span class="p">)</span></span></span></code></pre></div></div><p><code>Balance</code>则记录该账户所拥有的 ETH 数量，称为账户余额，这里的余额的单位是 Wei 。</p>
<p>转账操作：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/evm.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 执行余额增减的底层、原子性操作。它不关心转账是否合法，只负责在给定vm.StateDB（表示区块链状态数据库）上，将指定amount从sender的账户中减去，并加到recipient的账户中。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// vm.StateDB: 这是EVM管理账户状态（包括余额、nonce、存储等）的核心接口或结构</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">Transfer</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">StateDB</span><span class="p">,</span><span class="w"> </span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">recipient</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nf">SubBalance</span><span class="p">(</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nf">AddBalance</span><span class="p">(</span><span class="nx">recipient</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><p>实际执行转账之前的检查，验证调用者是否有足够的余额进行转账：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/vm/evm.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// evm.Context: EVM的执行上下文，包含了当前的区块链状态、配置、调用信息等。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 如果余额不足，EVM会立即停止执行当前操作，返回ErrInsufficientBalance错误</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">evm</span><span class="p">.</span><span class="nx">Context</span><span class="p">.</span><span class="nf">CanTransfer</span><span class="p">(</span><span class="nx">evm</span><span class="p">.</span><span class="nx">StateDB</span><span class="p">,</span><span class="w"> </span><span class="nx">caller</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">{},</span><span class="w"> </span><span class="nx">gas</span><span class="p">,</span><span class="w"> </span><span class="nx">ErrInsufficientBalance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><p>实际转账操作的代码：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/vm/evm.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nx">evm</span><span class="p">.</span><span class="nx">Context</span><span class="p">.</span><span class="nf">Transfer</span><span class="p">(</span><span class="nx">evm</span><span class="p">.</span><span class="nx">StateDB</span><span class="p">,</span><span class="w"> </span><span class="nx">caller</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span></span></span></code></pre></div></div><h1 class="heading-element" id="交易transaction"><span>交易(Transaction)</span>
  <a href="#%e4%ba%a4%e6%98%93transaction" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>交易(Transaction)是指由一个外部账户转移一定资产给某个账户， 或者发出一个消息指令到某个智能合约。</p>
<p>在以太坊网络中，交易执行属于一个事务。具有原子性、一致性、隔离性、持久性特点。</p>
<ul>
<li>原子性： 是不可分割的最小执行单位，要么做，要么不做。</li>
<li>一致性： 同一笔交易执行，必然是将以太坊账本从一个一致性状态变到另一个一致性状态。</li>
<li>隔离性： 交易执行途中不会受其他交易干扰。</li>
<li>持久性： 一旦交易提交，则对以太坊账本的改变是永久性的。后续的操作不会对其有任何影响。</li>
</ul>
<p>因为是事务型，因此我们需确保在执行事务前让交易符合一些设计要求。</p>
<ul>
<li>交易必须唯一，能区分不同交易且同一笔交易不能重复提交到账本中。</li>
<li>交易内容不得变化，每个节点收到的交易都必须一致，交易执行时账本状态变化也是一致的。</li>
<li>交易必须被合法签名，只有已正确签名的交易才能被执行。</li>
<li>交易不能占用过多系统资源，影响其他交易执行。</li>
</ul>
<h2 class="heading-element" id="交易数据结构"><span>交易数据结构</span>
  <a href="#%e4%ba%a4%e6%98%93%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>下图是以太坊交易的数据结构，根据用途主要划分为4个部分</p>
<pre tabindex="0"><code>&lt;svg version=&#34;1.1&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34; viewBox=&#34;0 0 685.1875 134&#34; width=&#34;685.1875&#34; height=&#34;134&#34;&gt;&lt;!-- svg-source:excalidraw --&gt;&lt;metadata&gt;&lt;/metadata&gt;&lt;defs&gt;&lt;style class=&#34;style-fonts&#34;&gt;
      @font-face { font-family: Xiaolai; src: url(data:font/woff2;base64,d09GMgABAAAAAAVcABEAAAAADiwAAAUDAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbHhweBmAANAgKCY4uERAKhTiEQQsGAAE2AiQDCAQgBYJeByAMFBuCDFEEGwcQ0jxP9uMgJzs14TRO0ITicbrYzikLoc7HKWK3tpPx8LRGe39mTjSJahZDxEPkGqFQL1RK3U4oRJpqot5erW0fz1TdH6qZRxEN9RKl0o52ZCuBlGH497SXzUmt1K8HKCOznIh0krId4HYH4Xv+/6+1iXPnr7ZdpIuXxufMw0qllBV7mFsTCwVSJFlTC8UjXgmJGpllbrRRMbDi9/hMJtAOiNokRDSthhZyh2dyNZApvwPaWQRwfM5v4qqBJCGeZ1GVrZCNSNEohw8Zmk25dC/ZhNDxkw7J63oNkgu4PhPFq3cOUkM6xdiaXsY54i6aG5lTZAxFjbbj13WNS0+2ITYjryt4kxVLF5n2a/fuESf3WdQvK4fDD+3y0yd6JpYQ45MYjWfLTFpiYoHXM3kJEzRPJyotbRvJGDnfJ2MJHHf6tExn7t5bDch9I1I3702QunWPp7tthTdj0G579ExZQ5Rx5D4mcDpbTN2M/xKP1bCURZpnSq1yi9btJ5TNUwlKieM6n+az4XHNZwklTlGDuoHHKd1Z/Z4VsvPCs9jDxvK8VuAo4WZ1FE03igw4nkDTStpAOVt2I4Cbp5Z2g8mjXU0+3cj+8P6W/QZcSYoMuL4TpcQpYlA38B4YpFDkQ2A7TjH6ulkDL7OXhIElsPRnK2QOnauDB77GswrUqRJIbf//As8tCwkiSQyJEKe/VCHL6HIdCig1hVFVSFYTNJIWOqFNf1wh6+kGHUaYNKNRzUi2EKwShE3A9IcsKuQl+rKOFaxqK0ZdQynXHxFA1izpw9W1DBIoaME/YhigC/f/aguPy+EaF3L57AWdSJ5Dm4WZcsD+/GZZOpYpKXysUepVDY/UIpJEzRUtMSMRRZhd3TklE2lykA4klnpm7yAqAPuHMvfGZQAyA+25bXsYXb0OdrEulEaKH9ad6Sg97ICy1zFkchZnwcaNiC0howE3u4i0zZGHZcRUAFH+Q5W0CjPllW3dnQGiLfZk+n5ZOWp+9ChGJvkLjY81D6emr82UNJ62JlNRdB2PbPPDoenrpIo0RYCjBsju0TGNgP0tyRJGBlsknqT8hrPyd3UnN+LYoc73GsmK3J529RjHY9wbTkBGWo0c3vVemMrYfzPvxEGXCIO7/yhReHdq32henBvMk9UOny8NFfn5uZcRBk/rUw1HbNvh5d7646U8zSn9sfesadEgPzw002NcgXRBLn+PeYD5nX6B7xy/ECff3d8e/YzDqlFE89kdbL5VVIVOU5Ms3ljxK27MLES6Ba5hZLCO7z3X3FavKK5xfTuKJXtPX78jFw+fre1jpLCBj5JTtbV2vsfheA1PHmC1K6anXpPBbAX1dOKheia09zUzmkf2pDkHyvkxn9qvnUM8YCHfiZLM1n+SL+ZuiqkhvnmM04/1HwwNI0Aq87182KyCSwXLrs3jTvwvw1w/wduyH0YA+DTAlNr/robK5Zc3QLM0w/cdLCr/Advpt82C7yW98neLojelX2apiLwNw+8f1+QBoSgtWPCt4kOXT3zSqYrPVpCVBY5v8IKcG+3XA/dMdKzMdUxURTUMbO1MrCwhKwMzM6+YgZ6BhS7uRjY6UWthilw4N6HevRe1xdwpsKpF5hXyTVGthaPDmG3PRq9rYn+KXNQ25tG4gmtHDorrbue5teiVtUvyiZGx/crbSfdFOS1JTUJ+dvWaSVNlbjHCCLrQWmIRAA==); }
      @font-face { font-family: Xiaolai; src: url(data:font/woff2;base64,d09GMgABAAAAAAfAABEAAAAAEbgAAAdmAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbHhweBmAAVAgKCY4uERAKjBSJSQsOAAE2AiQDEAQgBYJeByAMFBsyD1HUrDlKTvbzwHaHfK/rjxulLMvSjsbB+PG2n8fT3m+SwlOaDk4HqZOL4dDhYLU7TTwA3QEsTgDjgPU25nC1NqQUZnR3PqIWXW/jIyahXGq0jdcLMOhuRBC/q66mLZJN6AocsnSJcNxPboLxGLPJ181RaxPqlcS1qkqpQiHxjrcOodFIt7+KKqnZigwLcQABAB9AMOwCApARBsAF+9FInpajADbgfwckcGbS0xnDrqAlQEwFjBw0PA7VQyhid2IgJmDIAUjEhh1zStLVkJi3ash8bPj/HTCOCEs0OOq6bwZgEIx/AOAMBABPGB9hDRigYBwSiU9rMwDPW6UQ9LXqzxoyfzcTSj/b3nPj15YPTX9rpwACp5gAa/G8egDfbD3wC0q2I7SoVI/+z9GD3KEb+ID17uWXr4J8nZ1TB8i3IY3YkeGrBzQZVFy46eg5xuhcS2gE0llmjqRzDmb6iHE61s0zjWWpDxi+z4HhP3IiWe1BY6KkRwGZQ8ERRC4HFqOVhS7Q94Vz0ZWBMVlDNAVPz1g5MUNWRMjykYbwGzJWJNLT2C71uOQ9t+wXeAaLkCxmoLakC8UktaV0DamXlFbpRqZbhUD0ScxSMDgfo7N21vRGc+V0Da08RijvRFakjEeBXLktsplSAJKpbtey8BGMBqNo7a3E7fi9igBCOfCLvBIZsDT9d8F1szFHwqSQKan2ucRd8JcqKqjlylMbxrYcHdPDoPTajxL3xD+rWGCVF0/dGLtzHMwJl3Jqf0vcD/+rwlH9IUD299RAljCoCgCw920DBej//9xwAplAfAolAdDPYsZcoDQ8Jgb2gASwvcViaTyeieMOwSKRpUyM41ZiC8sJpEllMMgbyUZkZzbnm1R0riaejfGq12FzggfdAJsMCqOyAaj6kVxZI9rakNHEE1cx+NYP22eKb0QzQHufKSu122vmrXDsshtalkur6Kb13d8YKrSdZeuuFBi4Wq3JbE4wyVYo10Wtp0uFapVhVoxRa99QsRqmWxucjlSFDupLmuF1Hqir1Pwh5J74Dcz0UrIU9dO4jucu7jBDzL9uDkkzc1aJLruGDvI9nWVdHi9e8+FJgBvNXE3gQno1GBSGwE0Dq9QaVZVb5RBt9KW5zlHG3YPsPB7qUhuAWsXVkqrSZg1X1orKt5mifk8oZir2YIU8VdepixQ8WhOyAyNtoOpB1av3oK3mgEuJv42qr+LKtpgcQ+jNRhdz4MUideTxdGENMB2vJido4w9fSasrlRMMbV1RZjtjLU9ZNv3wUvVquGFoH0qexVjrYL0htn6YWgNVSAMqco8p/Imydxun66zmyo6pmiRCUIfRIbXqNonuSle0y5VDT5miL96Bo3CuEHH+ttXK+VUzKnvE5H86U0OuTKZGlq8tyZeHdubfb51oenn6NePrUqWdJnMhVZyQlJY+p/+SjIlU7dnWfizbDsn7mOq8C5R3DVW1+uq6RtFvlWLvHUv26huUPHlAmZZaccMoitpiQcx+UUlcDy2Re3vti0tI40XVUDOjenMVLHhgL33Jc/5u1TFmigs7Swf9D7QtSkp3TQy+3SGpO2NBLm64HJxaOtg9+yuq2hXq1SaJUYSPGEIeKUSf7Nk+rsXl43Kr385EAnshloA78xlhiMoWIuyZK9yq1OjElc516yystOGTRbMmoPBj1SNvWREZOsm3xHnO6vgZ38KZnm2Ud0j5jr6hycc6nTzbJHXDXBLat4t/W1P2Y3dkZNZwzDIWz7KnwzjuxWOjrdwwuftsaVmx/+3YI3yW/ALGzjFjUQ9ZcE1JptfTtd0WoiTO0iNy79qoYGykQytV+9pNcLUPxrvb+ZVgehkd0b4TgYN3XbD1bJO4KktX25cWIrlP3S8bDTY51W9QmwWaoPFso+oOuGjKh3dI6vSSyQnFmKxu/Y6Vcm+1a/Hs29Kodso7t+XFzeuIGeUdXnCn9qYkqn947oja7o3BH/UdVK2f1ze//Ev8617aHIHQZcVeTW1k3TornMDzLdjMxTNf2HiuCiXqwW5UZC9gyqx8pAcsCOdm9MSTMwNyX1+jh3u2kSfzYidFRNXYnJxU7L38/EIDkSdFKdKFOXaM9MfZw+epOZPbyKW3bLaNy2eVb7LEZ53bM5zpRQmLHHVnLIjIRmn6nBndrnymV7tYkmab2k16bbLAJak7/nWjXrxeNju1YmK21n7b1nLLLTUUlwa/N6+L2XsxfaZ29RbFfmXzsBcAADdWvnMHAHjsQ9f+f/L3wv9gIwCADYwRtt+WdPxrj//vjRtA4Bjc+oC9gP5QDdOAhiG9EUzGa/CwoWbwS07nMBaUAQYI5wCAN9zKoxBYw6koBghBH4WBP2jn4/1RBIwHS2IaXwcQKMzptlZ0c21pPWMHR3NbGyDEKyAgJWNsaGxtQA0gzC0VBfl9JJHDG07SDkR6KraICMyQ4veLgqI1gnhlYR4Dc6ddCJCXl5SpRUVTZ3DpwziUw7Z27jSHCmZONP+z03VBhZDXZ+Yk9d/xK1eO+tBBAioTuAAAAA==); }
      @font-face { font-family: Xiaolai; src: url(data:font/woff2;base64,d09GMgABAAAAAAWkABEAAAAADpwAAAVKAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbHhweBmAAPAgKCY4uERAKhhyFBQsIAAE2AiQDCgQgBYJeByAMFBvQDFGUJ85Sso/EdIO9TAaS4lz4nQ+Pm/Z+hLJARUkb1iZ1qMmZpVQFUnHZ6OaZuLHT9NQNBNntBAeKMJCLl6VRiSaQ//9zGpnbsqysI1IVrr8nr2RsjelP8Q2QJLAwKMym5BywArL1UT1TetIvD9sCjEyGcfk3DgSAEZimQCzd+ns4mJkR2VZQAT0YAHC7Adi4hqZfJJvBAlSyDJBB8mlID/0miuhAkxjI08Oggsq248a1ZGk/PegeBHoQmxsZcuiDNwCKpf4HiFgAFAAaQAAaBD0MYqGbIKDE+ntUafte7twOgniKRYDxKz8Q3zUYSxyXCdmoaMS9UoOcCzCCbqhP0EDiRTGrS3aRxgQNVLwGYpUSNNDxos1FR9nKHBGKqIpqbqsq2sTOplYXE0Vy9kdtqpIkulBeXaILFSW5blSE6FCbolydoIE5w8rsUBXRJnaLrd1S5/92jLHx+fRaOrrEUepwOWXBdaOsCJIkZrkeLHFk67IgKQqjV/eWspqe6+LfFx79OqvepT+By02pTymqOuiLkHCXqgpqhBJcqhEY9hsHNShvpaOyNOIsmV9wRkgC9UVI9lOKIClygoZF8fnljiwZ3JLC3N8tDr1dLyQDjFZD7j0VshfdW4MPfC0+Tj/1RgGZnP8Lv1v0JwQIgQiyBubepJB5erCGEAiWELOaQVxMCBXCIFrDci8p5HB6hIZIRFkizRoNYgwhVrDAarXk3vpxCjmenqAhEUmWRLMmQ3rKPAA6vJ8Cj7jdaAAooLvDGyAUQGyIu5ngLg/oBS+jyTMiisE3Zk3130mEmJZ54dwbcbsMUTtw/tUbK91rnPz2/p1BB18PFRb6XpMGqn3sbNUh07Wnkpv5fW+0zG5ZF/hRJQw7t3Jq84dNQdxBUvUN/GvmovceDanYH7+di95J3rAz9SO7zBtlvVnJ55b1DTIfwe1WlUHA9EbSLoObN8iZPtureLAnvEJSWkhjZXZ9VUtoY409nGsiVVLn0ICKqp1BIfOmmMpsMi/sM1Tayetq5k4i7DI0kUb1aNUhQ98dwTvgrAh0co14zbAu494jzbDf4AOK/YL2CMhovP4yJVu3We6lzI1vZc/zb/GWfaba5OpP79HNrPNlV/zt2f3TwodhcuvyBd6SZD+29S016Kcz15kbZKvlf7Ft21P7XlN9oSEyafP7Pp7fRC1piGYYSSvf9DXOHbCsPyB8+Kts3WpJJlep/LKDun91Vz06dOVB8mr5Gd5ygE9pW2zXmH05B7L3v6VnYveZtl2Ukj2Lti70srqrHuTZ1atCn91qzSV/Lri9+h3TVRmcz1q3ZS+/9bkgwhadXMDYbFhN+vqO1FLBro8MOyipj6ht00d/ujl5kpjmSjIyVoGN6a6mkqn9ls/n46O3tpkO5BVh8NwREijUoyKSHifFxgOmbQu+wWySNx3+PDtkTa9nl4UznhJbboyIYamkTVRpdPw+0zaOB5tyLxECI5A2kCeYfesjPEFfos2WmMBvnmjwvvY3vYH+ErxvHvs+8mV8Ehe11f2p28L8Sw8B0OtVqj4t+5jfNlz/f3sBgbhKyaC/hE2nn6a+QUw3WGqqjQJSPVCNBmEWTVu93YUJAjwepuAFLUwjkXqc2Q6zmOTHOt84wKFLkwG9mnQpd4sqbYaN6DKgnyhNohQpriFr06JNn2ZcF6WLNydTJWdl7LTx10fdYhi5qcHApCjlhO7kbDJV5oTF6mrpEjTrMvoWnaJ1vqstLsPJDmPMM4dl0vIPGDQV36VDp9HjZ970VlEBh2x2NOJS7kHJ5jTEtgyhCAA3gDgAAA==); }
      @font-face { font-family: Xiaolai; src: url(data:font/woff2;base64,d09GMgABAAAAAAWcABEAAAAADoQAAAVEAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbHhweBmAAPAgKCY4uERAKhgSEaQsIAAE2AiQDCgQgBYJeByAMFBu0DMiOw3Q7K4sLSZlv+fDfaX9ubjIRC89EFRfptk6pJFM5XcjTdRZCnqdP1h8cHj5vbzzg8WCE03X3oe6GXp4kEFidp1m1lievnyAgIxGFy37d1MX4GDMb3rsAoSMSBoVJlIwiUHHRp0KkdKTPPaZD1EU1q/iXDwSABhiWgKjV6t+jQqxYxF1Z3w4FpAAQCgEwspTS18k+yFZhVUfzgvRsEXlJAUgIA0o8oJICjtRHlRclc/7IMbogtADoAuybUnLms/dAIpP8D4Dd0obYTgFYUJA0VYokMAMEksXV16jFleeB434QeEMyWOSvvIG0LkLT7LuLkD28SEJbRbjLFDSgfb3pIkgay1b43UHSny5CkiaCpHDpImgaWxmkjspWn41nBVaoGRbYSnZ8YDgodaDsfNCIwGeyQbSFnw2iPbhgCR/jbhnh+fx0EdItvFImMnazE4u9E1Ko/yY8liytjg1SZ7OvxRfc4I4Jlrj5GI5jK4KPN/uCj7tjOJ5PF8FcUqbDa/2R14W8nUkRTYoNVJsixRAvCLU2G8fWCEKMYOPtI0UC6S/pFDF7OXVUiGRDc/fEBhsXg5ywehMfw/HudBHKtLo2X4W7FuZ4S/W5iRV+haCGxqs2X6uRdXS9AQOMHkPQpJcISLThf+G9RTPBIoQh3BtmfoRGjqRHGYhGjCfarbEgxhHihQSw3gTzOY1spdsM2OHw2N3qBDGRkCQkI8WbbH6qRk6jpxvIQKYnw61ZUDF7HAB1LpcgEgmFUACIwSidov89RHKhxaQoqwATadRrw6UOTbcadVr9XMHzrud2fMwRtePYE+90vKOe9DoOIfKdp3IeJnfey+w75xBOfmkHhw6Hvzul/VbcWOjw1laZztaZHme/cPxDz5kZHW03qPdJWi5FvX/SY9NwQwn9cZ4h0j8glh7f2Pn42yUHtxx/7z1ve3JHzAOTMzxn1I5j6MiXwqxJleedhnTs8qspPJ40pHJG06fb7ycxz5HtzutNwPeotblLJdglo42dk+QqsndB2CuuQ9jQyOe97DlMNlodW0wOqpx3XzD0RJzl3bfzTO5jnN4wDv7ctKoraXdx7aJFqw58EOH6VT3S3cVWRM00rzC7TkUEah8uZJJPRcyJ6tf9EN54vv+jB49f+4f/YoprrAxcjUzKE1+JuvjBVi3jcrbdDvwQ4bKVqEoDU4HX2U0w/TqtrF779SJS6ueWbQx/mWzKV877vFB8k46ytnnxgzRSOThBZs4hiNmY5O9n0Y03XZtSP4hMPhnprGs4llTfLZt5IvKAvrmcec2d4vrXQS7PJx+cigi8YG4mRdWL868kRryadkj2VODah3Im+Vnj1aDJnRL4f4u6VEkeCvwV7vo+ju7fWpp8IiLwsjXrrbhNU/fffHHk1UciAg8a9z195ZZZtuV92a23aoonjQyMRXQVfdZ78/u/FTOuUOn+QmSyJCMw9QWpjd8Jf22fXH/cxDiHpvDPvIvGJj96Qd3Xpy/4TaGm30Pa+xd+td+Nr1IdB0Jfh5Kl/9KFABSidkHt/7FN+ttI6P+fD4HAq8XCoN9j5Uinkp9Qm0HSc3wSoLwcnSiIVDmc4sMym8Di2WwJdBCzKTIIO6Xj2TKsYFKM9XqAj9+A+eYY4NemnMeIRRbzm28eVq4M2bLN4jZiyIi5Btl5rDxpWDmyQrbsSvr8EuUWMTWQY/4gK3uD5qxwMMf0lmLT4+VJN8hvySVsVj1Yvqpa2eCYpcT9Fy1jNX2+BVbm9xszbsnOaxc9l1XPp4oXhVdVaIEsY6KkFiIeFqg6kAo=); }
      @font-face { font-family: Xiaolai; src: url(data:font/woff2;base64,d09GMgABAAAAAAWkABEAAAAADnQAAAVMAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbHhweBmAARAgKCY4uERAKhWiEYgsKAAE2AiQDDAQgBYJeByAMFBu3DMiOk6UGkuLP5x83/fvyAl6nGtqGqs2M8xuoOZCK+ja6eTpxYfuWr64Q/+7uEwQUYdrWU2jePOCW//9TF5mb3xaMHdM4fk/eCcZjTB77p6z9y1ZRzKGnUFUYyUGNsXQVa3mMQ3qiLcP0AifgVR4QAHogxpiagoS/jxZGRkSw5pdDDRYA3G4AaBlK6YtkBxRTgWki/WhzGXNLDTBECUosoIAa++Ynyw7z3DJ7P+1394N2ReyoZ8nxD94AGAXzPwCeAsCK4gwDCqJZpGmeun6V8j36/ez9bnc89/LIZsOwBQRWXAED/ZYfSBoy9MWOG4RsE2XiXi9DaHdBD1pXmyyDJPG8pUNwkfpkGUySDJJgSpZBk3iri0ZbSx2RIi/xUk6zxFv59oZmFxsdcuWdWiQxlXehLB28C+UxucwiZ05pEcXFyTLYOQRbK4mwie8cLTqZqP86tCqS8tA90JhiR4nD5RQ4l1kQOZOJt7geLHa4HhQ4kygmy1DuksOOlR1B+4WqTplAKtUzqDLGJC5KUq420gTHSBInRYp6QpmAhs0NMgYPp9EWmTiLqyuc0OOwG7i8VuScQ4RkGZqkvDKHReBMpk152tuNrg6rJR30Que8h0H2pHvZ8IaP5Z3ia5olRHP+LVy37EcwSP4IEP7OBxrkIHqwjRBwVkhQjUAOJYRJ4eBFuPMmgxxBj7QRhWgrKqgxQI4lxEnxSBDxzica5CR6so0UpFopQU0D+dP7AND39ZQgxO0GBQCweMShM39eSeYBtQwHggUr+LG2S5KUHOYV1qCNOUQCK12vlu/RxuwLeeMNe/kdhHB36mYX2M7IUXcQrjg5ei+C7qNR5bqowkl9rRRgrUDcu9UmOoOP0BfQeC7kUOVMbOzsR9Fn4TzgcNqqbGKP1CgFnCMztQEzOv+PzqL6GGx2fUWTrRFNqxENj8xw51+w2/YRbn9jbcUbpnlHfezW0cPSjpQ/9VrO9Iedsz2de++rbdLy14n2xKvmHW5Orj/yxmGdbjb4tdfus2xrYK8UYLubkPK6FXvhNByovoNUvmoAbqfWmdg3mBdfUet4IIL//+PFF6MsqrgHAzyYyu9vmTSa7wpctN0nyl59lauaJEKkas1kkrmUDD32+W4hYZclYn9wnnf8oaBdPZvPkPVTU7M+inXTnHbnzvFVRwJ3vRVYVVRAtwTcuFC29sQS5sfs1ZoHYjL6kwI0r671oz3sQ+FFRcrV/2s0G/FRgLiMzv14bcQ6NkZjDNrhVu0yKa6temhJDrm5W3Fp2x9keh9dfeRxsue46iAeWSFEKtYdjbBYyzIPB+2622dHa96izOjMH4iQsDs+7VZfX++jH1ZN2OsX5xxqStrN6gV1Gy7Xl9Y9P3/1Ysv1sRXzBxXvBC+SghqLQvcc5h/hjArJM7/vQsefZVz0pGpN1ryGKPW+0P6Kdq0yYP/y1YOJzNkuesLr4DVPwxUzjbP6vOfFMsr2wmiPxw55+f7vDwAAAUCN8TYmeG+d19Lf1Dr6JQC8efr7KAD4JDF6l/tTdzz7Lx0AoAYzouT/WMv+1pL6/7cJQGAxYjr8SyzyFVbgDJb5BrEl/fozgIF1kgqVKAirAZDg7TSLwODxLAaekLMoUkjz2fYsBcb5KqX2fIBDhwZ9ujXoUCaTTYtBQzr06cWbI0W6dEsIWjRp0aMR+ry5kpjOkObqJaz9/WGZBpFqiNGneekzVKW5OsP8kuLDtc2VrFGH4V3EeL68xVyVQt1mpOeSg+OYp/XpN5G3Q5t2w/Mv7nRLXj6HLHYUVmHufmm6ZcR1iTAYoK1HIg==); }
      @font-face { font-family: Excalifont; src: url(data:font/woff2;base64,d09GMgABAAAAAAyQAA4AAAAAFXwAAAw8AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbhA4cNAZgAIEEEQgKnSCVUAsoAAE2AiQDTAQgBYMYByAbkRBRlJBWL9kXCbap2YI/NEKFCluRojYwvB+H1yOoH/vtuy8GyTzhVZuIRJVMiGRPmgqlMh1CJ/8f+Ju9rwBs1SAGDzX4UKMOFvofwL//fLrVh5a860aQFWNNTlQjJ9W38hd9aDOtRSBrEeyc5cQsUuLs/tOhai6U2LDomILZ4hG5ZL9s/ZkD5y4VbIlVy3NQi2NasBWuUqmILXFf0nYYTJtZGM1nYaSeBNQwFBAb4o2fC5SFS4XPmDLyQHbSs60BZBdtlfUgu3V1aQIZHPDcGLupbGsCCjiQw6FA2oSmEjgJ0jvSDejYoHoD+EmiYvUc4DKB8M1FrpIQnD/a0EkArvLhkov9o7kRJQy8CQqDI5BR0TAwsWqPMJwNgxAug3YxQnIFuolQfMa4/gGGQF4CICiyhyJlJSDSesCUBwOfGty7UyMPmQAESoxCiwAs807SPkT6heyTQ2e2zVlwABy6Zbr9GwXEqAXppgL4chS6DyfUrTIWyIxQvwwhRoprqTfjwMSbOeQq4FKuUrVaDVp0Sxm/aCxH0qTt6/y/0R23+NatWbXCU1cLQQapCkKoDkI9cY9B9gfkXoHWZ+8sIOyfu4yLffbDjKubnclRgpgAQYFM4aOXegSyY9JL7eaZVR/nMn05K69rIWqVnRcygazC5EBO1ERlNrNAZ+fDeKy7/e0YBdSyCytzjFILPL0RZRMiElGERRXxVhiiXjpuhg4Ctf7KxUWZ/G+ix4db6fR3zSk7Lhbbnm0jHx48mGjfG/+s9fKmwurMlmKVJbDeZz1F3dKalmmOLtoRxvfK7pdKE76rELiNyQn8ETclZlkN+hD43RhITRgkFQghkaaaRaNuAfpPrIXocc5p4wdTbOrRMZJkEy9KTopSrdeadkbdPeSBLNrRk+gLFl++4BO7mG1JnXEzzHPfB34M4jHJfpTARL3bV4u3fvzL75X4gJMOeGmJO7eQV75dYQRbfF+WQHEfZ3o2E+FoA9oFKtGnQKnFBaMmUUBVP53m3OFOFS9nL/YI/EImKgsYgAFkPnM3IaRuyN/O8XdAyNHiWCMTXw68GawuIz8e8792ZhtzzU1m1+yh9PAtffnNgRfZtuhRc8q2CxYwfY48xHug+3PWqNnQPhUkEzprSsbOrr6WHcl0HMF3yfBqfNTPm6fHLWk1ObFxZiI6ERWlp1vH4u2xluqBzFhAiBy9KLt4nPmwMVn477MWhq2SN9FuBPf5qlkhOLqfYTcrv82bxx+nA+vZnicyOWQAI28ifjx82JmkgFJGjwUDmWQ/ytkOOZiDqB4XYqV2Z7YzRm/Q8DMKvbL7pMIEo9tCto/VwFV/uoV4miKn7G5jRaNur0KjZkmU7kk1Eb/lOWu59WxwLRtxZTJlMKgyaSWOJTup14sM0L8c1FA6wj3+zK28CWKFxgVrfH/OzXC1xHPVNiRFWzJqkrh9G4t2G7d3iOAmKyaSatQlG1Bffd97fGtA51X8RH8ik+RQshgrtOu/10mWDXLH4S2U5k3gA9oADwvUqkvsJgyuUco5R6lWTavZ3fPaf85EMqkk6i+lFh/vpvvzRizFql1o3CALmdZ6f/ShYu96tC24cX/PixMfdjUlAzTyZojy3cnJDqCzhpUis6kF/ELueUnz7KXL7oQIIGOSoerCxe/2sY2N4INMIOGiUNV78paDvD0XMp0EpEjvrz5pvqVd3wfUgo+SqUQylLfp7t5fvWl+zyuno+6Ag3xgdpHqbsyX8Z4HJ3Cuva1ZZAmsRB+ibds2+ho3WMLcCnTVY8yxYEIQsPt3cCuCFYsroNP4epJ2/zLDEHGHe3wtFyth2OLPkbPmZDmRy/FR0cZiQ87og4OOtDLHAiaTmUwfXMZCJrJgAWz2GaBmJP31SaqaHLVez6cDzmGvHFOgPbjLs2KiFm27CRkWL8Rt0XaxO3h/RlSYrPZgX30HG1YGKP2vyjTtWhW/Qwiio5XY5OMynqG5/jt7xsfHyJhb8+fkk+aQGvlu7/FBpo7CzXYonPvx+KSkolnnPTZKkpEkBlUtKc0+EYWNI3jt3MfpXw93Ew8FOtNm8nqu96Swxbj2YYzXA2C0ulGaHPokytXhO89q8h3tGaZffPXRf9PVl+KFqgv/mAt9VoX1DbwTHK3l8T8mFjGoTfhSlLDHqFR84WdstYvWlbIeNe9GDBoBuz1f+x4PcEVtrbITDi8HMdCrJCTfHHNTwV6z+eerEZH0W1PEQFLRsFSHOcUwk4cgqqoBBCfAWAnSaEezNMtXlXpxQh/6To9AVn3xTUds1FcP03ONEfmNfr2T2dc/NrQ6wpHe2I4HoweYoe3pl+7gVPewdDoxYRhahjj4NeHr+kRvzVTQSAff7J7tE2LSsoZ2/KpNbqwERWvF8K3WHqMje07c5D28h/y1My78+8AfnbfsMR1FNKs0lXUeBedO1vRwHfDIFNmszCextf+nT7vQ/OAY+6rdZTvWYA7UP+ovHCI9npT4jq27kZ0vDEQCjTuDKzQTLexsMrd2VvyZstJx4iyxplQylpWN/wZi0L3CdNg7eqVI66dvzdN14F5H+lRasB7kaBseNblocwteK4Oy2gOtzk/lnNu/SKam8YNEnfxepB9XV11M8zl+ALv0n3Bp6suJH/2jd6O6pCWfI39nIpvqibZosqRHB/DbO+JdVZfqzJB8Kj/Q6kzzxZ3FmEgY1XDvJGu5O2Mwf+Dx2/o2H43g0TCHyJmN6wIMXiWvuhPtX7U0JZr7JGpcq1BwOrJ6IQju+Ka4ksbZ6dIsl5i32zDpuwaDW4OomR15uBMdFxuRNDzRQospqvmeFWcGohJOJ7pvMzr+fqo3aQxJSdZVVbu4t71VOkEnT0q3udjyYd4gH5uT7VnL6q6qmH0n+AWMP/jop1JFWzbIxec6cqamj4js5dUTSeAWcodLziwBZoec7CAXkWXKl75Hzwsbmy+HUDRhCBoWUAcD+eLj95C+EiaZRj/RitLPDfUUKTzR/gRmpjFDmDvJU60IZlStX8zsdRw2ozQpr6qapy3zXWcRa0gUtTYuJocfmtW60LDH00qfqiQyMSpH/0F1uC6IFYfoN131Kmj2upWuXlw3oX6Thzmf58QOJtkrVQ3cwQNr91l/47V1gbXrtP4z0mwj0o5HmdamNfZVfK1sCVfZ/QtE1ngTXbugGtHkhQZ7Ht3FzZtooPgF0RFa44dN9TCnraXlVsFerp+ZtpwCVa1IThnV0P/DSb6RSZ7c1SPc8pfR711TquZWTvRcnIoOU5PrEismzYydti9ZLrRaTHnrfL7R7ez5fVm9YLzXZJZBQGzUMMRRGiayeIF46ZjSQZ0EBFU21iJgrDD3HUnj+4yCtkbmmISkpQ8vprAwKyZCDaCd5V/1iY98rVyyMZ2uODU5plvIvExdvkwbY3JfkpMan5d55xKoGvsYsdnQzSLMGUo4P2zp+vv6laHf32/O/1gUp+v4iMxtVffrB4Kxi6U+l7b50Hv7CiwF+kM3qMqN7tsP9An8IsaBseodNaIloX5YS5VPxK2N2otLV8NA13cTZ6O4g4kdT8teL/tXGR3+2bFZO8TYvbaPGe8qWHfg4l1neufecZmOVlU/uMUgkRO1I1/0r5TkoKm9e3qqlmwaFhO1YqIEMdLzmaTQb3xNxEAzpgpFvX0Sw3LOu/0PU5V7bFUKm3/82bVkDO+8mKUOC/KNx1OY5k9/eMVwj8w9vPNkfAepY313sXIgaJIavDe+QmRGL60fPnzHvM+P/2gkhQvmyq6VXnmWS5qxUYUfWGGTH4xpexjyjB3GxN3VLuNWqPXhWhIZKJz6z/g9rs+vTuzkrxQ69gLw2zPQAMDfote9/w95b/xVNgFAEerD87Uez/EE0f4s/2pelbqMG4yxC7TxgC2agBoOEEU6+KYfoAopyCMIgnzB8RCigwUJUQThIYW4NAciwhP8IwCQ8N4lmcAMWVHnOpDc8QtTxgSqFZTAxuIsNX3r0k6NENinRrFsUGMCDVPjvLnVhFTeIOHNwaweyrk0qFWlWZMuQuT8SbCuAldegcol2kUXtqpECBVuKYlZrvfUoqbFL7IoRDL8DYvcPk5A6EZUi6Ht3iCXWZYkX4u4tgg9U4ueAmpdhWpigr8LBDBFCp8jegy3yJcLflHhuu7SXShCe4IGmPMfaj9AJbNKdMOWCqEw5Kj6DwEA); }&lt;/style&gt;&lt;/defs&gt;&lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;685.1875&#34; height=&#34;134&#34; fill=&#34;#f5faff&#34;&gt;&lt;/rect&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(515.19140625 10) rotate(0 79.998046875 57)&#34;&gt;&lt;path d=&#34;M0 0 C60.73 2.05, 121.01 1.22, 160 0 M0 0 C43.29 -0.24, 89.13 -0.57, 160 0 M160 0 C159.83 27.73, 159.57 52.3, 160 114 M160 0 C159.62 36.13, 158.89 72.33, 160 114 M160 114 C118.59 115.32, 79.14 115.3, 0 114 M160 114 C116.41 113.74, 73.85 114.73, 0 114 M0 114 C1.48 72.27, 1.77 28.39, 0 0 M0 114 C0.61 77.99, -0.35 40.66, 0 0&#34; stroke=&#34;#1e1e1e&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(555.189453125 15) rotate(0 40 12.5)&#34;&gt;&lt;text x=&#34;40&#34; y=&#34;17.619999999999997&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;20px&#34; fill=&#34;#1e1e1e&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;交易签名&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(517.93359375 46.04296875) rotate(0 26.44921875 19.23046875)&#34;&gt;&lt;path d=&#34;M1.89 -1.98 L50.99 -0.29 L52.73 37.29 L-1.14 39.39&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#eaeaea&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C16.62 -1.49, 35.26 -1.66, 52.9 0 M0 0 C18.35 -0.73, 38.72 0.11, 52.9 0 M52.9 0 C53.37 13.78, 53.55 31.31, 52.9 38.46 M52.9 0 C52.31 8.96, 52.86 18.94, 52.9 38.46 M52.9 38.46 C33.29 36.92, 14.55 38.46, 0 38.46 M52.9 38.46 C38.06 38.85, 21.31 39.64, 0 38.46 M0 38.46 C0.04 22.95, -0.91 9.44, 0 0 M0 38.46 C0.01 25.27, 0.35 12.99, 0 0&#34; stroke=&#34;#b3b3b3&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(537.022819519043 52.7734375) rotate(0 7.359992980957031 12.5)&#34;&gt;&lt;text x=&#34;7.359992980957031&#34; y=&#34;17.619999999999997&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;20px&#34; fill=&#34;#b3b3b3&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;R&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(573.06640625 45.30859375) rotate(0 25.8046875 18.7734375)&#34;&gt;&lt;path d=&#34;M-0.17 -1.17 L50.47 0.93 L53.58 36.79 L1.51 37.78&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#eaeaea&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C12.61 2.06, 23.34 -1.02, 51.61 0 M0 0 C13.42 -0.01, 25.26 0.08, 51.61 0 M51.61 0 C50.79 7.99, 50.01 16.19, 51.61 37.55 M51.61 0 C52.24 8.26, 52.23 16.41, 51.61 37.55 M51.61 37.55 C40.82 38.91, 32.1 39.07, 0 37.55 M51.61 37.55 C37.51 38.72, 22.33 38.07, 0 37.55 M0 37.55 C0.53 26.26, -1.68 17.83, 0 0 M0 37.55 C0.94 28.48, -0.96 21.25, 0 0&#34; stroke=&#34;#b3b3b3&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(592.6511001586914 51.58203125) rotate(0 6.219993591308594 12.5)&#34;&gt;&lt;text x=&#34;6.219993591308594&#34; y=&#34;17.619999999999997&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;20px&#34; fill=&#34;#b3b3b3&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;S&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(626.33984375 45.9609375) rotate(0 22.103515625 17.5)&#34;&gt;&lt;path d=&#34;M0.98 -0.38 L44.96 0.12 L45.14 35.52 L0.98 34.5&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#eaeaea&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C16.23 0.71, 33.88 1.12, 44.21 0 M0 0 C13.45 0.1, 27.83 -0.28, 44.21 0 M44.21 0 C43.28 9.56, 43.52 19.57, 44.21 35 M44.21 0 C43.85 10.13, 44.23 20.38, 44.21 35 M44.21 35 C27.64 34.87, 11.97 35.97, 0 35 M44.21 35 C27.09 34.89, 10.47 35.14, 0 35 M0 35 C-0.69 27.57, -0.63 21.06, 0 0 M0 35 C0.12 27.68, -0.12 21.17, 0 0&#34; stroke=&#34;#b3b3b3&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(642.5233612060547 50.9609375) rotate(0 5.9199981689453125 12.5)&#34;&gt;&lt;text x=&#34;5.9199981689453125&#34; y=&#34;17.619999999999997&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;20px&#34; fill=&#34;#b3b3b3&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;V&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(270.72265625 12.567863869326231) rotate(0 122.48400814995091 55.23487050567374)&#34;&gt;&lt;path d=&#34;M0 0 C82.13 2.18, 162.49 0.97, 244.97 0 M0 0 C52.54 1.13, 105.46 1.5, 244.97 0 M244.97 0 C244.38 39.36, 244.57 80.78, 244.97 110.47 M244.97 0 C245.55 44.28, 246.65 88.04, 244.97 110.47 M244.97 110.47 C158.4 109.68, 73.16 108.1, 0 110.47 M244.97 110.47 C193.45 108.1, 142.68 107.94, 0 110.47 M0 110.47 C-1.01 86.74, 1.09 67.26, 0 0 M0 110.47 C0.1 82, 0.15 52, 0 0&#34; stroke=&#34;#1e1e1e&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(306.8616708086423 17.56786386932623) rotate(0 86.34499359130865 15.423349530380108)&#34;&gt;&lt;text x=&#34;86.3449935913086&#34; y=&#34;21.7407534980238&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;24.677359248608173px&#34; fill=&#34;#1e1e1e&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;交易目标和消息&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(274.28956225908075 42.9301952085753) rotate(0 23.645922748764008 27.145095173468974)&#34;&gt;&lt;path d=&#34;M0.85 0.01 L47.05 0.74 L46.1 55.26 L0.7 53.03&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#f5dcdf&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C14.56 -0.82, 30.99 0.29, 47.29 0 M0 0 C12.25 -0.25, 22.4 -0.1, 47.29 0 M47.29 0 C49.16 17.04, 47.04 30.28, 47.29 54.29 M47.29 0 C48.24 20.13, 47.26 39.61, 47.29 54.29 M47.29 54.29 C30.92 53.23, 16.43 53.91, 0 54.29 M47.29 54.29 C35.87 53.67, 26.26 53.24, 0 54.29 M0 54.29 C-1 42.61, -0.02 29.78, 0 0 M0 54.29 C0.37 35.8, -0.08 17.05, 0 0&#34; stroke=&#34;#db8f96&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(283.7132407451494 54.651940851664165) rotate(0 14.222244262695312 15.423349530380108)&#34;&gt;&lt;text x=&#34;14.222244262695312&#34; y=&#34;21.7407534980238&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;24.677359248608173px&#34; fill=&#34;#db8f96&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;to&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(326.3191076716097 44.1971446315556) rotate(0 46.29896737150983 27.145095173468974)&#34;&gt;&lt;path d=&#34;M-1.2 0.97 L93.3 -1.26 L92.81 53.13 L-1.35 52.54&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#f5dcdf&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C22.28 1.13, 46.52 1.11, 92.6 0 M0 0 C24.98 0.08, 51 1.07, 92.6 0 M92.6 0 C93.89 22.22, 94.18 42.29, 92.6 54.29 M92.6 0 C92.43 17.46, 91.47 33.6, 92.6 54.29 M92.6 54.29 C66.24 56.2, 41.04 52.39, 0 54.29 M92.6 54.29 C65.61 54.21, 40.74 53.37, 0 54.29 M0 54.29 C0.97 35.88, -1.06 15.34, 0 0 M0 54.29 C0.18 34.75, -0.37 15.58, 0 0&#34; stroke=&#34;#db8f96&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(343.2484613956585 55.91889027464447) rotate(0 29.369613647460938 15.423349530380108)&#34;&gt;&lt;text x=&#34;29.369613647460938&#34; y=&#34;21.7407534980238&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;24.677359248608173px&#34; fill=&#34;#db8f96&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;value&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(421.74131508228993 42.83246902823919) rotate(0 45.219332904383236 27.145095173468974)&#34;&gt;&lt;path d=&#34;M0.21 -1.16 L89.09 -1.75 L88.81 53.93 L1.29 55.2&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#f5dcdf&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C31.98 -2.39, 64.82 -0.85, 90.44 0 M0 0 C27.54 -0.97, 53.18 -0.18, 90.44 0 M90.44 0 C91.24 19.68, 90.29 41.36, 90.44 54.29 M90.44 0 C89.64 16.57, 89.98 34.05, 90.44 54.29 M90.44 54.29 C54.46 53.26, 17.9 52.28, 0 54.29 M90.44 54.29 C59.86 54.07, 28.7 54.47, 0 54.29 M0 54.29 C1.47 33.58, 2.15 11.9, 0 0 M0 54.29 C-0.53 38.47, 0.42 21.06, 0 0&#34; stroke=&#34;#db8f96&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(437.2579883797396 54.554214671328054) rotate(0 29.702659606933594 15.423349530380108)&#34;&gt;&lt;text x=&#34;29.702659606933594&#34; y=&#34;21.7407534980238&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;24.677359248608173px&#34; fill=&#34;#db8f96&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;input&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(93.54077800850155 10.05069613420119) rotate(0 88.93273599574923 56.244118304231336)&#34;&gt;&lt;path d=&#34;M0 0 C65.98 -2.04, 133.76 0.17, 177.87 0 M0 0 C67.49 -0.61, 135.99 -0.11, 177.87 0 M177.87 0 C175.16 23.95, 175.29 49.73, 177.87 112.49 M177.87 0 C176.71 22.02, 176.22 45.67, 177.87 112.49 M177.87 112.49 C107.23 115.69, 37.17 115.79, 0 112.49 M177.87 112.49 C133.82 114.49, 89.3 113.56, 0 112.49 M0 112.49 C0.55 80.79, -1.68 47.9, 0 0 M0 112.49 C-0.05 85.09, 1.4 58.5, 0 0&#34; stroke=&#34;#1e1e1e&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(116.5935396390164 15.05069613420119) rotate(0 65.87997436523438 13.726320262303602)&#34;&gt;&lt;text x=&#34;65.87997436523438&#34; y=&#34;19.348621041743154&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;21.96211241968576px&#34; fill=&#34;#1e1e1e&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;交易燃料设置&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(96.47418980050736 44.707330203621154) rotate(0 58.43980851675758 24.15832366165432)&#34;&gt;&lt;path d=&#34;M1.92 -1.68 L115.96 -1.52 L118.54 48.79 L1.34 49.23&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#dce6f2&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C33.12 0.1, 63.32 -1.85, 116.88 0 M0 0 C30.73 -1.14, 62.87 -1.09, 116.88 0 M116.88 0 C114.52 12.66, 116.21 28.97, 116.88 48.32 M116.88 0 C117.59 11.29, 117.36 23.45, 116.88 48.32 M116.88 48.32 C69.95 51.27, 26.22 50.37, 0 48.32 M116.88 48.32 C70.72 48.69, 24.2 48.8, 0 48.32 M0 48.32 C-0.86 30.78, -1.45 14.32, 0 0 M0 48.32 C-0.64 35, 0.21 20.86, 0 0&#34; stroke=&#34;#a6c3e1&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(110.01681203796807 55.139333602971874) rotate(0 44.897186279296875 13.726320262303602)&#34;&gt;&lt;text x=&#34;44.897186279296875&#34; y=&#34;19.348621041743154&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;21.96211241968576px&#34; fill=&#34;#a6c3e1&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;gasPrice&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(214.85385861433463 45.0241161045592) rotate(0 27.89874593313209 24.15832366165432)&#34;&gt;&lt;path d=&#34;M1.66 0.47 L57.14 0.91 L54.65 46.41 L-1.51 49.86&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#dce6f2&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C19.01 0.42, 39.63 -1.49, 55.8 0 M0 0 C11.75 -0.31, 24.42 -0.52, 55.8 0 M55.8 0 C54.56 8.74, 56.66 21.73, 55.8 48.32 M55.8 0 C57.09 13.19, 57.14 24.86, 55.8 48.32 M55.8 48.32 C35.9 49.42, 12.26 48.33, 0 48.32 M55.8 48.32 C37.33 47.96, 18.27 48.01, 0 48.32 M0 48.32 C0.06 38.37, 1.33 25.19, 0 0 M0 48.32 C0.71 31.46, -0.71 15.52, 0 0&#34; stroke=&#34;#a6c3e1&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(224.37209612461515 55.45611950390992) rotate(0 18.380508422851562 13.726320262303602)&#34;&gt;&lt;text x=&#34;18.380508422851562&#34; y=&#34;19.348621041743154&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;21.96211241968576px&#34; fill=&#34;#a6c3e1&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;gas&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linecap=&#34;round&#34; transform=&#34;translate(10 44.73828125) rotate(0 40.875 22)&#34;&gt;&lt;path d=&#34;M-1.51 1.54 L80.31 1.46 L83.7 42.26 L-1.42 44.06&#34; stroke=&#34;none&#34; stroke-width=&#34;0&#34; fill=&#34;#fff&#34;&gt;&lt;/path&gt;&lt;path d=&#34;M0 0 C15.68 0.29, 33.19 2.16, 81.75 0 M0 0 C16.34 -0.47, 32.28 0.58, 81.75 0 M81.75 0 C81.82 19.39, 82.62 37.02, 81.75 44 M81.75 0 C82.6 11.95, 82.57 22.02, 81.75 44 M81.75 44 C59.17 44.21, 33.39 43.72, 0 44 M81.75 44 C61.15 43.1, 42.83 43.74, 0 44 M0 44 C-0.53 34.16, -1.82 19.56, 0 0 M0 44 C0.31 34.61, -0.94 23.35, 0 0&#34; stroke=&#34;#000&#34; stroke-width=&#34;2&#34; fill=&#34;none&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;g transform=&#34;translate(23.945022583007812 54.23828125) rotate(0 26.929977416992188 12.5)&#34;&gt;&lt;text x=&#34;26.929977416992188&#34; y=&#34;17.619999999999997&#34; font-family=&#34;Excalifont, Xiaolai, sans-serif, Segoe UI Emoji&#34; font-size=&#34;20px&#34; fill=&#34;#000&#34; text-anchor=&#34;middle&#34; style=&#34;white-space: pre;&#34; direction=&#34;ltr&#34; dominant-baseline=&#34;alphabetic&#34;&gt;nonce&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;</code></pre><ul>
<li><code>nonce</code>: 这是一个从0开始计数的整数，表示从发送者账户发出的交易序号。该字段用于防止重放攻击（确保每笔交易只能被网络处理一次）以及保证交易顺序。</li>
<li><code>gasPrice</code>: gas 费。</li>
<li><code>gas</code>: 为gasLimit，即你为这笔交易设定的愿意消耗的最大燃料数量。<code>交易总费用 = 实际消耗的 gas × gasPrice</code></li>
<li><code>to</code>: 接收方地址
<ul>
<li>普通账户地址：这通常是一笔简单的以太币转账。</li>
<li>智能合约地址：这意味着你想要与这个智能合约进行交互，比如调用它的一个函数。</li>
<li>空地址 (Null)：如果 to 字段为空，表示这笔交易的目的是创建并部署一个新的智能合约。</li>
</ul>
</li>
<li><code>value</code>: 转账金额</li>
<li><code>input</code>: 一个可选字段，用于携带额外的数据。
<ul>
<li>调用智能合约：当 to 是一个智能合约地址时，input 字段里包含了你想调用的函数名称以及需要传入的参数，这些信息会经过特定编码。例如，调用一个代币合约的 transfer(address, amount) 函数，相关信息就在这里。</li>
<li>创建智能合约：当 to 为空时，input 字段里包含的是编译后的智能合约字节码。</li>
</ul>
</li>
<li>后面的部分是交易发送方对交易的签名结果，可以利用交易内容和签名结果反向推导出签名者，即交易发送方地址。</li>
</ul>
<h2 class="heading-element" id="交易对象"><span>交易对象</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%af%b9%e8%b1%a1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>交易对象定义为一个<code>Transation</code>对象。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Transaction 是一个以太坊交易。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Transaction</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 交易的共识内容 (即交易的核心数据)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">inner</span><span class="w"> </span><span class="nx">TxData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 本地节点首次看到该交易的时间 (用于防止垃圾交易/spam)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">time</span><span class="w">  </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ---- 以下为缓存字段，用于优化性能 ----</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 缓存的交易哈希，使用原子指针以支持并发访问</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">hash</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">[</span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 缓存的交易大小，使用原子类型以支持并发访问</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">size</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Uint64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 缓存的交易发送方地址 (从签名中恢复而来)，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 使用 sigCache 避免重复进行昂贵的签名恢复操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">from</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">[</span><span class="nx">sigCache</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>其中<code>TxData</code>是一个接口，以太坊网络自诞生以来，交易的格式并非一成不变。随着以太坊的升级（如柏林硬分叉、伦敦硬分叉），引入了新的交易类型来支持新功能（如访问列表、EIP-1559 的动态 Gas 费）。比如：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/tx_dynamic_fee.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// DynamicFeeTx 代表一个 EIP-1559 交易。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">DynamicFeeTx</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ChainID</span><span class="w">    </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// 链 ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Nonce</span><span class="w">      </span><span class="kt">uint64</span><span class="w">   </span><span class="c1">// 交易序号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">GasTipCap</span><span class="w">  </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// Gas 小费上限 (也称为 maxPriorityFeePerGas)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">GasFeeCap</span><span class="w">  </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// Gas 费用上限 (也称为 maxFeePerGas)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Gas</span><span class="w">        </span><span class="kt">uint64</span><span class="w">   </span><span class="c1">// Gas 上限 (Gas Limit)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">To</span><span class="w">         </span><span class="o">*</span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="w"> </span><span class="s">`rlp:&#34;nil&#34;`</span><span class="w"> </span><span class="c1">// 接收方地址 (如果为 nil，则表示创建合约)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Value</span><span class="w">      </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// 转账金额 (单位: Wei)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Data</span><span class="w">       </span><span class="p">[]</span><span class="kt">byte</span><span class="w">   </span><span class="c1">// 交易数据 (例如，合约调用的输入)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">AccessList</span><span class="w"> </span><span class="nx">AccessList</span><span class="w"> </span><span class="c1">// 访问列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 签名值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">V</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// 签名的 V 值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">R</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// 签名的 R 值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">S</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="c1">// 签名的 S 值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>另外，<code>Transaction</code>还定义了三个缓存项：交易哈希值(hash)、交易大小(size)和交易发送方(from)。缓存的原因是使用频次高且CPU计算量大。</p>
<p>第一个是交易哈希，采用了**懒加载（Lazy Evaluation）<strong>和</strong>缓存（Caching）**的策略。这意味着哈希值只在第一次被请求时才会进行计算，计算结果会被缓存起来，后续的调用将直接返回缓存的结果，避免了重复的、昂贵的哈希计算</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 返回交易hash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">Hash</span><span class="p">()</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 缓存检查（“快”路径）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 如果 不是 nil，说明此交易的哈希值之前已经被计算并缓存了。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nf">Load</span><span class="p">();</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="nx">hash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 准备计算（“慢”路径）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// tx.Type() 返回交易类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// LegacyTxType: 代表“传统交易”，这是以太坊最初的交易格式</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">LegacyTxType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">rlpHash</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// EIP-2718 之后引入的新型交易</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">prefixedRlpHash</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">(),</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">tx</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>第二个缓存是交易大小，交易大小是指交易信息进行RLP编码后的数据大小。代表交易网络传输大小、代表交易占区块大小、代表交易存储大小。 每笔交易进入交易池都需要检查交易大小是否超过 32KB。推送交易数据给其他节点时也需结合交易大小，在不超过网络消息最大限制(默认10MB)下分包推送数据。为避免重复计算开销，在第一次计算后便缓存。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Size 返回交易编码后的真实存储大小。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 它会通过对交易进行编码来计算大小，或者直接返回一个先前已缓存的值。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">Size</span><span class="p">()</span><span class="w"> </span><span class="kt">uint64</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">size</span><span class="p">.</span><span class="nf">Load</span><span class="p">();</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 缓存未命中，则进行编码并缓存结果。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 注意，我们依赖于一个假设：即所有 tx.inner 的值都已经是 RLP 编码的！</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">writeCounter</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">size</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 对于 blob 交易，需要加上其 blob 内容（sidecar）以及对 [交易+sidecar] 整体进行编码时外层列表的大小。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">sc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">BlobTxSidecar</span><span class="p">();</span><span class="w"> </span><span class="nx">sc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">ListSize</span><span class="p">(</span><span class="nx">sc</span><span class="p">.</span><span class="nf">encodedSize</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 对于类型化交易，其编码结果还包含一个前置的类型字节。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">LegacyTxType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">tx</span><span class="p">.</span><span class="nx">size</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><blockquote>
<p>rlp 是以太坊定义的一套区块链数据编码解码协议，而非采用常见的 gzip、json、Protobuf 编码格式。目的是为了尽可能地压缩数据，毕竟区块链数据结构中只有常见的几种数据类型，不需要复杂的协议涉及，即可满足要求。</p>
</blockquote>
<p>最后一个缓存是交易的发送方(from)，交易的发送方，是根据签名反向计算过程，同样是CPU密集型运算。为了保证交易合法性，程序中到处都有涉及取交易发送方地址和校验发送方的合法性。只有正确的签名才能得到发送方地址。因此对交易发送方也进行缓存。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction_signing.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Sender 使用 secp256k1 椭圆曲线从签名 (V, R, S) 中恢复出发送者地址。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 如果恢复失败或签名不正确，则会返回一个错误。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// Sender 方法可能会缓存地址，使其可以在不同的签名方法中被复用。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 如果缓存中记录的签名者（signer）与当前调用所使用的签名者不匹配，那么该缓存将失效。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">Sender</span><span class="p">(</span><span class="nx">signer</span><span class="w"> </span><span class="nx">Signer</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">sigCache</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nf">Load</span><span class="p">();</span><span class="w"> </span><span class="nx">sigCache</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 如果先前用于派生地址的签名者与当前使用的签名者</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 不一致，则使缓存失效。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">sigCache</span><span class="p">.</span><span class="nx">signer</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">signer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">sigCache</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">signer</span><span class="p">.</span><span class="nf">Sender</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">tx</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">sigCache</span><span class="p">{</span><span class="nx">signer</span><span class="p">:</span><span class="w"> </span><span class="nx">signer</span><span class="p">,</span><span class="w"> </span><span class="nx">from</span><span class="p">:</span><span class="w"> </span><span class="nx">addr</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>特殊指出是需要一个<code>Signer</code>进行解签名，同时通过<code>signer</code>获取<code>Sender</code>，合法时缓存并返回。但在使用缓存内容时，还需要检查前后两个 <code>Signer</code> 是否一致，因为不一样的<code>Signer</code> 算法不一样，获得的交易签名者也不相同。</p>
<p>需要注意，上面三个缓存使用都在有一个前提条件：交易对象一旦创建，交易内容不得修改。这也是为何交易对象中单独定义在私有的 <code>txdata</code> 中，而非直接定义在 Transaction 中的原因之一</p>
<h2 class="heading-element" id="交易对象方法"><span>交易对象方法</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%af%b9%e8%b1%a1%e6%96%b9%e6%b3%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>交易对象 Transtion 除对外提供交易内容访问外，也定义了一些辅助方法。</p>
<ol>
<li><code>ChainId()</code>和<code>Protected()</code></li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// ChainId 返回交易的链 ID。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">ChainId</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nf">chainID</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Protected 用于判断该交易是否受重放保护 (replay-protected)。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">Protected</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">tx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">LegacyTx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 对于遗留（Legacy）类型的交易，只有当 V 字段不为 nil 且其值符合重放保护的格式时，才算受保护。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">V</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">isProtectedV</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">V</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 所有其他新类型的交易都默认受重放保护。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><ol start="2">
<li>RLP 接口实现方法</li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// EncodeRLP 实现了 rlp.Encoder 接口。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">EncodeRLP</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 检查交易类型是否为传统的 LegacyTxType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">LegacyTxType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 如果是遗留类型的交易，直接对其内部数据结构进行 RLP 编码。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 如果不是遗留类型，那么它就是一个 EIP-2718 类型的交易信封 (typed TX envelope)。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 从缓冲池中获取一个 bytes.Buffer 以提高性能。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">encodeBufferPool</span><span class="p">.</span><span class="nf">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 使用 defer 确保在函数退出时将缓冲区放回池中，以便复用。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">encodeBufferPool</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nf">Reset</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 调用内部方法将类型化交易编码到缓冲区中。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">encodeTyped</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 对于类型化交易，需要将编码后的数据（包含交易类型前缀和 payload）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 作为一个字节串，再次进行 RLP 编码后写入 io.Writer。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="p">.</span><span class="nf">Bytes</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>Go语言中只要对象有实现某个接口的所有方法，则认为该对象属于某接口类型。这里<code>Transaction</code> 实现了rlp包中的<code>Encoder</code>和<code>Decoder</code>两个接口。意味在进行RLP编码解码时，将通过自定义实现的两个方法进行。RLP编码解码交易，实际是将交易内容 txdata 进行编码解码。同时在解码交易时，缓存交易大小。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="cp">//rlp/encode.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Decoder 接口由那些需要自定义 RLP 解码规则或需要将数据解码到私有字段的类型来实现。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// DecodeRLP 方法应该从给定的 Stream 中读取一个值。虽然读取少于或多于一个值并非禁止，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 但这样做可能会引起混淆。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Decoder</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">DecodeRLP</span><span class="p">(</span><span class="o">*</span><span class="nx">Stream</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Encoder 接口由那些需要自定义编码规则或希望编码私有字段的类型来实现。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Encoder</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// EncodeRLP 方法应将其接收者（receiver）的 RLP 编码写入 w (io.Writer)。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 如果该方法的实现是一个指针方法，那么即使接收者为 nil 指针，该方法也可能被调用。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">    // 实现时应确保生成有效的 RLP。目前，写入的数据不会被校验，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 但未来的版本可能会加入校验。推荐只写入一个 RLP 值，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 但也允许写入多个值或不写入任何值。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">EncodeRLP</span><span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><ol start="3">
<li>JSON接口实现</li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/transaction_marshalling.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// MarshalJSON 将交易（Transaction）序列化为包含哈希的 JSON 格式。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">MarshalJSON</span><span class="p">()</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">txJSON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 以下字段适用于所有交易类型。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">Hash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Hash</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">hexutil</span><span class="p">.</span><span class="nf">Uint64</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 其他字段根据交易类型有条件地设置。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">itx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">inner</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 情况一：传统交易 (LegacyTx)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">LegacyTx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">Nonce</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Uint64</span><span class="p">)(</span><span class="o">&amp;</span><span class="nx">itx</span><span class="p">.</span><span class="nx">Nonce</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">To</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">To</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">Gas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Uint64</span><span class="p">)(</span><span class="o">&amp;</span><span class="nx">itx</span><span class="p">.</span><span class="nx">Gas</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">GasPrice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Big</span><span class="p">)(</span><span class="nx">itx</span><span class="p">.</span><span class="nx">GasPrice</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">Value</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Big</span><span class="p">)(</span><span class="nx">itx</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">Input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">)(</span><span class="o">&amp;</span><span class="nx">itx</span><span class="p">.</span><span class="nx">Data</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">V</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Big</span><span class="p">)(</span><span class="nx">itx</span><span class="p">.</span><span class="nx">V</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Big</span><span class="p">)(</span><span class="nx">itx</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">S</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Big</span><span class="p">)(</span><span class="nx">itx</span><span class="p">.</span><span class="nx">S</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 如果是受 EIP-155 保护的交易，则包含链 ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Protected</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">enc</span><span class="p">.</span><span class="nx">ChainID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">hexutil</span><span class="p">.</span><span class="nx">Big</span><span class="p">)(</span><span class="nx">tx</span><span class="p">.</span><span class="nf">ChainId</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 情况二：带访问列表的交易 (AccessListTx, EIP-2930)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">AccessListTx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">//...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 情况三：动态费用交易 (DynamicFeeTx, EIP-1559)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">DynamicFeeTx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">//...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 情况四：Blob 交易 (BlobTx, EIP-4844)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">BlobTx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">//...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 情况五：设置代码交易 (SetCodeTx, EIP-7702)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">SetCodeTx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">//...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">enc</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">Transaction</span><span class="p">)</span><span class="w"> </span><span class="nf">UnmarshalJSON</span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">//...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Now set the inner transaction.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">tx</span><span class="p">.</span><span class="nf">setDecoded</span><span class="p">(</span><span class="nx">inner</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>下面是一个交易JSON格式数据示例。</p>
<json-viewer value="&#34;{\n    \&#34;nonce\&#34;: \&#34;0x16\&#34;,\n    \&#34;gasPrice\&#34;: \&#34;0x2\&#34;,\n    \&#34;gas\&#34;: \&#34;0x1\&#34;,\n    \&#34;to\&#34;: \&#34;0x0100000000000000000000000000000000000000\&#34;,\n    \&#34;value\&#34;: \&#34;0x0\&#34;,\n    \&#34;input\&#34;: \&#34;0x616263646566\&#34;,\n    \&#34;v\&#34;: \&#34;0x25\&#34;,\n    \&#34;r\&#34;: \&#34;0x3c46a1ff9d0dd2129a7f8fbc3e45256d85890d9d63919b42dac1eb8dfa443a32\&#34;,\n    \&#34;s\&#34;: \&#34;0x6b2be3f225ae31f7ca18efc08fa403eb73b848359a63cd9fdeb61e1b83407690\&#34;,\n    \&#34;hash\&#34;: \&#34;0xb848eb905affc383b4f431f8f9d3676733ea96bcae65638c0ada6e45038fb3a6\&#34;\n}&#34;" expand-depth="1" boxed copyable="{&#34;copiedText&#34;:&#34;已复制&#34;,&#34;copyText&#34;:&#34;复制&#34;}"></json-viewer><h1 class="heading-element" id="交易回执"><span>交易回执</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>以太坊作为智能合约平台。每一笔交易作为消息在以太坊虚拟机中执行时，均会获得一个交易回执信息(Receipt)。就像在银行转账后，可以获得关于这笔转账的交易电子回单。</p>
<p>回执信息分为三部分：共识信息、交易信息、区块信息。</p>
<svg width="800" height="650" viewBox="0 0 800 650" fill="none" xmlns="http://www.w3.org/2000/svg">
  <style>
    /* English text, bold monospace style */
    .en-text {
      font-family: 'Courier New', Courier, monospace;
      font-size: 18px;
      fill: #000;
      font-weight: bold;
    }
    /* Chinese text for section labels */
    .cn-text {
      font-family: 'SimHei', 'Microsoft YaHei', 'Noto Sans CJK SC', sans-serif; /* Fallback fonts included */
      font-size: 24px;
      fill: #000;
      white-space: pre; /* Ensures text is treated as-is */
    }
    /* Chinese text for bottom right label */
    .cn-text-small {
      font-family: 'SimHei', 'Microsoft YaHei', 'Noto Sans CJK SC', sans-serif; /* Fallback fonts included */
      font-size: 16px;
      fill: #000;
      white-space: pre;
    }
  </style>
  <!-- Define common properties for blocks for reusability -->
  <defs>
    <rect id="block-shape" width="280" height="45" stroke="#333" stroke-width="1.5" />
  </defs>
  <!-- Group for the main stack of rectangular blocks and their text labels -->
  <g class="main-stack">
    <!-- Red Section: Consensus Content (共识内容) - Starts at y=50, ends at y=230 (50 + 4*45) -->
    <use href="#block-shape" x="100" y="50" fill="#FFE0E6"/>
    <text x="120" y="78" class="en-text">Status</text>
    <use href="#block-shape" x="100" y="95" fill="#FFE0E6"/>
    <text x="120" y="123" class="en-text">CumulativeGasUsed</text>
    <use href="#block-shape" x="100" y="140" fill="#FFE0E6"/>
    <text x="120" y="168" class="en-text">Logs</text>
    <use href="#block-shape" x="100" y="185" fill="#FFE0E6"/>
    <text x="120" y="213" class="en-text">Bloom</text>
    <!-- Blue Section: Transaction Information (交易信息) - Starts at y=230 (immediately after red), ends at y=365 (230 + 3*45) -->
    <use href="#block-shape" x="100" y="230" fill="#E0E6FF"/>
    <text x="120" y="258" class="en-text">TxHash</text>
    <use href="#block-shape" x="100" y="275" fill="#E0E6FF"/>
    <text x="120" y="303" class="en-text">ContractAddress</text>
    <use href="#block-shape" x="100" y="320" fill="#E0E6FF"/>
    <text x="120" y="348" class="en-text">GasUsed</text>
    <!-- Light Grey Section: Block Information (区块信息) - Starts at y=365 (immediately after blue), ends at y=500 (365 + 3*45) -->
    <use href="#block-shape" x="100" y="365" fill="#F0F0F0"/>
    <text x="120" y="393" class="en-text">BlockHash</text>
    <use href="#block-shape" x="100" y="410" fill="#F0F0F0"/>
    <text x="120" y="438" class="en-text">BlockNumber</text>
    <use href="#block-shape" x="100" y="455" fill="#F0F0F0"/>
    <text x="120" y="483" class="en-text">TransactionIndex</text>
  </g>
  <!-- Dashed lines separators, matching the edges of the sections -->
  <line x1="380" y1="50" x2="600" y2="50" stroke="#000" stroke-width="2" stroke-dasharray="8 8"/> <!-- Top of Red section -->
  <line x1="380" y1="230" x2="600" y2="230" stroke="#000" stroke-width="2" stroke-dasharray="8 8"/> <!-- Between Red and Blue sections -->
  <line x1="380" y1="365" x2="600" y2="365" stroke="#000" stroke-width="2" stroke-dasharray="8 8"/> <!-- Between Blue and Grey sections -->
  <line x1="380" y1="500" x2="600" y2="500" stroke="#000" stroke-width="2" stroke-dasharray="8 8"/> <!-- Bottom of Grey section -->
  <!-- Chinese labels positioned next to each section -->
  <!-- Y positions adjusted to visually center the text within the new section boundaries -->
  <text x="480" y="147" text-anchor="middle" class="cn-text">共识内容</text> <!-- Centered in [50, 230] -->
  <text x="480" y="305" text-anchor="middle" class="cn-text">交易信息</text> <!-- Centered in [230, 365] -->
  <text x="480" y="440" text-anchor="middle" class="cn-text">区块信息</text> <!-- Centered in [365, 500] -->
</svg>
<h2 class="heading-element" id="receipt结构体"><span>Receipt结构体</span>
  <a href="#receipt%e7%bb%93%e6%9e%84%e4%bd%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/receipt.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Receipt 代表一笔交易的执行结果。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Receipt</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 共识字段：这些字段由以太坊黄皮书（Yellow Paper）定义，所有节点必须达成一致。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Type</span><span class="w">              </span><span class="kt">uint8</span><span class="w">  </span><span class="s">`json:&#34;type,omitempty&#34;`</span><span class="w">                 </span><span class="c1">// 交易类型（如 Legacy, AccessList, DynamicFee 等）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">PostState</span><span class="w">         </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="s">`json:&#34;root&#34;`</span><span class="w">                           </span><span class="c1">// 【已废弃】拜占庭分叉前使用的状态根，现由 Status 替代</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Status</span><span class="w">            </span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;status&#34;`</span><span class="w">                         </span><span class="c1">// 交易状态：1=成功，0=失败（拜占庭后引入）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">CumulativeGasUsed</span><span class="w"> </span><span class="kt">uint64</span><span class="w"> </span><span class="s">`json:&#34;cumulativeGasUsed&#34; gencodec:&#34;required&#34;`</span><span class="w"> </span><span class="c1">// 本交易执行后区块累计消耗的 Gas 总量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Bloom</span><span class="w">             </span><span class="nx">Bloom</span><span class="w">  </span><span class="s">`json:&#34;logsBloom&#34; gencodec:&#34;required&#34;`</span><span class="w">  </span><span class="c1">// 日志的布隆过滤器，用于快速检索日志事件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Logs</span><span class="w">              </span><span class="p">[]</span><span class="o">*</span><span class="nx">Log</span><span class="w"> </span><span class="s">`json:&#34;logs&#34; gencodec:&#34;required&#34;`</span><span class="w">       </span><span class="c1">// 本次交易产生的日志列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 实现字段：这些字段由 Geth 在处理交易时添加，不属于黄皮书共识规范。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">TxHash</span><span class="w">            </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="w">    </span><span class="s">`json:&#34;transactionHash&#34; gencodec:&#34;required&#34;`</span><span class="w"> </span><span class="c1">// 交易哈希</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ContractAddress</span><span class="w">   </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="w"> </span><span class="s">`json:&#34;contractAddress&#34;`</span><span class="w">                    </span><span class="c1">// 若为合约创建交易，此为新合约地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">GasUsed</span><span class="w">           </span><span class="kt">uint64</span><span class="w">         </span><span class="s">`json:&#34;gasUsed&#34; gencodec:&#34;required&#34;`</span><span class="w">        </span><span class="c1">// 本次交易实际消耗的 Gas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">EffectiveGasPrice</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w">       </span><span class="s">`json:&#34;effectiveGasPrice&#34;`</span><span class="w">                  </span><span class="c1">// 本次交易实际支付的 Gas 价格（含小费和基础费），为兼容旧版未加 required 标签</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BlobGasUsed</span><span class="w">       </span><span class="kt">uint64</span><span class="w">         </span><span class="s">`json:&#34;blobGasUsed,omitempty&#34;`</span><span class="w">              </span><span class="c1">// 本次交易使用的 Blob Gas（EIP-4844 引入）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BlobGasPrice</span><span class="w">      </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w">       </span><span class="s">`json:&#34;blobGasPrice,omitempty&#34;`</span><span class="w">             </span><span class="c1">// 本次交易支付的每单位 Blob Gas 价格</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 包含信息：这些字段提供该收据对应交易被包含在哪个区块中的上下文信息。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BlockHash</span><span class="w">        </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="w"> </span><span class="s">`json:&#34;blockHash,omitempty&#34;`</span><span class="w">     </span><span class="c1">// 所在区块的哈希</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">BlockNumber</span><span class="w">      </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="w">    </span><span class="s">`json:&#34;blockNumber,omitempty&#34;`</span><span class="w">   </span><span class="c1">// 所在区块高度</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">TransactionIndex</span><span class="w"> </span><span class="kt">uint</span><span class="w">        </span><span class="s">`json:&#34;transactionIndex&#34;`</span><span class="w">        </span><span class="c1">// 交易在区块中的索引位置（第几笔交易）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>代码中对交易回执的构建部分：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/receipt.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewReceipt 创建一个基础交易收据，复制初始字段。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 已弃用：请改用结构体字面量创建收据。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewReceipt</span><span class="p">(</span><span class="nx">root</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">failed</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">cumulativeGasUsed</span><span class="w"> </span><span class="kt">uint64</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Receipt</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Receipt</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w">              </span><span class="nx">LegacyTxType</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">PostState</span><span class="p">:</span><span class="w">         </span><span class="nx">common</span><span class="p">.</span><span class="nf">CopyBytes</span><span class="p">(</span><span class="nx">root</span><span class="p">),</span><span class="w">  </span><span class="c1">// 拜占庭分叉前的状态根</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">CumulativeGasUsed</span><span class="p">:</span><span class="w"> </span><span class="nx">cumulativeGasUsed</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">failed</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ReceiptStatusFailed</span><span class="w">          </span><span class="c1">// 0 = 交易失败</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ReceiptStatusSuccessful</span><span class="w">      </span><span class="c1">// 1 = 交易成功</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h2 class="heading-element" id="交易回执内容介绍"><span>交易回执内容介绍</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7%e5%86%85%e5%ae%b9%e4%bb%8b%e7%bb%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="交易回执共识信息"><span>交易回执共识信息</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7%e5%85%b1%e8%af%86%e4%bf%a1%e6%81%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>在校验区块是否合法时，这部分信息也参与校验。这些信息参与校验的原因是确保交易必须在区块中的固定顺序中执行，且记录了交易执行后的状态信息。这样可强化交易顺序。</p>
<ol>
<li><code>status</code>: 表示是否成功，1表示成功。在高度1035301前，并非1或0，而是 StateRoot，表示此交易执行完毕后的以太坊状态。</li>
<li><code>CumulativeGasUsed：</code>: 区块中已执行的交易累计消耗的Gas，包含当前交易。</li>
<li><code>Logs</code>: 当前交易执行所产生的智能合约事件列表。</li>
<li><code>Bloom</code>：是从 <code>Logs</code> 中提取的事件布隆过滤器，用于快速检测某主题的事件是否存在于Logs中。</li>
</ol>
<p>关于这些信息是如何参与共识校验的，参与校验的仅仅是回执哈希，而回执哈希计算只包含这些信息。</p>
<ol>
<li>执行交易生成回执​：当节点收到一个新区块时，它会重新执行区块中的每笔交易（基于当前状态），并独立生成每个交易的回执。回执中的 status和其他字段取决于交易执行结果（例如，如果交易失败，status为 0）。</li>
<li>构建回执的 MPT​：节点将所有交易回执组织成一个 Merkle Patricia Trie（MPT）。每个回执被编码为 RLP 格式，并作为 MPT 的叶子节点。MPT 的根哈希被计算出来，称为 receiptsRoot。</li>
<li>验证 receiptsRoot​：节点将计算出的 receiptsRoot与区块头中的 receiptsRoot字段进行比较：
<ul>
<li>如果两者匹配，说明所有节点对交易回执的共识一致，区块有效。</li>
<li>如果不匹配，说明交易执行结果有分歧（例如，回执中的 status或其它字段不一致），区块被拒绝，共识无法达成。</li>
</ul>
</li>
</ol>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/block_validator.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// ValidateState 验证状态转换后发生的各种变更是否合法，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 包括：使用的 Gas 数量、收据树根（receipts root）、状态根（state root）等。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">BlockValidator</span><span class="p">)</span><span class="w"> </span><span class="nf">ValidateState</span><span class="p">(</span><span class="nx">block</span><span class="w"> </span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">Block</span><span class="p">,</span><span class="w"> </span><span class="nx">statedb</span><span class="w"> </span><span class="o">*</span><span class="nx">state</span><span class="p">.</span><span class="nx">StateDB</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">ProcessResult</span><span class="p">,</span><span class="w"> </span><span class="nx">stateless</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 验证收据 Trie 的根哈希（R = (Tr [[H1, R1], ... [Hn, Rn]])) 是否匹配区块头</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receiptSha</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nf">DeriveSha</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">Receipts</span><span class="p">,</span><span class="w"> </span><span class="nx">trie</span><span class="p">.</span><span class="nf">NewStackTrie</span><span class="p">(</span><span class="kc">nil</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">receiptSha</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">header</span><span class="p">.</span><span class="nx">ReceiptHash</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;收据根哈希无效（远程：%x，本地：%x）&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">header</span><span class="p">.</span><span class="nx">ReceiptHash</span><span class="p">,</span><span class="w"> </span><span class="nx">receiptSha</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>函数 <code>types.DeriveSha</code> 用于为交易回执列表（或其他可派生列表）生成 Merkle Trie 根哈希。它将列表中每个元素的 RLP 编码作为“值”，以“索引的 RLP 编码”作为“键”，构建一棵 Merkle Trie，并最终计算其根哈希。</p>
<p>与早期实现不同，当前版本为适配内存高效的 <code>StackTrie</code>，<strong>必须按“键的字典序”插入数据</strong>。由于 RLP 编码的特性（例如索引 <code>0</code> 的编码 <code>0x80</code> 在字典序上大于 <code>0x01</code> ~ <code>0x7f</code>），插入顺序被调整为：</p>
<ol>
<li>先插入索引 <code>1</code> 到 <code>0x7f</code>；</li>
<li>再插入索引 <code>0</code>；</li>
<li>最后插入索引 <code>0x80</code> 到列表末尾。</li>
</ol>
<p>这确保了键值按字典序递增，满足 <code>StackTrie</code> 的要求。虽然插入顺序与原始索引顺序不同，但最终生成的 Trie 根哈希与规范一致，不影响共识。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/hashing.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// DeriveSha 为区块头中的交易列表、收据列表或提款列表生成对应的 Merkle Trie 哈希根。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 适用于：交易根（transactions root）、收据根（receipts root）、提款根（withdrawals root）等。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">DeriveSha</span><span class="p">(</span><span class="nx">list</span><span class="w"> </span><span class="nx">DerivableList</span><span class="p">,</span><span class="w"> </span><span class="nx">hasher</span><span class="w"> </span><span class="nx">TrieHasher</span><span class="p">)</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 重置哈希器，确保无残留状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">hasher</span><span class="p">.</span><span class="nf">Reset</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 从缓冲池中获取一个 bytes.Buffer 用于临时编码，避免重复分配内存</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">valueBuf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">encodeBufferPool</span><span class="p">.</span><span class="nf">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">encodeBufferPool</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="nx">valueBuf</span><span class="p">)</span><span class="w"> </span><span class="c1">// 使用后归还缓冲池</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// StackTrie 要求键值必须按“哈希字典序”递增插入，但 `list` 提供的顺序（按索引 0,1,2...）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 并不符合该顺序（因为 RLP 编码后，0 的字节序大于 0x80~0xff）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 因此，此处采用特殊插入顺序，确保键（索引的 RLP 编码）按字典序递增：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   1. 先插入索引 1 ~ 0x7f（RLP 单字节编码，字典序递增）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   2. 再插入索引 0（RLP 编码为 0x80，字典序大于 0x7f）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   3. 最后插入索引 0x80 ~ Len-1（RLP 多字节编码，字典序递增）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">    // 注意：此处忽略 hasher.Update 可能返回的错误。因为一旦出错，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// hasher 内部状态已损坏，后续 Hash() 会返回错误或无效哈希 —— 这本身就是一种“失败信号”。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">indexBuf</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="c1">// 用于临时存储索引的 RLP 编码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 阶段一：插入索引 1 到 0x7f（含）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">list</span><span class="p">.</span><span class="nf">Len</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">indexBuf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">AppendUint64</span><span class="p">(</span><span class="nx">indexBuf</span><span class="p">[:</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span><span class="w"> </span><span class="c1">// 将索引 i 编码为 RLP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">encodeForDerive</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">valueBuf</span><span class="p">)</span><span class="w">          </span><span class="c1">// 获取第 i 项的 RLP 编码值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">hasher</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">indexBuf</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">                       </span><span class="c1">// 插入到 Trie 哈希器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 阶段二：插入索引 0（RLP 编码为 0x80，字典序大于 0x7f）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">list</span><span class="p">.</span><span class="nf">Len</span><span class="p">()</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">indexBuf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">AppendUint64</span><span class="p">(</span><span class="nx">indexBuf</span><span class="p">[:</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">encodeForDerive</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">valueBuf</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">hasher</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">indexBuf</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 阶段三：插入索引 0x80 到 Len-1（RLP 编码为多字节，字典序递增）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mh">0x80</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">list</span><span class="p">.</span><span class="nf">Len</span><span class="p">();</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">indexBuf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">AppendUint64</span><span class="p">(</span><span class="nx">indexBuf</span><span class="p">[:</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">encodeForDerive</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">valueBuf</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">hasher</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">indexBuf</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 最终计算并返回 Trie 根哈希</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hasher</span><span class="p">.</span><span class="nf">Hash</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// core/types/hashing.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">encodeForDerive</span><span class="p">(</span><span class="nx">list</span><span class="w"> </span><span class="nx">DerivableList</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="w"> </span><span class="o">*</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nf">Reset</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">list</span><span class="p">.</span><span class="nf">EncodeIndex</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// It&#39;s really unfortunate that we need to perform this copy.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// StackTrie holds onto the values until Hash is called, so the values</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// written to it must not alias.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nf">CopyBytes</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">Bytes</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">DerivableList</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">Len</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">EncodeIndex</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>Receipts 实现了 DerivableList 接口</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/receipt.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// EncodeIndex 将第i个收据编码至写入器w。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="nx">Receipts</span><span class="p">)</span><span class="w"> </span><span class="nf">EncodeIndex</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">receiptRLP</span><span class="p">{</span><span class="nx">r</span><span class="p">.</span><span class="nf">statusEncoding</span><span class="p">(),</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">CumulativeGasUsed</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Bloom</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Logs</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">LegacyTxType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 传统交易类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">WriteByte</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">AccessListTxType</span><span class="p">,</span><span class="w"> </span><span class="nx">DynamicFeeTxType</span><span class="p">,</span><span class="w"> </span><span class="nx">BlobTxType</span><span class="p">,</span><span class="w"> </span><span class="nx">SetCodeTxType</span><span class="p">:</span><span class="w"> </span><span class="c1">// 访问列表交易类型/动态费用交易类型/Blob交易类型/设置代码交易类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 对于不支持的交易类型，不写入任何内容。由于该方法用于DeriveSha，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 错误会在匹配派生哈希与区块时被捕获</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>而receiptRLP仅仅包含上面提到的参与共识校验的内容：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/receipt.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// receiptRLP 是收据的共识编码结构。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">receiptRLP</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">PostStateOrStatus</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="w">  </span><span class="c1">// 交易后状态或状态码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">CumulativeGasUsed</span><span class="w"> </span><span class="kt">uint64</span><span class="w">  </span><span class="c1">// 累计燃气消耗量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Bloom</span><span class="w">             </span><span class="nx">Bloom</span><span class="w">   </span><span class="c1">// 布隆过滤器（日志摘要）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">Logs</span><span class="w">              </span><span class="p">[]</span><span class="o">*</span><span class="nx">Log</span><span class="w">  </span><span class="c1">// 日志条目列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><h3 class="heading-element" id="交易回执交易信息"><span>交易回执交易信息</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7%e4%ba%a4%e6%98%93%e4%bf%a1%e6%81%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这部分信息记录的是关于回执所对应的交易信息，有：</p>
<ul>
<li><code>TxHash</code>: 交易回执所对应的交易哈希。</li>
<li><code>ContractAddress</code>: 当这笔交易是部署新合约时，记录新合约的地址。</li>
<li><code>GasUsed</code>: 这笔交易执行所消耗的Gas燃料。</li>
</ul>
<p>这些信息不参与共识的原因是这三项信息已经在其他地方校验。</p>
<ul>
<li><code>TxHash</code>: 区块有校验交易集的正确性。</li>
<li><code>ContractAddress</code>: 如果是新合约，实际上已经提交到以太坊状态 <code>State</code> 中。</li>
<li><code>GasUsed</code>: 已属于<code>CumulativeGasUsed</code>的一部分。</li>
</ul>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/receipt.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// DeriveFields 根据共识数据和上下文信息（如包含的区块和交易）填充收据的计算字段。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Receipt</span><span class="p">)</span><span class="w"> </span><span class="nf">DeriveFields</span><span class="p">(</span><span class="nx">signer</span><span class="w"> </span><span class="nx">Signer</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="nx">DeriveReceiptContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">TxHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Tx</span><span class="p">.</span><span class="nf">Hash</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">GasUsed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">GasUsed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 合约地址可以从交易本身中推导出来</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Tx</span><span class="p">.</span><span class="nf">To</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 获取签名者开销较大，仅在确实需要时执行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">from</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">Sender</span><span class="p">(</span><span class="nx">signer</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Tx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">ContractAddress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nf">CreateAddress</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Tx</span><span class="p">.</span><span class="nf">Nonce</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">ContractAddress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Address</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h3 class="heading-element" id="交易回执区块信息"><span>交易回执区块信息</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7%e5%8c%ba%e5%9d%97%e4%bf%a1%e6%81%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这部分信息完全是为了方便外部读取交易回执，不但知道交易执行情况，还能方便的指定该交易属于哪个区块中第几笔交易。</p>
<ul>
<li><code>BlockHash</code>: 交易所在区块哈希。</li>
<li><code>BlockNumber</code>: 交易所在区块高度。</li>
<li><code>TransactionIndex</code>: 交易在区块中的序号。</li>
</ul>
<h2 class="heading-element" id="交易回执构造"><span>交易回执构造</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7%e6%9e%84%e9%80%a0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>交易回执是在以太坊虚拟机处理完交易后，根据结果整理出的交易执行结果信息。反映了交易执行前后以太坊变化以及交易执行状态。</p>
<p>构造部分前面说了，就是<code>NewReceipt</code>，但是已经弃用了。</p>
<p>这里是完整的交易回执构造代码：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/state_processor.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// MakeReceipt 根据交易的执行结果，生成对应的交易回执（Receipt）对象。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">MakeReceipt</span><span class="p">(</span><span class="nx">evm</span><span class="w"> </span><span class="o">*</span><span class="nx">vm</span><span class="p">.</span><span class="nx">EVM</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="nx">ExecutionResult</span><span class="p">,</span><span class="w"> </span><span class="nx">statedb</span><span class="w"> </span><span class="o">*</span><span class="nx">state</span><span class="p">.</span><span class="nx">StateDB</span><span class="p">,</span><span class="w"> </span><span class="nx">blockNumber</span><span class="w"> </span><span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHash</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">blockTime</span><span class="w"> </span><span class="kt">uint64</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">,</span><span class="w"> </span><span class="nx">usedGas</span><span class="w"> </span><span class="kt">uint64</span><span class="p">,</span><span class="w"> </span><span class="nx">root</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">Receipt</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 创建一个新的交易回执，记录交易执行后的中间状态根（仅旧版本使用）和累计消耗 Gas。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">types</span><span class="p">.</span><span class="nx">Receipt</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w">              </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">(),</span><span class="w">      </span><span class="c1">// 交易类型（如 Legacy, AccessList, DynamicFee, BlobTx）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">PostState</span><span class="p">:</span><span class="w">         </span><span class="nx">root</span><span class="p">,</span><span class="w">           </span><span class="c1">// 【已废弃】拜占庭前用于记录状态根，现由 Status 替代</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">CumulativeGasUsed</span><span class="p">:</span><span class="w"> </span><span class="nx">usedGas</span><span class="p">,</span><span class="w">        </span><span class="c1">// 本交易执行后，区块内累计消耗的总 Gas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 根据执行结果设置交易状态：成功或失败</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nf">Failed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">ReceiptStatusFailed</span><span class="w">       </span><span class="c1">// 0 — 执行失败</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">ReceiptStatusSuccessful</span><span class="w">   </span><span class="c1">// 1 — 执行成功</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 记录交易哈希和本交易实际消耗的 Gas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">TxHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Hash</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">GasUsed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">UsedGas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 如果是 Blob 交易（EIP-4844），记录使用的 Blob Gas 和每单位 Blob 的价格</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">BlobTxType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">BlobGasUsed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nf">BlobHashes</span><span class="p">())</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">BlobTxBlobGasPerBlob</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">BlobGasPrice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">evm</span><span class="p">.</span><span class="nx">Context</span><span class="p">.</span><span class="nx">BlobBaseFee</span><span class="w"> </span><span class="c1">// 当前区块的 blob 基础费用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 如果是合约创建交易（To 为 nil），计算并记录新创建的合约地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">To</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">ContractAddress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nf">CreateAddress</span><span class="p">(</span><span class="nx">evm</span><span class="p">.</span><span class="nx">TxContext</span><span class="p">.</span><span class="nx">Origin</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nf">Nonce</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 获取本次交易产生的所有日志（Logs），并构建布隆过滤器（Bloom Filter）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">Logs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">statedb</span><span class="p">.</span><span class="nf">GetLogs</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nf">Hash</span><span class="p">(),</span><span class="w"> </span><span class="nx">blockNumber</span><span class="p">.</span><span class="nf">Uint64</span><span class="p">(),</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">,</span><span class="w"> </span><span class="nx">blockTime</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">Bloom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nf">CreateBloom</span><span class="p">(</span><span class="nx">receipt</span><span class="p">)</span><span class="w"> </span><span class="c1">// 基于日志内容生成布隆过滤器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 填充区块上下文信息，便于索引和查询</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">BlockHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">blockHash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">BlockNumber</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">blockNumber</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">receipt</span><span class="p">.</span><span class="nx">TransactionIndex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">uint</span><span class="p">(</span><span class="nx">statedb</span><span class="p">.</span><span class="nf">TxIndex</span><span class="p">())</span><span class="w"> </span><span class="c1">// 交易在区块中的位置索引</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><h2 class="heading-element" id="交易回执存储"><span>交易回执存储</span>
  <a href="#%e4%ba%a4%e6%98%93%e5%9b%9e%e6%89%a7%e5%ad%98%e5%82%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>交易回执作为交易执行中间产物，为了方便快速获取某笔交易的执行明细。以太坊中有跟随区块存储时实时存储交易回执。但为了降低存储量，只存储了必要内容。</p>
<p>首先，在存储时，将交易回执对象转换为精简内容。精简内容是专门为存储定义的一个结构<code>ReceiptForStorage</code>。存储时将交易回执集进行RLP编码存储。</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/rawdb/accessors_chain.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// WriteReceipts 将属于某个区块的所有交易回执（receipts）写入数据库。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">WriteReceipts</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="nx">ethdb</span><span class="p">.</span><span class="nx">KeyValueWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="kt">uint64</span><span class="p">,</span><span class="w"> </span><span class="nx">receipts</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">Receipts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 将回执列表转换为“存储专用格式”，并序列化为 RLP 字节流</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">storageReceipts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">ReceiptForStorage</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">receipts</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">receipt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">receipts</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将 *Receipt 类型强制转换为 *ReceiptForStorage（存储优化格式）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">storageReceipts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">ReceiptForStorage</span><span class="p">)(</span><span class="nx">receipt</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">EncodeToBytes</span><span class="p">(</span><span class="nx">storageReceipts</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 如果序列化失败，记录致命错误并终止程序（因为回执必须可序列化）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nf">Crit</span><span class="p">(</span><span class="s">&#34;区块回执序列化失败&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;err&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 将序列化后的回执字节数据写入数据库，键由区块号和哈希共同生成</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="nf">blockReceiptsKey</span><span class="p">(</span><span class="nx">number</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">),</span><span class="w"> </span><span class="nx">bytes</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 如果数据库写入失败，记录致命错误并终止程序（因为回执必须持久化）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nf">Crit</span><span class="p">(</span><span class="s">&#34;区块回执存储失败&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;err&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>所以看存储了哪些内容，只需要看 <code>ReceiptForStorage</code> 的 <code>EncodeRLP</code> 方法：</p>
<div class="code-block highlight line-nos-hidden" data-mode="classic" data-copyable="true"><div class="code-header language-go"><span class="code-title"><i class="arrow fa-solid fa-chevron-down" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="切换行号" role="button" title="切换行号"><i class="fa-solid fa-list-ol" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="切换自动换行" role="button" title="切换自动换行"><i class="fa-solid fa-right-left" aria-hidden="true"></i></span><span class="copy-btn" aria-label="复制到剪贴板" role="button" title="复制到剪贴板"><i class="fa-regular fa-clone" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// core/types/receipt.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// EncodeRLP 实现了 rlp.Encoder 接口，将 ReceiptForStorage 的所有内容字段“扁平化”编码为 RLP 流。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// 该编码格式专为存储优化，省略了 TxHash、BlockHash 等可推导字段，仅保留核心共识数据。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ReceiptForStorage</span><span class="p">)</span><span class="w"> </span><span class="nf">EncodeRLP</span><span class="p">(</span><span class="nx">_w</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 创建一个带缓冲的 RLP 编码器，提升写入效率</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rlp</span><span class="p">.</span><span class="nf">NewEncoderBuffer</span><span class="p">(</span><span class="nx">_w</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 开始编码最外层的列表（对应 Receipt 的顶层结构）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">outerList</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nf">List</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. 写入状态字段（Status 或 PostState，取决于分叉）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//    → 调用 (*Receipt)(r).statusEncoding() 获取兼容旧版的编码值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">WriteBytes</span><span class="p">((</span><span class="o">*</span><span class="nx">Receipt</span><span class="p">)(</span><span class="nx">r</span><span class="p">).</span><span class="nf">statusEncoding</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. 写入累计 Gas 消耗量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">WriteUint64</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">CumulativeGasUsed</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. 开始编码日志列表（Logs）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">logList</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nf">List</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Logs</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 逐条编码每条日志（Log 也实现了 EncodeRLP）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nf">EncodeRLP</span><span class="p">(</span><span class="nx">w</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">ListEnd</span><span class="p">(</span><span class="nx">logList</span><span class="p">)</span><span class="w"> </span><span class="c1">// 结束日志列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 结束最外层列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">ListEnd</span><span class="p">(</span><span class="nx">outerList</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 将缓冲区内容刷新到原始 Writer（如文件或网络流）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nf">Flush</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="code-expand-btn" aria-label="展开或折叠代码块" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div></div><p>根据EncodeRLP方法实现，可以得出在存储时仅仅存储了部分内容：<code>Status</code>，<code>CumulativeGasUsed</code>，<code>Logs</code></p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="更新于 2025-09-10 00:00:00">更新于 2025-09-10&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="分享到 X" data-sharer="twitter" data-url="https://nesl42.github.io/posts/202509-ethbasestruct/" data-title="以太坊-基础数据结构解析" data-hashtags="Web3"><i class="fa-brands fa-x-twitter" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://nesl42.github.io/posts/202509-ethbasestruct/" data-hashtag="Web3"><i class="fa-brands fa-facebook-square" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://nesl42.github.io/posts/202509-ethbasestruct/" data-title="以太坊-基础数据结构解析"><i class="fa-brands fa-weibo" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags me-1" aria-hidden="true"></i><a href="/tags/web3/" class="post-tag" title="标签 - Web3">Web3</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/202509-llmquart/" class="post-nav-item" rel="prev" title="量化可视化指南揭秘：大型语言模型的压缩"><i class="fa-solid fa-angle-left" aria-hidden="true"></i>量化可视化指南揭秘：大型语言模型的压缩</a><a href="/posts/202509-ethpool/" class="post-nav-item" rel="next" title="以太坊详解之交易池">以太坊详解之交易池<i class="fa-solid fa-angle-right" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li><a href="#chainconfig-结构体概述"><code>ChainConfig</code> 结构体概述</a>
      <ul>
        <li><a href="#字段解释">字段解释</a>
          <ul>
            <li><a href="#以太坊兼容或基于以太坊协议的区块链网络">以太坊兼容或基于以太坊协议的区块链网络</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#最外层创世区块的头部和初始状态">最外层（创世区块的头部和初始状态）</a></li>
        <li><a href="#config-对象网络配置和硬分叉时间表"><code>config</code> 对象（网络配置和硬分叉时间表）</a></li>
        <li><a href="#alloc-对象初始账户分配"><code>alloc</code> 对象（初始账户分配）</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#外部账户">外部账户</a></li>
    <li><a href="#合约账户">合约账户</a></li>
    <li><a href="#账户数据结构">账户数据结构</a></li>
  </ul>

  <ul>
    <li><a href="#交易数据结构">交易数据结构</a></li>
    <li><a href="#交易对象">交易对象</a></li>
    <li><a href="#交易对象方法">交易对象方法</a></li>
  </ul>

  <ul>
    <li><a href="#receipt结构体">Receipt结构体</a></li>
    <li><a href="#交易回执内容介绍">交易回执内容介绍</a>
      <ul>
        <li><a href="#交易回执共识信息">交易回执共识信息</a></li>
        <li><a href="#交易回执交易信息">交易回执交易信息</a></li>
        <li><a href="#交易回执区块信息">交易回执区块信息</a></li>
      </ul>
    </li>
    <li><a href="#交易回执构造">交易回执构造</a></li>
    <li><a href="#交易回执存储">交易回执存储</a></li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.154.5"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.3-20260123080729-2a5bd268"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2026</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up" aria-hidden="true"></i></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="目录"><i class="fa-solid fa-bars" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/json-viewer-element/json-viewer-element.umd.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/js/config/0f27eae16600abc217b11f6dca7ce991.js" defer></script><script src="/js/lib/mermaid.min.js" type="module"></script><script src="/js/theme.min.js" defer></script></body>
</html>
