<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Solidity 101 - 敬渊&#39;s Blog</title><meta name="author" content="">
<meta name="description" content="学习Solidity 101 记录
Solidity 是一种用于编写以太坊虚拟机（EVM）智能合约的编程语言。
开发工具 本教程中，我们将使用 Remix 运行 Solidity 合约。Remix 是以太坊官方推荐的智能合约集成开发环境（IDE），适合新手，可以在浏览器中快速开发和部署合约，无需在本地安装任何程序。网址：https://remix.ethereum.org
"><meta name="keywords" content='Web3'>
  <meta itemprop="name" content="Solidity 101">
  <meta itemprop="description" content="学习Solidity 101 记录
Solidity 是一种用于编写以太坊虚拟机（EVM）智能合约的编程语言。
开发工具 本教程中，我们将使用 Remix 运行 Solidity 合约。Remix 是以太坊官方推荐的智能合约集成开发环境（IDE），适合新手，可以在浏览器中快速开发和部署合约，无需在本地安装任何程序。网址：https://remix.ethereum.org">
  <meta itemprop="datePublished" content="2025-08-01T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-08-01T00:00:00+00:00">
  <meta itemprop="wordCount" content="10268">
  <meta itemprop="keywords" content="Web3"><meta property="og:url" content="https://nesl42.github.io/posts/202508-solidity101/">
  <meta property="og:site_name" content="敬渊&#39;s Blog">
  <meta property="og:title" content="Solidity 101">
  <meta property="og:description" content="学习Solidity 101 记录
Solidity 是一种用于编写以太坊虚拟机（EVM）智能合约的编程语言。
开发工具 本教程中，我们将使用 Remix 运行 Solidity 合约。Remix 是以太坊官方推荐的智能合约集成开发环境（IDE），适合新手，可以在浏览器中快速开发和部署合约，无需在本地安装任何程序。网址：https://remix.ethereum.org">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-01T00:00:00+00:00">
    <meta property="article:tag" content="Web3">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Solidity 101">
  <meta name="twitter:description" content="学习Solidity 101 记录
Solidity 是一种用于编写以太坊虚拟机（EVM）智能合约的编程语言。
开发工具 本教程中，我们将使用 Remix 运行 Solidity 合约。Remix 是以太坊官方推荐的智能合约集成开发环境（IDE），适合新手，可以在浏览器中快速开发和部署合约，无需在本地安装任何程序。网址：https://remix.ethereum.org">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://nesl42.github.io/posts/202508-solidity101/" title="Solidity 101 - 敬渊&#39;s Blog" /><link rel="prev" type="text/html" href="https://nesl42.github.io/posts/202507-alphagopaperread/" title="论文阅读 AlphaGo Moment for Model Architecture Discovery" /><link rel="next" type="text/html" href="https://nesl42.github.io/posts/top%E8%AE%B0%E5%BD%95/" title="碎碎存" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Solidity 101",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/nesl42.github.io\/posts\/202508-solidity101\/"
    },"genre": "posts","keywords": "Web3","wordcount":  10268 ,
    "url": "https:\/\/nesl42.github.io\/posts\/202508-solidity101\/","datePublished": "2025-08-01T00:00:00+00:00","dateModified": "2025-08-01T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Author"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="敬渊&#39;s Blog"><span class="header-title-text">敬渊&#39;s Blog</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/">文章</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/">标签</a></li><li class="menu-item">
              <a class="menu-link" href="/about/">关于</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/">分类</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="敬渊&#39;s Blog"><span class="header-title-text">敬渊&#39;s Blog</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="menu-item"><a class="menu-link" href="/posts/">文章</a></li><li class="menu-item"><a class="menu-link" href="/tags/">标签</a></li><li class="menu-item"><a class="menu-link" href="/about/">关于</a></li><li class="menu-item"><a class="menu-link" href="/categories/">分类</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Solidity 101</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Anonymous</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/technology/" class="post-category" title="Category - Technology"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Technology</a></span></div><div class="post-meta-line"><span title="published on 2025-08-01 00:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-08-01">2025-08-01</time></span>&nbsp;<span title="10268 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 10300 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>21 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#开发工具">开发工具</a></li>
    <li><a href="#hello-world">Hello world</a></li>
    <li><a href="#值类型">值类型</a>
      <ul>
        <li><a href="#布尔">布尔</a></li>
        <li><a href="#整形">整形</a></li>
        <li><a href="#地址类型">地址类型</a></li>
        <li><a href="#定长字节数组">定长字节数组</a></li>
        <li><a href="#枚举">枚举</a></li>
      </ul>
    </li>
    <li><a href="#函数">函数</a>
      <ul>
        <li>
          <ul>
            <li><a href="#pure-vs-view">pure vs view</a></li>
            <li><a href="#internal-vs-external">internal vs external</a></li>
            <li><a href="#payable">payable</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#函数输出">函数输出</a>
      <ul>
        <li><a href="#命名式返回">命名式返回</a></li>
        <li><a href="#结构式复制">结构式复制</a></li>
      </ul>
    </li>
    <li><a href="#变量数据存储和作用域">变量数据存储和作用域</a>
      <ul>
        <li><a href="#变量的作用域">变量的作用域</a>
          <ul>
            <li><a href="#以太单位">以太单位</a></li>
            <li><a href="#时间单位">时间单位</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#引用类型">引用类型</a>
      <ul>
        <li><a href="#数组">数组</a></li>
        <li><a href="#结构体">结构体</a></li>
      </ul>
    </li>
    <li><a href="#映射类型">映射类型</a>
      <ul>
        <li><a href="#映射的规则">映射的规则</a></li>
      </ul>
    </li>
    <li><a href="#变量的初始值">变量的初始值</a></li>
    <li><a href="#常数">常数</a></li>
    <li><a href="#控制流">控制流</a></li>
    <li><a href="#构造函数和修饰器">构造函数和修饰器</a>
      <ul>
        <li><a href="#构造函数">构造函数</a></li>
        <li><a href="#修饰器-modifier">修饰器 modifier</a></li>
      </ul>
    </li>
    <li><a href="#事件-event">事件 event</a>
      <ul>
        <li><a href="#声明事件">声明事件</a></li>
        <li><a href="#释放事件">释放事件</a></li>
        <li><a href="#evm-日志">EVM 日志</a>
          <ul>
            <li><a href="#主题-topics">主题 topics</a></li>
            <li><a href="#数据-data">数据 data</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#继承-inheritance">继承 inheritance</a>
      <ul>
        <li><a href="#规则">规则</a></li>
        <li><a href="#简单继承">简单继承</a></li>
        <li><a href="#多重继承">多重继承</a></li>
        <li><a href="#修饰器的继承">修饰器的继承</a></li>
        <li><a href="#构造函数的继承">构造函数的继承</a></li>
        <li><a href="#调用父合约的函数">调用父合约的函数</a></li>
        <li><a href="#菱形继承">菱形继承</a></li>
      </ul>
    </li>
    <li><a href="#抽象合约和接口">抽象合约和接口</a></li>
    <li><a href="#抽象合约">抽象合约</a>
      <ul>
        <li><a href="#接口">接口</a></li>
        <li><a href="#什么时候使用接口">什么时候使用接口？</a></li>
        <li><a href="#异常">异常</a></li>
        <li><a href="#error-异常">error 异常</a></li>
        <li><a href="#require-异常">require 异常</a></li>
        <li><a href="#assert-异常">assert 异常</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>学习<a href="https://www.wtf.academy/zh/course/solidity101/HelloWeb3"target="_blank" rel="external nofollow noopener noreferrer">Solidity 101</a> 记录</p>
<p><code>Solidity</code> 是一种用于编写以太坊虚拟机（EVM）智能合约的编程语言。</p>
<h2 id="开发工具" class="heading-element"><span>开发工具</span>
  <a href="#%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>本教程中，我们将使用 Remix 运行 Solidity 合约。Remix 是以太坊官方推荐的智能合约集成开发环境（IDE），适合新手，可以在浏览器中快速开发和部署合约，无需在本地安装任何程序。网址：https://remix.ethereum.org</p>
<h2 id="hello-world" class="heading-element"><span>Hello world</span>
  <a href="#hello-world" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span><span class="c1">// 表示源文件将不允许小于 0.8.21 版本或大于等于 0.9.0 的编译器编译（第二个条件由 ^ 提供）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">contract</span> <span class="nx">HelloWeb3</span> <span class="p">{</span> <span class="c1">// 创建合约(contract)，合约名为 HelloWeb3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">string</span> <span class="kr">public</span> <span class="nx">_string</span> <span class="o">=</span> <span class="s2">&#34;hello web3&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Remix 会使用 Remix 虚拟机（以前称为 JavaScript 虚拟机）来模拟以太坊链，运行智能合约，类似在浏览器里运行一条测试链。</p>
<p>Remix 还会为你分配一些测试账户，每个账户里有 100 ETH（测试代币），随意使用。</p>
<p>点击部署 Deploy 即可部署合约。</p>
<h2 id="值类型" class="heading-element"><span>值类型</span>
  <a href="#%e5%80%bc%e7%b1%bb%e5%9e%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>值类型(Value Type) ：包括布尔型，整数型等等，这类变量赋值时候直接传递数值。</li>
<li>引用类型(Reference Type) ：包括数组和结构体，这类变量占空间大，赋值时候直接传递地址（类似指针）。</li>
<li>映射类型(Mapping Type) : Solidity中存储键值对的数据结构，可以理解为哈希表</li>
</ul>
<h2 id="布尔" class="heading-element"><span>布尔</span>
  <a href="#%e5%b8%83%e5%b0%94" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">bool</span> <span class="kr">public</span> <span class="nx">_bool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></span></span></code></pre></div><h2 id="整形" class="heading-element"><span>整形</span>
  <a href="#%e6%95%b4%e5%bd%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">int</span> <span class="kr">public</span> <span class="nx">_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">uint</span> <span class="kr">public</span> <span class="nx">_uint</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">_number</span> <span class="o">=</span> <span class="mi">123456</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">_number1</span> <span class="o">=</span> <span class="nx">_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// +，-，*，/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">_number2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// 指数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">_number3</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// 取余数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">bool</span> <span class="kr">public</span> <span class="nx">_numberbool</span> <span class="o">=</span> <span class="nx">_number2</span> <span class="o">&gt;</span> <span class="nx">_number3</span><span class="p">;</span> <span class="c1">// 比大小
</span></span></span></code></pre></div><h2 id="地址类型" class="heading-element"><span>地址类型</span>
  <a href="#%e5%9c%b0%e5%9d%80%e7%b1%bb%e5%9e%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有两类：</p>
<ul>
<li>普通地址：存储一个 20 字节的值（以太坊地址的大小）。</li>
<li>payable address: 比普通地址多了 transfer 和 send 两个成员方法，用于接收转账。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">address</span> <span class="kr">public</span> <span class="nx">_address</span> <span class="o">=</span> <span class="mi">0</span><span class="nx">x</span><span class="p">......;</span>
</span></span><span class="line"><span class="cl"><span class="nx">address</span> <span class="nx">payable</span> <span class="kr">public</span> <span class="nx">_add1</span> <span class="o">=</span> <span class="nx">payable</span><span class="p">(</span><span class="nx">_adderss</span><span class="p">)</span> <span class="c1">// 可以转账、查余额
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">balance</span> <span class="o">=</span> <span class="nx">_address</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span></span></span></code></pre></div><h2 id="定长字节数组" class="heading-element"><span>定长字节数组</span>
  <a href="#%e5%ae%9a%e9%95%bf%e5%ad%97%e8%8a%82%e6%95%b0%e7%bb%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>定长字节数组: 属于值类型，数组长度在声明之后不能改变。根据字节数组的长度分为 bytes1, bytes8, bytes32 等类型。定长字节数组最多存储 32 bytes 数据，即bytes32。</li>
<li>不定长字节数组: 属于引用类型（之后的章节介绍），数组长度在声明之后可以改变，包括 bytes 等。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">bytes32</span> <span class="kr">public</span> <span class="nx">_byte32</span> <span class="o">=</span> <span class="s2">&#34;MiniSolidity&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">bytes1</span> <span class="kr">public</span> <span class="nx">_byte</span> <span class="o">=</span> <span class="nx">_byte32</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// 0x4d
</span></span></span></code></pre></div><h2 id="枚举" class="heading-element"><span>枚举</span>
  <a href="#%e6%9e%9a%e4%b8%be" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>类似C预言中的枚举</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 用enum将uint 0， 1， 2表示为Buy, Hold, Sell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">enum</span> <span class="nx">ActionSet</span> <span class="p">{</span> <span class="nx">Buy</span><span class="p">,</span> <span class="nx">Hold</span><span class="p">,</span> <span class="nx">Sell</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 创建enum变量 action
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ActionSet</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">ActionSet</span><span class="p">.</span><span class="nx">Buy</span><span class="p">;</span></span></span></code></pre></div><h2 id="函数" class="heading-element"><span>函数</span>
  <a href="#%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Solidity 中函数的形式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 方括号中的是可写可不 写的关键字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="o">&lt;</span><span class="kd">function</span> <span class="nx">name</span><span class="o">&gt;</span><span class="p">([</span><span class="nx">parameter</span> <span class="nx">types</span><span class="p">[,</span> <span class="p">...]])</span> <span class="p">{</span><span class="nx">internal</span><span class="o">|</span><span class="nx">external</span><span class="o">|</span><span class="kr">public</span><span class="o">|</span><span class="kr">private</span><span class="p">}</span> <span class="p">[</span><span class="nx">pure</span><span class="o">|</span><span class="nx">view</span><span class="o">|</span><span class="nx">payable</span><span class="p">]</span> <span class="p">[</span><span class="nx">virtual</span><span class="o">|</span><span class="nx">override</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="nx">modifiers</span><span class="o">&gt;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">returns</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">return</span> <span class="nx">types</span><span class="o">&gt;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="kd">function</span> <span class="nx">body</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>解释：</p>
<ul>
<li>function：声明函数时的固定用法。</li>
<li><code>&lt;function name&gt;</code>：函数名。</li>
<li><code>([parameter types[, ...]])</code>：圆括号内写入函数的参数，即输入到函数的变量类型和名称。</li>
<li><code>{internal|external|public|private}</code>：函数可见性说明符，共有4种。
<ul>
<li>public：内部和外部均可见。</li>
<li>private：只能从本合约内部访问，继承的合约也不能使用。</li>
<li>external：只能从合约外部访问（但内部可以通过 this.f() 来调用，f是函数名）。</li>
<li>internal: 只能从合约内部访问，继承的合约可以用。</li>
<li>注意
<ul>
<li>1：合约中定义的函数需要明确指定可见性，它们没有默认值。</li>
<li>2：public|private|internal 也可用于修饰状态变量。public变量会自动生成同名的getter函数，用于查询数值。未标明可见性类型的状态变量，默认为internal。</li>
</ul>
</li>
</ul>
</li>
<li><code>[pure|view|payable]</code>：决定函数权限/功能的关键字。
<ul>
<li>payable（可支付的）很好理解，带着它的函数，运行的时候可以给合约转入 ETH。</li>
<li>pure 和 view 的介绍见下一节。</li>
</ul>
</li>
<li><code>[virtual|override]</code>: 方法是否可以被重写，或者是否是重写方法。virtual用在父合约上，标识的方法可以被子合约重写。override用在自合约上，表明方法重写了父合约的方法。</li>
<li><code>&lt;modifiers&gt;</code>: 自定义的修饰器，可以有0个或多个修饰器。</li>
<li><code>[returns ()]</code>：函数返回的变量类型和名称。</li>
<li><code>&lt;function body&gt;</code>: 函数体。</li>
</ul>
<p>solidity 引入<code>pure|view</code>这两个关键字主要是因为 以太坊交易需要支付gas。合约的状态变量存储在链上，gas fee 很贵，如果计算不改变链上状态，就可以不用付 gas。包含 pure 和 view 关键字的函数是不改写链上状态的，因此用户直接调用它们是不需要付 gas 的（注意，合约中非 pure/view 函数调用 pure/view 函数时需要付gas）。</p>
<ul>
<li>pure，中文意思是“纯”，这里可以理解为”纯打酱油的”。pure 函数既不能读取也不能写入链上的状态变量。</li>
<li>view，“看”，这里可以理解为“看客”。view函数能读取但也不能写入状态变量。</li>
<li>非 pure 或 view 的函数既可以读取也可以写入状态变量。</li>
</ul>
<p>在以太坊中，以下语句被视为修改链上状态：</p>
<ul>
<li>写入状态变量。</li>
<li>释放事件。</li>
<li>创建其他合约。</li>
<li>使用 selfdestruct.</li>
<li>通过调用发送以太币。</li>
<li>调用任何未标记 view 或 pure 的函数。</li>
<li>使用低级调用（low-level calls）。</li>
<li>使用包含某些操作码的内联汇编。</li>
</ul>
<h3 id="pure-vs-view" class="heading-element"><span>pure vs view</span>
  <a href="#pure-vs-view" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">FunctionTypes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">add</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span><span class="c1">// 这个函数不能标记为pure，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">number</span> <span class="o">=</span> <span class="nx">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// pure: 不能读写链上的状态变量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">addPure</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">_number</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">pure</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">new_number</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">new_number</span> <span class="o">=</span> <span class="nx">_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// view: 可以读不可以写
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">addView</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">new_number</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">new_number</span> <span class="o">=</span> <span class="nx">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h3 id="internal-vs-external" class="heading-element"><span>internal vs external</span>
  <a href="#internal-vs-external" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>由于 internal 函数只能由合约内部调用，我们必须再定义一个 external 的 minusCall() 函数，通过它间接调用内部的 minus() 函数。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">FunctionTypes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">minus</span><span class="p">()</span> <span class="nx">internal</span><span class="p">{</span> <span class="c1">// 内部函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">number</span> <span class="o">=</span> <span class="nx">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 合约内的函数可以调用内部函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">minusCall</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">minus</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h3 id="payable" class="heading-element"><span>payable</span>
  <a href="#payable" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>如果在remix的value中设置了1eth，点击minusPayable后，这1eth会转入合约地址，合约地址的余额会增加：</p>
<pre tabindex="0"><code>{
	&#34;0&#34;: &#34;uint256: balance 1000000000000000000&#34;
}</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">FunctionTypes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">minus</span><span class="p">()</span> <span class="nx">internal</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">number</span> <span class="o">=</span> <span class="nx">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">minusCall</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">minus</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 能给合约支付eth的函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">minusPayable</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">balance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">minus</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">balance</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="函数输出" class="heading-element"><span>函数输出</span>
  <a href="#%e5%87%bd%e6%95%b0%e8%be%93%e5%87%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有两个：return 和 returns</p>
<ul>
<li>returns：跟在函数名后面，用于声明返回的变量类型及变量名。</li>
<li>return：用于函数主体中，返回指定的变量。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">returnMultiple</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint256</span><span class="p">,</span><span class="nx">bool</span><span class="p">,</span><span class="nx">uint256</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">memory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">true</span><span class="p">,[</span><span class="nx">uint256</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>因为<code>[1,2,3]</code>会默认为<code>uint8(3)</code>，因此<code>[uint256(1),2,5]中</code>首个元素必须强转<code>uint256</code>来声明该数组内的元素皆为此类型。数组类型返回值默认必须用memory修饰。</p>
<h2 id="命名式返回" class="heading-element"><span>命名式返回</span>
  <a href="#%e5%91%bd%e5%90%8d%e5%bc%8f%e8%bf%94%e5%9b%9e" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">returnNamed</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">_number</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">_bool</span><span class="p">,</span> <span class="nx">uint256</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">memory</span> <span class="nx">_array</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_number</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_bool</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_array</span> <span class="o">=</span> <span class="p">[</span><span class="nx">uint256</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="结构式复制" class="heading-element"><span>结构式复制</span>
  <a href="#%e7%bb%93%e6%9e%84%e5%bc%8f%e5%a4%8d%e5%88%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">readReturn</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 读取所有返回值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">uint256</span> <span class="nx">_number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">bool</span> <span class="nx">_bool</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">memory</span> <span class="nx">_array</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">_number</span><span class="p">,</span> <span class="nx">_bool</span><span class="p">,</span> <span class="nx">_array</span><span class="p">)</span> <span class="o">=</span> <span class="nx">returnNamed</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 读取部分
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(,</span> <span class="nx">_bool2</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nx">returnNamed</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="变量数据存储和作用域" class="heading-element"><span>变量数据存储和作用域</span>
  <a href="#%e5%8f%98%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e5%92%8c%e4%bd%9c%e7%94%a8%e5%9f%9f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>引用类型包括数组和结构体，由于这类变量比较复杂，占用存储空间大，在使用时必须要声明数据存储的位置。</p>
<p>Solidity数据存储位置有三类：storage，memory和calldata。不同存储位置的gas成本不同。storage类型的数据存在链上，类似计算机的硬盘，消耗gas多；memory和calldata类型的临时存在内存里，消耗gas少。整体消耗gas从多到少依次为：storage &gt; memory &gt; calldata</p>
<p>与memory的不同点在于calldata变量不能修改（immutable），一般用于函数的参数。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fCalldata</span><span class="p">(</span><span class="nx">uint</span><span class="p">[]</span> <span class="nx">calldata</span> <span class="nx">_x</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint</span><span class="p">[]</span> <span class="nx">calldata</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//参数为calldata数组，不能被修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// _x[0] = 0 //这样修改会报错
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span><span class="p">(</span><span class="nx">_x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>在不同存储类型相互赋值时候，有时会产生独立的副本（修改新变量不会影响原变量），有时会产生引用（修改新变量会影响原变量）</p>
<p>赋值本质上是创建引用指向本体，因此修改本体或者是引用，变化可以被同步。</p>
<ol>
<li>storage（合约的状态变量）赋值给本地storage（函数里的）时候，会创建引用，改变新变量会影响原变量。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">uint</span><span class="p">[]</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span> <span class="c1">// 状态变量：数组 x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fStorage</span><span class="p">()</span> <span class="kr">public</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//声明一个storage的变量 xStorage，指向x。修改xStorage也会影响x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">uint</span><span class="p">[]</span> <span class="nx">storage</span> <span class="nx">xStorage</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">xStorage</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><ol start="2">
<li>
<p>memory赋值给memory，会创建引用，改变新变量会影响原变量。</p>
</li>
<li>
<p>其他情况下，赋值创建的是本体的副本，即对二者之一的修改，并不会同步到另一方。这有时会涉及到开发中的问题，比如从storage中读取数据，赋值给memory，然后修改memory的数据，但如果没有将memory的数据赋值回storage，那么storage的数据是不会改变的。</p>
</li>
</ol>
<h2 id="变量的作用域" class="heading-element"><span>变量的作用域</span>
  <a href="#%e5%8f%98%e9%87%8f%e7%9a%84%e4%bd%9c%e7%94%a8%e5%9f%9f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有三种，分别是状态变量（state variable），局部变量（local variable）和全局变量(global variable)</p>
<ol>
<li>状态变量存储在链上，所有合约内函数都可以访问，gas消耗高。状态变量在合约内、函数外声明。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Variables</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">string</span> <span class="kr">public</span> <span class="nx">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><ol start="2">
<li>
<p>局部变量是仅在函数执行过程中有效的变量，函数退出后，变量无效。局部变量不上链，gas低。</p>
</li>
<li>
<p>全局变量是全局范围工作的变量，都是solidity预留关键字。他们可以在函数内不声明直接使用。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">global</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">uint</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">address</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="c1">// 请求发起地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">uint</span> <span class="nx">blockNum</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="p">;</span><span class="c1">// 当前区块高度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span><span class="c1">// 请求的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span><span class="p">(</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">blockNum</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>常见的全局变量：</p>
<ul>
<li><code>blockhash(uint blockNumber): (bytes32)</code>：给定区块的哈希值 – 只适用于最近的256个区块，不包含当前区块。</li>
<li><code>block.coinbase: (address payable)</code>：当前区块矿工的地址。</li>
<li><code>block.gaslimit: (uint)</code>：当前区块的gaslimit。</li>
<li><code>block.number: (uint)</code>：当前区块的number。</li>
<li><code>block.timestamp: (uint)</code>：当前区块的时间戳，为unix纪元以来的秒。</li>
<li><code>gasleft(): (uint256)</code>：剩余 gas。</li>
<li><code>msg.data: (bytes calldata)</code>：完整call data。</li>
<li><code>msg.sender: (address payable)</code>：消息发送者 (当前caller)。</li>
<li><code>msg.sig: (bytes4)</code>：calldata的前四个字节 (function identifier)。</li>
<li><code>msg.value: (uint)</code>：当前交易发送的wei值。</li>
<li><code>block.blobbasefee: (uint)</code>：当前区块的blob基础费用。这是Cancun升级新增的全局变量。</li>
<li><code>blobhash(uint index): (bytes32)</code>：返回跟当前交易关联的第index个blob的版本化哈希（第一个字节为版本号，当前为0x01，后面接KZG承诺的SHA256哈希的最后31个字节）。若当前交易不包含blob，则返回空字节。这是Cancun升级新增的全局变量。</li>
</ul>
<h3 id="以太单位" class="heading-element"><span>以太单位</span>
  <a href="#%e4%bb%a5%e5%a4%aa%e5%8d%95%e4%bd%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Solidity中不存在小数点，以0代替为小数点，来确保交易的精确度，并且防止精度的损失：</p>
<ul>
<li>wei: 1</li>
<li>gwei: 1e9 = 1000000000</li>
<li>ether: 1e18 = 1000000000000000000</li>
</ul>
<h3 id="时间单位" class="heading-element"><span>时间单位</span>
  <a href="#%e6%97%b6%e9%97%b4%e5%8d%95%e4%bd%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>可以在合约中规定一个操作必须在一周内完成，或者某个事件在一个月后发生。这样就能让合约的执行可以更加精确，不会因为技术上的误差而影响合约的结果。</p>
<ul>
<li>seconds: 1</li>
<li>minutes: 60 seconds = 60</li>
<li>hours: 60 minutes = 3600</li>
<li>days: 24 hours = 86400</li>
<li>weeks: 7 days = 604800</li>
</ul>
<h2 id="引用类型" class="heading-element"><span>引用类型</span>
  <a href="#%e5%bc%95%e7%94%a8%e7%b1%bb%e5%9e%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有两个，一个是数组array，一个是结构体struct</p>
<h2 id="数组" class="heading-element"><span>数组</span>
  <a href="#%e6%95%b0%e7%bb%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有定长和变长两种</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 固定长度 Array
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="nx">array1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">bytes1</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nx">array2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">address</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="nx">array3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 可变长度 Array
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint</span><span class="p">[]</span> <span class="nx">array4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">bytes1</span><span class="p">[]</span> <span class="nx">array5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">address</span><span class="p">[]</span> <span class="nx">array6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">bytes</span> <span class="nx">array7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// bytes比较特殊，是数组，但是不用加[]。另外，不能用byte[]声明单字节数组，可以使用bytes或bytes1[]。
</span></span></span><span class="line"><span class="cl"><span class="c1">// bytes 比 bytes1[] 省gas。
</span></span></span></code></pre></div><p>对于memory修饰的动态数组，可以用new操作符来创建，但是必须声明长度，并且声明后长度不能改变。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// memory动态数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint</span><span class="p">[]</span> <span class="nx">memory</span> <span class="nx">array8</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">uint</span><span class="p">[](</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">array9</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bytes</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span></span></span></code></pre></div><p>如果创建的是动态数组，需要一个一个元素的赋值。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">uint</span><span class="p">[]</span> <span class="nx">memory</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">uint</span><span class="p">[](</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span></span></span></code></pre></div><p>成员：</p>
<ul>
<li><code>length</code>: 数组有一个包含元素数量的length成员，memory数组的长度在创建后是固定的。</li>
<li><code>push()</code>: 动态数组拥有push()成员，可以在数组最后添加一个0元素，并返回该元素的引用。</li>
<li><code>push(x)</code>: 动态数组拥有push(x)成员，可以在数组最后添加一个x元素。</li>
<li><code>pop()</code>: 动态数组拥有pop()成员，可以移除数组最后一个元素。</li>
</ul>
<h2 id="结构体" class="heading-element"><span>结构体</span>
  <a href="#%e7%bb%93%e6%9e%84%e4%bd%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有四种赋值的方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 结构体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">struct</span> <span class="nx">Student</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span> <span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span> <span class="nx">score</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Student</span> <span class="nx">student</span><span class="p">;</span> <span class="c1">// 初始一个student结构体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//  给结构体赋值
</span></span></span><span class="line"><span class="cl"><span class="c1">// 方法1:在函数中创建一个storage的struct引用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">initStudent1</span><span class="p">()</span> <span class="nx">external</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Student</span> <span class="nx">storage</span> <span class="nx">_student</span> <span class="o">=</span> <span class="nx">student</span><span class="p">;</span> <span class="c1">// assign a copy of student
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">_student</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_student</span><span class="p">.</span><span class="nx">score</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 方法2:直接引用状态变量的struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">initStudent2</span><span class="p">()</span> <span class="nx">external</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">student</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">student</span><span class="p">.</span><span class="nx">score</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 方法3:构造函数式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">initStudent3</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">student</span> <span class="o">=</span> <span class="nx">Student</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 方法4:key value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">initStudent4</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">student</span> <span class="o">=</span> <span class="nx">Student</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">score</span><span class="o">:</span> <span class="mi">60</span><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="映射类型" class="heading-element"><span>映射类型</span>
  <a href="#%e6%98%a0%e5%b0%84%e7%b1%bb%e5%9e%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>声明映射的格式为<code>mapping(_KeyType =&gt; _ValueType)</code>，其中<code>_KeyType</code>和<code>_ValueType</code>分别是Key和Value的变量类型。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">mapping</span><span class="p">(</span><span class="nx">uint</span> <span class="p">=&gt;</span> <span class="nx">address</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">idToAddress</span><span class="p">;</span> <span class="c1">// id映射到地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span> <span class="p">=&gt;</span> <span class="nx">address</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">swapPair</span><span class="p">;</span> <span class="c1">// 币对的映射，地址到地址
</span></span></span></code></pre></div><h2 id="映射的规则" class="heading-element"><span>映射的规则</span>
  <a href="#%e6%98%a0%e5%b0%84%e7%9a%84%e8%a7%84%e5%88%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>
<p>映射的<code>_KeyType</code>只能选择Solidity内置的值类型，比如<code>uint</code>，<code>address</code>等，不能用自定义的结构体。而<code>_ValueType</code>可以使用自定义的类型。</p>
</li>
<li>
<p>映射的存储位置必须是<code>storage</code>，因此可以用于合约的状态变量，不能用于<code>public</code>函数的参数或返回结果中，因为mapping记录的是一种关系 (key - value pair)。</p>
</li>
<li>
<p>如果映射声明为<code>public</code>，那么Solidity会自动给你创建一个<code>getter</code>函数，可以通过Key来查询对应的Value。</p>
</li>
<li>
<p>给映射新增的键值对的语法为<code>_Var[_Key] = _Value</code>，其中_Var是映射变量名，<code>_Key</code>和<code>_Value</code>对应新增的键值对。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">writeMap</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_key</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">_value</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">idToAddress</span><span class="p">[</span><span class="nx">_key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="变量的初始值" class="heading-element"><span>变量的初始值</span>
  <a href="#%e5%8f%98%e9%87%8f%e7%9a%84%e5%88%9d%e5%a7%8b%e5%80%bc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>
<p><strong>值类型初始值</strong>：</p>
<ul>
<li>boolean: <code>false</code></li>
<li>string: <code>&quot;&quot;</code>（空字符串）</li>
<li>int/uint: <code>0</code></li>
<li>enum: 枚举第一个元素（如<code>enum Action {Buy, Hold}</code>初始为<code>Buy</code>）</li>
<li>address: <code>0x0000000000000000000000000000000000000000</code></li>
<li>function（内部/外部）: 空白函数</li>
</ul>
</li>
<li>
<p><strong>引用类型初始值</strong>：</p>
<ul>
<li>mapping: 所有元素为对应类型默认值</li>
<li>struct: 所有成员为默认值（如<code>struct Student {uint id;}</code>初始<code>id=0</code>）</li>
<li>动态数组: <code>[]</code>（空数组）</li>
<li>静态数组: 所有成员为默认值（如<code>uint[3]</code>初始<code>[0,0,0]</code>）</li>
</ul>
</li>
<li>
<p><strong>delete操作符</strong>：将变量重置为初始值（如<code>delete _bool</code>将<code>_bool</code>设为<code>false</code>）</p>
</li>
</ul>
<h2 id="常数" class="heading-element"><span>常数</span>
  <a href="#%e5%b8%b8%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>constant（常量）和immutable（不变量）。</p>
<ul>
<li>
<p><strong><code>constant</code> 与 <code>immutable</code> 关键字</strong>：</p>
<ul>
<li>用于状态变量，初始化后值不可改，提升安全性且节省gas。</li>
<li>仅数值变量适用，<code>string</code>和<code>bytes</code>可声明为<code>constant</code>，不可为<code>immutable</code>。</li>
</ul>
</li>
<li>
<p><strong><code>constant</code> 特性</strong>：</p>
<ul>
<li>必须声明时初始化，后续不可修改，否则编译报错。</li>
<li>示例：<code>uint256 constant MY_CONST = 10;</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// constant变量必须在声明的时候初始化，之后不能改变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint256</span> <span class="nx">constant</span> <span class="nx">CONSTANT_NUM</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">string</span> <span class="nx">constant</span> <span class="nx">CONSTANT_STRING</span> <span class="o">=</span> <span class="s2">&#34;0xAA&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">bytes</span> <span class="nx">constant</span> <span class="nx">CONSTANT_BYTES</span> <span class="o">=</span> <span class="s2">&#34;WTF&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">address</span> <span class="nx">constant</span> <span class="nx">CONSTANT_ADDRESS</span> <span class="o">=</span> <span class="mh">0x0000000000000000000000000000000000000000</span><span class="p">;</span></span></span></code></pre></div><ul>
<li><strong><code>immutable</code> 特性</strong>：
<ul>
<li>可在声明时或构造函数中初始化（v0.8.21后未显式初始化用数值初始值）。</li>
<li>声明与构造函数均初始化时，以构造函数为准，支持全局变量/自定义函数初始化。</li>
<li>示例：<code>uint256 immutable IMMUTABLE_VAL; constructor() { IMMUTABLE_VAL = 20; }</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// immutable变量可以在constructor里初始化，之后不能改变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">immutable</span> <span class="nx">IMMUTABLE_NUM</span> <span class="o">=</span> <span class="mi">9999999999</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 在`Solidity v8.0.21`以后,下列变量数值暂为初始值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">address</span> <span class="kr">public</span> <span class="nx">immutable</span> <span class="nx">IMMUTABLE_ADDRESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">immutable</span> <span class="nx">IMMUTABLE_BLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">immutable</span> <span class="nx">IMMUTABLE_TEST</span><span class="p">;</span></span></span></code></pre></div><h2 id="控制流" class="heading-element"><span>控制流</span>
  <a href="#%e6%8e%a7%e5%88%b6%e6%b5%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>也就是if else while for 之类的，和其他语言一样。</p>
<h2 id="构造函数和修饰器" class="heading-element"><span>构造函数和修饰器</span>
  <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e5%92%8c%e4%bf%ae%e9%a5%b0%e5%99%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>构造函数（constructor），修饰器（modifier）。</p>
<h2 id="构造函数" class="heading-element"><span>构造函数</span>
  <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>每个合约可以定义一个，并在部署合约的时候自动运行一次。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">address</span> <span class="nx">owner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">initOwner</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">initOwner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="修饰器-modifier" class="heading-element"><span>修饰器 modifier</span>
  <a href="#%e4%bf%ae%e9%a5%b0%e5%99%a8-modifier" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>类似面向对象编程中的装饰器，声明函数拥有的特性，并减少代码冗余。<code>modifier</code>的主要使用场景是运行函数前的检查，例如地址，变量，余额等。</p>
<p>定义了一个<code>changeOwner</code>函数，运行它可以改变合约的<code>owner</code>，但是由于<code>onlyOwner</code>修饰符的存在，只有原先的<code>owner</code>可以调用，别人调用就会报错。这也是最常用的控制智能合约权限的方法。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 定义modifier
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span> <span class="c1">// 检查调用者是否为owner地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="nx">_</span><span class="p">;</span> <span class="c1">// 如果是的话，继续运行函数主体；否则报错并revert交易
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 带有onlyOwner修饰符的函数只能被owner地址调用，比如下面这个例子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">changeOwner</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_newOwner</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">onlyOwner</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_newOwner</span><span class="p">;</span> <span class="c1">// 只有owner地址运行这个函数，并改变owner
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div><h2 id="事件-event" class="heading-element"><span>事件 event</span>
  <a href="#%e4%ba%8b%e4%bb%b6-event" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>事件（event）定义：EVM日志的抽象，用于记录合约关键操作，支持前端监听响应，且存储成本低（约2,000 gas/次，远低于链上存储）。</li>
</ul>
<h2 id="声明事件" class="heading-element"><span>声明事件</span>
  <a href="#%e5%a3%b0%e6%98%8e%e4%ba%8b%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>事件的声明由event关键字开头，接着是事件名称，括号里面写好事件需要记录的变量类型和变量名。以ERC20代币合约的Transfer事件为例：</p>
<p><code>from</code>和<code>to</code>前面带有<code>indexed</code>关键字，他们会保存在以太坊虚拟机日志的topics中，方便之后检索。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">event</span> <span class="nx">Transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">value</span><span class="p">);</span></span></span></code></pre></div><h2 id="释放事件" class="heading-element"><span>释放事件</span>
  <a href="#%e9%87%8a%e6%94%be%e4%ba%8b%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在下面的例子中，每次用<code>_transfer()</code>函数进行转账操作的时候，都会释放<code>Transfer</code>事件，并记录相应的变量。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 定义_transfer函数，执行转账逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">_transfer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">address</span> <span class="nx">from</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint256</span> <span class="nx">amount</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="nx">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">_balances</span><span class="p">[</span><span class="nx">from</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000000</span><span class="p">;</span> <span class="c1">// 给转账地址一些初始代币
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nx">_balances</span><span class="p">[</span><span class="nx">from</span><span class="p">]</span> <span class="o">-=</span>  <span class="nx">amount</span><span class="p">;</span> <span class="c1">// from地址减去转账数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">_balances</span><span class="p">[</span><span class="nx">to</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span> <span class="c1">// to地址加上转账数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 释放事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">emit</span> <span class="nx">Transfer</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="evm-日志" class="heading-element"><span>EVM 日志</span>
  <a href="#evm-%e6%97%a5%e5%bf%97" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>以太坊虚拟机（EVM）用日志Log来存储Solidity事件，每条日志记录都包含主题<code>topics</code>和数据<code>data</code>两部分。</p>
<p><img loading="lazy" src='/posts/202508-solidity101/image.png' alt="alt text" height="585" width="1920"></p>
<h3 id="主题-topics" class="heading-element"><span>主题 topics</span>
  <a href="#%e4%b8%bb%e9%a2%98-topics" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>日志的第一部分是主题数组，用于描述事件，长度不能超过4。它的第一个元素是事件的签名（哈希）。对于上面的Transfer事件，它的事件哈希就是：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">keccak256</span><span class="p">(</span><span class="s2">&#34;Transfer(address,address,uint256)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef
</span></span></span></code></pre></div><p><code>indexed</code>标记的参数可以理解为检索事件的索引“键”，方便之后搜索。每个 <code>indexed </code>参数的大小为固定的256比特，如果参数太大了（比如字符串），就会自动计算哈希存储在主题中。</p>
<h3 id="数据-data" class="heading-element"><span>数据 data</span>
  <a href="#%e6%95%b0%e6%8d%ae-data" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>事件中不带 <code>indexed</code> 的参数会被存储在 <code>data</code> 部分中，可以理解为事件的“值”。<code>data</code> 部分的变量不能被直接检索，但可以存储任意大小的数据。因此一般 <code>data</code> 部分可以用来存储复杂的数据结构，例如数组和字符串等等，因为这些数据超过了256比特，即使存储在事件的 <code>topics</code> 部分中，也是以哈希的方式存储。另外，<code>data</code> 部分的变量在存储上消耗的gas相比于 <code>topics</code> 更少。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: MIT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">FunctionTypes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mapping</span> <span class="p">(</span> <span class="nx">address</span> <span class="p">=&gt;</span> <span class="nx">uint256</span> <span class="p">)</span> <span class="kr">private</span> <span class="nx">_balances</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="nx">Transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 定义_transfer函数，执行转账逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">_transfer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">address</span> <span class="nx">from</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">uint256</span> <span class="nx">amount</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="nx">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">_balances</span><span class="p">[</span><span class="nx">from</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">_balances</span><span class="p">[</span><span class="nx">from</span><span class="p">]</span> <span class="o">-=</span>  <span class="nx">amount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">_balances</span><span class="p">[</span><span class="nx">to</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 释放事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">emit</span> <span class="nx">Transfer</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>部署后可以看到日志：</p>
<p>其中from式产生日志的合约地址，topic是事件签名(哈希)，args部分是事件参数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;from&#34;</span><span class="p">:</span> <span class="s2">&#34;0xd9145CCE52D386f254917e481eB44e9943F39138&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;topic&#34;</span><span class="p">:</span> <span class="s2">&#34;0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;event&#34;</span><span class="p">:</span> <span class="s2">&#34;Transfer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&#34;0&#34;</span><span class="p">:</span> <span class="s2">&#34;0x5B38Da6a701c568545dCfcB03FcB875f56beddC4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&#34;1&#34;</span><span class="p">:</span> <span class="s2">&#34;0x1111111111111111111111111111111111111111&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&#34;2&#34;</span><span class="p">:</span> <span class="s2">&#34;100&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span></span></span></code></pre></div><h2 id="继承-inheritance" class="heading-element"><span>继承 inheritance</span>
  <a href="#%e7%bb%a7%e6%89%bf-inheritance" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>包括简单继承，多重继承，以及修饰器（Modifier）和构造函数（Constructor）的继承。</p>
<h2 id="规则" class="heading-element"><span>规则</span>
  <a href="#%e8%a7%84%e5%88%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><code>virtual</code>: 父合约中的函数，如果希望子合约重写，需要加上<code>virtual</code>关键字。</li>
<li><code>override</code>：子合约重写了父合约中的函数，需要加上<code>override</code>关键字。</li>
</ul>
<h2 id="简单继承" class="heading-element"><span>简单继承</span>
  <a href="#%e7%ae%80%e5%8d%95%e7%bb%a7%e6%89%bf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Yeye</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="nx">Log</span><span class="p">(</span><span class="nx">string</span> <span class="nx">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 定义3个function: hip(), pop(), yeye()，Log值为Yeye。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">hip</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Yeye&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">pop</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Yeye&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">yeye</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Yeye&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>在写一个继承Yeye合约：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Baba</span> <span class="nx">is</span> <span class="nx">Yeye</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 继承两个function: hip()和pop()，输出改为Baba。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">hip</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Baba&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">pop</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Baba&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">baba</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Baba&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="多重继承" class="heading-element"><span>多重继承</span>
  <a href="#%e5%a4%9a%e9%87%8d%e7%bb%a7%e6%89%bf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>
<p>继承时要按辈分最高到最低的顺序排。比如写一个<code>Erzi</code>合约，继承<code>Yeye合约</code>和<code>Baba</code>合约，那么就要写成<code>contract Erzi is Yeye, Baba</code>，而不能写成<code>contract Erzi is Baba, Yeye</code>，不然就会报错。</p>
</li>
<li>
<p>如果某一个函数在多个继承的合约里都存在，比如例子中的<code>hip()</code>和<code>pop()</code>，在子合约里必须重写，不然会报错。</p>
</li>
<li>
<p>重写在多个父合约中都重名的函数时，<code>override</code>关键字后面要加上所有父合约名字，例如<code>override(Yeye, Baba)</code>。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Erzi</span> <span class="nx">is</span> <span class="nx">Yeye</span><span class="p">,</span> <span class="nx">Baba</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 继承两个function: hip()和pop()，输出值为Erzi。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">hip</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span><span class="p">(</span><span class="nx">Yeye</span><span class="p">,</span> <span class="nx">Baba</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Erzi&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">pop</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span><span class="p">(</span><span class="nx">Yeye</span><span class="p">,</span> <span class="nx">Baba</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Erzi&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="修饰器的继承" class="heading-element"><span>修饰器的继承</span>
  <a href="#%e4%bf%ae%e9%a5%b0%e5%99%a8%e7%9a%84%e7%bb%a7%e6%89%bf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Solidity中的修饰器（Modifier）同样可以继承，用法与函数继承类似，在相应的地方加<code>virtual</code>和<code>override</code>关键字即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Base1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">modifier</span> <span class="nx">exactDividedBy2And3</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_a</span><span class="p">)</span> <span class="nx">virtual</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">require</span><span class="p">(</span><span class="nx">_a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">_a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Identifier</span> <span class="nx">is</span> <span class="nx">Base1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//计算一个数分别被2除和被3除的值，但是传入的参数必须是2和3的倍数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">getExactDividedBy2And3</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_dividend</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">exactDividedBy2And3</span><span class="p">(</span><span class="nx">_dividend</span><span class="p">)</span> <span class="nx">pure</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint</span><span class="p">,</span> <span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">getExactDividedBy2And3WithoutModifier</span><span class="p">(</span><span class="nx">_dividend</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//计算一个数分别被2除和被3除的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">getExactDividedBy2And3WithoutModifier</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_dividend</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint</span><span class="p">,</span> <span class="nx">uint</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">uint</span> <span class="nx">div2</span> <span class="o">=</span> <span class="nx">_dividend</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">uint</span> <span class="nx">div3</span> <span class="o">=</span> <span class="nx">_dividend</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nx">div2</span><span class="p">,</span> <span class="nx">div3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="构造函数的继承" class="heading-element"><span>构造函数的继承</span>
  <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e7%9a%84%e7%bb%a7%e6%89%bf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>子合约有两种方法继承父合约的构造函数。举个简单的例子，父合约A里面有一个状态变量a，并由构造函数的参数来确定：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 构造函数的继承
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">abstract</span> <span class="nx">contract</span> <span class="nx">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">constructor</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_a</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">a</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><ol>
<li>在继承时声明父构造函数的参数，例如：<code>contract B is A(1)</code></li>
<li>在子合约的构造函数中声明构造函数的参数，例如：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">C</span> <span class="nx">is</span> <span class="nx">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">constructor</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_c</span><span class="p">)</span> <span class="nx">A</span><span class="p">(</span><span class="nx">_c</span> <span class="o">*</span> <span class="nx">_c</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="调用父合约的函数" class="heading-element"><span>调用父合约的函数</span>
  <a href="#%e8%b0%83%e7%94%a8%e7%88%b6%e5%90%88%e7%ba%a6%e7%9a%84%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>有两种：</p>
<ol>
<li>直接调用：<code>父合约名.函数名()</code></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">callParent</span><span class="p">()</span> <span class="kr">public</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Yeye</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><ol start="2">
<li>使用super关键字：子合约可以利用<code>super.函数名()</code>来调用最近的父合约函数。</li>
</ol>
<p>Solidity继承关系按声明时<code>从右到左</code>的顺序是：<code>contract Erzi is Yeye, Baba</code>，那么Baba是最近的父合约，super.pop()将调用Baba.pop()而不是Yeye.pop()：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">callParentSuper</span><span class="p">()</span> <span class="kr">public</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 将调用最近的父合约函数，Baba.pop()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">super</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="菱形继承" class="heading-element"><span>菱形继承</span>
  <a href="#%e8%8f%b1%e5%bd%a2%e7%bb%a7%e6%89%bf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在多重+菱形继承链条上使用<code>super</code>关键字时，需要注意的是使用<code>super</code>会调用继承链条上的每一个合约的相关函数，而不是只调用最近的父合约。</p>
<p>在下面的例子中，调用合约<code>people</code>中的<code>super.bar()</code>会依次调用<code>Eve</code>、<code>Adam</code>，最后是<code>God</code>合约</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: MIT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* 继承树：
</span></span></span><span class="line"><span class="cl"><span class="cm">  God
</span></span></span><span class="line"><span class="cl"><span class="cm"> /  \
</span></span></span><span class="line"><span class="cl"><span class="cm">Adam Eve
</span></span></span><span class="line"><span class="cl"><span class="cm"> \  /
</span></span></span><span class="line"><span class="cl"><span class="cm">people
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">God</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="nx">Log</span><span class="p">(</span><span class="nx">string</span> <span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;God.foo called&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;God.bar called&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Adam</span> <span class="nx">is</span> <span class="nx">God</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Adam.foo called&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">super</span><span class="p">.</span><span class="nx">foo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Adam.bar called&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">super</span><span class="p">.</span><span class="nx">bar</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">Eve</span> <span class="nx">is</span> <span class="nx">God</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Eve.foo called&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">super</span><span class="p">.</span><span class="nx">foo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">emit</span> <span class="nx">Log</span><span class="p">(</span><span class="s2">&#34;Eve.bar called&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">super</span><span class="p">.</span><span class="nx">bar</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">people</span> <span class="nx">is</span> <span class="nx">Adam</span><span class="p">,</span> <span class="nx">Eve</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">override</span><span class="p">(</span><span class="nx">Adam</span><span class="p">,</span> <span class="nx">Eve</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">super</span><span class="p">.</span><span class="nx">foo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">override</span><span class="p">(</span><span class="nx">Adam</span><span class="p">,</span> <span class="nx">Eve</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">super</span><span class="p">.</span><span class="nx">bar</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="抽象合约和接口" class="heading-element"><span>抽象合约和接口</span>
  <a href="#%e6%8a%bd%e8%b1%a1%e5%90%88%e7%ba%a6%e5%92%8c%e6%8e%a5%e5%8f%a3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>这里使用<code>ERC721</code>的接口合约为例介绍Solidity中的<code>抽象合约（abstract）</code>和<code>接口（interface）</code></p>
<h2 id="抽象合约" class="heading-element"><span>抽象合约</span>
  <a href="#%e6%8a%bd%e8%b1%a1%e5%90%88%e7%ba%a6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>如果一个智能合约里至少有一个未实现的函数，即某个函数缺少主体{}中的内容，则必须将该合约标为abstract，不然编译会报错；另外，未实现的函数需要加virtual，以便子合约重写。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">abstract</span> <span class="nx">contract</span> <span class="nx">InsertionSort</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">insertionSort</span><span class="p">(</span><span class="nx">uint</span><span class="p">[]</span> <span class="nx">memory</span> <span class="nx">a</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">virtual</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">uint</span><span class="p">[]</span> <span class="nx">memory</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="接口" class="heading-element"><span>接口</span>
  <a href="#%e6%8e%a5%e5%8f%a3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>接口类似于抽象合约，但不实现任何功能。</p>
<ul>
<li><strong>接口的规则</strong>：
<ul>
<li>不能包含状态变量</li>
<li>不能包含构造函数</li>
<li>不能继承除接口外的其他合约</li>
<li>所有函数都必须是<code>external</code>且不能有函数体</li>
<li>继承接口的非抽象合约必须实现接口定义的所有功能</li>
</ul>
</li>
</ul>
<p>虽然接口不实现任何功能，但它非常重要。接口是智能合约的骨架，定义了合约的功能以及如何触发它们：如果智能合约实现了某种接口（比如ERC20或ERC721），其他Dapps和智能合约就知道如何与它交互。因为接口提供了两个重要的信息：</p>
<ol>
<li>合约里每个函数的bytes4选择器，以及函数签名函数名(每个参数类型）。</li>
<li>接口id（更多信息见EIP165）</li>
</ol>
<p>另外，接口与合约ABI（Application Binary Interface）等价，可以相互转换：编译接口可以得到合约的ABI，利用abi-to-sol工具，也可以将ABI json文件转换为接口sol文件。</p>
<p>以ERC721接口合约IERC721为例，它定义了3个event和9个function，所有ERC721标准的NFT都实现了这些函数。我们可以看到，接口和常规合约的区别在于每个函数都以;代替函数体{ }结尾。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">IERC721</span> <span class="nx">is</span> <span class="nx">IERC165</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="nx">Transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">indexed</span> <span class="nx">tokenId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="nx">Approval</span><span class="p">(</span><span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">approved</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">indexed</span> <span class="nx">tokenId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">event</span> <span class="nx">ApprovalForAll</span><span class="p">(</span><span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">indexed</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">approved</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span> <span class="nx">owner</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint256</span> <span class="nx">balance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">ownerOf</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">address</span> <span class="nx">owner</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">safeTransferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">transferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">approve</span><span class="p">(</span><span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">getApproved</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">address</span> <span class="nx">operator</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">setApprovalForAll</span><span class="p">(</span><span class="nx">address</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">_approved</span><span class="p">)</span> <span class="nx">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">isApprovedForAll</span><span class="p">(</span><span class="nx">address</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">operator</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">safeTransferFrom</span><span class="p">(</span> <span class="nx">address</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">calldata</span> <span class="nx">data</span><span class="p">)</span> <span class="nx">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>IERC721事件：</p>
<ul>
<li><code>Transfer</code>事件：在转账时被释放，记录代币的发出地址from，接收地址to和tokenId。</li>
<li><code>Approval</code>事件：在授权时被释放，记录授权地址owner，被授权地址approved和tokenId。</li>
<li><code>ApprovalForAll</code>事件：在批量授权时被释放，记录批量授权的发出地址owner，被授权地址operator和授权与否的approved。</li>
</ul>
<p>IERC721函数:</p>
<ul>
<li><code>balanceOf</code>：返回某地址的NFT持有量balance。</li>
<li><code>ownerOf</code>：返回某tokenId的主人owner。</li>
<li><code>transferFrom</code>：普通转账，参数为转出地址from，接收地址to和tokenId。</li>
<li><code>safeTransferFrom</code>：安全转账（如果接收方是合约地址，会要求实现ERC721Receiver接口）。参数为转出地址from，接收地址to和tokenId。</li>
<li><code>approve</code>：授权另一个地址使用你的NFT。参数为被授权地址approve和tokenId。</li>
<li><code>getApproved</code>：查询tokenId被批准给了哪个地址。</li>
<li><code>setApprovalForAll</code>：将自己持有的该系列NFT批量授权给某个地址operator。</li>
<li><code>isApprovedForAll</code>：查询某地址的NFT是否批量授权给了另一个operator地址。</li>
<li><code>safeTransferFrom</code>：安全转账的重载函数，参数里面包含了data。</li>
</ul>
<h2 id="什么时候使用接口" class="heading-element"><span>什么时候使用接口？</span>
  <a href="#%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e4%bd%bf%e7%94%a8%e6%8e%a5%e5%8f%a3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>如果我们知道一个合约实现了IERC721接口，我们不需要知道它具体代码实现，就可以与它交互。</p>
<p>无聊猿<code>BAYC</code>属于<code>ERC721</code>代币，实现了<code>IERC721</code>接口的功能。我们不需要知道它的源代码，只需知道它的合约地址，用<code>IERC721</code>接口就可以与它交互，比如用<code>balanceOf()</code>来查询某个地址的<code>BAYC</code>余额，用<code>safeTransferFrom()</code>来转账BAYC。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">contract</span> <span class="nx">interactBAYC</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 利用BAYC地址创建接口合约变量（ETH主网）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">IERC721</span> <span class="nx">BAYC</span> <span class="o">=</span> <span class="nx">IERC721</span><span class="p">(</span><span class="mh">0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 通过接口调用BAYC的balanceOf()查询持仓量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">balanceOfBAYC</span><span class="p">(</span><span class="nx">address</span> <span class="nx">owner</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint256</span> <span class="nx">balance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">BAYC</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 通过接口调用BAYC的safeTransferFrom()安全转账
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">safeTransferFromBAYC</span><span class="p">(</span><span class="nx">address</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">external</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">BAYC</span><span class="p">.</span><span class="nx">safeTransferFrom</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="异常" class="heading-element"><span>异常</span>
  <a href="#%e5%bc%82%e5%b8%b8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>三种抛出异常的方法：<code>error</code>，<code>require</code>和<code>assert</code></p>
<p><code>error方</code>法gas最少，其次是<code>assert</code>，<code>require</code>方法消耗gas最多。</p>
<h2 id="error-异常" class="heading-element"><span>error 异常</span>
  <a href="#error-%e5%bc%82%e5%b8%b8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>error 异常方便且高效（省gas）。同时还可以在抛出异常的同时携带参数，帮助开发者更好地调试。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">error</span> <span class="nx">TransferNotOwner</span><span class="p">();</span> <span class="c1">// 自定义error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">error</span> <span class="nx">TransferNotOwner</span><span class="p">(</span><span class="nx">address</span> <span class="nx">sender</span><span class="p">);</span> <span class="c1">// 自定义的带参数的error
</span></span></span></code></pre></div><p>在执行当中，<code>error</code>必须搭配<code>revert（回退）</code>命令使用。</p>
<p>定义了一个<code>transferOwner1()</code>函数，它会检查代币的<code>owner</code>是不是发起人，如果不是，就会抛出<code>TransferNotOwner</code>异常；如果是的话，就会转账。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">transferOwner1</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">newOwner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">_owners</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">revert</span> <span class="nx">TransferNotOwner</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// revert TransferNotOwner(msg.sender);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_owners</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newOwner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="require-异常" class="heading-element"><span>require 异常</span>
  <a href="#require-%e5%bc%82%e5%b8%b8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>唯一的缺点就是gas随着描述异常的字符串长度增加，比error命令要高。使用方法：<code>require(检查条件，&quot;异常的描述&quot;)</code>，当检查条件不成立的时候，就会抛出异常。</p>
<p>使用require重写上面的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">transferOwner2</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">newOwner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">require</span><span class="p">(</span><span class="nx">_owners</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">==</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="s2">&#34;Transfer Not Owner&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_owners</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newOwner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="assert-异常" class="heading-element"><span>assert 异常</span>
  <a href="#assert-%e5%bc%82%e5%b8%b8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><code>assert</code>命令一般用于程序员写程序debug，因为它不能解释抛出异常的原因（比require少个字符串）。它的用法很简单，<code>assert(检查条件）</code>，当检查条件不成立的时候，就会抛出异常。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">transferOwner3</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">newOwner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">assert</span><span class="p">(</span><span class="nx">_owners</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">==</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_owners</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newOwner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2025-08-01 00:00:00">Updated on 2025-08-01&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Share on X" data-sharer="twitter" data-url="https://nesl42.github.io/posts/202508-solidity101/" data-title="Solidity 101" data-hashtags="Web3"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://nesl42.github.io/posts/202508-solidity101/" data-hashtag="Web3"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://nesl42.github.io/posts/202508-solidity101/" data-title="Solidity 101"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/web3/" class="post-tag" title="Tags - Web3">Web3</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/202507-alphagopaperread/" class="post-nav-item" rel="prev" title="论文阅读 AlphaGo Moment for Model Architecture Discovery"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>论文阅读 AlphaGo Moment for Model Architecture Discovery</a><a href="/posts/top%E8%AE%B0%E5%BD%95/" class="post-nav-item" rel="next" title="碎碎存">碎碎存<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.145.0"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.17-8212d6fd"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="preload" href="/lib/katex/katex.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"version":"v0.3.17-8212d6fd"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
