<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Web3 - 标签 - 敬渊&#39;s Blog</title>
    <link>http://localhost:1313/tags/web3/</link>
    <description>敬渊&#39;s Blog</description>
    <generator>Hugo 0.154.5 &amp; FixIt v0.4.3-20260123080729-2a5bd268</generator>
    <language>zh-CN</language>
    <lastBuildDate>Thu, 18 Sep 2025 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/web3/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>以太坊 PoS 共识机制与 Engine API 源码阅读</title>
      <link>http://localhost:1313/posts/202509-ethpos/</link>
      <pubDate>Thu, 18 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-ethpos/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;1-理论基础&#34;&gt;&lt;span&gt;1. 理论基础&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e7%90%86%e8%ae%ba%e5%9f%ba%e7%a1%80&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;11-以太坊共识机制的历史演进&#34;&gt;&lt;span&gt;1.1 以太坊共识机制的历史演进&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-%e4%bb%a5%e5%a4%aa%e5%9d%8a%e5%85%b1%e8%af%86%e6%9c%ba%e5%88%b6%e7%9a%84%e5%8e%86%e5%8f%b2%e6%bc%94%e8%bf%9b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;1. 历史背景：工作量证明 (Proof-of-Work) 时代&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>以太坊之详解默克尔压缩前缀树</title>
      <link>http://localhost:1313/posts/202509-ethmpt/</link>
      <pubDate>Wed, 17 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-ethmpt/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;1-基础数据结构&#34;&gt;&lt;span&gt;1. 基础数据结构&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e5%9f%ba%e7%a1%80%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;在深入以太坊状态树的实现之前，有必要先理解其底层数据结构：&lt;strong&gt;Merkle Patricia Trie（MPT）&lt;/strong&gt; —— 一种结合了&lt;strong&gt;前缀树（Trie）&lt;/strong&gt;、&lt;strong&gt;压缩前缀树（Patricia Trie）&lt;/strong&gt; 和&lt;strong&gt;默克尔树（Merkle Tree）&lt;/strong&gt; 特性的混合结构。它不仅是高效键值存储的载体，也是以太坊实现“状态可验证性”和“轻节点同步”的核心。&lt;/p&gt;</description>
    </item>
    <item>
      <title>以太坊详解之交易池</title>
      <link>http://localhost:1313/posts/202509-ethpool/</link>
      <pubDate>Sun, 14 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-ethpool/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;交易池&#34;&gt;&lt;span&gt;交易池&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e4%ba%a4%e6%98%93%e6%b1%a0&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;架构设计&#34;&gt;&lt;span&gt;架构设计&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;1交易处理流程&#34;&gt;&lt;span&gt;1.交易处理流程&lt;/span&gt;&#xA;  &lt;a href=&#34;#1%e4%ba%a4%e6%98%93%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;下图是一笔交易从出生到交易进入区块的主要流程：&lt;/p&gt;</description>
    </item>
    <item>
      <title>以太坊-基础数据结构解析</title>
      <link>http://localhost:1313/posts/202509-ethbasestruct/</link>
      <pubDate>Wed, 10 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-ethbasestruct/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;以太坊基础配置&#34;&gt;&lt;span&gt;以太坊基础配置&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e4%bb%a5%e5%a4%aa%e5%9d%8a%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;以太坊的基础配置用于服务于链，启动以太坊节点，则需要将链配置载入&lt;/p&gt;</description>
    </item>
    <item>
      <title>量化可视化指南揭秘：大型语言模型的压缩</title>
      <link>http://localhost:1313/posts/202509-llmquart/</link>
      <pubDate>Sat, 06 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-llmquart/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;量化技术图解指南&#34;&gt;&lt;span&gt;量化技术图解指南&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%87%8f%e5%8c%96%e6%8a%80%e6%9c%af%e5%9b%be%e8%a7%a3%e6%8c%87%e5%8d%97&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;深入浅出揭秘大语言模型的压缩之道&#34;&gt;&lt;span&gt;深入浅出，揭秘大语言模型的压缩之道&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%b7%b1%e5%85%a5%e6%b5%85%e5%87%ba%e6%8f%ad%e7%a7%98%e5%a4%a7%e8%af%ad%e8%a8%80%e6%a8%a1%e5%9e%8b%e7%9a%84%e5%8e%8b%e7%bc%a9%e4%b9%8b%e9%81%93&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;hr&gt;&#xA;&lt;p&gt;所谓大语言模型（LLM），“大”是其最显著的特征之一。这不仅体现在它们能够处理海量信息，更直接地体现在其庞大的体积上。这些模型动辄拥有数十亿的参数，通常需要配备大显存的顶级 GPU 才能流畅运行，这无疑将许多普通用户和开发者拒之门外。&lt;/p&gt;</description>
    </item>
    <item>
      <title>02.Uniswap V2 swap 操作</title>
      <link>http://localhost:1313/posts/202509-uniswap02/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap02/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;p&gt;&lt;strong&gt;这份学习笔记将Uniswap V2的swap操作进行了深入剖析，涵盖了其核心机制、数学原理和代码实现，以及手续费的计算方式。&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V2 架构与路由灵活性&lt;/strong&gt;：V2引入了任何ERC20代币之间直接交换的能力，不再强制通过ETH作为中介。用户通过&lt;code&gt;UniswapV2Router02&lt;/code&gt;合约进行交互，该合约负责寻找并协调&lt;code&gt;UniswapV2Pair&lt;/code&gt;合约完成交易，支持单跳和多跳（多级路由）交换。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;两种核心交换类型&lt;/strong&gt;：V2提供了两种主要的&lt;code&gt;swap&lt;/code&gt;函数：&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;code&gt;swapExactTokensForTokens&lt;/code&gt;：用户指定&lt;strong&gt;精确的输入代币数量&lt;/strong&gt;，系统计算并返回尽可能多的输出代币。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;swapTokensForExactTokens&lt;/code&gt;：用户指定&lt;strong&gt;精确的输出代币数量&lt;/strong&gt;，系统计算所需的最小输入代币数量。&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;0.3%固定手续费机制&lt;/strong&gt;：每次&lt;code&gt;swap&lt;/code&gt;操作都会对&lt;strong&gt;输入代币&lt;/strong&gt;收取0.3%（千分之三）的手续费。这意味着实际用于AMM计算的输入量是用户提供量的99.7%。多跳交易会累积手续费。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;数学原理与代码实现&lt;/strong&gt;：&lt;code&gt;UniswapV2Library&lt;/code&gt;中的&lt;code&gt;getAmountOut&lt;/code&gt;和&lt;code&gt;getAmountIn&lt;/code&gt;函数是核心计算逻辑，它们基于恒定乘积做市商（AMM）公式，并融入了0.3%的手续费计算，确保了交易的准确性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;滑点与MEV攻击&lt;/strong&gt;：用户可以通过设置&lt;code&gt;amountOutMin&lt;/code&gt;（最小输出量）来控制滑点。然而，这种机制也可能被MEV（矿工可提取价值）套利者利用，通过三明治攻击（Front-running + Back-running）来捕获用户设定的最小输出与实际可能输出之间的差价。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;1-uniswap-v2-核心架构与合约&#34;&gt;&lt;span&gt;1. Uniswap V2 核心架构与合约&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-uniswap-v2-%e6%a0%b8%e5%bf%83%e6%9e%b6%e6%9e%84%e4%b8%8e%e5%90%88%e7%ba%a6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;Uniswap V2 的代码主要存在于两个仓库：&lt;/p&gt;</description>
    </item>
    <item>
      <title>03.Uniswap V2 手续费机制</title>
      <link>http://localhost:1313/posts/202509-uniswap03/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap03/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性增长&lt;/strong&gt;：Uniswap V2 的千三（0.3%）交易手续费会直接重新注入到流动性池中，导致池子中的资产（X和Y）缓慢增长，进而使总流动性 &lt;code&gt;K&lt;/code&gt; 值不断增大。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;LP 收益机制&lt;/strong&gt;：流动性提供者（LP）通过持有 &lt;strong&gt;LP Token (Share)&lt;/strong&gt; 来证明其在池中的份额。当池子总流动性 &lt;code&gt;K&lt;/code&gt; 增长时，LP Token 的总份额不变，因此每个 LP Token 所代表的实际资产价值会提升，LP 在撤出流动性时能获得更多资产。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;协议手续费 (PROTOCOL_FEE)&lt;/strong&gt;：Uniswap V2 设计了一种机制，允许协议开发者收取一部分手续费（例如千三的 1/6，即万分之五）。这通过&lt;strong&gt;增发新的 LP Token (Share)&lt;/strong&gt; 给协议方来实现，从而让协议方在不提供流动性的前提下，分享流动性增长带来的收益。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;链上状态&lt;/strong&gt;：尽管 Uniswap V2 设计了协议手续费机制，但目前该功能并未在主网上开启。通过检查 &lt;code&gt;UniswapV2Factory&lt;/code&gt; 合约的 &lt;code&gt;feeTo&lt;/code&gt; 地址是否为零，可以验证其开启状态。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;1-uniswap-v2-手续费机制概览&#34;&gt;&lt;span&gt;1. Uniswap V2 手续费机制概览&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-uniswap-v2-%e6%89%8b%e7%bb%ad%e8%b4%b9%e6%9c%ba%e5%88%b6%e6%a6%82%e8%a7%88&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;11-基础概念流动性与-lp-token&#34;&gt;&lt;span&gt;1.1 基础概念：流动性与 LP Token&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5%e6%b5%81%e5%8a%a8%e6%80%a7%e4%b8%8e-lp-token&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;恒定乘积做市商 (CPMM)&lt;/strong&gt;：Uniswap V2 基于 &lt;code&gt;X * Y = K&lt;/code&gt; 的公式进行资产交换，其中 &lt;code&gt;X&lt;/code&gt; 和 &lt;code&gt;Y&lt;/code&gt; 分别代表池中两种资产的数量，&lt;code&gt;K&lt;/code&gt; 是一个常数（在无手续费和无流动性增减的情况下）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性 (L)&lt;/strong&gt;：在 Uniswap V2 中，流动性 &lt;code&gt;L&lt;/code&gt; 通常指 &lt;code&gt;sqrt(K)&lt;/code&gt;。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;公式：$L = \sqrt{K}$&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;LP Token (Share / LPT)&lt;/strong&gt;：当用户向 Uniswap 池中提供流动性时，会获得相应数量的 LP Token 作为凭证。这些 Token 代表了用户在池中的份额。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;S1&lt;/code&gt;：在 &lt;code&gt;T1&lt;/code&gt; 时刻，LP Token 的总数量。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;12-千三手续费-03&#34;&gt;&lt;span&gt;1.2 千三手续费 (0.3%)&lt;/span&gt;&#xA;  &lt;a href=&#34;#12-%e5%8d%83%e4%b8%89%e6%89%8b%e7%bb%ad%e8%b4%b9-03&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;收取方式&lt;/strong&gt;：每笔交易都会收取 0.3% 的手续费。这笔费用并不是直接从交易对的另一方扣除，而是从&lt;strong&gt;进入池子的 Token&lt;/strong&gt; 中扣除。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;例如，用户用 &lt;code&gt;DX&lt;/code&gt; 数量的 X 资产购买 Y 资产，池子实际上只收到 &lt;code&gt;(1 - 0.003) * DX = 0.997 * DX&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;归属&lt;/strong&gt;：这 0.3% 的手续费&lt;strong&gt;直接重新注入到流动性池中&lt;/strong&gt;，而非直接分配给某个用户或地址。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;2-流动性增长的逻辑&#34;&gt;&lt;span&gt;2. 流动性增长的逻辑&lt;/span&gt;&#xA;  &lt;a href=&#34;#2-%e6%b5%81%e5%8a%a8%e6%80%a7%e5%a2%9e%e9%95%bf%e7%9a%84%e9%80%bb%e8%be%91&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;21-为什么流动性会增长-k2--k1&#34;&gt;&lt;span&gt;2.1 为什么流动性会增长 (K2 &amp;gt; K1)？&lt;/span&gt;&#xA;  &lt;a href=&#34;#21-%e4%b8%ba%e4%bb%80%e4%b9%88%e6%b5%81%e5%8a%a8%e6%80%a7%e4%bc%9a%e5%a2%9e%e9%95%bf-k2--k1&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;手续费的积累&lt;/strong&gt;：由于 0.3% 的手续费被重新注入到池子中，池子里的 &lt;code&gt;X&lt;/code&gt; 和 &lt;code&gt;Y&lt;/code&gt; 资产总量会随着交易量的增加而缓慢增长。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;如果用 &lt;code&gt;DX&lt;/code&gt; 购买 Y，池子收到 &lt;code&gt;0.997 * DX&lt;/code&gt;。这 &lt;code&gt;0.997 * DX&lt;/code&gt; 增加了池子里的 X 资产。&lt;/li&gt;&#xA;&lt;li&gt;如果用 &lt;code&gt;DY&lt;/code&gt; 购买 X，池子收到 &lt;code&gt;0.997 * DY&lt;/code&gt;。这 &lt;code&gt;0.997 * DY&lt;/code&gt; 增加了池子里的 Y 资产。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;结果&lt;/strong&gt;：只要有交易发生，池子中的 &lt;code&gt;X&lt;/code&gt; 和 &lt;code&gt;Y&lt;/code&gt; 资产总量就会增加，从而导致 &lt;code&gt;K&lt;/code&gt; 值（即 &lt;code&gt;X * Y&lt;/code&gt;）不断增大。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;$K_2 &amp;gt; K_1$ (在不考虑流动性增减的情况下)。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;22-案例分析daiusdt-池子&#34;&gt;&lt;span&gt;2.2 案例分析：DAI/USDT 池子&lt;/span&gt;&#xA;  &lt;a href=&#34;#22-%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90daiusdt-%e6%b1%a0%e5%ad%90&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;为了更好地理解流动性增长和套利机制，我们以 DAI/USDT 稳定币交易对为例：&lt;/p&gt;</description>
    </item>
    <item>
      <title>04.Uniswap V2 添加移除流动性</title>
      <link>http://localhost:1313/posts/202509-uniswap04/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap04/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心公式与流动性衡量：&lt;/strong&gt; Uniswap V2 的流动性池基于 $X \times Y = K$ 恒定乘积公式，其中 $L = \sqrt{K}$ 被用作衡量流动性大小的线性指标，便于 LP Token (LPT) 的线性增发与销毁。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格不变性约束：&lt;/strong&gt; 无论是添加还是移除流动性，操作前后池内两种代币的价格比（即兑换价格）必须保持不变，这是确保用户按当前市场价提供或撤出流动性的核心原则。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;LPT 增发/销毁机制：&lt;/strong&gt; 添加流动性时，新铸造的 LP Token 数量与新增流动性占总流动性的比例成正比；移除流动性时，用户收回的代币数量也与销毁的 LP Token 占总 LP Token 的比例成正比。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V2 合约架构：&lt;/strong&gt; 核心交互涉及 &lt;strong&gt;路由合约 (Router)&lt;/strong&gt;、&lt;strong&gt;工厂合约 (Factory)&lt;/strong&gt; 和 &lt;strong&gt;交易对合约 (Pair)&lt;/strong&gt;。路由合约是用户入口，工厂合约负责创建交易对，交易对合约管理实际的流动性池和代币交换。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;关键工程实现：&lt;/strong&gt; 智能合约实现中包含多项精巧设计，如使用 &lt;code&gt;create2&lt;/code&gt; 预测交易对地址、对代币地址进行排序以确保交易对的唯一性、以及设置 &lt;code&gt;minimum liquidity&lt;/code&gt; 机制以增强安全性和稳定性。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;uniswap-v2-流动性管理概述&#34;&gt;&lt;span&gt;Uniswap V2 流动性管理概述&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-v2-%e6%b5%81%e5%8a%a8%e6%80%a7%e7%ae%a1%e7%90%86%e6%a6%82%e8%bf%b0&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;本节课主要围绕 Uniswap V2 中的&lt;strong&gt;添加流动性&lt;/strong&gt;、&lt;strong&gt;移除流动性&lt;/strong&gt;和&lt;strong&gt;无常损失&lt;/strong&gt;（本节课不深入讲解）三个核心概念。目标是清晰梳理前两个概念的数学原理和合约实现流程。&lt;/p&gt;</description>
    </item>
    <item>
      <title>05.Uniswap V2 无常损失</title>
      <link>http://localhost:1313/posts/202509-uniswap05/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap05/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;uniswap-v2-无常损失深度解析&#34;&gt;&lt;span&gt;Uniswap V2 无常损失深度解析&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-v2-%e6%97%a0%e5%b8%b8%e6%8d%9f%e5%a4%b1%e6%b7%b1%e5%ba%a6%e8%a7%a3%e6%9e%90&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;无常损失 (Impermanent Loss)&lt;/strong&gt; 是指在去中心化交易所（DEX）中提供流动性（LP）的资产价值，与仅仅持有这些资产（HODL）相比所产生的价值差异。&lt;/li&gt;&#xA;&lt;li&gt;其核心特征可以总结为一句口诀：&lt;strong&gt;“涨价少赚钱，降价多亏钱”&lt;/strong&gt;。无论市场朝哪个方向波动，只要价格发生变化，LP的资产价值增长总会慢于或亏损总会多于单纯持有者。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;手续费的核心作用之一是弥补无常损失&lt;/strong&gt;。DEX 通过向 LP 支付交易手续费，不仅是为了激励用户提供流动性，更是为了补偿他们在价格波动中可能遭受的无常损失。&lt;/li&gt;&#xA;&lt;li&gt;无常损失的大小可以通过一个数学公式量化，它只与&lt;strong&gt;资产的相对价格变化率&lt;/strong&gt;有关，而与流动性池的大小或具体的资产价格无关。&lt;/li&gt;&#xA;&lt;li&gt;在 Uniswap V2 中，价格波动越大，无常损失就越严重。而在 Uniswap V3 中，由于流动性被集中在特定价格区间，无常损失的问题会&lt;strong&gt;更加显著&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;1-什么是无常损失-impermanent-loss&#34;&gt;&lt;span&gt;1. 什么是无常损失 (Impermanent Loss)？&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e4%bb%80%e4%b9%88%e6%98%af%e6%97%a0%e5%b8%b8%e6%8d%9f%e5%a4%b1-impermanent-loss&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;11-核心定义&#34;&gt;&lt;span&gt;1.1 核心定义&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-%e6%a0%b8%e5%bf%83%e5%ae%9a%e4%b9%89&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;无常损失&lt;/strong&gt; (Impermanent Loss, 简称 &lt;strong&gt;IL&lt;/strong&gt;) 是指当您作为&lt;strong&gt;流动性提供者 (LP)&lt;/strong&gt; 将资金存入一个流动性池后，由于池中代币的相对价格发生变化，导致您撤出资金时的总价值&lt;strong&gt;低于&lt;/strong&gt;您从一开始就选择&lt;strong&gt;单纯持有 (HODL)&lt;/strong&gt; 这些代币的价值。&lt;/p&gt;</description>
    </item>
    <item>
      <title>06.Uniswap V2 闪电贷</title>
      <link>http://localhost:1313/posts/202509-uniswap06/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap06/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Flash Swaps (闪电交换)&lt;/strong&gt; 是一种无需任何抵押即可借出资产的机制，但前提是必须在&lt;strong&gt;同一笔区块链交易&lt;/strong&gt;内归还借款本金及相应的手续费。&lt;/li&gt;&#xA;&lt;li&gt;该机制的核心是&lt;strong&gt;原子性 (Atomicity)&lt;/strong&gt;，即整笔复杂操作（借款、执行自定义逻辑、还款）要么全部成功，要么全部失败回滚，从而保证资金池的安全。&lt;/li&gt;&#xA;&lt;li&gt;Flash Swaps 是 &lt;strong&gt;DeFi 可组合性 (Composability)&lt;/strong&gt; 的强大体现，允许开发者像搭乐高一样，在单笔交易中调用多个协议（如 Uniswap, Compound, Aave）来执行复杂的套利或其它金融策略。&lt;/li&gt;&#xA;&lt;li&gt;为了确保协议盈利，用户需要支付一笔手续费。这笔费用的最低标准是借出资产数量的 &lt;code&gt;3/997&lt;/code&gt;，这个数值是通过数学计算确保资金池资产不会减少而得出的。&lt;/li&gt;&#xA;&lt;li&gt;实现 Flash Swap 需要用户编写并部署一个智能合约，该合约必须实现一个特定的回调接口（&lt;code&gt;uniswapV2Call&lt;/code&gt;），Uniswap 的交易对（Pair）合约会通过调用这个接口来执行用户的自定义逻辑。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-flash-swaps-核心概念&#34;&gt;&lt;span&gt;&lt;strong&gt;1. Flash Swaps 核心概念&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-flash-swaps-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Flash Swaps&lt;/strong&gt;，也常被称为&lt;strong&gt;闪电贷 (Flash Loan)&lt;/strong&gt;，是 Uniswap V2 引入的一项创新功能。它与普通交易（Swap）的根本区别在于资金的获取和使用方式。&lt;/p&gt;</description>
    </item>
    <item>
      <title>07.Uniswap V2 TWAP</title>
      <link>http://localhost:1313/posts/202509-uniswap07/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap07/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;uniswap-v2-的时间加权平均价格-twap-学习笔记&#34;&gt;&lt;span&gt;Uniswap V2 的时间加权平均价格 (TWAP) 学习笔记&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-v2-%e7%9a%84%e6%97%b6%e9%97%b4%e5%8a%a0%e6%9d%83%e5%b9%b3%e5%9d%87%e4%bb%b7%e6%a0%bc-twap-%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Spot Price (瞬时价格) 的高风险&lt;/strong&gt;: 直接用储备量相除得出的瞬时价格（Spot Price）非常容易受到闪电贷等方式的操控，不适合在实际应用中作为可靠的价格预言机。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;TWAP 的核心思想&lt;/strong&gt;: TWAP (Time-Weighted Average Price) 通过将每个价格与其持续的时间进行加权平均，提供了一个更能抵抗市场瞬时操纵、反映真实市场价格的指标。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;TWAP 的数学原理&lt;/strong&gt;: 其本质是计算“价格-时间”图下的面积（价格与持续时间的乘积累加），再除以总时间长度，从而得到该时间段内的平均价格。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V2 的高效实现&lt;/strong&gt;: 为了避免在链上存储大量历史价格数据和进行高成本的循环计算，Uniswap V2 巧妙地只维护一个&lt;strong&gt;累积价格变量 (Price Cumulative)&lt;/strong&gt;。通过在两个不同时间点读取这个累积值并做差，可以高效地计算出任意时间区间的 TWAP。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;为什么需要-twap-spot-price-的局限性&#34;&gt;&lt;span&gt;为什么需要 TWAP？—— Spot Price 的局限性&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81-twap-spot-price-%e7%9a%84%e5%b1%80%e9%99%90%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;spot-price-瞬时价格-的定义&#34;&gt;&lt;span&gt;Spot Price (瞬时价格) 的定义&lt;/span&gt;&#xA;  &lt;a href=&#34;#spot-price-%e7%9e%ac%e6%97%b6%e4%bb%b7%e6%a0%bc-%e7%9a%84%e5%ae%9a%e4%b9%89&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;Spot Price&lt;/strong&gt; 是指在特定时刻，交易池中两种代币储备量的比率。它反映了当前瞬间的兑换价格。&lt;/p&gt;</description>
    </item>
    <item>
      <title>08.Uniswap V3简介</title>
      <link>http://localhost:1313/posts/202509-uniswap08/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap08/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;解决核心痛点&lt;/strong&gt;：Uniswap V3 的首要目标是解决 V2 版本&lt;strong&gt;资金利用率低下&lt;/strong&gt;的问题。V2 将流动性平均分布在 &lt;code&gt;(0, +∞)&lt;/code&gt; 的价格区间，导致大部分资金在常规价格波动范围之外被闲置。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心创新：集中流动性 (Concentrated Liquidity)&lt;/strong&gt;：V3 允许流动性提供者 (LP) 将资金集中在自定义的&lt;strong&gt;价格区间 &lt;code&gt;[PA, PB]&lt;/code&gt;&lt;/strong&gt; 内。这使得在有限的资本下，可以实现与 V2 庞大资金池相同的交易深度，从而极大地提高了资本效率。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;LP 角色与凭证的转变&lt;/strong&gt;：由于每个 LP 提供的价格区间和资金量都可能不同，其流动性头寸是独一无二的。因此，LP 凭证从 V2 的同质化代币 &lt;strong&gt;ERC-20&lt;/strong&gt; 演变为 V3 的非同质化代币 &lt;strong&gt;ERC-721 (NFT)&lt;/strong&gt;。这也要求 LP 从被动提供者转变为&lt;strong&gt;主动的策略管理者&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;功能与风险的优化&lt;/strong&gt;：集中流动性不仅能带来更高的手续费收益，还能在极端行情下提供更好的&lt;strong&gt;风险控制&lt;/strong&gt;。此外，它还催生了新功能，如通过设置极窄的价格区间来&lt;strong&gt;模拟限价订单 (Range Orders)&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;灵活的手续费机制&lt;/strong&gt;：V3 摒弃了 V2 单一的 0.3% 手续费，引入了基于交易对波动性的&lt;strong&gt;多级费率&lt;/strong&gt;（如 0.01%, 0.05%, 0.3%, 1%），为不同类型的资产（稳定币、主流币等）提供了更合理的定价。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-uniswap-v2-的核心问题资金利用率低下&#34;&gt;&lt;span&gt;&lt;strong&gt;1. Uniswap V2 的核心问题：资金利用率低下&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-uniswap-v2-%e7%9a%84%e6%a0%b8%e5%bf%83%e9%97%ae%e9%a2%98%e8%b5%84%e9%87%91%e5%88%a9%e7%94%a8%e7%8e%87%e4%bd%8e%e4%b8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/posts/202509-uniswap08/v2-swap.webp&#39; alt=&#34;img&#34; height=&#34;964&#34; width=&#34;1226&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>09.Uniswap V3 集中流动性</title>
      <link>http://localhost:1313/posts/202509-uniswap09/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap09/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心问题与解决方案&lt;/strong&gt;：Uniswap V2 的流动性平均分布在 &lt;code&gt;(0, +∞)&lt;/code&gt; 的整个价格区间，导致对价格稳定的资产（如稳定币）或价格波动在可预测范围内的资产，&lt;strong&gt;资本效率极低&lt;/strong&gt;。Uniswap V3 引入&lt;strong&gt;集中流动性&lt;/strong&gt;，允许流动性提供者（LP）将资金集中在自定义的价格区间 &lt;code&gt;[Pa, Pb]&lt;/code&gt; 内，从而极大地提高了资本效率。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;虚拟流动性 (Virtual Liquidity)&lt;/strong&gt;：通过将流动性集中在特定区间，V3 能用较少的&lt;strong&gt;真实资产&lt;/strong&gt;（&lt;code&gt;x_real&lt;/code&gt;, &lt;code&gt;y_real&lt;/code&gt;）创造出等效于 V2 中巨大资金量的&lt;strong&gt;虚拟流动性&lt;/strong&gt;。这个虚拟的 &lt;code&gt;k&lt;/code&gt; 值（流动性深度）在进行交易计算时生效，能为交易者提供更低的&lt;strong&gt;滑点&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格区间与资产构成&lt;/strong&gt;：当市场价格在 LP 设置的 &lt;code&gt;[Pa, Pb]&lt;/code&gt; 区间内波动时，其持有的两种代币会根据交易进行兑换。一旦价格超出这个区间，LP 的全部流动性头寸会自动转换成区间边界上的一种代币（在 &lt;code&gt;Pa&lt;/code&gt; 点全部变为 X 代币，在 &lt;code&gt;Pb&lt;/code&gt; 点全部变为 Y 代币）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格区间的宽度是关键&lt;/strong&gt;：LP 设置的价格区间越窄，资本效率的提升倍数就越高，但也面临着价格更容易偏离区间的风险。反之，区间越宽，其表现越接近于 Uniswap V2，资本效率越低，但管理更省心。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-uniswap-v2-的核心问题资本效率低下&#34;&gt;&lt;span&gt;&lt;strong&gt;1. Uniswap V2 的核心问题：资本效率低下&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-uniswap-v2-%e7%9a%84%e6%a0%b8%e5%bf%83%e9%97%ae%e9%a2%98%e8%b5%84%e6%9c%ac%e6%95%88%e7%8e%87%e4%bd%8e%e4%b8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;Uniswap V2 使用一个非常简洁的恒定乘积做市商（AMM）公式来定义资产池的行为：&#xA;$$&#xA;x \cdot y = k&#xA;$$&#xA;其中 &lt;code&gt;x&lt;/code&gt; 和 &lt;code&gt;y&lt;/code&gt; 是两种代币的数量，&lt;code&gt;k&lt;/code&gt; 是一个常数。池中的瞬时价格 &lt;code&gt;P&lt;/code&gt; 由两种资产的比例决定：&#xA;$$&#xA;P = \frac{y}{x}&#xA;$$&lt;/p&gt;</description>
    </item>
    <item>
      <title>10UniswapV3流动性计算</title>
      <link>http://localhost:1313/posts/202509-uniswap10/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap10/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V3 的核心创新&lt;/strong&gt;：通过引入&lt;strong&gt;价格区间&lt;/strong&gt; $p \in [p_a, p_b]$ 和&lt;strong&gt;虚拟流动性&lt;/strong&gt; ($x_{virtual}$, $y_{virtual}$) 的概念，实现了&lt;strong&gt;集中流动性&lt;/strong&gt;，允许用户将资金集中在特定价格范围，从而极大地提高了资金效率。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;V3 核心公式&lt;/strong&gt;：V3 的流动性计算公式是 V2 中 $x \cdot y = L^2$ 的演进，具体形式为 $$(x_{real} + \frac{L}{\sqrt{p_b}}) \cdot (y_{real} + L\sqrt{p_a}) = L^2$$。这个公式是理解 V3 机制的关键。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;资金效率与价格区间的关系&lt;/strong&gt;：用户设定的价格区间 $[p_a, p_b]$ 越窄（即 $p_a$ 越大，$p_b$ 越小，两者越接近），提供的虚拟流动性就越大。这意味着可以用更少的真实资金（$x_{real}$, $y_{real}$）达到与 V2 相同的流动性深度（&lt;code&gt;L&lt;/code&gt; 值），即资金效率越高。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;模拟限价订单&lt;/strong&gt;：利用价格区间特性，用户可以通过在价格区间的某一端点（如 $p_a$）存入单一资产，当市场价格穿过整个区间到达另一端点（$p_b$）时，该资产会被完全兑换成另一种资产，从而实现类似&lt;strong&gt;限价订单&lt;/strong&gt;的效果。&lt;/li&gt;&#xA;&lt;/ul&gt;</description>
    </item>
    <item>
      <title>11.Uniswap V3 tick 与价格表示</title>
      <link>http://localhost:1313/posts/202509-uniswap11/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap11/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;&lt;code&gt;tick&lt;/code&gt; 引入目的与作用&lt;/strong&gt;: Uniswap V3 引入了 &lt;strong&gt;&lt;code&gt;tick&lt;/code&gt;&lt;/strong&gt; 机制，将连续的价格范围离散化，以解决集中流动性中用户随意设置价格区间导致的高 Gas 消耗问题，从而大幅节省 Gas 费用。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格与 &lt;code&gt;tick&lt;/code&gt; 的数学关系&lt;/strong&gt;: Uniswap V3 中的价格 $P$ 与 &lt;code&gt;tick&lt;/code&gt; 索引 $T$ 之间通过公式 $P = 1.0001^T$ 建立精确的指数关系。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;合约价格存储&lt;/strong&gt;: Uniswap V3 合约的 &lt;code&gt;slot0&lt;/code&gt; 结构中，价格信息并非直接存储为 $P$，而是以 &lt;strong&gt;$\sqrt{P} \times 2^{96}$&lt;/strong&gt; 的形式（即 &lt;code&gt;sqrtPriceX96&lt;/code&gt;）存储，并采用 &lt;strong&gt;Q64.96 定点数格式&lt;/strong&gt;，以适应 Solidity 对浮点数处理的限制并优化 Gas 消耗。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;实际价格计算的复杂性&lt;/strong&gt;: 从合约中读取的价格需要考虑 &lt;strong&gt;Token 精度差异&lt;/strong&gt; 和 &lt;strong&gt;&lt;code&gt;token0&lt;/code&gt;/&lt;code&gt;token1&lt;/code&gt; 顺序&lt;/strong&gt;（可能导致价格倒数）进行修正，才能得到真实的市场价格。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;&lt;code&gt;tick&lt;/code&gt; 范围的由来&lt;/strong&gt;: &lt;code&gt;tick&lt;/code&gt; 的范围被限制在 &lt;strong&gt;-887272 到 +887272&lt;/strong&gt;，这一范围是根据 &lt;code&gt;Q64.96&lt;/code&gt; 定点数格式所能表示的 $\sqrt{P}$ 的上下限，通过价格与 &lt;code&gt;tick&lt;/code&gt; 的数学关系推导而来，并硬编码在合约中。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;1-tick-的引入与作用&#34;&gt;&lt;span&gt;1. &lt;code&gt;tick&lt;/code&gt; 的引入与作用&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-tick-%e7%9a%84%e5%bc%95%e5%85%a5%e4%b8%8e%e4%bd%9c%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;11-问题背景集中流动性的-gas-消耗&#34;&gt;&lt;span&gt;1.1 问题背景：集中流动性的 Gas 消耗&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-%e9%97%ae%e9%a2%98%e8%83%8c%e6%99%af%e9%9b%86%e4%b8%ad%e6%b5%81%e5%8a%a8%e6%80%a7%e7%9a%84-gas-%e6%b6%88%e8%80%97&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V3 的核心创新&lt;/strong&gt;: 引入了&lt;strong&gt;集中流动性 (Concentrated Liquidity)&lt;/strong&gt;，允许用户在任意价格区间 $P_a$ 和 $P_b$ 内提供流动性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;潜在问题&lt;/strong&gt;: 如果用户可以随意设置 $P_a$ 和 $P_b$ (例如 $1795.0234$ 到 $1800.00012$)，会带来以下问题：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;每个用户设置的价格范围都是独一无二且随意的。&lt;/li&gt;&#xA;&lt;li&gt;维护和记录每个用户添加的 $P_a$ 和 $P_b$ 范围会消耗巨量的 &lt;strong&gt;Gas 费用&lt;/strong&gt;，因为合约状态需要存储大量不规则的数据。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;12-解决方案引入-tick-进行离散化&#34;&gt;&lt;span&gt;1.2 解决方案：引入 &lt;code&gt;tick&lt;/code&gt; 进行离散化&lt;/span&gt;&#xA;  &lt;a href=&#34;#12-%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%e5%bc%95%e5%85%a5-tick-%e8%bf%9b%e8%a1%8c%e7%a6%bb%e6%95%a3%e5%8c%96&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/posts/202509-uniswap11/tickTickTickTick.jpg&#39; alt=&#34;An illustration of Uniswap price curve getting sliced by ticks&#34; height=&#34;1080&#34; width=&#34;1920&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>12.Uniswap V3 添加流动性案例</title>
      <link>http://localhost:1313/posts/202509-uniswap12/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap12/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V3 的核心是集中流动性&lt;/strong&gt;：与 V2 的无限价格范围不同，V3 允许流动性提供者（LP）将资金集中在特定的价格区间 &lt;code&gt;[Pa, Pb]&lt;/code&gt; 内，其底层数学模型可以看作是对 V2 的 &lt;code&gt;x * y = k&lt;/code&gt; 模型进行了平移和截断。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格变动消耗特定 Token&lt;/strong&gt;：在设定的价格区间内，当价格从当前价 &lt;code&gt;P&lt;/code&gt; 下降至 &lt;code&gt;Pa&lt;/code&gt; 时，池子会消耗 &lt;code&gt;Y&lt;/code&gt; Token；当价格从 &lt;code&gt;P&lt;/code&gt; 上升至 &lt;code&gt;Pb&lt;/code&gt; 时，池子会消耗 &lt;code&gt;X&lt;/code&gt; Token。理解这一点是计算所需流动性的关键。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性计算基于虚拟曲线&lt;/strong&gt;：尽管 V3 的真实曲线是分段的，但其流动性数量 $\Delta X$ 和 $\Delta Y$ 的计算可以基于 V2 的 $x \cdot y = L^2$ 和 $P = y/x$ 这两个基础公式，应用在一条“虚拟”的、经过平移的曲线上进行推导。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;工程实现中的核心逻辑&lt;/strong&gt;：在实际添加流动性时，智能合约会根据用户提供的两种 Token ($\Delta X$ 和 $\Delta Y$) 分别计算出两个可能的流动性值 &lt;code&gt;L&lt;/code&gt;，并最终选择&lt;strong&gt;较小&lt;/strong&gt;的那个作为最终的流动性。这可能导致实际使用的某一种 Token 数量略少于用户最初提供的数量。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;一-uniswap-v3-核心公式与概念回顾&#34;&gt;&lt;span&gt;&lt;strong&gt;一、 Uniswap V3 核心公式与概念回顾&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e4%b8%80-uniswap-v3-%e6%a0%b8%e5%bf%83%e5%85%ac%e5%bc%8f%e4%b8%8e%e6%a6%82%e5%bf%b5%e5%9b%9e%e9%a1%be&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;1-v3-流动性公式与曲线&#34;&gt;&lt;span&gt;&lt;strong&gt;1. V3 流动性公式与曲线&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-v3-%e6%b5%81%e5%8a%a8%e6%80%a7%e5%85%ac%e5%bc%8f%e4%b8%8e%e6%9b%b2%e7%ba%bf&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;Uniswap V3 引入了&lt;strong&gt;集中流动性&lt;/strong&gt;的概念，允许将流动性提供在指定的价格区间 &lt;code&gt;[Pa, Pb]&lt;/code&gt;。其公式可以理解为对 V2 公式的平移。&lt;/p&gt;</description>
    </item>
    <item>
      <title>13.Uniswap V3 单价格区间内 Swap 机制</title>
      <link>http://localhost:1313/posts/202509-uniswap13/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap13/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;uniswap-v3单价格区间内-swap-机制与数学实现&#34;&gt;&lt;span&gt;&lt;strong&gt;Uniswap V3：单价格区间内 Swap 机制与数学实现&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-v3%e5%8d%95%e4%bb%b7%e6%a0%bc%e5%8c%ba%e9%97%b4%e5%86%85-swap-%e6%9c%ba%e5%88%b6%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%ae%9e%e7%8e%b0&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;两步核心算法&lt;/strong&gt;：在 Uniswap V3 的单个价格区间内执行 &lt;strong&gt;swap&lt;/strong&gt; 的核心逻辑分为两步：首先，根据输入的代币数量和当前流动性，计算出交易完成后的&lt;strong&gt;新价格&lt;/strong&gt;；然后，利用新旧两个价格点和流动性，计算出可以兑换出的输出代币数量。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;基石数学关系&lt;/strong&gt;：所有计算都基于 &lt;strong&gt;流动性 (L)&lt;/strong&gt;、&lt;strong&gt;代币 X 数量&lt;/strong&gt;、&lt;strong&gt;代币 Y 数量&lt;/strong&gt; 和 &lt;strong&gt;价格 (P)&lt;/strong&gt; 之间的恒定关系。具体来说，$X = L / \sqrt{P}$ 和 $Y = L \cdot \sqrt{P}$ 是推导所有 &lt;code&gt;swap&lt;/code&gt; 公式的基石。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格方向决定公式形态&lt;/strong&gt;：无论是用 Y 买 X（价格上升）还是用 X 卖 Y（价格下降），其底层的数学原理是统一的。公式的具体形态（谁减谁）取决于价格的高低（$P_{upper}$ vs $P_{lower}$），最终可以抽象为统一的表达式。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-基础回顾价格tick-与流动性&#34;&gt;&lt;span&gt;&lt;strong&gt;1. 基础回顾：价格、Tick 与流动性&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e5%9f%ba%e7%a1%80%e5%9b%9e%e9%a1%be%e4%bb%b7%e6%a0%bctick-%e4%b8%8e%e6%b5%81%e5%8a%a8%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;在深入 &lt;code&gt;swap&lt;/code&gt; 逻辑之前，我们首先要回顾 Uniswap V3 的基本概念。协议通过 &lt;strong&gt;Tick&lt;/strong&gt; 来离散化价格，并将 Tick 转换为实际计算中使用的 $\sqrt{P}$ (square root price)。在一个给定的价格点 &lt;code&gt;P&lt;/code&gt;，流动性 &lt;code&gt;L&lt;/code&gt; 与两种代币（X 和 Y）的数量关系如下：&lt;/p&gt;</description>
    </item>
    <item>
      <title>14.Uniswap V3 Tick Bitmap</title>
      <link>http://localhost:1313/posts/202509-uniswap14/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap14/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Tick BitMap 的核心目的&lt;/strong&gt;: 为了高效、低成本地跟踪 Uniswap V3 池中哪些价格点（Ticks）被用作了流动性区间的边界，从而知道哪些价格范围是活跃的。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;精巧的数据压缩&lt;/strong&gt;: &lt;code&gt;Tick BitMap&lt;/code&gt; 抛弃了为每个 Tick 单独存储状态的朴素方案（成本过高），而是通过位运算将 256 个连续的 Tick 状态压缩存储在一个 &lt;code&gt;uint256&lt;/code&gt; 变量中，极大地节省了 Gas 费和存储空间。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;关键转换公式&lt;/strong&gt;: 任何一个 &lt;code&gt;tick&lt;/code&gt; (类型为 &lt;code&gt;int24&lt;/code&gt;) 都可以通过数学运算定位到它在 BitMap 中的具体位置。其核心是两个坐标：&lt;code&gt;wordPosition&lt;/code&gt; (确定在哪一个 &lt;code&gt;uint256&lt;/code&gt; 组里) 和 &lt;code&gt;bitPosition&lt;/code&gt; (确定在该组的第几位)。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;wordPosition = tick / 256&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;bitPosition = tick % 256&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;数据结构&lt;/strong&gt;: &lt;code&gt;Tick BitMap&lt;/code&gt; 在合约中实现为一个 &lt;code&gt;mapping(int16 =&amp;gt; uint256)&lt;/code&gt;。其中 &lt;code&gt;key (int16)&lt;/code&gt; 是 &lt;code&gt;wordPosition&lt;/code&gt;，&lt;code&gt;value (uint256)&lt;/code&gt; 是一个 256 位的位图，每一位代表一个 &lt;code&gt;tick&lt;/code&gt; 的活跃状态（1 表示活跃，0 表示不活跃）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;状态更新机制&lt;/strong&gt;: 添加或移除流动性时，通过生成一个特定的&lt;strong&gt;掩码 (Mask)&lt;/strong&gt;，并与 BitMap 中对应的 &lt;code&gt;uint256&lt;/code&gt; 值进行&lt;strong&gt;按位或 (OR)&lt;/strong&gt; 或&lt;strong&gt;按位与 (AND)&lt;/strong&gt; 运算，来精确地将某一位从 0 改为 1 或从 1 改为 0，而不影响其他位。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-tick-的回顾与作用&#34;&gt;&lt;span&gt;&lt;strong&gt;1. Tick 的回顾与作用&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-tick-%e7%9a%84%e5%9b%9e%e9%a1%be%e4%b8%8e%e4%bd%9c%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;定义&lt;/strong&gt;: &lt;strong&gt;Tick&lt;/strong&gt; (也称 &lt;strong&gt;Tick Index&lt;/strong&gt;) 是 Uniswap V3 中用来标记离散化价格点的单位。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格公式&lt;/strong&gt;: 价格 &lt;code&gt;P&lt;/code&gt; 与 &lt;code&gt;tick&lt;/code&gt; &lt;code&gt;T&lt;/code&gt; 的关系通过以下公式定义：&#xA;$$&#xA;P = 1.0001^T&#xA;$$&#xA;其中 &lt;code&gt;T&lt;/code&gt; 就是 &lt;code&gt;tick&lt;/code&gt; 的索引。当 &lt;code&gt;T&lt;/code&gt; 增大时，价格 &lt;code&gt;P&lt;/code&gt; 上升；当 &lt;code&gt;T&lt;/code&gt; 减小时，价格 &lt;code&gt;P&lt;/code&gt; 下降。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Tick 范围&lt;/strong&gt;:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;合约中 &lt;code&gt;tick&lt;/code&gt; 的类型为 &lt;code&gt;int24&lt;/code&gt;，其理论范围是从 &lt;code&gt;-887272&lt;/code&gt; 到 &lt;code&gt;+887272&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例&lt;/strong&gt;: 这个范围足以表示极其宽广的价格区间。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;当 &lt;code&gt;tick&lt;/code&gt; 为 &lt;code&gt;-887272&lt;/code&gt; 时，价格约为 $2.938 \times 10^{-39}$。&lt;/li&gt;&#xA;&lt;li&gt;当 &lt;code&gt;tick&lt;/code&gt; 为 &lt;code&gt;+887272&lt;/code&gt; 时，价格约为 $3.4 \times 10^{38}$。&lt;/li&gt;&#xA;&lt;li&gt;这个范围远超比特币等主流资产的价格波动范围，因此在设计上是足够用的。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;2-核心问题如何跟踪活跃的流动性区间&#34;&gt;&lt;span&gt;&lt;strong&gt;2. 核心问题：如何跟踪活跃的流动性区间？&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#2-%e6%a0%b8%e5%bf%83%e9%97%ae%e9%a2%98%e5%a6%82%e4%bd%95%e8%b7%9f%e8%b8%aa%e6%b4%bb%e8%b7%83%e7%9a%84%e6%b5%81%e5%8a%a8%e6%80%a7%e5%8c%ba%e9%97%b4&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;背景&lt;/strong&gt;: 在 Uniswap V3 中，用户在自定义的价格区间 &lt;code&gt;[PA, PB]&lt;/code&gt; (对应 &lt;code&gt;[Tick_A, Tick_B]&lt;/code&gt;) 内添加流动性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;挑战&lt;/strong&gt;: 一个活跃的交易对（如 BTC/USDT）可能有成千上万的用户在各种不同的、甚至重叠的价格区间添加流动性。合约需要一种高效的方式来跟踪哪些 &lt;code&gt;tick&lt;/code&gt; 成为了这些流动性区间的边界（即被激活）。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例&lt;/strong&gt;: 假设一个用户在 &lt;code&gt;tick&lt;/code&gt; 范围 &lt;code&gt;[-10, -5]&lt;/code&gt; 添加了流动性，而另一个用户在 &lt;code&gt;[-4, 1]&lt;/code&gt; 添加了流动性。此外，还可能存在重叠区间，例如用户 A 在 &lt;code&gt;[6, 10]&lt;/code&gt; 添加流动性，用户 B 在 &lt;code&gt;[7, 12]&lt;/code&gt; 添加流动性，那么在 &lt;code&gt;[7, 10]&lt;/code&gt; 区间内流动性是重叠的。合约必须有效管理这一切。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;从 ERC20 到 ERC721&lt;/strong&gt;:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;V2&lt;/strong&gt;: 所有流动性提供者的 LP 凭证是同质化的 &lt;strong&gt;ERC20&lt;/strong&gt; 代币。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;V3&lt;/strong&gt;: 由于每个人的流动性价格区间和数量都可能不同，LP 凭证变成了非同质化的 &lt;strong&gt;ERC721&lt;/strong&gt; 代币（NFT）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例&lt;/strong&gt;: 一个 V3 LP NFT (通过 &lt;code&gt;NonfungiblePositionManager&lt;/code&gt; 合约管理) 记录了如 &lt;code&gt;tickLower&lt;/code&gt;、&lt;code&gt;tickUpper&lt;/code&gt; 和 &lt;code&gt;liquidity (uint128)&lt;/code&gt; 等唯一信息，代表一个独一无二的流动性仓位。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;根本问题&lt;/strong&gt;: 尽管 NFT 记录了每个仓位的具体信息，但 &lt;code&gt;Pool&lt;/code&gt; 合约本身如何宏观地、低成本地知道在任意一个 &lt;code&gt;tick&lt;/code&gt; 上，是否有流动性边界存在？&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;3-一种被否决的朴素方案&#34;&gt;&lt;span&gt;&lt;strong&gt;3. 一种被否决的朴素方案&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#3-%e4%b8%80%e7%a7%8d%e8%a2%ab%e5%90%a6%e5%86%b3%e7%9a%84%e6%9c%b4%e7%b4%a0%e6%96%b9%e6%a1%88&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;思路&lt;/strong&gt;: 设计一个简单的键值对（Key-Value）结构来记录每个 &lt;code&gt;tick&lt;/code&gt; 的状态。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;mapping(int24 =&amp;gt; bool)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;Key&lt;/code&gt;: &lt;code&gt;tick&lt;/code&gt; 索引 (例如: -10000, 20000)&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;Value&lt;/code&gt;: &lt;code&gt;true&lt;/code&gt; (被用作边界) 或 &lt;code&gt;false&lt;/code&gt; (未被用作边界)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;致命缺陷&lt;/strong&gt;:&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;存储量巨大&lt;/strong&gt;: &lt;code&gt;tick&lt;/code&gt; 的总数约有 177 万个。为每一个 &lt;code&gt;tick&lt;/code&gt; 都创建一个存储槽位在区块链上是无法承受的，成本极高。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;计算量巨大 (高 Gas 费)&lt;/strong&gt;: 当一笔交易（swap）需要跨越成千上万个 &lt;code&gt;tick&lt;/code&gt; 时，如果需要逐一查询这些 &lt;code&gt;tick&lt;/code&gt; 的状态，将会导致交易的 Gas 费极高，用户无法接受。&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;4-uniswap-v3-的精巧解决方案tick-bitmap&#34;&gt;&lt;span&gt;&lt;strong&gt;4. Uniswap V3 的精巧解决方案：Tick BitMap&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#4-uniswap-v3-%e7%9a%84%e7%b2%be%e5%b7%a7%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88tick-bitmap&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/posts/202509-uniswap14/tick_bitmap.png&#39; alt=&#34;Tick indexes in tick bitmap&#34; height=&#34;432&#34; width=&#34;1058&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>15.Uniswap V3 Tick Bitmap 寻找下一个 tick</title>
      <link>http://localhost:1313/posts/202509-uniswap15/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap15/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Tick Bitmap 的核心作用&lt;/strong&gt;：它是一个 &lt;code&gt;uint256&lt;/code&gt; 的位图，用于高效追踪 Uniswap V3 池中哪些价格点（Ticks）被用作了流动性区间的边界。&lt;code&gt;1&lt;/code&gt; 代表该 Tick 活跃（有流动性），&lt;code&gt;0&lt;/code&gt; 代表不活跃。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;寻找下一个 Tick 的目的&lt;/strong&gt;：在进行交易（Swap）时，价格会发生变动。当价格穿过一个活跃的 Tick，意味着当前流动性区间的流动性（L）将被耗尽，合约必须找到下一个有流动性的价格区间才能继续完成交易。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;通过位运算实现高效查找&lt;/strong&gt;：寻找下一个活跃 Tick 的过程利用了**掩码（Mask）&lt;strong&gt;和&lt;/strong&gt;按位与（Bitwise AND）**运算。通过构建特定的掩码，可以快速地隔离出目标方向（价格升高或降低）上所有活跃的 Ticks。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;交易方向决定搜索方向&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;当交易导致&lt;strong&gt;价格上涨&lt;/strong&gt;时（例如用 USDC 买 ETH），需要在 Tick Bitmap 中向&lt;strong&gt;左&lt;/strong&gt;搜索（寻找更大的 Tick）。&lt;/li&gt;&#xA;&lt;li&gt;当交易导致&lt;strong&gt;价格下跌&lt;/strong&gt;时（例如卖出 ETH 换 USDC），需要在 Tick Bitmap 中向&lt;strong&gt;右&lt;/strong&gt;搜索（寻找更小的 Tick）。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Bitmap 内部方向与全局 Tick 轴方向的区别&lt;/strong&gt;：在 Bitmap（一个 &lt;code&gt;uint256&lt;/code&gt;）内部，索引位（&lt;code&gt;bit position&lt;/code&gt;）从右到左增大，因此向&lt;strong&gt;左&lt;/strong&gt;查找意味着寻找&lt;strong&gt;更大&lt;/strong&gt;的 Tick 值。这与全局价格数轴上数值从左到右增大的直觉相反，需要注意区分。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;i-tick-bitmap-核心概念回顾&#34;&gt;&lt;span&gt;&lt;strong&gt;I. Tick Bitmap 核心概念回顾&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#i-tick-bitmap-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5%e5%9b%9e%e9%a1%be&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;本节内容对应 &lt;code&gt;TickBitmap.sol&lt;/code&gt; 库合约中的核心逻辑。&lt;/p&gt;</description>
    </item>
    <item>
      <title>16.Uniswap V3 cross tick swap</title>
      <link>http://localhost:1313/posts/202509-uniswap17/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap17/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;跨Tick交易的核心机制&lt;/strong&gt;：当一笔交易的规模大到足以耗尽当前价格区间（Tick Range）内的流动性时，交易会“穿越”到一个新的、相邻的活跃价格区间，并利用新区间的流动性继续完成剩余部分的兑换。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;迭代循环过程&lt;/strong&gt;：跨Tick交易并非一次性计算，而是一个循环过程。系统在当前区间内完成部分交易，计算剩余未兑换量，然后寻找下一个活跃Tick，更新流动性，再对剩余量进行计算，如此往复，直至交易完成或流动性耗尽。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;两大基础工具&lt;/strong&gt;：整个跨Tick交易的实现依赖于两个核心数据结构：&lt;strong&gt;Tick Bitmap&lt;/strong&gt; 用于快速查找下一个有流动性的活跃Tick；&lt;strong&gt;Liquidity Net&lt;/strong&gt; 用于在穿越Tick边界时，高效地计算出新价格区间的总流动性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;V3与V2的复杂度对比&lt;/strong&gt;：Uniswap V3由于引入了集中流动性，其&lt;code&gt;swap&lt;/code&gt;（交易）的数学逻辑和代码实现复杂度远超V2。V2的交易遵循简单的 $x \times y = k$ 恒定乘积公式，而V3则需要处理离散的、分段的流动性，进行复杂的迭代计算。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-交易机制回顾与铺垫&#34;&gt;&lt;span&gt;&lt;strong&gt;1. 交易机制回顾与铺垫&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e4%ba%a4%e6%98%93%e6%9c%ba%e5%88%b6%e5%9b%9e%e9%a1%be%e4%b8%8e%e9%93%ba%e5%9e%ab&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;11-基础概念回顾&#34;&gt;&lt;span&gt;1.1 基础概念回顾&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5%e5%9b%9e%e9%a1%be&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;横坐标 (价格/Tick)&lt;/strong&gt;：智能合约使用 &lt;strong&gt;Tick Bitmap&lt;/strong&gt; 来记录哪些价格点（Ticks）是活跃的（即作为某个流动性区间的边界）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;纵坐标 (流动性)&lt;/strong&gt;：使用 &lt;strong&gt;Liquidity Net&lt;/strong&gt; 记录在每个Tick点上流动性的净变化量。当价格穿越一个Tick时，总流动性会根据该Tick的&lt;code&gt;liquidityNet&lt;/code&gt;值进行更新。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性叠加&lt;/strong&gt;：在某个价格区间，多个用户提供的流动性会叠加起来，形成一个总的、更高的流动性池。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;12-单一价格区间内的交易-未跨tick&#34;&gt;&lt;span&gt;1.2 单一价格区间内的交易 (未跨Tick)&lt;/span&gt;&#xA;  &lt;a href=&#34;#12-%e5%8d%95%e4%b8%80%e4%bb%b7%e6%a0%bc%e5%8c%ba%e9%97%b4%e5%86%85%e7%9a%84%e4%ba%a4%e6%98%93-%e6%9c%aa%e8%b7%a8tick&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;这是跨Tick交易的基础。在一个固定的价格区间 &lt;code&gt;[PA, PB]&lt;/code&gt; 内，流动性 &lt;code&gt;L&lt;/code&gt; 是恒定的。&lt;/p&gt;</description>
    </item>
    <item>
      <title>16.Uniswap V3 LiquidityNet</title>
      <link>http://localhost:1313/posts/202509-uniswap16/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap16/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;智能合约的效率限制&lt;/strong&gt;：Uniswap v3 智能合约因存储和计算成本的限制，不会记录每个价格区间的具体流动性值。它采用一种更高效的动态计算方法，只在流动性发生变化的 &lt;code&gt;tick&lt;/code&gt; 边界点记录关键信息。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心概念 &lt;code&gt;Liquidity Net&lt;/code&gt;&lt;/strong&gt;：合约追踪流动性的核心是记录在每个被初始化的 &lt;code&gt;tick&lt;/code&gt; 上的 &lt;strong&gt;&lt;code&gt;Liquidity Net&lt;/code&gt; (流动性净变化量)&lt;/strong&gt;。这是一个&lt;strong&gt;有符号&lt;/strong&gt;的值 (&lt;code&gt;ΔL&lt;/code&gt;)，表示当价格穿越该 &lt;code&gt;tick&lt;/code&gt; 时，池中活跃流动性的&lt;strong&gt;变化量&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;边界点的符号规则&lt;/strong&gt;：当用户在 &lt;code&gt;[tick_lower, tick_upper]&lt;/code&gt; 区间添加流动性 &lt;code&gt;L&lt;/code&gt; 时，合约会在 &lt;code&gt;tick_lower&lt;/code&gt; 处记录一个正的净变化量 (&lt;code&gt;+L&lt;/code&gt;)，在 &lt;code&gt;tick_upper&lt;/code&gt; 处记录一个负的净变化量 (&lt;code&gt;-L&lt;/code&gt;)。移除流动性则符号相反。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性的动态计算&lt;/strong&gt;：在交易（swap）过程中，当价格从一个区间穿越 &lt;code&gt;tick&lt;/code&gt; 进入下一个区间时，合约通过一个简单的累加公式实时更新当前的活跃流动性：$L_{新区间} = L_{旧区间} + \Delta L_{tick}$。这使得合约只需追踪当前区间的流动性，而无需预存所有区间的流动性信息。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-背景问题uniswap-v3-如何高效追踪流动性&#34;&gt;&lt;span&gt;&lt;strong&gt;1. 背景问题：Uniswap v3 如何高效追踪流动性？&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e8%83%8c%e6%99%af%e9%97%ae%e9%a2%98uniswap-v3-%e5%a6%82%e4%bd%95%e9%ab%98%e6%95%88%e8%bf%bd%e8%b8%aa%e6%b5%81%e5%8a%a8%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;在 Uniswap v3 中，流动性提供者可以在任意自定义的价格区间（由 &lt;code&gt;tick&lt;/code&gt; 界定）内提供流动性。这导致了池子的总流动性在不同价格段是阶梯式变化的。&lt;/p&gt;</description>
    </item>
    <item>
      <title>18.Uniswap V3 手续费计算（一）</title>
      <link>http://localhost:1313/posts/202509-uniswap18/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap18/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;V3手续费的复杂性根源&lt;/strong&gt;：与V2的全范围流动性不同，Uniswap V3的&lt;strong&gt;集中流动性&lt;/strong&gt;允许LP在自定义价格区间（&lt;code&gt;ticks&lt;/code&gt;）提供流动性，这使得手续费的计算和分配变得极其复杂。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;全局手续费累加器 &lt;code&gt;feeGrowthGlobal&lt;/code&gt;&lt;/strong&gt;：Uniswap V3引入了一个全局状态变量 &lt;code&gt;feeGrowthGlobal&lt;/code&gt;，它代表&lt;strong&gt;每单位流动性&lt;/strong&gt;可以获得的总手续费。这个值会随着每笔交易单调递增。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;手续费按&lt;code&gt;token in&lt;/code&gt;收取&lt;/strong&gt;：手续费只对交易中“进入”池子的代币收取。因此，系统需要为交易对中的两种代币（&lt;code&gt;token0&lt;/code&gt; 和 &lt;code&gt;token1&lt;/code&gt;）分别维护两个独立的&lt;code&gt;feeGrowthGlobal&lt;/code&gt;变量，导致其增长呈现阶梯状。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;LP的核心关注点 &lt;code&gt;feeGrowthInside&lt;/code&gt;&lt;/strong&gt;：LP只关心在其提供的流动性区间内产生的手су费。因此，需要从全局&lt;code&gt;feeGrowthGlobal&lt;/code&gt;中剥离掉区间外的部分，得到&lt;code&gt;feeGrowthInside&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;精巧的边界记录机制 &lt;code&gt;feeGrowthOutside&lt;/code&gt;&lt;/strong&gt;：V3通过在每个&lt;code&gt;tick&lt;/code&gt;边界上记录一个名为&lt;code&gt;feeGrowthOutside&lt;/code&gt;的值，来巧妙地计算任意区间的&lt;code&gt;feeGrowthInside&lt;/code&gt;。当价格穿越一个&lt;code&gt;tick&lt;/code&gt;时，该&lt;code&gt;tick&lt;/code&gt;的&lt;code&gt;feeGrowthOutside&lt;/code&gt;值会被更新，从而精确追踪内外手续费的累积情况。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-uniswap-v2-vs-v3-手续费机制对比&#34;&gt;&lt;span&gt;&lt;strong&gt;1. Uniswap V2 vs. V3 手续费机制对比&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-uniswap-v2-vs-v3-%e6%89%8b%e7%bb%ad%e8%b4%b9%e6%9c%ba%e5%88%b6%e5%af%b9%e6%af%94&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;11-uniswap-v2简单直接&#34;&gt;&lt;span&gt;&lt;strong&gt;1.1 Uniswap V2：简单直接&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-uniswap-v2%e7%ae%80%e5%8d%95%e7%9b%b4%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性模型&lt;/strong&gt;：流动性平均分布在从 &lt;code&gt;0&lt;/code&gt; 到 &lt;code&gt;+∞&lt;/code&gt; 的整个价格曲线上。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;手续费收取&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;对每笔交易收取固定的千分之三（0.3%）手续费。&lt;/li&gt;&#xA;&lt;li&gt;手续费只对 &lt;strong&gt;&lt;code&gt;token in&lt;/code&gt;&lt;/strong&gt; （交易中流入池子的代币）收取。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;用 X 换 Y：收取 &lt;code&gt;0.003 * X&lt;/code&gt;，实际用于交易的是 &lt;code&gt;0.997 * X&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;li&gt;用 Y 换 X：收取 &lt;code&gt;0.003 * Y&lt;/code&gt;，实际用于交易的是 &lt;code&gt;0.997 * Y&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;手续费分配&lt;/strong&gt;：收取的手续费会自动累积到流动性池中，为LP实现&lt;strong&gt;自动复投&lt;/strong&gt;增值，无需任何额外操作。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;12-uniswap-v3挑战重重&#34;&gt;&lt;span&gt;&lt;strong&gt;1.2 Uniswap V3：挑战重重&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#12-uniswap-v3%e6%8c%91%e6%88%98%e9%87%8d%e9%87%8d&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心挑战&lt;/strong&gt;：&lt;strong&gt;集中流动性 (Concentrated Liquidity)&lt;/strong&gt;。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;不同的LP可以在&lt;strong&gt;不同的价格区间&lt;/strong&gt;（由&lt;code&gt;tick lower&lt;/code&gt;和&lt;code&gt;tick upper&lt;/code&gt;定义，视频中也称为&lt;code&gt;PA&lt;/code&gt;和&lt;code&gt;PB&lt;/code&gt;）提供流动性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;手续费档位&lt;/strong&gt;：V3提供了多个手续费档位供流动性池选择，如 &lt;code&gt;0.01%&lt;/code&gt;, &lt;code&gt;0.05%&lt;/code&gt;, &lt;code&gt;0.3%&lt;/code&gt;, &lt;code&gt;1%&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;需要解决的问题&lt;/strong&gt;：&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;按比例分配&lt;/strong&gt;：在同一个&lt;code&gt;tick&lt;/code&gt;区间内，手续费需按LP提供的流动性比例进行分配。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;跨&lt;code&gt;tick&lt;/code&gt;计算&lt;/strong&gt;：当交易价格跨越&lt;code&gt;tick&lt;/code&gt;边界，导致总流动性发生变化时，如何精确计算每个LP在其活跃区间内应得的手续费。&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;2-手续费分配的基本原理与&#34;&gt;&lt;span&gt;&lt;strong&gt;2. 手续费分配的基本原理与 &lt;code&gt;feeGrowth&lt;/code&gt; 的引入&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#2-%e6%89%8b%e7%bb%ad%e8%b4%b9%e5%88%86%e9%85%8d%e7%9a%84%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86%e4%b8%8e&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;21-单次交易的分配逻辑&#34;&gt;&lt;span&gt;&lt;strong&gt;2.1 单次交易的分配逻辑&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#21-%e5%8d%95%e6%ac%a1%e4%ba%a4%e6%98%93%e7%9a%84%e5%88%86%e9%85%8d%e9%80%bb%e8%be%91&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心思想&lt;/strong&gt;：LP在某个价格区间获得的手续费，等于该区间产生的&lt;strong&gt;总手续费&lt;/strong&gt;乘以该LP提供的&lt;strong&gt;流动性占比&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例：单次跨&lt;code&gt;tick&lt;/code&gt;交易&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;背景&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;一个LP在某个范围内提供了流动性，大小为 &lt;code&gt;S&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;li&gt;一笔交易发生，使得价格从&lt;code&gt;tick_0&lt;/code&gt;移动到&lt;code&gt;tick_1&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;li&gt;在$tick_0$区间的总流动性为$L_0$，产生的总手续费为$F_0$。&lt;/li&gt;&#xA;&lt;li&gt;在&lt;code&gt;tick_1&lt;/code&gt;区间的总流动性为$L_1$，产生的总手续费为$F_1$。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;计算LP应得手续费&lt;/strong&gt;：该LP获得的手续费 $Fee_S$ 是其在每个&lt;code&gt;tick&lt;/code&gt;区间所获手续费的总和。&#xA;$$&#xA;Fee_S = \left(F_0 \cdot \frac{S}{L_0}\right) + \left(F_1 \cdot \frac{S}{L_1}\right)&#xA;$$&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;22&#34;&gt;&lt;span&gt;&lt;strong&gt;2.2 &lt;code&gt;feeGrowthGlobal&lt;/code&gt;：全局手续费累加器&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#22&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;概念推导&lt;/strong&gt;：将上述逻辑扩展到 &lt;code&gt;N&lt;/code&gt; 次交易，LP的总手续费可以表示为：&#xA;$$&#xA;Fee_S = S \cdot \sum_{i=0}^{N} \frac{F_i}{L_i}&#xA;$$&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;定义&lt;/strong&gt;：Uniswap V3将公式中求和的部分 $\sum_{i=0}^{N} \frac{F_i}{L_i}$ 定义为一个全局变量，称为 &lt;strong&gt;&lt;code&gt;feeGrowthGlobal&lt;/code&gt;&lt;/strong&gt; (视频中简称为&lt;code&gt;FG&lt;/code&gt;)。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;物理含义&lt;/strong&gt;：&lt;code&gt;feeGrowthGlobal&lt;/code&gt; 代表从系统部署开始，&lt;strong&gt;每单位流动性 (&lt;code&gt;S=1&lt;/code&gt;)&lt;/strong&gt; 累计可以获得的总手续费。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;简化公式&lt;/strong&gt;：LP的总手续费 $Fee_S = S \cdot feeGrowthGlobal$。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心特性&lt;/strong&gt;：&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;全局状态&lt;/strong&gt;：&lt;code&gt;feeGrowthGlobal&lt;/code&gt; 是一个存储在合约中的全局变量，随每次交易更新。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;单调递增&lt;/strong&gt;：只要有交易发生，&lt;code&gt;feeGrowthGlobal&lt;/code&gt; 的值就会不断累积，永远不会减少。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;按代币分离&lt;/strong&gt;：由于手续费只对 &lt;strong&gt;&lt;code&gt;token in&lt;/code&gt;&lt;/strong&gt; 收取，因此合约为交易对中的两个代币分别维护了两个&lt;code&gt;feeGrowthGlobal&lt;/code&gt;变量：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;**feeGrowthGlobal0**&lt;/code&gt; (针对 &lt;code&gt;token0&lt;/code&gt;)&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;**feeGrowthGlobal1**&lt;/code&gt; (针对 &lt;code&gt;token1&lt;/code&gt;)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;阶梯式增长&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;当价格上涨时（例如，用&lt;code&gt;token0&lt;/code&gt;换&lt;code&gt;token1&lt;/code&gt;），&lt;code&gt;feeGrowthGlobal0&lt;/code&gt;会增加，而&lt;code&gt;feeGrowthGlobal1&lt;/code&gt;保持不变（呈水平线）。&lt;/li&gt;&#xA;&lt;li&gt;当价格下跌时（例如，用&lt;code&gt;token1&lt;/code&gt;换&lt;code&gt;token0&lt;/code&gt;），&lt;code&gt;feeGrowthGlobal1&lt;/code&gt;会增加，而&lt;code&gt;feeGrowthGlobal0&lt;/code&gt;保持不变。&lt;/li&gt;&#xA;&lt;li&gt;这导致每个&lt;code&gt;feeGrowthGlobal&lt;/code&gt;变量的增长曲线都呈现出&lt;strong&gt;阶梯状&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;3-从全局到局部计算&#34;&gt;&lt;span&gt;&lt;strong&gt;3. 从全局到局部：计算 &lt;code&gt;feeGrowthInside&lt;/code&gt;&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#3-%e4%bb%8e%e5%85%a8%e5%b1%80%e5%88%b0%e5%b1%80%e9%83%a8%e8%ae%a1%e7%ae%97&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;LP的视角&lt;/strong&gt;：一个在特定价格区间 $[i_l, i_u]$ (&lt;code&gt;tick lower&lt;/code&gt;, &lt;code&gt;tick upper&lt;/code&gt;) 提供流动性的LP，只关心在这个区间内（&lt;code&gt;inside&lt;/code&gt;）累积的手续费，区间外（&lt;code&gt;outside&lt;/code&gt;）的与他无关。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心概念&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;feeGrowthInside&lt;/strong&gt;：在LP指定的 $[i_l, i_u]$ 区间内累积的每单位流动性手续费。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;feeGrowthOutside&lt;/strong&gt;：在该区间之外累积的手续费。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;计算逻辑&lt;/strong&gt;：&lt;code&gt;feeGrowthInside&lt;/code&gt; 等于全局的 &lt;code&gt;feeGrowthGlobal&lt;/code&gt; 减去所有在区间之外累积的部分。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;白皮书与视频中的公式&lt;/strong&gt; (变量名来自视频讲解)：&#xA;$$&#xA;F_{R(i_l, i_u)} = F_g - F_{B(i_l)} - F_{A(i_u)}&#xA;$$&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;公式解读&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;$F_{R(i_l, i_u)}$：我们想求的 &lt;strong&gt;&lt;code&gt;feeGrowthInside&lt;/code&gt;&lt;/strong&gt; (Range Fee)。&lt;/li&gt;&#xA;&lt;li&gt;$F_g$：当前的全局 &lt;strong&gt;&lt;code&gt;feeGrowthGlobal&lt;/code&gt;&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;$F_{B(i_l)}$：所有&lt;strong&gt;低于&lt;/strong&gt;下边界 $i_l$ 的手续费累积 (&lt;code&gt;Fee Below&lt;/code&gt;)。&lt;/li&gt;&#xA;&lt;li&gt;$F_{A(i_u)}$：所有&lt;strong&gt;高于&lt;/strong&gt;上边界 $i_u$ 的手续费累积 (&lt;code&gt;Fee Above&lt;/code&gt;)。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;4&#34;&gt;&lt;span&gt;&lt;strong&gt;4. &lt;code&gt;feeGrowthOutside&lt;/code&gt;：精巧的边界状态记录机制&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#4&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;为了高效计算任意区间的$F_{B(i_l)}$和$F_{A(i_u)}$，V3合约并不直接记录它们，而是采用了一个更巧妙的机制：在&lt;strong&gt;每个被激活的&lt;code&gt;tick&lt;/code&gt;上&lt;/strong&gt;记录一个状态变量 &lt;code&gt;**feeGrowthOutside**&lt;/code&gt; (视频中简称为$F_{O(i)}$)。&lt;/p&gt;</description>
    </item>
    <item>
      <title>19.Uniswap V3 手续费计算（二）</title>
      <link>http://localhost:1313/posts/202509-uniswap19/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap19/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;uniswap-v3-手续费计算深度解析-二&#34;&gt;&lt;span&gt;&lt;strong&gt;Uniswap V3 手续费计算深度解析 (二)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-v3-%e6%89%8b%e7%bb%ad%e8%b4%b9%e8%ae%a1%e7%ae%97%e6%b7%b1%e5%ba%a6%e8%a7%a3%e6%9e%90-%e4%ba%8c&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心公式&lt;/strong&gt;: 为特定价格区间 $(i_l, i_u)$ 计算手续费的核心思想是：用全局累计手续费 $f_g$ 减去该区间下方的累计手续费 $f_b$ 和上方的累计手续费 $f_a$。公式为：$f_r(i_l, i_u) = f_g - f_b(i_l) - f_a(i_u)$。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;关键变量 $f_{o,i}$&lt;/strong&gt;: Uniswap V3 引入了一个名为 &lt;strong&gt;&lt;code&gt;feeOutside&lt;/code&gt;&lt;/strong&gt; (笔记中记为 $f_{o,i}$) 的关键变量。每个 tick &lt;code&gt;i&lt;/code&gt; 都会记录这个值，它巧妙地追踪了当价格在 tick &lt;code&gt;i&lt;/code&gt; 的“外部”时所累积的单位流动性手续费。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;$f_{o,i}$ 的更新机制&lt;/strong&gt;: 当价格穿越一个 tick &lt;code&gt;i&lt;/code&gt; 时，该 tick 对应的 $f_{o,i}$ 会进行一次“翻转”更新。更新规则为：$f_{o,i}^{\text{new}} = f_g^{\text{current}} - f_{o,i}^{\text{old}}$。这个机制是整个计算逻辑的精髓。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;推导关系&lt;/strong&gt;: 通过 $f_{o,i}$ 和当前全局手续费 $f_g$，可以精确推导出任意时刻的 $f_b$ 和 $f_a$。它们的值取决于当前价格 $i_c$ 相对于目标 tick &lt;code&gt;i&lt;/code&gt; 的位置。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-背景v3-手续费计算的复杂性&#34;&gt;&lt;span&gt;&lt;strong&gt;1. 背景：V3 手续费计算的复杂性&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e8%83%8c%e6%99%afv3-%e6%89%8b%e7%bb%ad%e8%b4%b9%e8%ae%a1%e7%ae%97%e7%9a%84%e5%a4%8d%e6%9d%82%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;根本原因&lt;/strong&gt;: &lt;strong&gt;集中流动性 (Concentrated Liquidity)&lt;/strong&gt;。与 V2 不同，V3 的流动性提供者 (LP) 将资金集中在特定的价格区间内。&lt;/p&gt;</description>
    </item>
    <item>
      <title>20.Uniswap V4 简介</title>
      <link>http://localhost:1313/posts/202509-uniswap20/</link>
      <pubDate>Tue, 02 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap20/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;uniswap-v4-简介&#34;&gt;&lt;span&gt;Uniswap V4 简介&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-v4-%e7%ae%80%e4%bb%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;架构性革新&lt;/strong&gt;: Uniswap V4 的核心升级在于&lt;strong&gt;代码架构&lt;/strong&gt;而非底层的 AMM 数学原理。它从 V2/V3 的“工厂模式”转变为“单例模式”，旨在大幅降低 Gas 费并提升效率。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;高度可定制化 (Hooks)&lt;/strong&gt;: V4 引入了**“钩子 (Hooks)”**机制，允许开发者在交易生命周期的关键节点（如交易前/后、添加流动性前/后）插入自定义逻辑，极大地增强了协议的灵活性和可扩展性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;显著降低 Gas 费&lt;/strong&gt;: 通过&lt;strong&gt;单例模式&lt;/strong&gt;、&lt;strong&gt;闪电记账 (Flash Accounting)&lt;/strong&gt; 和支持&lt;strong&gt;原生 ETH&lt;/strong&gt; 交易，V4 从多个维度解决了 V3 及之前版本中 Gas 费用高昂的问题，尤其是在多路径交易和涉及 ETH 的交易中。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;战略定位转变&lt;/strong&gt;: V4 的发布标志着 Uniswap 从一个单纯的去中心化交易所 (DEX) 向一个&lt;strong&gt;DeFi 基础设施平台&lt;/strong&gt;的战略转型，旨在搭建一个舞台，让更多开发者在其之上构建多样化的应用。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;一-uniswap-v4-发展历程&#34;&gt;&lt;span&gt;&lt;strong&gt;一、 Uniswap V4 发展历程&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e4%b8%80-uniswap-v4-%e5%8f%91%e5%b1%95%e5%8e%86%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;发布形式&lt;/strong&gt;: 以一种创新的 &lt;strong&gt;“社区共建”&lt;/strong&gt; 模式发布。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;2023年6月13日&lt;/strong&gt;: Uniswap 官方发布了 V4 的&lt;strong&gt;代码草案 (Code Draft)&lt;/strong&gt;，当时代码完成度约 60-70%。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;社区参与&lt;/strong&gt;: 官方并未像传统项目那样先完成内部开发和审计，而是提前将代码开源，并设立了 &lt;strong&gt;1550 万美元&lt;/strong&gt;的悬赏基金，鼓励全球社区共同寻找 Bug 和安全漏洞。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;正式上线&lt;/strong&gt;:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;经过约一年半的社区共建和测试，Uniswap V4 于&lt;strong&gt;2024年1月&lt;/strong&gt;正式发布到生产环境。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;二-uniswap-版本演进与-v3-的痛点&#34;&gt;&lt;span&gt;&lt;strong&gt;二、 Uniswap 版本演进与 V3 的痛点&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e4%ba%8c-uniswap-%e7%89%88%e6%9c%ac%e6%bc%94%e8%bf%9b%e4%b8%8e-v3-%e7%9a%84%e7%97%9b%e7%82%b9&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;每个新版本的发布都是为了解决前一版本的问题。&lt;/p&gt;</description>
    </item>
    <item>
      <title>01.Uniswap 简介</title>
      <link>http://localhost:1313/posts/202509-uniswap01/</link>
      <pubDate>Mon, 01 Sep 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-uniswap01/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;uniswap-简介&#34;&gt;&lt;span&gt;Uniswap 简介&lt;/span&gt;&#xA;  &lt;a href=&#34;#uniswap-%e7%ae%80%e4%bb%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap 作为 DeFi 核心基础设施：&lt;/strong&gt; 掌握 Uniswap V2, V3, V4 能帮助深度理解 DeFi 领域，超越行业内90-95%的人。其团队以创新力著称，而非营销。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;恒定乘积做市商模型 (AMM) 的起源：&lt;/strong&gt; Vitalik Buterin 在2017年提出无订单簿交易方案，核心是 $X \cdot Y = K$ 公式，由 Hayden Adams 实现并部署了 Uniswap V1。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V2 引爆 DeFi 赛道：&lt;/strong&gt; 2020年5月发布，引入 ERC20-ERC20 直换、闪电贷、预言机等，直接推动 DeFi 总锁仓量 (TVL) 从平稳期飙升至千亿规模。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;创新与竞争：&lt;/strong&gt; Uniswap V2 因其宽松的开源协议被 SushiSwap 抄袭并挖走大量流动性，促使 Uniswap 发行 UNI 代币并空投反击。此事件凸显了创新与营销在加密货币领域的博弈。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;V3 与 V4 的技术飞跃：&lt;/strong&gt; V3 引入&lt;strong&gt;集中流动性&lt;/strong&gt;和 &lt;strong&gt;LP NFT&lt;/strong&gt;，显著提升资本效率并改进开源协议（2年商用保护期）。V4 引入 &lt;strong&gt;Hooks (钩子)&lt;/strong&gt; 和 &lt;strong&gt;Singleton 架构&lt;/strong&gt;，旨在成为更快、更省 Gas、更易集成的 DeFi 基础设施。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-uniswap-简介与重要性&#34;&gt;&lt;span&gt;1. Uniswap 简介与重要性&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-uniswap-%e7%ae%80%e4%bb%8b%e4%b8%8e%e9%87%8d%e8%a6%81%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;本系列将以 Uniswap 为主线，深入讲解其 V2、V3、V4 版本。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;深度理解 DeFi：&lt;/strong&gt; 大部分人对于Uniswap仅停留在 &lt;code&gt;X * Y = K&lt;/code&gt; 的肤浅认知。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;创新驱动：&lt;/strong&gt; Uniswap 团队是业界极具创新力的团队，与多数仅靠营销的项目不同。它为行业带来了巨大的变革和创新。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;DeFi 基础设施：&lt;/strong&gt; 如果只了解一个区块链项目，那必须是 Uniswap。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;2-uniswap-v1恒定乘积做市商的诞生&#34;&gt;&lt;span&gt;2. Uniswap V1：恒定乘积做市商的诞生&lt;/span&gt;&#xA;  &lt;a href=&#34;#2-uniswap-v1%e6%81%92%e5%ae%9a%e4%b9%98%e7%a7%af%e5%81%9a%e5%b8%82%e5%95%86%e7%9a%84%e8%af%9e%e7%94%9f&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;诞生时间：&lt;/strong&gt; 2017年6月22日，Vitalik Buterin 发表文章。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Vitalik 的文章：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;标题：&lt;/strong&gt; &amp;ldquo;On Path Independence&amp;rdquo;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心思想：&lt;/strong&gt; 提出无需订单簿模式也能完成代币互换 (swap) 的方案。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;数学机制：&lt;/strong&gt; 基于 &lt;strong&gt;恒定乘积做市商 (Constant Product Market Maker, CPMM)&lt;/strong&gt; 模型，即：&#xA;$$&#xA;X \cdot Y = K&#xA;$$&#xA;其中，$X$ 和 $Y$ 分别代表两种代币的储备量，$K$ 是一个常数。价格波动通过曲线上代币余额的变化来体现。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Hayden Adams 的实现：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;背景故事：&lt;/strong&gt; 曾是西门子机械工程师，被解雇后在好友 Karl 的建议下开始学习以太坊和智能合约开发。Hayden 在《A Short History of Uniswap》中记录了这段经历。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;对话案例：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Hayden: &amp;ldquo;我刚被开除了&amp;hellip;&amp;rdquo;&lt;/li&gt;&#xA;&lt;li&gt;Karl: &amp;ldquo;恭喜你！这是你身上发生的最好的事情了！以太坊是未来，你的新使命就是写智能合约。&amp;rdquo;&lt;/li&gt;&#xA;&lt;li&gt;Hayden: &amp;ldquo;我也不知道怎么写代码啊&amp;hellip;&amp;rdquo;&lt;/li&gt;&#xA;&lt;li&gt;Karl: &amp;ldquo;没事，写代码很简单，而且那个时候（2017年）也没人知道怎么写智能合约，学学就好了。&amp;rdquo;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;开发历程：&lt;/strong&gt; 学习 Solidity 和 JavaScript 两个月后开始编写代码，并与团队伙伴共同尝试实现 Vitalik 的公式。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;部署与初期影响：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;部署时间：&lt;/strong&gt; 2018年11月2日，在 &lt;strong&gt;伊斯坦布尔会议&lt;/strong&gt; 期间正式部署到以太坊主网。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;市场环境：&lt;/strong&gt; 处于熊市 (比特币价格约 $3000-$4000，此前高峰 $20000)，因此 V1 发布后并未引起广泛关注。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;开发语言：&lt;/strong&gt; 使用 &lt;strong&gt;Viper&lt;/strong&gt; 语言编写 (类似 Python)，由 Vitalik 建议。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;V1 的局限性：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;仅支持 ERC20-ETH 互换：&lt;/strong&gt; 所有流动性池都必须是 ERC20 代币与 ETH 的配对。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例：&lt;/strong&gt; 若要将 DAI 兑换为 USDC，必须先将 DAI 兑换为 ETH，再将 ETH 兑换为 USDC，需要两次交易。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;合约结构：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;UniswapExchange&lt;/code&gt;：负责代币互换逻辑，代码逻辑简单，约 &lt;strong&gt;490行&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;UniswapFactory&lt;/code&gt;：负责创建新的交易对。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;特点：&lt;/strong&gt; 合约代码简洁，被视为“历史遗迹”。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;名字由来：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;最初内部名称：&lt;/strong&gt; UniPeg (铆钉)。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Vitalik 建议：&lt;/strong&gt; UniSwap。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Logo：&lt;/strong&gt; 独角兽 (Unicorn)。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;3-uniswap-v2引爆-defi-赛道&#34;&gt;&lt;span&gt;3. Uniswap V2：引爆 DeFi 赛道&lt;/span&gt;&#xA;  &lt;a href=&#34;#3-uniswap-v2%e5%bc%95%e7%88%86-defi-%e8%b5%9b%e9%81%93&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;发布时间：&lt;/strong&gt; 2020年5月。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心特性：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;ERC20-ERC20 直接互换：&lt;/strong&gt; 允许任意两种 ERC20 代币直接组成流动性池 (例如 DAI-USDC 池)，无需通过 ETH 中转。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;闪电贷 (Flash Swaps)：&lt;/strong&gt; 允许用户在同一笔交易中借入资产、使用、并归还，无需抵押品。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;价格预言机 (Price Oracles)：&lt;/strong&gt; 提供链上价格数据，供其他 DeFi 协议使用。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;改进手续费设计。&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;对 DeFi 行业的影响 (引爆 DeFi)：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;数据案例：&lt;/strong&gt; 2020年5月 V2 发布后，DeFi 领域的 &lt;strong&gt;总锁仓量 (TVL)&lt;/strong&gt; 从平稳状态迅速飙升，并在2021年达到约2000亿美元的峰值。V2 的发布是这一增长的起点。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;个人经历案例：&lt;/strong&gt; 2020年7月，老师的朋友主动联系讨论 Fork Uniswap，显示了 V2 巨大的市场热度。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;31-uniswap-与-sushiswap-的竞争uni-代币的诞生&#34;&gt;&lt;span&gt;3.1 Uniswap 与 SushiSwap 的竞争：UNI 代币的诞生&lt;/span&gt;&#xA;  &lt;a href=&#34;#31-uniswap-%e4%b8%8e-sushiswap-%e7%9a%84%e7%ab%9e%e4%ba%89uni-%e4%bb%a3%e5%b8%81%e7%9a%84%e8%af%9e%e7%94%9f&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;背景：&lt;/strong&gt; Uniswap V2 采用宽松的开源协议，允许任何人商用其代码。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;SushiSwap (2020年8月发布)：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;策略：&lt;/strong&gt; Fork Uniswap V2 代码，并在此基础上增加了对 &lt;strong&gt;流动性提供者 (LP) 的奖励&lt;/strong&gt; (即&lt;strong&gt;流动性挖矿&lt;/strong&gt;)。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;影响：&lt;/strong&gt; 通过 SUSHI 代币的激励，SushiSwap 从 Uniswap 挖走了数十亿美元的流动性，对 Uniswap 造成巨大冲击。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap 的反击 (2020年9月)：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;发行 UNI 代币：&lt;/strong&gt; 作为治理代币。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;空投：&lt;/strong&gt; 向所有在特定时间点前使用过 Uniswap 的地址空投 &lt;strong&gt;400个 UNI 代币&lt;/strong&gt;。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;价值案例：&lt;/strong&gt; 以当前价格 $7/UNI 计算，空投价值 $2800。历史最高价曾达 $40/UNI。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;意义：&lt;/strong&gt; 这是 Uniswap 团队夺回劳动成果、反击抄袭者的一种方式。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Hayden Adams 的理念与团队风格：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;反浮躁：&lt;/strong&gt; 批评加密货币领域过度炒作、高估值（例如：“不是所有项目一发布就必须成为独角兽”）。他认为，一个项目在百万到十亿级别（$10^7 \sim 10^9$）的市场估值已是非常了不起的成就。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;注重实际价值：&lt;/strong&gt; 认为项目估值应基于实际成就，而非短期炒作。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;团队风格：&lt;/strong&gt; Uniswap 团队秉持踏实、有远见的风格，不追求短期利益和泡沫，不频繁喊单，因此能够走得更远，成为行业创新的引领者。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;4-uniswap-v3资本效率的飞跃&#34;&gt;&lt;span&gt;4. Uniswap V3：资本效率的飞跃&lt;/span&gt;&#xA;  &lt;a href=&#34;#4-uniswap-v3%e8%b5%84%e6%9c%ac%e6%95%88%e7%8e%87%e7%9a%84%e9%a3%9e%e8%b7%83&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;发布时间：&lt;/strong&gt; 2021年5月。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心特性：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;集中流动性 (Concentrated Liquidity)：&lt;/strong&gt; 允许 LP 将其流动性集中在特定的价格区间内，显著提高资本效率。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;优化手续费设置：&lt;/strong&gt; 提供多层手续费选项。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;LP Token 作为 NFT：&lt;/strong&gt; 流动性提供者代币 (LPT) 从 ERC20 形式改为 NFT 形式，以支持集中流动性的复杂性。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;改进开源协议：&lt;/strong&gt; 引入 &lt;strong&gt;2年商业使用保护期&lt;/strong&gt;。在此期间，社区成员可学习代码，但禁止直接 Fork 并发布商用产品。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;市场影响：&lt;/strong&gt; 2023年5月保护期结束后，许多 DEX 纷纷宣布“更新到 V3”，实则抄袭了 Uniswap V3 的代码。市场会通过自我纠错机制，最终认可创新而非简单的抄袭。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;5-uniswap-v4-草案基础设施愿景&#34;&gt;&lt;span&gt;5. Uniswap V4 (草案)：基础设施愿景&lt;/span&gt;&#xA;  &lt;a href=&#34;#5-uniswap-v4-%e8%8d%89%e6%a1%88%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd%e6%84%bf%e6%99%af&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;代码草案发布时间：&lt;/strong&gt; 2023年6月23日。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心特性：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Hooks (钩子)：&lt;/strong&gt; 允许开发者在 Uniswap 协议的固定操作点 (如 &lt;code&gt;beforeSwap&lt;/code&gt;, &lt;code&gt;afterSwap&lt;/code&gt;) 插入自定义逻辑。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;案例：&lt;/strong&gt; 可用于创建带有 KYC 验证的去中心化交易所 (在 Swap 前调用 Hook 检查地址的 KYC 信息)。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Singleton 架构：&lt;/strong&gt; 将所有交易对部署在一个合约中，而非每个交易对一个合约，显著降低部署成本和 Gas 费用。解决了 V2/V3 中每个交易对都需要独立部署合约的问题。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;重新引入原生 ETH 支持 (Reintroduction of Native ETH)：&lt;/strong&gt; V4 将再次支持原生 ETH，无需 WETH 中转。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Flash Accounting。&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;目标：&lt;/strong&gt; 成为一个更快、更省 Gas、更易集成、更具可扩展性的 DeFi 领域基础设施平台。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;6-核心概念解析eth-erc20-weth&#34;&gt;&lt;span&gt;6. 核心概念解析：ETH, ERC20, WETH&lt;/span&gt;&#xA;  &lt;a href=&#34;#6-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5%e8%a7%a3%e6%9e%90eth-erc20-weth&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;ETH (以太坊原生代币)：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;定义：&lt;/strong&gt; 以太坊区块链的原生代币，用于支付 Gas 费用。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;ERC20 兼容性：&lt;/strong&gt; &lt;strong&gt;不符合&lt;/strong&gt; ERC20 标准。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;原因：&lt;/strong&gt; ETH 早于 ERC20 标准诞生。它没有 &lt;code&gt;approve&lt;/code&gt;、&lt;code&gt;transferFrom&lt;/code&gt; 等 ERC20 标准中定义的函数。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;转账方式：&lt;/strong&gt; 在智能合约中，转账原生 ETH 通常使用 &lt;code&gt;address.transfer()&lt;/code&gt; 或 &lt;code&gt;address.call{value: ...}()&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;ERC20 (代币标准)：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;定义：&lt;/strong&gt; 以太坊上的第20个改进提案 (EIP-20) 提出的一种代币协议标准。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;功能：&lt;/strong&gt; 规定了代币必须实现的一系列函数 (如 &lt;code&gt;transfer&lt;/code&gt;, &lt;code&gt;transferFrom&lt;/code&gt;, &lt;code&gt;approve&lt;/code&gt;, &lt;code&gt;balanceOf&lt;/code&gt;) 和事件 (如 &lt;code&gt;Transfer&lt;/code&gt;, &lt;code&gt;Approval&lt;/code&gt;)。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;目的：&lt;/strong&gt; 确保不同代币之间的互操作性。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;WETH (Wrapped ETH / 封装的 ETH)：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;定义：&lt;/strong&gt; 将原生 ETH “封装”成符合 ERC20 标准的代币。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;作用：&lt;/strong&gt; 由于 Uniswap V2 和 V3 等 DEX 主要支持 ERC20 代币之间的交易，原生 ETH 无法直接参与。&lt;strong&gt;WETH 使得 ETH 能够以 ERC20 的形式在这些智能合约和 DeFi 协议中使用。&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;历史版本支持：&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V1：&lt;/strong&gt; 支持原生 ETH。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V2/V3：&lt;/strong&gt; &lt;strong&gt;依赖 WETH&lt;/strong&gt; 才能与 ERC20 代币配对。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Uniswap V4：&lt;/strong&gt; 重新引入对原生 ETH 的支持。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;7-uniswap-v2-与-sushiswap-竞争时序图&#34;&gt;&lt;span&gt;7. Uniswap V2 与 SushiSwap 竞争时序图&lt;/span&gt;&#xA;  &lt;a href=&#34;#7-uniswap-v2-%e4%b8%8e-sushiswap-%e7%ab%9e%e4%ba%89%e6%97%b6%e5%ba%8f%e5%9b%be&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;以下 Mermaid 时序图展示了 Uniswap V2 发布后，SushiSwap 如何通过 Fork 代码和流动性挖矿与 Uniswap 竞争，以及 Uniswap 如何通过发行 UNI 代币反击的过程。&lt;/p&gt;</description>
    </item>
    <item>
      <title>去中心化借贷</title>
      <link>http://localhost:1313/posts/202509-jiedai/</link>
      <pubDate>Sat, 30 Aug 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-jiedai/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;&lt;strong&gt;核心摘要 (Key Takeaways)&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;核心机制&lt;/strong&gt;：去中心化借贷协议本质上是一个资金池，&lt;strong&gt;存款人 (Lender)&lt;/strong&gt; 提供闲置资产赚取利息，&lt;strong&gt;借款人 (Borrower)&lt;/strong&gt; 通过超额抵押资产来借出其他资产，整个过程由智能合约自动执行。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;动态利率模型&lt;/strong&gt;：借贷利率并非固定不变，而是由&lt;strong&gt;资金使用率 (Utilization Rate)&lt;/strong&gt; 动态调节。当资金池中大量资产被借出时（使用率高），利率会自动升高以抑制借款、鼓励存款；反之则降低利率。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;安全基石：超额抵押与清算&lt;/strong&gt;：为应对加密资产的价格波动，所有借款都必须&lt;strong&gt;超额抵押&lt;/strong&gt;。协议通过&lt;strong&gt;健康因子 (Health Factor)&lt;/strong&gt; 监控每笔贷款的风险。一旦抵押物价值跌破&lt;strong&gt;清算阈值&lt;/strong&gt;，&lt;strong&gt;监控者 (Keeper)&lt;/strong&gt; 会触发清算程序（如拍卖或市场售出）以保护存款人的资金。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;关键外部依赖：预言机 (Oracle)&lt;/strong&gt;：协议需要&lt;strong&gt;预言机&lt;/strong&gt;来获取抵押物和借出资产的实时价格，以准确计算健康因子。因此，预言机的稳定性和安全性至关重要，是协议最主要的攻击点之一，对于黑客来说，&lt;strong&gt;预言机就是提款机&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;记账方式的演进&lt;/strong&gt;：协议通过向存款人发放&lt;strong&gt;凭证Token&lt;/strong&gt;（如Compound的cToken）来代表其在资金池中的份额。这种方式相比传统的复式记账法，极大地简化了利息计算和用户资产追踪。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-去中心化借贷的核心价值与传统对比&#34;&gt;&lt;span&gt;&lt;strong&gt;1. 去中心化借贷的核心价值与传统对比&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e5%8e%bb%e4%b8%ad%e5%bf%83%e5%8c%96%e5%80%9f%e8%b4%b7%e7%9a%84%e6%a0%b8%e5%bf%83%e4%bb%b7%e5%80%bc%e4%b8%8e%e4%bc%a0%e7%bb%9f%e5%af%b9%e6%af%94&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;11-为什么需要借贷&#34;&gt;&lt;span&gt;&lt;strong&gt;1.1. 为什么需要借贷？&lt;/strong&gt;&lt;/span&gt;&#xA;  &lt;a href=&#34;#11-%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e5%80%9f%e8%b4%b7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;借贷是源远流长的金融活动，核心在于&lt;strong&gt;提高资金利用效率&lt;/strong&gt;和&lt;strong&gt;满足流动性需求&lt;/strong&gt;，而非简单地“没钱才借”。&lt;/p&gt;</description>
    </item>
    <item>
      <title>恒定乘积自动做市商 (CPAMM) 学习笔记</title>
      <link>http://localhost:1313/posts/202509-amm/</link>
      <pubDate>Sat, 30 Aug 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202509-amm/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;恒定乘积自动做市商-cpamm-学习笔记&#34;&gt;&lt;span&gt;恒定乘积自动做市商 (CPAMM) 学习笔记&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%81%92%e5%ae%9a%e4%b9%98%e7%a7%af%e8%87%aa%e5%8a%a8%e5%81%9a%e5%b8%82%e5%95%86-cpamm-%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;核心摘要-key-takeaways&#34;&gt;&lt;span&gt;核心摘要 (Key Takeaways)&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a0%b8%e5%bf%83%e6%91%98%e8%a6%81-key-takeaways&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;CPAMM 核心公式&lt;/strong&gt;：$X \times Y = K$ 是恒定乘积自动做市商（Constant Product Automated Market Maker, CPAMM）的核心，它定义了去中心化交易所（DEX）中流动性池中两种资产数量的关系。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;DEFI 基石&lt;/strong&gt;：该公式是 2020-2021 年 DEFI 浪潮的起点，支撑了数百亿美元的 DEFI 市值发展，实现了无需中心化对手方的代币交换。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;交换中的 K 值恒定&lt;/strong&gt;：在用户进行代币买卖（Swap）时，池子的总流动性 $K$ 保持不变，但池中两种代币的比例会根据交易量动态调整。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;滑点 (Slippage)&lt;/strong&gt;：交易量相对于池子总流动性的比例越大，交易产生的滑点就越大，导致实际成交价格偏离预期市场价格。用户在交易时可设置&lt;strong&gt;滑点容忍度&lt;/strong&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;流动性提供者 (LP)&lt;/strong&gt;：用户可以通过向池子提供两种代币，成为流动性提供者，获得 LP 凭证 (LPT) 并赚取交易手续费；添加和移除流动性会改变 $K$ 值。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;1-恒定乘积自动做市商-cpamm-核心原理&#34;&gt;&lt;span&gt;1. 恒定乘积自动做市商 (CPAMM) 核心原理&lt;/span&gt;&#xA;  &lt;a href=&#34;#1-%e6%81%92%e5%ae%9a%e4%b9%98%e7%a7%af%e8%87%aa%e5%8a%a8%e5%81%9a%e5%b8%82%e5%95%86-cpamm-%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;1.1 定义与核心公式&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Shade BIOSUnleashing the Full Stealth of UEFI Malware</title>
      <link>http://localhost:1313/posts/202508-shadebiods/</link>
      <pubDate>Sun, 17 Aug 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202508-shadebiods/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;技术深度分析报告shade-bios-unleashing-the-full-stealth-of-uefi-malware&#34;&gt;&lt;span&gt;技术深度分析报告：Shade BIOS: Unleashing the Full Stealth of UEFI Malware&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%8a%80%e6%9c%af%e6%b7%b1%e5%ba%a6%e5%88%86%e6%9e%90%e6%8a%a5%e5%91%8ashade-bios-unleashing-the-full-stealth-of-uefi-malware&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;1. 摘要与背景设定 (Executive Summary &amp;amp; Stage Setting)&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Solidity 101</title>
      <link>http://localhost:1313/posts/202508-solidity101/</link>
      <pubDate>Fri, 01 Aug 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202508-solidity101/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;p&gt;学习&lt;a href=&#34;https://www.wtf.academy/zh/course/solidity101/HelloWeb3&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Solidity 101&lt;/a&gt; 记录&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;Solidity&lt;/code&gt; 是一种用于编写以太坊虚拟机（EVM）智能合约的编程语言。&lt;/p&gt;&#xA;&lt;h1 class=&#34;heading-element&#34; id=&#34;开发工具&#34;&gt;&lt;span&gt;开发工具&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;本教程中，我们将使用 Remix 运行 Solidity 合约。Remix 是以太坊官方推荐的智能合约集成开发环境（IDE），适合新手，可以在浏览器中快速开发和部署合约，无需在本地安装任何程序。网址：https://remix.ethereum.org&lt;/p&gt;</description>
    </item>
    <item>
      <title>Solidity 102</title>
      <link>http://localhost:1313/posts/202508-solidity102/</link>
      <pubDate>Fri, 01 Aug 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/202508-solidity102/</guid>
      <category domain="http://localhost:1313/categories/technology/">Technology</category>
      <description>&lt;h1 class=&#34;heading-element&#34; id=&#34;函数重载&#34;&gt;&lt;span&gt;函数重载&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%87%bd%e6%95%b0%e9%87%8d%e8%bd%bd&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;和C++中的一样：参数返回值不同，函数名相同。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
